%!PS-Adobe-2.0
%%DocumentFonts: Courier Times-Bold
%%Title: <stdin> (mpage)
%%Creator: mpage 2.5.6 Januari 2008
%%CreationDate: Thu Apr  9 17:56:16 2009
%%Orientation: Landscape
%%DocumentMedia: Letter 612 792
%%BoundingBox: 18 50 594 742
%%Pages: (atend)
%%EndComments

%%BeginProlog

/mp_stm usertime def
/mp_pgc statusdict begin pagecount end def
statusdict begin /jobname (<stdin>) def end
statusdict /setduplexmode known { statusdict begin true setduplexmode end } if
statusdict /settumble known { statusdict begin true settumble end } if
/reencsmalldict 12 dict def /ReEncodeSmall { reencsmalldict begin
/newcodesandnames exch def /newfontname exch def /basefontname exch def
/basefontdict basefontname findfont def /newfont basefontdict maxlength dict def
basefontdict { exch dup /FID ne { dup /Encoding eq { exch dup length array copy newfont 3 1 roll put } { exch newfont 3 1 roll put }
ifelse }
  { pop pop }
  ifelse } forall
newfont /FontName newfontname put
newcodesandnames aload pop newcodesandnames length 2 idiv
{ newfont /Encoding get 3 1 roll put } repeat
newfontname newfont definefont pop end } def
/charvec [
026 /Scaron
027 /Ydieresis
028 /Zcaron
029 /scaron
030 /trademark
031 /zcaron
032 /space
033 /exclam
034 /quotedbl
035 /numbersign
036 /dollar
037 /percent
038 /ampersand
039 /quoteright
040 /parenleft
041 /parenright
042 /asterisk
043 /plus
044 /comma
045 /minus
046 /period
047 /slash
048 /zero
049 /one
050 /two
051 /three
052 /four
053 /five
054 /six
055 /seven
056 /eight
057 /nine
058 /colon
059 /semicolon
060 /less
061 /equal
062 /greater
063 /question
064 /at
065 /A
066 /B
067 /C
068 /D
069 /E
070 /F
071 /G
072 /H
073 /I
074 /J
075 /K
076 /L
077 /M
078 /N
079 /O
080 /P
081 /Q
082 /R
083 /S
084 /T
085 /U
086 /V
087 /W
088 /X
089 /Y
090 /Z
091 /bracketleft
092 /backslash
093 /bracketright
094 /asciicircum
095 /underscore
096 /quoteleft
097 /a
098 /b
099 /c
100 /d
101 /e
102 /f
103 /g
104 /h
105 /i
106 /j
107 /k
108 /l
109 /m
110 /n
111 /o
112 /p
113 /q
114 /r
115 /s
116 /t
117 /u
118 /v
119 /w
120 /x
121 /y
122 /z
123 /braceleft
124 /bar
125 /braceright
126 /asciitilde
127 /.notdef
128 /fraction
129 /florin
130 /quotesingle
131 /quotedblleft
132 /guilsinglleft
133 /guilsinglright
134 /fi
135 /fl
136 /endash
137 /dagger
138 /daggerdbl
139 /bullet
140 /quotesinglbase
141 /quotedblbase
142 /quotedblright
143 /ellipsis
144 /dotlessi
145 /grave
146 /acute
147 /circumflex
148 /tilde
149 /oe
150 /breve
151 /dotaccent
152 /perthousand
153 /emdash
154 /ring
155 /Lslash
156 /OE
157 /hungarumlaut
158 /ogonek
159 /caron
160 /lslash
161 /exclamdown
162 /cent
163 /sterling
164 /currency
165 /yen
166 /brokenbar
167 /section
168 /dieresis
169 /copyright
170 /ordfeminine
171 /guillemotleft
172 /logicalnot
173 /hyphen
174 /registered
175 /macron
176 /degree
177 /plusminus
178 /twosuperior
179 /threesuperior
180 /acute
181 /mu
182 /paragraph
183 /periodcentered
184 /cedilla
185 /onesuperior
186 /ordmasculine
187 /guillemotright
188 /onequarter
189 /onehalf
190 /threequarters
191 /questiondown
192 /Agrave
193 /Aacute
194 /Acircumflex
195 /Atilde
196 /Adieresis
197 /Aring
198 /AE
199 /Ccedilla
200 /Egrave
201 /Eacute
202 /Ecircumflex
203 /Edieresis
204 /Igrave
205 /Iacute
206 /Icircumflex
207 /Idieresis
208 /Eth
209 /Ntilde
210 /Ograve
211 /Oacute
212 /Ocircumflex
213 /Otilde
214 /Odieresis
215 /multiply
216 /Oslash
217 /Ugrave
218 /Uacute
219 /Ucircumflex
220 /Udieresis
221 /Yacute
222 /Thorn
223 /germandbls
224 /agrave
225 /aacute
226 /acircumflex
227 /atilde
228 /adieresis
229 /aring
230 /ae
231 /ccedilla
232 /egrave
233 /eacute
234 /ecircumflex
235 /edieresis
236 /igrave
237 /iacute
238 /icircumflex
239 /idieresis
240 /eth
241 /ntilde
242 /ograve
243 /oacute
244 /ocircumflex
245 /otilde
246 /odieresis
247 /divide
248 /oslash
249 /ugrave
250 /uacute
251 /ucircumflex
252 /udieresis
253 /yacute
254 /thorn
255 /ydieresis
] def
/Courier /OurCharSet charvec ReEncodeSmall
/textfont /OurCharSet findfont 11 scalefont def
/textfontbold /OurCharSet-Bold findfont 11 scalefont def
/fnamefont /Times-Bold findfont 14 scalefont def
/headerfont /Times-Bold findfont 12 scalefont def
textfont setfont
(a) stringwidth pop /mp_a_x exch def
/unigb /BousungEG-Light-GB-UniGB-UTF8-H findfont 11 scalefont def
%%EndProlog
%%BeginSetup
%%BeginFeature: *Duplex DuplexTumble
<< /Duplex true /Tumble true >> setpagedevice
%%EndFeature
%%EndSetup
%%Page: 1 1
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  README  Page 1) show
0 648 moveto (xv6 is a re-implementation of Dennis Ritchie's and Ken Thompson's Unix) show
0 636 moveto (Version 6 \(v6\).  xv6 loosely follows the structure and style of v6,) show
0 624 moveto (but is implemented for a modern x86-based multiprocessor using ANSI C.) show
0 600 moveto (ACKNOWLEDGMENTS) show
0 576 moveto (xv6 is inspired by John Lions's Commentary on UNIX 6th Edition \(Peer) show
0 564 moveto (to Peer Communications; ISBN: 1-57398-013-7; 1st edition \(June 14,) show
0 552 moveto (2000\)\). See also http://pdos.csail.mit.edu/6.828/2007/v6.html, which) show
0 540 moveto (provides pointers to on-line resources for v6.) show
0 516 moveto (xv6 borrows code from the following sources:) show
4 mp_a_x mul 504 moveto (JOS \(asm.h, elf.h, mmu.h, bootasm.S, ide.c, console.c, and others\)) show
4 mp_a_x mul 492 moveto (Plan 9 \(bootother.S, mp.h, mp.c, lapic.c\)) show
4 mp_a_x mul 480 moveto (FreeBSD \(ioapic.c\)) show
4 mp_a_x mul 468 moveto (NetBSD \(console.c\)) show
0 444 moveto (The following people made contributions:) show
4 mp_a_x mul 432 moveto (Russ Cox \(context switching, locking\)) show
4 mp_a_x mul 420 moveto (Cliff Frey \(MP\)) show
4 mp_a_x mul 408 moveto (Xiao Yu \(MP\)) show
0 384 moveto (The code in the files that constitute xv6 is) show
0 372 moveto (Copyright 2006-2007 Frans Kaashoek, Robert Morris, and Russ Cox.) show
0 348 moveto (ERROR REPORTS) show
0 324 moveto (If you spot errors or have suggestions for improvement, please send) show
0 312 moveto (email to Frans Kaashoek and Robert Morris \(kaashoek,rtm@csail.mit.edu\). ) show
0 288 moveto (BUILDING AND RUNNING XV6) show
0 264 moveto (To build xv6 on an x86 ELF machine \(like Linux or FreeBSD\), run "make".) show
0 252 moveto (On non-x86 or non-ELF machines \(like OS X, even on x86\), you will) show
0 240 moveto (need to install a cross-compiler gcc suite capable of producing x86 ELF) show
0 228 moveto (binaries.  See http://pdos.csail.mit.edu/6.828/2007/tools.html.) show
0 216 moveto (Then run "make TOOLPREFIX=i386-jos-elf-".) show
0 192 moveto (To run xv6, you can use Bochs or QEMU, both PC simulators.) show
0 180 moveto (Bochs makes debugging easier, but QEMU is much faster. ) show
0 168 moveto (To run in Bochs, run "make bochs" and then type "c" at the bochs prompt.) show
0 156 moveto (To run in QEMU, run "make qemu".  Both log the xv6 screen output to ) show
0 144 moveto (standard output.) show
0 120 moveto (To create a typeset version of the code, run "make xv6.pdf".) show
0 108 moveto (This requires the "mpage" text formatting utility.) show
0 96 moveto (See http://www.mesa.nl/pub/mpage/.) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  table of contents  Page 1) show
0 648 moveto (The numbers to the left of the file names in the table are sheet numbers.) show
0 636 moveto (The source code has been printed in a double column format with fifty) show
0 624 moveto (lines per column, giving one hundred lines per sheet \(or page\).) show
0 612 moveto (Thus there is a convenient relationship between line numbers and sheet numbers.) show
0 576 moveto (# basic headers) show
24 mp_a_x mul 576 moveto (27 kalloc.c) show
48 mp_a_x mul 576 moveto (61 pipe.c) show
0 564 moveto (01 types.h) show
24 mp_a_x mul 564 moveto (29 thread.h) show
0 552 moveto (01 param.h) show
24 mp_a_x mul 552 moveto (29 thread.c) show
48 mp_a_x mul 552 moveto (# string operations) show
0 540 moveto (02 defs.h) show
48 mp_a_x mul 540 moveto (63 string.c) show
0 528 moveto (04 x86.h) show
24 mp_a_x mul 528 moveto (# system calls) show
0 516 moveto (06 asm.h) show
24 mp_a_x mul 516 moveto (30 traps.h) show
48 mp_a_x mul 516 moveto (# low-level hardware) show
0 504 moveto (06 mmu.h) show
24 mp_a_x mul 504 moveto (31 vectors.pl) show
48 mp_a_x mul 504 moveto (64 mp.h) show
0 492 moveto (08 elf.h) show
24 mp_a_x mul 492 moveto (31 trapasm.S) show
48 mp_a_x mul 492 moveto (65 mp.c) show
24 mp_a_x mul 480 moveto (32 trap.c) show
48 mp_a_x mul 480 moveto (67 lapic.c) show
0 468 moveto (# startup) show
24 mp_a_x mul 468 moveto (33 syscall.h) show
48 mp_a_x mul 468 moveto (68 ioapic.c) show
0 456 moveto (09 bootasm.S) show
24 mp_a_x mul 456 moveto (34 syscall.c) show
48 mp_a_x mul 456 moveto (69 picirq.h) show
0 444 moveto (10 bootother.S) show
24 mp_a_x mul 444 moveto (36 sysproc.c) show
48 mp_a_x mul 444 moveto (70 picirq.c) show
0 432 moveto (11 bootmain.c) show
48 mp_a_x mul 432 moveto (71 kbd.h) show
0 420 moveto (12 main.c) show
24 mp_a_x mul 420 moveto (# file system) show
48 mp_a_x mul 420 moveto (73 kbd.c) show
24 mp_a_x mul 408 moveto (39 buf.h) show
48 mp_a_x mul 408 moveto (73 console.c) show
0 396 moveto (# locks) show
24 mp_a_x mul 396 moveto (40 dev.h) show
48 mp_a_x mul 396 moveto (79 timer.c) show
0 384 moveto (14 spinlock.h) show
24 mp_a_x mul 384 moveto (40 fcntl.h) show
48 mp_a_x mul 384 moveto (79 pci.h) show
0 372 moveto (15 spinlock.c) show
24 mp_a_x mul 372 moveto (41 stat.h) show
48 mp_a_x mul 372 moveto (80 pcireg.h) show
0 360 moveto (16 sem.h) show
24 mp_a_x mul 360 moveto (41 file.h) show
48 mp_a_x mul 360 moveto (87 pci.c) show
0 348 moveto (17 sem.c) show
24 mp_a_x mul 348 moveto (42 fs.h) show
48 mp_a_x mul 348 moveto (91 e100.h) show
24 mp_a_x mul 336 moveto (43 fsvar.h) show
48 mp_a_x mul 336 moveto (93 e100.c) show
0 324 moveto (# asserts) show
24 mp_a_x mul 324 moveto (43 ide.c) show
0 312 moveto (18 assert.h) show
24 mp_a_x mul 312 moveto (45 bio.c) show
48 mp_a_x mul 312 moveto (# user-level) show
0 300 moveto (19 assert.c) show
24 mp_a_x mul 300 moveto (47 fs.c) show
48 mp_a_x mul 300 moveto (100 initcode.S) show
24 mp_a_x mul 288 moveto (54 file.c) show
48 mp_a_x mul 288 moveto (100 init.c) show
0 276 moveto (# processes) show
24 mp_a_x mul 276 moveto (56 sysfile.c) show
48 mp_a_x mul 276 moveto (101 usys.S) show
0 264 moveto (19 proc.h) show
24 mp_a_x mul 264 moveto (60 exec.c) show
48 mp_a_x mul 264 moveto (101 sh.c) show
0 252 moveto (20 proc.c) show
0 240 moveto (26 swtch.S) show
24 mp_a_x mul 240 moveto (# pipes) show
0 204 moveto (The source listing is preceded by a cross-reference that lists every defined ) show
0 192 moveto (constant, struct, global variable, and function in xv6.  Each entry gives,) show
0 180 moveto (on the same line as the name, the line number \(or, in a few cases, numbers\)) show
0 168 moveto (where the name is defined.  Successive lines in an entry list the line) show
0 156 moveto (numbers where the name is used.  For example, this entry:) show
4 mp_a_x mul 132 moveto (swtch 2256) show
8 mp_a_x mul 120 moveto (0311 1928 1962 2255) show
8 mp_a_x mul 108 moveto (2256) show
0 84 moveto (indicates that swtch is defined on line 2256 and is mentioned on five lines) show
0 72 moveto (on sheets 03, 19, and 22.) show
grestore
restore
showpage
%%Page: 2 2
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 1) show
0 648 moveto (acquire 1526) show
36 mp_a_x mul 648 moveto (BACKSPACE 7368) show
4 mp_a_x mul 636 moveto (0328 1526 1539 1729 1740) show
40 mp_a_x mul 636 moveto (7368 7386 7413 7706 7712) show
4 mp_a_x mul 624 moveto (1754 1775 1791 2084 2247) show
36 mp_a_x mul 624 moveto (balloc 4767) show
4 mp_a_x mul 612 moveto (2295 2327 2353 2376 2391) show
40 mp_a_x mul 612 moveto (4767 4789 5069 5080 5090) show
4 mp_a_x mul 600 moveto (2432 2442 2458 2496 2528) show
36 mp_a_x mul 600 moveto (BBLOCK 4246) show
4 mp_a_x mul 588 moveto (2771 2820 3253 3671 4456) show
40 mp_a_x mul 588 moveto (4246 4777 4812) show
4 mp_a_x mul 576 moveto (4493 4613 4679 4873 4908) show
36 mp_a_x mul 576 moveto (bfree 4802) show
4 mp_a_x mul 564 moveto (4924 4957 4967 4977 5473) show
40 mp_a_x mul 564 moveto (4802 5110 5120) show
4 mp_a_x mul 552 moveto (5490 5506 6212 6231 6255) show
36 mp_a_x mul 552 moveto (bget 4609) show
4 mp_a_x mul 540 moveto (7543 7671 7696 7793 9615) show
40 mp_a_x mul 540 moveto (4609 4640 4656) show
4 mp_a_x mul 528 moveto (9806 9937) show
36 mp_a_x mul 528 moveto (binit 4588) show
0 516 moveto (allocproc 2079) show
40 mp_a_x mul 516 moveto (0213 1286 4588) show
4 mp_a_x mul 504 moveto (0308 2079 2160 2967) show
36 mp_a_x mul 504 moveto (bmap 5060) show
0 492 moveto (alltraps 3156) show
40 mp_a_x mul 492 moveto (5060 5097 5170 5201 5237) show
4 mp_a_x mul 480 moveto (3110 3118 3132 3137 3155) show
36 mp_a_x mul 480 moveto (bootmain 1167) show
4 mp_a_x mul 468 moveto (3156) show
40 mp_a_x mul 468 moveto (1018 1167) show
0 456 moveto (ALT 7160) show
36 mp_a_x mul 456 moveto (bootothers 1351) show
4 mp_a_x mul 444 moveto (7160 7188 7190) show
40 mp_a_x mul 444 moveto (1258 1308 1351) show
0 432 moveto (argfd 5614) show
36 mp_a_x mul 432 moveto (BPB 4243) show
4 mp_a_x mul 420 moveto (5614 5657 5669 5680 5694) show
40 mp_a_x mul 420 moveto (4243 4246 4776 4778 4813) show
4 mp_a_x mul 408 moveto (5706) show
36 mp_a_x mul 408 moveto (bread 4652) show
0 396 moveto (argint 3444) show
40 mp_a_x mul 396 moveto (0214 4652 4734 4757 4777) show
4 mp_a_x mul 384 moveto (0345 3444 3458 3474 3636) show
40 mp_a_x mul 384 moveto (4812 4931 5012 5033 5082) show
4 mp_a_x mul 372 moveto (3656 3669 3706 3719 3731) show
40 mp_a_x mul 372 moveto (5116 5170 5201 5237) show
4 mp_a_x mul 360 moveto (3758 3759 3760 3774 3775) show
36 mp_a_x mul 360 moveto (brelse 4674) show
4 mp_a_x mul 348 moveto (3776 3786 3805 3816 3817) show
40 mp_a_x mul 348 moveto (0215 4674 4677 4736 4760) show
4 mp_a_x mul 336 moveto (3828 3829 3831 3858 3859) show
40 mp_a_x mul 336 moveto (4783 4787 4819 4940 5018) show
4 mp_a_x mul 324 moveto (3861 3874 3875 3877 3890) show
40 mp_a_x mul 324 moveto (5021 5042 5087 5093 5122) show
4 mp_a_x mul 312 moveto (3891 3893 3905 3906 3907) show
40 mp_a_x mul 312 moveto (5173 5205 5248 5252) show
4 mp_a_x mul 300 moveto (3918 3931 5619 5657 5669) show
36 mp_a_x mul 300 moveto (BSIZE 4207) show
4 mp_a_x mul 288 moveto (5869 5912 5913 5957) show
40 mp_a_x mul 288 moveto (4207 4219 4237 4243 4758) show
0 276 moveto (argptr 3454) show
40 mp_a_x mul 276 moveto (5170 5171 5172 5193 5194) show
4 mp_a_x mul 264 moveto (0346 3454 3707 3708 3720) show
40 mp_a_x mul 264 moveto (5201 5202 5203 5236 5237) show
4 mp_a_x mul 252 moveto (3721 3761 3762 3777 3778) show
40 mp_a_x mul 252 moveto (5239) show
4 mp_a_x mul 240 moveto (3806 3807 3830 3860 3862) show
36 mp_a_x mul 240 moveto (buf 3950) show
4 mp_a_x mul 228 moveto (3863 3876 3892 3894 3895) show
40 mp_a_x mul 228 moveto (0203 0214 0215 0216 0258) show
4 mp_a_x mul 216 moveto (3919 3920 3932 3933 5657) show
40 mp_a_x mul 216 moveto (3950 3954 3955 3956 4360) show
4 mp_a_x mul 204 moveto (5669 5706 5982) show
40 mp_a_x mul 204 moveto (4376 4427 4454 4482 4484) show
0 192 moveto (argstr 3471) show
40 mp_a_x mul 192 moveto (4487 4577 4579 4585 4590) show
4 mp_a_x mul 180 moveto (0347 3471 5718 5774 5869) show
40 mp_a_x mul 180 moveto (4597 4608 4611 4621 4651) show
4 mp_a_x mul 168 moveto (5911 5926 5938 5957) show
40 mp_a_x mul 168 moveto (4654 4664 4674 4689 4719) show
0 156 moveto (assert 1853) show
40 mp_a_x mul 156 moveto (4731 4754 4770 4804 4918) show
4 mp_a_x mul 144 moveto (1700 1714 1723 1853 1900) show
40 mp_a_x mul 144 moveto (5005 5030 5063 5105 5155) show
4 mp_a_x mul 132 moveto (1907 8755 8806 8807 8808) show
40 mp_a_x mul 132 moveto (5183 5230 7454 7466 7469) show
4 mp_a_x mul 120 moveto (8809 8810) show
40 mp_a_x mul 120 moveto (7483 7504 7516 7519 7522) show
0 108 moveto (BACK 10161) show
40 mp_a_x mul 108 moveto (7666 7673 7683 7704 7717) show
4 mp_a_x mul 96 moveto (10161 10274 10420 10689) show
40 mp_a_x mul 96 moveto (7830 10284 10287 10288) show
0 84 moveto (backcmd 10196 10414) show
40 mp_a_x mul 84 moveto (10289 10303 10315 10316) show
4 mp_a_x mul 72 moveto (10196 10209 10275 10414) show
40 mp_a_x mul 72 moveto (10319 10320 10321 10325) show
4 mp_a_x mul 60 moveto (10416 10530 10655 10690) show
36 mp_a_x mul 60 moveto (bufhead 4585) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 2) show
4 mp_a_x mul 648 moveto (4585 4595 4596 4598 4599) show
40 mp_a_x mul 648 moveto (10408 10409 10410 10413) show
4 mp_a_x mul 636 moveto (4600 4601 4617 4631 4683) show
40 mp_a_x mul 636 moveto (10414 10416 10418 10419) show
4 mp_a_x mul 624 moveto (4684 4685 4686) show
40 mp_a_x mul 624 moveto (10420 10421 10422 10500) show
0 612 moveto (buf_table_lock 4580) show
40 mp_a_x mul 612 moveto (10501 10502 10503 10505) show
4 mp_a_x mul 600 moveto (4580 4592 4613 4621 4625) show
40 mp_a_x mul 600 moveto (10509 10512 10518 10519) show
4 mp_a_x mul 588 moveto (4636 4679 4691) show
40 mp_a_x mul 588 moveto (10522 10525 10527 10530) show
0 576 moveto (bwrite 4664) show
40 mp_a_x mul 576 moveto (10534 10536 10550 10553) show
4 mp_a_x mul 564 moveto (0216 4664 4667 4759 4782) show
40 mp_a_x mul 564 moveto (10555 10558 10560 10563) show
4 mp_a_x mul 552 moveto (4818 5017 5041 5091 5204) show
40 mp_a_x mul 552 moveto (10564 10575 10578 10581) show
0 540 moveto (bzero 4752) show
40 mp_a_x mul 540 moveto (10585 10600 10603 10608) show
4 mp_a_x mul 528 moveto (4752 4808) show
40 mp_a_x mul 528 moveto (10612 10613 10616 10621) show
0 516 moveto (B_BUSY 3959) show
40 mp_a_x mul 516 moveto (10622 10628 10637 10638) show
4 mp_a_x mul 504 moveto (3959 4486 4618 4620 4624) show
40 mp_a_x mul 504 moveto (10644 10645 10651 10652) show
4 mp_a_x mul 492 moveto (4632 4633 4666 4676 4688) show
40 mp_a_x mul 492 moveto (10661 10664 10666 10672) show
0 480 moveto (B_DIRTY 3961) show
40 mp_a_x mul 480 moveto (10673 10678 10684 10690) show
4 mp_a_x mul 468 moveto (3961 4439 4463 4468 4488) show
40 mp_a_x mul 468 moveto (10691 10694) show
4 mp_a_x mul 456 moveto (4506 4668) show
36 mp_a_x mul 456 moveto (cmpxchg 0539) show
0 444 moveto (B_VALID 3960) show
40 mp_a_x mul 444 moveto (0539 1550) show
4 mp_a_x mul 432 moveto (3960 4467 4488 4506 4618) show
36 mp_a_x mul 432 moveto (CONSOLE 4007) show
4 mp_a_x mul 420 moveto (4657) show
40 mp_a_x mul 420 moveto (4007 7856 7857) show
0 408 moveto (C 7181 7689) show
36 mp_a_x mul 408 moveto (console_init 7851) show
4 mp_a_x mul 396 moveto (7181 7229 7254 7255 7256) show
40 mp_a_x mul 396 moveto (0219 1295 7851) show
4 mp_a_x mul 384 moveto (7257 7258 7260 7689 7699) show
36 mp_a_x mul 384 moveto (console_intr 7692) show
4 mp_a_x mul 372 moveto (7702 7709 7719 7831) show
40 mp_a_x mul 372 moveto (0221 7348 7692) show
0 360 moveto (CAPSLOCK 7162) show
36 mp_a_x mul 360 moveto (console_lock 7372) show
4 mp_a_x mul 348 moveto (7162 7195 7336) show
40 mp_a_x mul 348 moveto (7372 7543 7662 7671 7674) show
0 336 moveto (cga_putc 7401) show
40 mp_a_x mul 336 moveto (7853) show
4 mp_a_x mul 324 moveto (7401 7442) show
36 mp_a_x mul 324 moveto (console_read 7780) show
0 312 moveto (cli 0551) show
40 mp_a_x mul 312 moveto (7780 7857) show
4 mp_a_x mul 300 moveto (0551 0553 0964 1077 1545) show
36 mp_a_x mul 300 moveto (console_write 7666) show
4 mp_a_x mul 288 moveto (7436 7885) show
40 mp_a_x mul 288 moveto (7666 7856) show
0 276 moveto (cmd 10165) show
36 mp_a_x mul 276 moveto (cons_putc 7433) show
4 mp_a_x mul 264 moveto (8076 8077 9222 9238 9254) show
40 mp_a_x mul 264 moveto (7433 7475 7480 7483 7522) show
4 mp_a_x mul 252 moveto (9490 9491 9492 9493 9584) show
40 mp_a_x mul 252 moveto (7558 7582 7620 7625 7653) show
4 mp_a_x mul 240 moveto (9585 9586 9588 9603 9604) show
40 mp_a_x mul 240 moveto (7654 7673 7706 7712 7718) show
4 mp_a_x mul 228 moveto (9605 9607 9817 9874 9875) show
36 mp_a_x mul 228 moveto (context 1968) show
4 mp_a_x mul 216 moveto (9876 9877 9878 9881 9882) show
40 mp_a_x mul 216 moveto (0204 0325 1968 1994 2018) show
4 mp_a_x mul 204 moveto (9886 10165 10177 10186) show
40 mp_a_x mul 204 moveto (2191 2192 2193 2263 2288) show
4 mp_a_x mul 192 moveto (10187 10192 10193 10198) show
40 mp_a_x mul 192 moveto (2602 2981 2987 2988 2989) show
4 mp_a_x mul 180 moveto (10202 10206 10215 10218) show
40 mp_a_x mul 180 moveto (2990 2991) show
4 mp_a_x mul 168 moveto (10223 10231 10237 10241) show
36 mp_a_x mul 168 moveto (copyproc 2154) show
4 mp_a_x mul 156 moveto (10251 10275 10277 10352) show
40 mp_a_x mul 156 moveto (0307 2154 2207 3612) show
4 mp_a_x mul 144 moveto (10355 10357 10358 10359) show
36 mp_a_x mul 144 moveto (cp 2010) show
4 mp_a_x mul 132 moveto (10360 10363 10364 10366) show
40 mp_a_x mul 132 moveto (2010 2107 2110 2111 2112) show
4 mp_a_x mul 120 moveto (10368 10369 10370 10371) show
40 mp_a_x mul 120 moveto (2113 2114 2115 2116 2259) show
4 mp_a_x mul 108 moveto (10372 10373 10374 10375) show
40 mp_a_x mul 108 moveto (2268 2281 2288 2296 2309) show
4 mp_a_x mul 96 moveto (10376 10379 10380 10382) show
40 mp_a_x mul 96 moveto (2320 2321 2331 2332 2336) show
4 mp_a_x mul 84 moveto (10384 10385 10386 10387) show
40 mp_a_x mul 84 moveto (2343 2344 2363 2381 2382) show
4 mp_a_x mul 72 moveto (10388 10389 10400 10401) show
40 mp_a_x mul 72 moveto (2386 2482 2487 2488 2489) show
4 mp_a_x mul 60 moveto (10403 10405 10406 10407) show
40 mp_a_x mul 60 moveto (2493 2494 2499 2502 2509) show
grestore
restore
showpage
%%Page: 3 3
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 3) show
4 mp_a_x mul 648 moveto (2510 2513 2514 2515 2536) show
36 mp_a_x mul 648 moveto (CUC_START 9138) show
4 mp_a_x mul 636 moveto (2562 2568 3238 3240 3242) show
40 mp_a_x mul 636 moveto (9138 9681 9845) show
4 mp_a_x mul 624 moveto (3284 3295 3296 3305 3310) show
36 mp_a_x mul 624 moveto (delay 9474) show
4 mp_a_x mul 612 moveto (3446 3460 3462 3476 3567) show
40 mp_a_x mul 612 moveto (9474 9489) show
4 mp_a_x mul 600 moveto (3569 3572 3573 3612 3644) show
36 mp_a_x mul 600 moveto (devsw 4000) show
4 mp_a_x mul 588 moveto (3660 3674 5362 5621 5638) show
40 mp_a_x mul 588 moveto (4000 4005 5159 5161 5186) show
4 mp_a_x mul 576 moveto (5639 5655 5657 5659 5667) show
40 mp_a_x mul 576 moveto (5188 5457 7856 7857) show
4 mp_a_x mul 564 moveto (5669 5671 5696 5946 5947) show
36 mp_a_x mul 564 moveto (dinode 4223) show
4 mp_a_x mul 552 moveto (5963 5969 5989 6104 6107) show
40 mp_a_x mul 552 moveto (4223 4237 4919 4933 5006) show
4 mp_a_x mul 540 moveto (6108 6109 6110 6111 6112) show
40 mp_a_x mul 540 moveto (5013 5031 5034) show
4 mp_a_x mul 528 moveto (6234 6257 7796) show
36 mp_a_x mul 528 moveto (dirent 4250) show
0 516 moveto (cprintf 7534) show
40 mp_a_x mul 516 moveto (4250 5231 5238 5239 5262) show
4 mp_a_x mul 504 moveto (0220 1283 1325 1530 1536) show
40 mp_a_x mul 504 moveto (5755 5770) show
4 mp_a_x mul 492 moveto (1538 1907 2540 2541 2546) show
36 mp_a_x mul 492 moveto (dirlink 5259) show
4 mp_a_x mul 480 moveto (2600 2604 2606 2736 2760) show
40 mp_a_x mul 480 moveto (0238 5259 5274 5282 5734) show
4 mp_a_x mul 468 moveto (2764 2814 2836 2844 2854) show
40 mp_a_x mul 468 moveto (5842 5854) show
4 mp_a_x mul 456 moveto (3269 3286 3293 3571 5509) show
36 mp_a_x mul 456 moveto (dirlookup 5227) show
4 mp_a_x mul 444 moveto (5527 6687 6912 7534 7736) show
40 mp_a_x mul 444 moveto (0239 5227 5234 5266 5377) show
4 mp_a_x mul 432 moveto (7741 7816 7820 7822 7824) show
40 mp_a_x mul 432 moveto (5786 5822) show
4 mp_a_x mul 420 moveto (7870 7874 7875 7887 7888) show
36 mp_a_x mul 420 moveto (DIRSIZ 4249) show
4 mp_a_x mul 408 moveto (7889 7892 8846 8892 8910) show
40 mp_a_x mul 408 moveto (4249 4252 5220 5279 5327) show
4 mp_a_x mul 396 moveto (8919 8932 8943 8957 8996) show
40 mp_a_x mul 396 moveto (5328 5394 5715 5771 5816) show
4 mp_a_x mul 384 moveto (9002 9010 9011 9014 9413) show
36 mp_a_x mul 384 moveto (disk_1_present 4378) show
4 mp_a_x mul 372 moveto (9424 9431 9518 9519 9522) show
40 mp_a_x mul 372 moveto (4378 4415 4490) show
4 mp_a_x mul 360 moveto (9524 9526 9528 9530 9532) show
36 mp_a_x mul 360 moveto (DPL_USER 0714) show
4 mp_a_x mul 348 moveto (9534 9644 9676 9679 9707) show
40 mp_a_x mul 348 moveto (0714 2139 2140 2212 2213) show
4 mp_a_x mul 336 moveto (9718 9722 9724 9726 9733) show
40 mp_a_x mul 336 moveto (3223 3305) show
4 mp_a_x mul 324 moveto (9734 9735) show
36 mp_a_x mul 324 moveto (dummy_ide_intr 4395) show
0 312 moveto (cpu 2016 6786) show
40 mp_a_x mul 312 moveto (4395 4409) show
4 mp_a_x mul 300 moveto (0261 0276 1283 1314 1315) show
36 mp_a_x mul 300 moveto (E0ESC 7166) show
4 mp_a_x mul 288 moveto (1325 1327 1330 1333 1334) show
40 mp_a_x mul 288 moveto (7166 7320 7324 7325 7327) show
4 mp_a_x mul 276 moveto (1355 1362 1408 1517 1548) show
40 mp_a_x mul 276 moveto (7330) show
4 mp_a_x mul 264 moveto (1549 1561 1573 1582 1622) show
36 mp_a_x mul 264 moveto (E100_CB_SIZE 9116) show
4 mp_a_x mul 252 moveto (2010 2016 2028 2124 2126) show
40 mp_a_x mul 252 moveto (9116 9753 9764 9870 9874) show
4 mp_a_x mul 240 moveto (2263 2288 3249 3252 3269) show
40 mp_a_x mul 240 moveto (9886) show
4 mp_a_x mul 228 moveto (3286 3287 3294 3295 3300) show
36 mp_a_x mul 228 moveto (e100_cu_command 9582) show
4 mp_a_x mul 216 moveto (6562 6563 6786 7887) show
40 mp_a_x mul 216 moveto (9398 9582 9681 9710 9840) show
0 204 moveto (cpuid 0521) show
40 mp_a_x mul 204 moveto (9845 9851) show
4 mp_a_x mul 192 moveto (0521 0525 1329 1555 1577) show
36 mp_a_x mul 192 moveto (E100_CU_RING_SIZE 9114) show
0 180 moveto (create 5812) show
40 mp_a_x mul 180 moveto (9114 9421 9435) show
4 mp_a_x mul 168 moveto (5812 5855 5873 5914 5926) show
36 mp_a_x mul 168 moveto (e100_get_state 9501) show
0 156 moveto (CRTPORT 7366) show
40 mp_a_x mul 156 moveto (9501 9517 9649) show
4 mp_a_x mul 144 moveto (7366 7406 7407 7408 7409) show
36 mp_a_x mul 144 moveto (e100_intr 9629) show
4 mp_a_x mul 132 moveto (7425 7426 7427 7428) show
40 mp_a_x mul 132 moveto (9400 9465 9629 9644) show
0 120 moveto (CTL 7159) show
36 mp_a_x mul 120 moveto (E100_IOPORT_SIZE 9113) show
4 mp_a_x mul 108 moveto (7159 7185 7189 7335) show
40 mp_a_x mul 108 moveto (9113 9451) show
0 96 moveto (CUC_DUMP_RESET 9143) show
36 mp_a_x mul 96 moveto (E100_MAX_DEVS 9111) show
4 mp_a_x mul 84 moveto (9143 9492) show
40 mp_a_x mul 84 moveto (9111 9393) show
0 72 moveto (CUC_RESUME 9139) show
36 mp_a_x mul 72 moveto (e100_print_state 9515) show
4 mp_a_x mul 60 moveto (9139 9710 9840 9851) show
40 mp_a_x mul 60 moveto (9395 9457 9515) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 4) show
0 648 moveto (e100_put_state 9509) show
40 mp_a_x mul 648 moveto (10216 10225 10235 10280) show
4 mp_a_x mul 636 moveto (9396 9509 9652) show
40 mp_a_x mul 636 moveto (10328 10335) show
0 624 moveto (e100_read_scb_command 9570) show
36 mp_a_x mul 624 moveto (fdalloc 5633) show
4 mp_a_x mul 612 moveto (9397 9570 9589 9608) show
40 mp_a_x mul 612 moveto (5633 5682 5885 5987) show
0 600 moveto (e100_receive 9925) show
36 mp_a_x mul 600 moveto (fetchint 3416) show
4 mp_a_x mul 588 moveto (7815 9027 9106 9925) show
40 mp_a_x mul 588 moveto (0348 3416 3446 5963) show
0 576 moveto (e100_receive_dev 9933) show
36 mp_a_x mul 576 moveto (fetchstr 3428) show
4 mp_a_x mul 564 moveto (9404 9929 9933) show
40 mp_a_x mul 564 moveto (0349 3428 3476 5969) show
0 552 moveto (e100_reset 9486) show
36 mp_a_x mul 552 moveto (file 4150) show
4 mp_a_x mul 540 moveto (9394 9454 9486) show
40 mp_a_x mul 540 moveto (0205 0229 0230 0231 0233) show
0 528 moveto (E100_RFD_SIZE 9117) show
40 mp_a_x mul 528 moveto (0234 0235 0301 1904 1908) show
4 mp_a_x mul 516 moveto (9117 9890 9893 9896 9909) show
40 mp_a_x mul 516 moveto (1992 4150 5453 5459 5468) show
0 504 moveto (e100_ru_command 9601) show
40 mp_a_x mul 504 moveto (5475 5476 5477 5479 5487) show
4 mp_a_x mul 492 moveto (9399 9601 9921 9958) show
40 mp_a_x mul 492 moveto (5488 5502 5504 5510 5528) show
0 480 moveto (E100_RU_RING_SIZE 9115) show
40 mp_a_x mul 480 moveto (5534 5552 5572 5608 5614) show
4 mp_a_x mul 468 moveto (9115 9428 9436) show
40 mp_a_x mul 468 moveto (5617 5633 5653 5665 5677) show
0 456 moveto (e100_ru_start 9918) show
40 mp_a_x mul 456 moveto (5692 5703 5866 5979 6155) show
4 mp_a_x mul 444 moveto (9401 9469 9918) show
40 mp_a_x mul 444 moveto (6170 10178 10233 10234) show
0 432 moveto (e100_rx_thread 9612) show
40 mp_a_x mul 432 moveto (10364 10372 10572) show
4 mp_a_x mul 420 moveto (9405 9468 9612) show
36 mp_a_x mul 420 moveto (filealloc 5469) show
0 408 moveto (e100_send 9859) show
40 mp_a_x mul 408 moveto (0229 5469 5885 6176) show
4 mp_a_x mul 396 moveto (7813 9038 9105 9859) show
36 mp_a_x mul 396 moveto (fileclose 5502) show
0 384 moveto (e100_send_dev 9801) show
40 mp_a_x mul 384 moveto (0230 2488 5502 5510 5528) show
4 mp_a_x mul 372 moveto (9801 9863) show
40 mp_a_x mul 372 moveto (5697 5887 5990 5991 6200) show
0 360 moveto (e100_set_gp 9576) show
40 mp_a_x mul 360 moveto (6204) show
4 mp_a_x mul 348 moveto (9576 9587 9606) show
36 mp_a_x mul 348 moveto (filedup 5488) show
0 336 moveto (elfhdr 0855) show
40 mp_a_x mul 336 moveto (0231 2185 5488 5492 5684) show
4 mp_a_x mul 324 moveto (0855 1169 1173 6014) show
36 mp_a_x mul 324 moveto (fileinit 5462) show
0 312 moveto (ELF_MAGIC 0852) show
40 mp_a_x mul 312 moveto (0232 1292 5462) show
4 mp_a_x mul 300 moveto (0852 1179 6030) show
36 mp_a_x mul 300 moveto (fileread 5552) show
0 288 moveto (ELF_PROG_LOAD 0886) show
40 mp_a_x mul 288 moveto (0233 5552 5567 5659) show
4 mp_a_x mul 276 moveto (0886 6035 6064) show
36 mp_a_x mul 276 moveto (filestat 5534) show
0 264 moveto (EOI 6710) show
40 mp_a_x mul 264 moveto (0234 5534 5708) show
4 mp_a_x mul 252 moveto (6710 6773 6798) show
36 mp_a_x mul 252 moveto (filewrite 5572) show
0 240 moveto (ERROR 6728) show
40 mp_a_x mul 240 moveto (0235 5572 5587 5671) show
4 mp_a_x mul 228 moveto (6728 6766 8846) show
36 mp_a_x mul 228 moveto (file_table_lock 5458) show
0 216 moveto (ESR 6713) show
40 mp_a_x mul 216 moveto (5458 5464 5473 5478 5482) show
4 mp_a_x mul 204 moveto (6713 6769 6770) show
40 mp_a_x mul 204 moveto (5490 5494 5506 5513 5519) show
0 192 moveto (ether_e100_attach 9411) show
36 mp_a_x mul 192 moveto (FL_IF 0662) show
4 mp_a_x mul 180 moveto (8790 9104 9411) show
40 mp_a_x mul 180 moveto (0662 2216) show
0 168 moveto (EXEC 10157) show
36 mp_a_x mul 168 moveto (fmt_types 7525) show
4 mp_a_x mul 156 moveto (10157 10222 10359 10665) show
40 mp_a_x mul 156 moveto (7525 7539) show
0 144 moveto (execcmd 10169 10353) show
36 mp_a_x mul 144 moveto (fork1 10339) show
4 mp_a_x mul 132 moveto (10169 10210 10223 10353) show
40 mp_a_x mul 132 moveto (10200 10242 10254 10261) show
4 mp_a_x mul 120 moveto (10355 10621 10627 10628) show
40 mp_a_x mul 120 moveto (10276 10324 10339) show
4 mp_a_x mul 108 moveto (10656 10666) show
36 mp_a_x mul 108 moveto (forkret 2303) show
0 96 moveto (exit 2477) show
40 mp_a_x mul 96 moveto (2066 2192 2303) show
4 mp_a_x mul 84 moveto (0309 2477 2517 2991 3239) show
36 mp_a_x mul 84 moveto (forkret1 3184) show
4 mp_a_x mul 72 moveto (3243 3306 3621 10015) show
40 mp_a_x mul 72 moveto (2067 2309 3183 3184) show
4 mp_a_x mul 60 moveto (10018 10076 10081 10111) show
36 mp_a_x mul 60 moveto (gatedesc 0780) show
grestore
restore
showpage
%%Page: 4 4
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 5) show
4 mp_a_x mul 648 moveto (0485 0488 0780 3211) show
40 mp_a_x mul 648 moveto (4383 4408 4433 4463) show
0 636 moveto (getcallerpcs 1602) show
36 mp_a_x mul 636 moveto (idtinit 3229) show
4 mp_a_x mul 624 moveto (0329 1562 1602 2602 7872) show
40 mp_a_x mul 624 moveto (0357 1291 1326 3229) show
4 mp_a_x mul 612 moveto (7890) show
36 mp_a_x mul 612 moveto (idup 4906) show
0 600 moveto (getcmd 10284) show
40 mp_a_x mul 600 moveto (0241 2186 4906 5362) show
4 mp_a_x mul 588 moveto (10284 10315) show
36 mp_a_x mul 588 moveto (iget 4869) show
0 576 moveto (gettoken 10430) show
40 mp_a_x mul 576 moveto (4869 4890 5019 5249 5360) show
4 mp_a_x mul 564 moveto (10430 10529 10533 10557) show
36 mp_a_x mul 564 moveto (iinit 4861) show
4 mp_a_x mul 552 moveto (10570 10571 10607 10611) show
40 mp_a_x mul 552 moveto (0242 1293 4861) show
4 mp_a_x mul 540 moveto (10633) show
36 mp_a_x mul 540 moveto (ilock 4916) show
0 528 moveto (growproc 2103) show
40 mp_a_x mul 528 moveto (0243 4916 4922 4943 5366) show
4 mp_a_x mul 516 moveto (0310 2103 3658) show
40 mp_a_x mul 516 moveto (5537 5561 5581 5722 5733) show
0 504 moveto (holding 1620) show
40 mp_a_x mul 504 moveto (5743 5778 5790 5820 5824) show
4 mp_a_x mul 492 moveto (0330 1528 1569 1620 2283) show
40 mp_a_x mul 492 moveto (5836 5878 5940 6021 7675) show
0 480 moveto (ialloc 5002) show
40 mp_a_x mul 480 moveto (7798 7845) show
4 mp_a_x mul 468 moveto (0240 5002 5023 5832) show
36 mp_a_x mul 468 moveto (inb 0405) show
0 456 moveto (IBLOCK 4240) show
40 mp_a_x mul 456 moveto (0405 0978 0986 1204 4387) show
4 mp_a_x mul 444 moveto (4240 4931 5012 5033) show
40 mp_a_x mul 444 moveto (4414 6696 7314 7317 7384) show
0 432 moveto (ICRHI 6721) show
40 mp_a_x mul 432 moveto (7407 7409 9572) show
4 mp_a_x mul 420 moveto (6721 6776 6820 6826) show
36 mp_a_x mul 420 moveto (INDIRECT 4218) show
0 408 moveto (ICRLO 6714) show
40 mp_a_x mul 408 moveto (4218 5077 5080 5115 5116) show
4 mp_a_x mul 396 moveto (6714 6777 6778 6821 6827) show
40 mp_a_x mul 396 moveto (5123 8024) show
0 384 moveto (ID 6707) show
36 mp_a_x mul 384 moveto (initlock 1513) show
4 mp_a_x mul 372 moveto (6707 6789 8045 8410 8477) show
40 mp_a_x mul 372 moveto (0331 1513 1715 2072 2732) show
4 mp_a_x mul 360 moveto (8696 8701 8708 8710) show
40 mp_a_x mul 360 moveto (3225 4405 4592 4863 5464) show
0 348 moveto (IDE_BSY 4363) show
40 mp_a_x mul 348 moveto (6184 7853 7854 9442 9443) show
4 mp_a_x mul 336 moveto (4363 4387) show
40 mp_a_x mul 336 moveto (9444) show
0 324 moveto (IDE_CMD_READ 4368) show
36 mp_a_x mul 324 moveto (inl 0414) show
4 mp_a_x mul 312 moveto (4368 4443) show
40 mp_a_x mul 312 moveto (0414 8821) show
0 300 moveto (IDE_CMD_WRITE 4369) show
36 mp_a_x mul 300 moveto (inode 4302) show
4 mp_a_x mul 288 moveto (4369 4440) show
40 mp_a_x mul 288 moveto (0206 0238 0239 0240 0241) show
0 276 moveto (IDE_DF 4365) show
40 mp_a_x mul 276 moveto (0243 0244 0245 0246 0247) show
4 mp_a_x mul 264 moveto (4365 4389) show
40 mp_a_x mul 264 moveto (0249 0250 0251 0252 0253) show
0 252 moveto (IDE_DRDY 4364) show
40 mp_a_x mul 252 moveto (1993 4001 4002 4156 4302) show
4 mp_a_x mul 240 moveto (4364 4387) show
40 mp_a_x mul 240 moveto (4725 4857 4868 4871 4877) show
0 228 moveto (IDE_ERR 4366) show
40 mp_a_x mul 228 moveto (4905 4906 4916 4952 4965) show
4 mp_a_x mul 216 moveto (4366 4389) show
40 mp_a_x mul 216 moveto (4987 5001 5028 5060 5102) show
0 204 moveto (ide_init 4401) show
40 mp_a_x mul 204 moveto (5132 5152 5180 5226 5227) show
4 mp_a_x mul 192 moveto (0256 1296 4401) show
40 mp_a_x mul 192 moveto (5259 5263 5353 5356 5391) show
0 180 moveto (ide_intr 4452) show
40 mp_a_x mul 180 moveto (5400 5716 5752 5769 5811) show
4 mp_a_x mul 168 moveto (0257 3261 4452) show
40 mp_a_x mul 168 moveto (5815 5867 5906 5924 5936) show
0 156 moveto (ide_lock 4375) show
40 mp_a_x mul 156 moveto (6015 7666 7780) show
4 mp_a_x mul 144 moveto (4375 4405 4456 4458 4475) show
36 mp_a_x mul 144 moveto (INPUT_BUF 7680) show
4 mp_a_x mul 132 moveto (4493 4508 4512) show
40 mp_a_x mul 132 moveto (7680 7683 7704 7716 7717) show
0 120 moveto (ide_rw 4482) show
40 mp_a_x mul 120 moveto (7719 7830) show
4 mp_a_x mul 108 moveto (0258 4482 4487 4489 4658) show
36 mp_a_x mul 108 moveto (insl 0432) show
4 mp_a_x mul 96 moveto (4669) show
40 mp_a_x mul 96 moveto (0432 1223 4464) show
0 84 moveto (ide_start_request 4427) show
36 mp_a_x mul 84 moveto (INT_DISABLED 6869) show
4 mp_a_x mul 72 moveto (4379 4427 4431 4473 4502) show
40 mp_a_x mul 72 moveto (6869 6917) show
0 60 moveto (ide_wait_ready 4383) show
36 mp_a_x mul 60 moveto (int_enabled 1520) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 6) show
4 mp_a_x mul 648 moveto (1520 1579) show
36 mp_a_x mul 648 moveto (isdirempty 5752) show
0 636 moveto (inw 0423) show
40 mp_a_x mul 636 moveto (5752 5759 5794) show
4 mp_a_x mul 624 moveto (0423 9504) show
36 mp_a_x mul 624 moveto (ismp 6564) show
0 612 moveto (IOAPIC 6858) show
40 mp_a_x mul 612 moveto (0287 1309 6564 6663 6905) show
4 mp_a_x mul 600 moveto (6858 6908) show
40 mp_a_x mul 600 moveto (6925) show
0 588 moveto (ioapic_enable 6923) show
36 mp_a_x mul 588 moveto (itrunc 5102) show
4 mp_a_x mul 576 moveto (0261 4407 6923 7861 9467) show
40 mp_a_x mul 576 moveto (4725 4974 5102) show
0 564 moveto (ioapic_id 6566) show
36 mp_a_x mul 564 moveto (iunlock 4952) show
4 mp_a_x mul 552 moveto (0262 6566 6678 6911 6912) show
40 mp_a_x mul 552 moveto (0245 4952 4955 4989 5374) show
0 540 moveto (ioapic_init 6901) show
40 mp_a_x mul 540 moveto (5539 5564 5584 5729 5891) show
4 mp_a_x mul 528 moveto (0263 1288 6901 6912) show
40 mp_a_x mul 528 moveto (5945 7670 7791) show
0 516 moveto (ioapic_read 6884) show
36 mp_a_x mul 516 moveto (iunlockput 4987) show
4 mp_a_x mul 504 moveto (6884 6909 6910) show
40 mp_a_x mul 504 moveto (0246 4987 5369 5378 5381) show
0 492 moveto (ioapic_write 6891) show
40 mp_a_x mul 492 moveto (5724 5736 5742 5746 5782) show
4 mp_a_x mul 480 moveto (6891 6917 6918 6931 6932) show
40 mp_a_x mul 480 moveto (5787 5795 5796 5803 5807) show
0 468 moveto (IO_PIC1 7010) show
40 mp_a_x mul 468 moveto (5823 5826 5833 5844 5845) show
4 mp_a_x mul 456 moveto (7010 7029 7055 7064 7067) show
40 mp_a_x mul 456 moveto (5857 5880 5888 5916 5928) show
4 mp_a_x mul 444 moveto (7071 7081 7095 7096) show
40 mp_a_x mul 444 moveto (5942 6072 6118) show
0 432 moveto (IO_PIC2 7011) show
36 mp_a_x mul 432 moveto (iupdate 5028) show
4 mp_a_x mul 420 moveto (7011 7030 7056 7084 7085) show
40 mp_a_x mul 420 moveto (0247 4976 5028 5127 5210) show
4 mp_a_x mul 408 moveto (7086 7089 7098 7099) show
40 mp_a_x mul 408 moveto (5728 5745 5806 5840 5852) show
0 396 moveto (IO_TIMER1 7909) show
36 mp_a_x mul 396 moveto (I_BUSY 4316) show
4 mp_a_x mul 384 moveto (7909 7918 7928 7929) show
40 mp_a_x mul 384 moveto (4316 4925 4927 4954 4958) show
0 372 moveto (IPB 4237) show
40 mp_a_x mul 372 moveto (4970 4972 4978) show
4 mp_a_x mul 360 moveto (4237 4240 4246 4933 5013) show
36 mp_a_x mul 360 moveto (I_VALID 4317) show
4 mp_a_x mul 348 moveto (5034) show
40 mp_a_x mul 348 moveto (4317 4930 4941 4968) show
0 336 moveto (iput 4965) show
36 mp_a_x mul 336 moveto (kalloc 2808) show
4 mp_a_x mul 324 moveto (0244 2493 4965 4971 4990) show
40 mp_a_x mul 324 moveto (0266 2107 2164 2175 2209) show
4 mp_a_x mul 312 moveto (5267 5385 5524 5737 5946) show
40 mp_a_x mul 312 moveto (2732 2808 2814 2818 2836) show
0 300 moveto (IRQ_ERROR 3085) show
40 mp_a_x mul 300 moveto (2846 6055 6178 9421 9428) show
4 mp_a_x mul 288 moveto (3085 6766) show
36 mp_a_x mul 288 moveto (kalloc_lock 2713) show
0 276 moveto (IRQ_IDE 3083) show
40 mp_a_x mul 276 moveto (2713 2732 2771 2801 2820) show
4 mp_a_x mul 264 moveto (3083 3260 4406 4407) show
40 mp_a_x mul 264 moveto (2824 2830 2834) show
0 252 moveto (IRQ_IDE_2 3084) show
36 mp_a_x mul 252 moveto (KBDATAP 7154) show
4 mp_a_x mul 240 moveto (3084 4409) show
40 mp_a_x mul 240 moveto (7154 7317) show
0 228 moveto (IRQ_KBD 3082) show
36 mp_a_x mul 228 moveto (kbd_getc 7306) show
4 mp_a_x mul 216 moveto (3082 3264 7860 7861) show
40 mp_a_x mul 216 moveto (7306 7348) show
0 204 moveto (IRQ_MAX 6957) show
36 mp_a_x mul 204 moveto (kbd_intr 7346) show
4 mp_a_x mul 192 moveto (3276 6957 7008) show
40 mp_a_x mul 192 moveto (0273 3265 7346) show
0 180 moveto (IRQ_OFFSET 3079) show
36 mp_a_x mul 180 moveto (KBSTATP 7152) show
4 mp_a_x mul 168 moveto (3079 3251 3260 3264 3268) show
40 mp_a_x mul 168 moveto (7152 7314) show
4 mp_a_x mul 156 moveto (3276 3277 3280 3310 6743) show
36 mp_a_x mul 156 moveto (KBS_DIB 7153) show
4 mp_a_x mul 144 moveto (6754 6766 6917 6931 7067) show
40 mp_a_x mul 144 moveto (7153 7315) show
4 mp_a_x mul 132 moveto (7085 9636) show
36 mp_a_x mul 132 moveto (KEY_DEL 7178) show
0 120 moveto (IRQ_SLAVE 7013) show
40 mp_a_x mul 120 moveto (7178 7219 7241 7265) show
4 mp_a_x mul 108 moveto (7013 7017 7071 7086) show
36 mp_a_x mul 108 moveto (KEY_DN 7172) show
0 96 moveto (IRQ_SPURIOUS 3086) show
40 mp_a_x mul 96 moveto (7172 7215 7237 7261) show
4 mp_a_x mul 84 moveto (3086 3268 6743) show
36 mp_a_x mul 84 moveto (KEY_END 7170) show
0 72 moveto (IRQ_TIMER 3081) show
40 mp_a_x mul 72 moveto (7170 7218 7240 7264) show
4 mp_a_x mul 60 moveto (3081 3251 3310 6754 7930) show
36 mp_a_x mul 60 moveto (KEY_HOME 7169) show
grestore
restore
showpage
%%Page: 5 5
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 7) show
4 mp_a_x mul 648 moveto (7169 7218 7240 7264) show
40 mp_a_x mul 648 moveto (10190 10211 10241 10401) show
0 636 moveto (KEY_INS 7177) show
40 mp_a_x mul 636 moveto (10403 10534 10657 10684) show
4 mp_a_x mul 624 moveto (7177 7219 7241 7265) show
36 mp_a_x mul 624 moveto (LPTPORT 7367) show
0 612 moveto (KEY_LF 7173) show
40 mp_a_x mul 612 moveto (7367 7384 7388 7389 7390) show
4 mp_a_x mul 600 moveto (7173 7217 7239 7263) show
36 mp_a_x mul 600 moveto (lpt_putc 7380) show
0 588 moveto (KEY_PGDN 7176) show
40 mp_a_x mul 588 moveto (7380 7441) show
4 mp_a_x mul 576 moveto (7176 7216 7238 7262) show
36 mp_a_x mul 576 moveto (ltr 0501) show
0 564 moveto (KEY_PGUP 7175) show
40 mp_a_x mul 564 moveto (0501 0503 2147) show
4 mp_a_x mul 552 moveto (7175 7216 7238 7262) show
36 mp_a_x mul 552 moveto (MAXARGS 10163) show
0 540 moveto (KEY_RT 7174) show
40 mp_a_x mul 540 moveto (10163 10171 10172 10640) show
4 mp_a_x mul 528 moveto (7174 7217 7239 7263) show
36 mp_a_x mul 528 moveto (MAXFILE 4220) show
0 516 moveto (KEY_UP 7171) show
40 mp_a_x mul 516 moveto (4220 5193 5194) show
4 mp_a_x mul 504 moveto (7171 7215 7237 7261) show
36 mp_a_x mul 504 moveto (MAX_LOCKS 2024) show
0 492 moveto (kfree 2755) show
40 mp_a_x mul 492 moveto (2024 2025) show
4 mp_a_x mul 480 moveto (0267 2114 2176 2544 2548) show
36 mp_a_x mul 480 moveto (memcmp 6332) show
4 mp_a_x mul 468 moveto (2737 2755 2760 2764 2765) show
40 mp_a_x mul 468 moveto (0335 6332 6593 6638) show
4 mp_a_x mul 456 moveto (2856 6107 6117 6197 6223) show
36 mp_a_x mul 456 moveto (memcpy 6303) show
0 444 moveto (kill 2454) show
40 mp_a_x mul 444 moveto (0342 6303 9832 9945) show
4 mp_a_x mul 432 moveto (0311 2454 3294 3638) show
36 mp_a_x mul 432 moveto (memmove 6351) show
4 mp_a_x mul 420 moveto (10117) show
40 mp_a_x mul 420 moveto (0336 1359 2110 2172 2181) show
0 408 moveto (kinit 2726) show
40 mp_a_x mul 408 moveto (2225 4735 4939 5040 5172) show
4 mp_a_x mul 396 moveto (0270 1289 2726) show
40 mp_a_x mul 396 moveto (5203 5328 5330 6083 6351) show
0 384 moveto (kmalloc 2841) show
40 mp_a_x mul 384 moveto (7420) show
4 mp_a_x mul 372 moveto (0268 2841 2844 2964 2971) show
36 mp_a_x mul 372 moveto (memset 6320) show
0 360 moveto (kmfree 2851) show
40 mp_a_x mul 360 moveto (0337 1269 2111 2191 2211) show
4 mp_a_x mul 348 moveto (0269 2851 2854 3004) show
40 mp_a_x mul 348 moveto (2769 2981 4758 5015 5800) show
0 336 moveto (kproc_t 2902) show
40 mp_a_x mul 336 moveto (5959 6058 6070 6320 7102) show
4 mp_a_x mul 324 moveto (2902 2918 2920 2961 2964) show
40 mp_a_x mul 324 moveto (7422 8868 8938 9054) show
4 mp_a_x mul 312 moveto (3000) show
40 mp_a_x mul 312 moveto (10287 10358 10369 10385) show
0 300 moveto (KSTACKSIZE 0154) show
40 mp_a_x mul 300 moveto (10406 10419) show
4 mp_a_x mul 288 moveto (0154 2129 2164 2168 2176) show
36 mp_a_x mul 288 moveto (microdelay 6803) show
4 mp_a_x mul 276 moveto (2548 2971 2988) show
40 mp_a_x mul 276 moveto (6803 6822) show
0 264 moveto (lapic_eoi 6795) show
36 mp_a_x mul 264 moveto (millitime 7934) show
4 mp_a_x mul 252 moveto (0280 3258 3262 3266 3270) show
40 mp_a_x mul 252 moveto (0354 2315 2341 3687 7934) show
4 mp_a_x mul 240 moveto (3281 6795) show
36 mp_a_x mul 240 moveto (min 4724) show
0 228 moveto (lapic_init 6737) show
40 mp_a_x mul 228 moveto (4724 5171 5202) show
4 mp_a_x mul 216 moveto (0281 1282 1327 6737) show
36 mp_a_x mul 216 moveto (mp 6452) show
0 204 moveto (lapic_startap 6814) show
40 mp_a_x mul 204 moveto (6452 6557 6586 6592 6593) show
4 mp_a_x mul 192 moveto (0282 1368 6814) show
40 mp_a_x mul 192 moveto (6594 6605 6610 6614 6615) show
0 180 moveto (lgdt 0474) show
40 mp_a_x mul 180 moveto (6618 6619 6630 6633 6635) show
4 mp_a_x mul 168 moveto (0474 0482 0997 1090 2146) show
40 mp_a_x mul 168 moveto (6637 6644 6654 6660 6692) show
0 156 moveto (lidt 0488) show
36 mp_a_x mul 156 moveto (MPBUS 6502) show
4 mp_a_x mul 144 moveto (0488 0496 3231) show
40 mp_a_x mul 144 moveto (6502 6681) show
0 132 moveto (LINT0 6726) show
36 mp_a_x mul 132 moveto (mpconf 6463) show
4 mp_a_x mul 120 moveto (6726 6757) show
40 mp_a_x mul 120 moveto (6463 6629 6632 6637 6655) show
0 108 moveto (LINT1 6727) show
36 mp_a_x mul 108 moveto (mpioapic 6489) show
4 mp_a_x mul 96 moveto (6727 6758) show
40 mp_a_x mul 96 moveto (6489 6657 6677 6679) show
0 84 moveto (LIST 10160) show
36 mp_a_x mul 84 moveto (MPIOINTR 6504) show
4 mp_a_x mul 72 moveto (10160 10240 10407 10683) show
40 mp_a_x mul 72 moveto (6504 6682) show
0 60 moveto (listcmd 10190 10401) show
36 mp_a_x mul 60 moveto (MPLINTR 6505) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 8) show
4 mp_a_x mul 648 moveto (6505 6683) show
40 mp_a_x mul 648 moveto (7252 7253 7255 7256 7257) show
0 636 moveto (mpmain 1323) show
40 mp_a_x mul 636 moveto (7258 8024) show
4 mp_a_x mul 624 moveto (1323 1367) show
36 mp_a_x mul 624 moveto (NOFILE 0156) show
0 612 moveto (mpproc 6478) show
40 mp_a_x mul 612 moveto (0156 1992 2183 2486 5621) show
4 mp_a_x mul 600 moveto (6478 6656 6669 6674) show
40 mp_a_x mul 600 moveto (5637) show
0 588 moveto (MPSTACK 2013) show
36 mp_a_x mul 588 moveto (NPROC 0152) show
4 mp_a_x mul 576 moveto (1279 1280 1366 2013 2021) show
40 mp_a_x mul 576 moveto (0152 2061 2085 2250 2407) show
0 564 moveto (mp_bcpu 6569) show
40 mp_a_x mul 564 moveto (2420 2459 2501 2532 2592) show
4 mp_a_x mul 552 moveto (0288 1276 6569) show
36 mp_a_x mul 552 moveto (NSEGS 1959) show
0 540 moveto (mp_config 6630) show
40 mp_a_x mul 540 moveto (1959 2020) show
4 mp_a_x mul 528 moveto (6630 6660) show
36 mp_a_x mul 528 moveto (NULL 0366) show
0 516 moveto (mp_init 6651) show
40 mp_a_x mul 516 moveto (0365 0366 2966 2970 2973) show
4 mp_a_x mul 504 moveto (0289 6651 6687 6688) show
36 mp_a_x mul 504 moveto (nulterminate 10652) show
0 492 moveto (mp_search 6606) show
40 mp_a_x mul 492 moveto (10503 10518 10652 10673) show
4 mp_a_x mul 480 moveto (6606 6635) show
40 mp_a_x mul 480 moveto (10679 10680 10685 10686) show
0 468 moveto (mp_search1 6587) show
40 mp_a_x mul 468 moveto (10691) show
4 mp_a_x mul 456 moveto (6587 6614 6618 6621) show
36 mp_a_x mul 456 moveto (NUMLOCK 7163) show
0 444 moveto (msleep_spin 2313) show
40 mp_a_x mul 444 moveto (7163 7196) show
4 mp_a_x mul 432 moveto (0317 1758 2313 7804) show
36 mp_a_x mul 432 moveto (OP_TRANSMIT 9171) show
0 420 moveto (NADDRS 4216) show
40 mp_a_x mul 420 moveto (9171 9817) show
4 mp_a_x mul 408 moveto (4216 4229 4313) show
36 mp_a_x mul 408 moveto (outb 0441) show
0 396 moveto (namecmp 5218) show
40 mp_a_x mul 396 moveto (0441 0983 0991 1214 1215) show
4 mp_a_x mul 384 moveto (0248 5218 5243 5781) show
40 mp_a_x mul 384 moveto (1216 1217 1218 1219 4412) show
0 372 moveto (namei 5392) show
40 mp_a_x mul 372 moveto (4421 4422 4434 4435 4436) show
4 mp_a_x mul 360 moveto (0249 2210 2992 5392 5720) show
40 mp_a_x mul 360 moveto (4437 4438 4440 4443 6695) show
4 mp_a_x mul 348 moveto (5876 5938 6018) show
40 mp_a_x mul 348 moveto (6696 7029 7030 7055 7056) show
0 336 moveto (nameiparent 5401) show
40 mp_a_x mul 336 moveto (7064 7067 7071 7081 7084) show
4 mp_a_x mul 324 moveto (0250 5401 5731 5776 5818) show
40 mp_a_x mul 324 moveto (7085 7086 7089 7095 7096) show
0 312 moveto (NBUF 0158) show
40 mp_a_x mul 312 moveto (7098 7099 7388 7389 7390) show
4 mp_a_x mul 300 moveto (0158 4579 4597) show
40 mp_a_x mul 300 moveto (7406 7408 7425 7426 7427) show
0 288 moveto (NCPU 0155) show
40 mp_a_x mul 288 moveto (7428 7927 7928 7929) show
4 mp_a_x mul 276 moveto (0155 1272 2009 2028 2062) show
36 mp_a_x mul 276 moveto (outl 0457) show
4 mp_a_x mul 264 moveto (6562) show
40 mp_a_x mul 264 moveto (0457 8814 8828 9488 9578) show
0 252 moveto (NDEV 0160) show
36 mp_a_x mul 252 moveto (outsl 0463) show
4 mp_a_x mul 240 moveto (0160 5159 5186 5457) show
40 mp_a_x mul 240 moveto (0463 4441) show
0 228 moveto (NDIRECT 4217) show
36 mp_a_x mul 228 moveto (outw 0451) show
4 mp_a_x mul 216 moveto (4216 4217 4220 5065 5073) show
40 mp_a_x mul 216 moveto (0451 1194 1195 9493 9511) show
4 mp_a_x mul 204 moveto (5108) show
40 mp_a_x mul 204 moveto (9588 9607) show
0 192 moveto (NELEM 0363) show
36 mp_a_x mul 192 moveto (O_CREATE 4053) show
4 mp_a_x mul 180 moveto (0363 2596 3568 5961) show
40 mp_a_x mul 180 moveto (4053 5872 10578 10581) show
0 168 moveto (NFILE 0157) show
36 mp_a_x mul 168 moveto (O_RDONLY 4050) show
4 mp_a_x mul 156 moveto (0157 5459 5474) show
40 mp_a_x mul 156 moveto (4050 10575) show
0 144 moveto (NINDIRECT 4219) show
36 mp_a_x mul 144 moveto (O_RDWR 4052) show
4 mp_a_x mul 132 moveto (4219 4220 5075 5118) show
40 mp_a_x mul 132 moveto (4052 5879 5897 10064) show
0 120 moveto (NINODE 0159) show
40 mp_a_x mul 120 moveto (10066 10307) show
4 mp_a_x mul 108 moveto (0159 4857 4877) show
36 mp_a_x mul 108 moveto (O_WRONLY 4051) show
0 96 moveto (NO 7156) show
40 mp_a_x mul 96 moveto (4051 5879 5896 5897) show
4 mp_a_x mul 84 moveto (7156 7202 7205 7207 7208) show
40 mp_a_x mul 84 moveto (10578 10581) show
4 mp_a_x mul 72 moveto (7209 7210 7212 7224 7227) show
36 mp_a_x mul 72 moveto (PAGE 0153) show
4 mp_a_x mul 60 moveto (7229 7230 7231 7232 7234) show
40 mp_a_x mul 60 moveto (0153 0154 2208 2734 2736) show
grestore
restore
showpage
%%Page: 6 6
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 9) show
4 mp_a_x mul 648 moveto (2737 2760 2762 2814 2817) show
36 mp_a_x mul 648 moveto (PCI_BRIDGE_IO_32BITS 8613) show
4 mp_a_x mul 636 moveto (2846 2856 6051 6054 6178) show
40 mp_a_x mul 636 moveto (8613 8931) show
4 mp_a_x mul 624 moveto (6197 6223 9421 9428 9435) show
36 mp_a_x mul 624 moveto (pci_bridge_pci_attach 8926) show
4 mp_a_x mul 612 moveto (9436) show
40 mp_a_x mul 612 moveto (8768 8782 8926) show
0 600 moveto (panic 7880 10332) show
36 mp_a_x mul 600 moveto (PCI_BRIDGE_STATIO_REG 8606) show
4 mp_a_x mul 588 moveto (0222 1539 1570 1580 2282) show
40 mp_a_x mul 588 moveto (8606 8928) show
4 mp_a_x mul 576 moveto (2284 2321 2323 2364 2367) show
36 mp_a_x mul 576 moveto (pci_bus 7974) show
4 mp_a_x mul 564 moveto (2483 2517 2765 2777 2818) show
40 mp_a_x mul 564 moveto (7958 7961 7974 8864 8937) show
4 mp_a_x mul 552 moveto (4431 4487 4489 4491 4640) show
40 mp_a_x mul 552 moveto (9053) show
4 mp_a_x mul 540 moveto (4667 4677 4789 4816 4890) show
36 mp_a_x mul 540 moveto (PCI_CACHELINE_MASK 8333) show
4 mp_a_x mul 528 moveto (4922 4943 4955 4971 5023) show
40 mp_a_x mul 528 moveto (8333 8335 8342) show
4 mp_a_x mul 516 moveto (5097 5234 5274 5282 5492) show
36 mp_a_x mul 516 moveto (PCI_CACHELINE_SHIFT 8332) show
4 mp_a_x mul 504 moveto (5510 5528 5567 5587 5759) show
40 mp_a_x mul 504 moveto (8332 8335 8342) show
4 mp_a_x mul 492 moveto (5793 5802 5855 6688 7880) show
36 mp_a_x mul 492 moveto (PCI_CLASS 8118) show
4 mp_a_x mul 480 moveto (7887 10201 10220 10253) show
40 mp_a_x mul 480 moveto (8118 8857 8895) show
4 mp_a_x mul 468 moveto (10332 10345 10516 10572) show
36 mp_a_x mul 468 moveto (PCI_CLASS_BRIDGE 8148) show
4 mp_a_x mul 456 moveto (10606 10610 10636 10641) show
40 mp_a_x mul 456 moveto (8148 8781 8782) show
0 444 moveto (parseblock 10601) show
36 mp_a_x mul 444 moveto (PCI_CLASS_DISPLAY 8145) show
4 mp_a_x mul 432 moveto (10601 10606 10625) show
40 mp_a_x mul 432 moveto (8145 8783) show
0 420 moveto (parsecmd 10506) show
36 mp_a_x mul 420 moveto (PCI_CLASS_MASK 8117) show
4 mp_a_x mul 408 moveto (10202 10325 10506) show
40 mp_a_x mul 408 moveto (8117 8119 8137) show
0 396 moveto (parseexec 10617) show
36 mp_a_x mul 396 moveto (PCI_CLASS_NETWORK 8144) show
4 mp_a_x mul 384 moveto (10502 10555 10617) show
40 mp_a_x mul 384 moveto (8144 8784) show
0 372 moveto (parseline 10523) show
36 mp_a_x mul 372 moveto (PCI_CLASS_REG 8109) show
4 mp_a_x mul 360 moveto (10500 10512 10523 10534) show
40 mp_a_x mul 360 moveto (8109 8890) show
4 mp_a_x mul 348 moveto (10608) show
36 mp_a_x mul 348 moveto (PCI_CLASS_SHIFT 8116) show
0 336 moveto (parsepipe 10551) show
40 mp_a_x mul 336 moveto (8116 8119 8137) show
4 mp_a_x mul 324 moveto (10501 10527 10551 10558) show
36 mp_a_x mul 324 moveto (PCI_COMMAND_IO_ENABLE 8080) show
0 312 moveto (parseredirs 10564) show
40 mp_a_x mul 312 moveto (8080 8969) show
4 mp_a_x mul 300 moveto (10564 10612 10631 10642) show
36 mp_a_x mul 300 moveto (PCI_COMMAND_MASK 8072) show
0 288 moveto (PCINT 6725) show
40 mp_a_x mul 288 moveto (8072 8077) show
4 mp_a_x mul 276 moveto (6725 6763) show
36 mp_a_x mul 276 moveto (PCI_COMMAND_MASTER_ENABLE 8082) show
0 264 moveto (pci_attach 8854) show
40 mp_a_x mul 264 moveto (8082 8971) show
4 mp_a_x mul 252 moveto (8854 8900) show
36 mp_a_x mul 252 moveto (PCI_COMMAND_MEM_ENABLE 8081) show
0 240 moveto (pci_attach_match 8832) show
40 mp_a_x mul 240 moveto (8081 8970) show
4 mp_a_x mul 228 moveto (8832 8846 8857 8859) show
36 mp_a_x mul 228 moveto (PCI_COMMAND_SHIFT 8071) show
0 216 moveto (PCI_BHLC_REG 8310) show
40 mp_a_x mul 216 moveto (8071 8077) show
4 mp_a_x mul 204 moveto (8310 8872) show
36 mp_a_x mul 204 moveto (PCI_COMMAND_STATUS_REG 8070) show
0 192 moveto (PCI_BIST_MASK 8313) show
40 mp_a_x mul 192 moveto (8070 8968) show
4 mp_a_x mul 180 moveto (8313 8315 8338) show
36 mp_a_x mul 180 moveto (pci_conf1_set_addr 8801) show
0 168 moveto (PCI_BIST_SHIFT 8312) show
40 mp_a_x mul 168 moveto (8801 8820 8827) show
4 mp_a_x mul 156 moveto (8312 8315 8338) show
36 mp_a_x mul 156 moveto (pci_conf_read 8818) show
0 144 moveto (pci_bridge_attach 8917) show
40 mp_a_x mul 144 moveto (8818 8872 8883 8887 8890) show
4 mp_a_x mul 132 moveto (8767 8781 8917) show
40 mp_a_x mul 132 moveto (8928 8929 8978 8982) show
0 120 moveto (PCI_BRIDGE_BUS_REG 8601) show
36 mp_a_x mul 120 moveto (pci_conf_write 8825) show
4 mp_a_x mul 108 moveto (8601 8929) show
40 mp_a_x mul 108 moveto (8825 8968 8981 9006) show
0 96 moveto (PCI_BRIDGE_BUS_SECONDARY_SHIFT 8603 pci_display_attach 8955) show
4 mp_a_x mul 84 moveto (8603 8940) show
40 mp_a_x mul 84 moveto (8769 8783 8955) show
0 72 moveto (PCI_BRIDGE_BUS_SUBORDINATE_SHIFT 86 pci_driver 8773) show
4 mp_a_x mul 60 moveto (8604 8946) show
40 mp_a_x mul 60 moveto (8773 8780 8789 8833) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 10) show
0 648 moveto (pci_func 7960) show
36 mp_a_x mul 648 moveto (PCI_MAPREG_END 8354) show
4 mp_a_x mul 636 moveto (7960 7975 7980 8767 8768) show
40 mp_a_x mul 636 moveto (8354 8975) show
4 mp_a_x mul 624 moveto (8769 8770 8775 8818 8825) show
36 mp_a_x mul 624 moveto (PCI_MAPREG_IO_ADDR 8391) show
4 mp_a_x mul 612 moveto (8833 8854 8867 8878 8881) show
40 mp_a_x mul 612 moveto (8391 8394 9000) show
4 mp_a_x mul 600 moveto (8908 8917 8926 8955 8966) show
36 mp_a_x mul 600 moveto (PCI_MAPREG_IO_ADDR_MASK 8395) show
4 mp_a_x mul 588 moveto (9104 9411) show
40 mp_a_x mul 588 moveto (8392 8395) show
0 576 moveto (pci_func_enable 8966) show
36 mp_a_x mul 576 moveto (PCI_MAPREG_IO_SIZE 8393) show
4 mp_a_x mul 564 moveto (7980 8966 9441) show
40 mp_a_x mul 564 moveto (8393 8999) show
0 552 moveto (PCI_HDRTYPE 8319) show
36 mp_a_x mul 552 moveto (PCI_MAPREG_MEM64_ADDR 8385) show
4 mp_a_x mul 540 moveto (8319 8323 8325) show
40 mp_a_x mul 540 moveto (8385 8388) show
0 528 moveto (PCI_HDRTYPE_MASK 8318) show
36 mp_a_x mul 528 moveto (PCI_MAPREG_MEM64_ADDR_MASK 8389) show
4 mp_a_x mul 516 moveto (8318 8320 8339) show
40 mp_a_x mul 516 moveto (8386 8389) show
0 504 moveto (PCI_HDRTYPE_MULTIFN 8324) show
36 mp_a_x mul 504 moveto (PCI_MAPREG_MEM_ADDR 8379) show
4 mp_a_x mul 492 moveto (8324 8879) show
40 mp_a_x mul 492 moveto (8379 8382 8994) show
0 480 moveto (PCI_HDRTYPE_SHIFT 8317) show
36 mp_a_x mul 480 moveto (PCI_MAPREG_MEM_ADDR_MASK 8383) show
4 mp_a_x mul 468 moveto (8317 8320 8339 8340) show
40 mp_a_x mul 468 moveto (8380 8383) show
0 456 moveto (PCI_HDRTYPE_TYPE 8322) show
36 mp_a_x mul 456 moveto (PCI_MAPREG_MEM_PREFETCHABLE_MASK 83) show
4 mp_a_x mul 444 moveto (8322 8873) show
40 mp_a_x mul 444 moveto (8376 8377) show
0 432 moveto (PCI_ID_REG 8047) show
36 mp_a_x mul 432 moveto (PCI_MAPREG_MEM_SIZE 8381) show
4 mp_a_x mul 420 moveto (8047 8411 8883) show
40 mp_a_x mul 420 moveto (8381 8993) show
0 408 moveto (pci_init 9051) show
36 mp_a_x mul 408 moveto (PCI_MAPREG_MEM_TYPE 8367) show
4 mp_a_x mul 396 moveto (1307 7979 9051) show
40 mp_a_x mul 396 moveto (8367 8990) show
0 384 moveto (PCI_INTERFACE_MASK 8127) show
36 mp_a_x mul 384 moveto (PCI_MAPREG_MEM_TYPE_64BIT 8373) show
4 mp_a_x mul 372 moveto (8127 8129 8139) show
40 mp_a_x mul 372 moveto (8373 8990) show
0 360 moveto (PCI_INTERFACE_SHIFT 8126) show
36 mp_a_x mul 360 moveto (PCI_MAPREG_MEM_TYPE_MASK 8369) show
4 mp_a_x mul 348 moveto (8126 8129 8139) show
40 mp_a_x mul 348 moveto (8368 8369) show
0 336 moveto (PCI_INTERRUPT_GRANT_MASK 8566) show
36 mp_a_x mul 336 moveto (PCI_MAPREG_NUM 8400) show
4 mp_a_x mul 324 moveto (8566 8568 8587) show
40 mp_a_x mul 324 moveto (8400 8987) show
0 312 moveto (PCI_INTERRUPT_GRANT_SHIFT 8565) show
36 mp_a_x mul 312 moveto (PCI_MAPREG_START 8353) show
4 mp_a_x mul 300 moveto (8565 8568 8587) show
40 mp_a_x mul 300 moveto (8353 8401 8975) show
0 288 moveto (PCI_INTERRUPT_LATENCY_MASK 8571) show
36 mp_a_x mul 288 moveto (PCI_MAPREG_TYPE 8359) show
4 mp_a_x mul 276 moveto (8571 8573 8586) show
40 mp_a_x mul 276 moveto (8359 8989) show
0 264 moveto (PCI_INTERRUPT_LATENCY_SHIFT 8570    PCI_MAPREG_TYPE_MASK 8361) show
4 mp_a_x mul 252 moveto (8570 8573 8586) show
40 mp_a_x mul 252 moveto (8360 8361) show
0 240 moveto (PCI_INTERRUPT_LINE 8582) show
36 mp_a_x mul 240 moveto (PCI_MAPREG_TYPE_MEM 8363) show
4 mp_a_x mul 228 moveto (8582 8888) show
40 mp_a_x mul 228 moveto (8363 8989) show
0 216 moveto (PCI_INTERRUPT_LINE_MASK 8581) show
36 mp_a_x mul 216 moveto (PCI_MAX_LAT_MASK 8556) show
4 mp_a_x mul 204 moveto (8581 8583 8589) show
40 mp_a_x mul 204 moveto (8556 8558) show
0 192 moveto (PCI_INTERRUPT_LINE_SHIFT 8580) show
36 mp_a_x mul 192 moveto (PCI_MAX_LAT_SHIFT 8555) show
4 mp_a_x mul 180 moveto (8580 8583 8589) show
40 mp_a_x mul 180 moveto (8555 8558) show
0 168 moveto (PCI_INTERRUPT_PIN_MASK 8576) show
36 mp_a_x mul 168 moveto (PCI_MIN_GNT_MASK 8561) show
4 mp_a_x mul 156 moveto (8576 8578 8588) show
40 mp_a_x mul 156 moveto (8561 8563) show
0 144 moveto (PCI_INTERRUPT_PIN_SHIFT 8575) show
36 mp_a_x mul 144 moveto (PCI_MIN_GNT_SHIFT 8560) show
4 mp_a_x mul 132 moveto (8575 8578 8588) show
40 mp_a_x mul 132 moveto (8560 8563) show
0 120 moveto (PCI_INTERRUPT_REG 8545) show
36 mp_a_x mul 120 moveto (pci_net_ether_attach 8908) show
4 mp_a_x mul 108 moveto (8545 8887) show
40 mp_a_x mul 108 moveto (8770 8785 8908) show
0 96 moveto (PCI_LATTIMER_MASK 8328) show
36 mp_a_x mul 96 moveto (PCI_PRODUCT 8060) show
4 mp_a_x mul 84 moveto (8328 8330 8341) show
40 mp_a_x mul 84 moveto (8060 8859 8894 8912 8921) show
0 72 moveto (PCI_LATTIMER_SHIFT 8327) show
40 mp_a_x mul 72 moveto (8959 9017 9416) show
4 mp_a_x mul 60 moveto (8327 8330 8341) show
36 mp_a_x mul 60 moveto (PCI_PRODUCT_E100 9109) show
grestore
restore
showpage
%%Page: 7 7
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 11) show
4 mp_a_x mul 648 moveto (8790 9109) show
40 mp_a_x mul 648 moveto (7026 7036 7101) show
0 636 moveto (PCI_PRODUCT_MASK 8059) show
36 mp_a_x mul 636 moveto (pinit 2070) show
4 mp_a_x mul 624 moveto (8059 8061 8065) show
40 mp_a_x mul 624 moveto (0312 1285 2070) show
0 612 moveto (PCI_PRODUCT_SHIFT 8058) show
36 mp_a_x mul 612 moveto (pipe 6160) show
4 mp_a_x mul 600 moveto (8058 8061 8065) show
40 mp_a_x mul 600 moveto (0207 0302 0303 0304 4155) show
0 588 moveto (PCI_REVISION_MASK 8132) show
40 mp_a_x mul 588 moveto (5522 5559 5579 6160 6172) show
4 mp_a_x mul 576 moveto (8132 8134) show
40 mp_a_x mul 576 moveto (6178 6184 6188 6192 6210) show
0 564 moveto (PCI_REVISION_SHIFT 8131) show
40 mp_a_x mul 564 moveto (6227 6251 10113 10252) show
4 mp_a_x mul 552 moveto (8131 8134) show
40 mp_a_x mul 552 moveto (10253) show
0 540 moveto (pci_scan_bus 8864) show
36 mp_a_x mul 540 moveto (pipealloc 6170) show
4 mp_a_x mul 528 moveto (8864 8950 9056) show
40 mp_a_x mul 528 moveto (0301 5984 6170) show
0 516 moveto (PCI_STATUS_MASK 8074) show
36 mp_a_x mul 516 moveto (pipeclose 6210) show
4 mp_a_x mul 504 moveto (8074 8078) show
40 mp_a_x mul 504 moveto (0302 5522 6210) show
0 492 moveto (PCI_STATUS_SHIFT 8073) show
36 mp_a_x mul 492 moveto (pipecmd 10184 10380) show
4 mp_a_x mul 480 moveto (8073 8078) show
40 mp_a_x mul 480 moveto (10184 10212 10251 10380) show
0 468 moveto (PCI_SUBCLASS 8123) show
40 mp_a_x mul 468 moveto (10382 10558 10658 10678) show
4 mp_a_x mul 456 moveto (8123 8857 8895) show
36 mp_a_x mul 456 moveto (piperead 6251) show
0 444 moveto (PCI_SUBCLASS_ANY 8778) show
40 mp_a_x mul 444 moveto (0303 5559 6251) show
4 mp_a_x mul 432 moveto (8778 8781 8783) show
36 mp_a_x mul 432 moveto (PIPESIZE 6158) show
0 420 moveto (PCI_SUBCLASS_BRIDGE_PCI 8210) show
40 mp_a_x mul 420 moveto (6158 6166 6233 6242 6267) show
4 mp_a_x mul 408 moveto (8210 8782) show
36 mp_a_x mul 408 moveto (pipewrite 6227) show
0 396 moveto (PCI_SUBCLASS_MASK 8122) show
40 mp_a_x mul 396 moveto (0304 5579 6227) show
4 mp_a_x mul 384 moveto (8122 8124 8138) show
36 mp_a_x mul 384 moveto (PORT_SOFT_RESET 9160) show
0 372 moveto (PCI_SUBCLASS_NETWORK_ETHERNET 8177) show
40 mp_a_x mul 372 moveto (9160 9488) show
4 mp_a_x mul 360 moveto (8177 8784) show
36 mp_a_x mul 360 moveto (printint 7501) show
0 348 moveto (PCI_SUBCLASS_SHIFT 8121) show
40 mp_a_x mul 348 moveto (7501 7591 7600 7610) show
4 mp_a_x mul 336 moveto (8121 8124 8138) show
36 mp_a_x mul 336 moveto (printintlen 7451) show
0 324 moveto (PCI_VENDOR 8055) show
40 mp_a_x mul 324 moveto (7451 7589 7598 7608) show
4 mp_a_x mul 312 moveto (8055 8859 8884 8894 8912) show
36 mp_a_x mul 312 moveto (printstack 7865) show
4 mp_a_x mul 300 moveto (8921 8959 9017 9416) show
40 mp_a_x mul 300 moveto (0223 2815 7865) show
0 288 moveto (PCI_VENDOR_INTEL 9108) show
36 mp_a_x mul 288 moveto (proc 1983) show
4 mp_a_x mul 276 moveto (8790 9108) show
40 mp_a_x mul 276 moveto (0208 0307 0308 0315 0348) show
0 264 moveto (PCI_VENDOR_MASK 8054) show
40 mp_a_x mul 264 moveto (0349 1254 1507 1983 1989) show
4 mp_a_x mul 252 moveto (8054 8056 8064) show
40 mp_a_x mul 252 moveto (2009 2055 2061 2062 2063) show
0 240 moveto (PCI_VENDOR_SHIFT 8053) show
40 mp_a_x mul 240 moveto (2078 2082 2086 2122 2153) show
4 mp_a_x mul 228 moveto (8053 8056 8064) show
40 mp_a_x mul 228 moveto (2154 2157 2204 2242 2251) show
0 216 moveto (PCI_VPD_ADDRESS_MASK 8448) show
40 mp_a_x mul 216 moveto (2405 2407 2418 2420 2456) show
4 mp_a_x mul 204 moveto (8448 8451) show
40 mp_a_x mul 204 moveto (2459 2479 2501 2525 2533) show
0 192 moveto (PCI_VPD_ADDRESS_SHIFT 8449) show
40 mp_a_x mul 192 moveto (2588 2593 2913 2918 2955) show
4 mp_a_x mul 180 moveto (8449 8451) show
40 mp_a_x mul 180 moveto (2959 2961 2968 2990 3002) show
0 168 moveto (peek 10475) show
40 mp_a_x mul 168 moveto (3204 3294 3404 3416 3428) show
4 mp_a_x mul 156 moveto (10475 10513 10528 10532) show
40 mp_a_x mul 156 moveto (3604 3610 4356 4717 5605) show
4 mp_a_x mul 144 moveto (10556 10569 10605 10609) show
40 mp_a_x mul 144 moveto (6003 6154 6560 6656 6669) show
4 mp_a_x mul 132 moveto (10624 10632) show
40 mp_a_x mul 132 moveto (6670 6671 7361 9356) show
0 120 moveto (pic_enable 7034) show
36 mp_a_x mul 120 moveto (procdump 2576) show
4 mp_a_x mul 108 moveto (0293 4406 7034 7860 7930) show
40 mp_a_x mul 108 moveto (0313 2576 7700) show
4 mp_a_x mul 96 moveto (9466) show
36 mp_a_x mul 96 moveto (proc_table_lock 2059) show
0 84 moveto (pic_init 7052) show
40 mp_a_x mul 84 moveto (2030 2059 2072 2084 2091) show
4 mp_a_x mul 72 moveto (0294 1287 7052) show
40 mp_a_x mul 72 moveto (2095 2247 2272 2283 2284) show
0 60 moveto (pic_setmask 7026) show
40 mp_a_x mul 60 moveto (2295 2298 2306 2325 2327) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 12) show
4 mp_a_x mul 648 moveto (2350 2352 2375 2376 2389) show
40 mp_a_x mul 648 moveto (0161 5360) show
4 mp_a_x mul 636 moveto (2390 2432 2434 2442 2444) show
36 mp_a_x mul 636 moveto (RUC_START 9152) show
4 mp_a_x mul 624 moveto (2458 2465 2469 2496 2528) show
40 mp_a_x mul 624 moveto (9152 9921 9958) show
4 mp_a_x mul 612 moveto (2554 2563 2568 3009) show
36 mp_a_x mul 612 moveto (run 2715) show
0 600 moveto (proghdr 0874) show
40 mp_a_x mul 600 moveto (2583 2715 2716 2719 2757) show
4 mp_a_x mul 588 moveto (0874 1170 1183 6016) show
40 mp_a_x mul 588 moveto (2772 2773 2775 2811) show
0 576 moveto (readi 5152) show
36 mp_a_x mul 576 moveto (runcmd 10206) show
4 mp_a_x mul 564 moveto (0251 5152 5273 5562 5758) show
40 mp_a_x mul 564 moveto (10206 10220 10237 10243) show
4 mp_a_x mul 552 moveto (5759 6028 6033 6062 6068) show
40 mp_a_x mul 552 moveto (10245 10259 10266 10277) show
0 540 moveto (readsb 4729) show
40 mp_a_x mul 540 moveto (10325) show
4 mp_a_x mul 528 moveto (4729 4775 4811 5010) show
36 mp_a_x mul 528 moveto (RUNNABLE 1979) show
0 516 moveto (readsect 1210) show
40 mp_a_x mul 516 moveto (1979 2227 2252 2261 2296) show
4 mp_a_x mul 504 moveto (1210 1246) show
40 mp_a_x mul 504 moveto (2410 2424 2464 2582 2993) show
0 492 moveto (readseg 1229) show
40 mp_a_x mul 492 moveto (3614) show
4 mp_a_x mul 480 moveto (1164 1176 1186 1229) show
36 mp_a_x mul 480 moveto (safestrcpy 6402) show
0 468 moveto (REDIR 10158) show
40 mp_a_x mul 468 moveto (0338 2226 2984 2986 6104) show
4 mp_a_x mul 456 moveto (10158 10230 10370 10671) show
40 mp_a_x mul 456 moveto (6402) show
0 444 moveto (redircmd 10175 10364) show
36 mp_a_x mul 444 moveto (SCB_COMMAND 9121) show
4 mp_a_x mul 432 moveto (10175 10213 10231 10364) show
40 mp_a_x mul 432 moveto (9121 9493 9572 9588 9607) show
4 mp_a_x mul 420 moveto (10366 10575 10578 10581) show
36 mp_a_x mul 420 moveto (scb_command_word 9205) show
4 mp_a_x mul 408 moveto (10659 10672) show
40 mp_a_x mul 408 moveto (9205 9222 9223 9490 9584) show
0 396 moveto (REG_ID 6860) show
40 mp_a_x mul 396 moveto (9603) show
4 mp_a_x mul 384 moveto (6860 6910) show
36 mp_a_x mul 384 moveto (SCB_GENPTR 9122) show
0 372 moveto (reg_irq_handler 7020) show
40 mp_a_x mul 372 moveto (9122 9578) show
4 mp_a_x mul 360 moveto (4409 6956 7020 9465) show
36 mp_a_x mul 360 moveto (SCB_PORT 9123) show
0 348 moveto (REG_TABLE 6862) show
40 mp_a_x mul 348 moveto (9123 9488) show
4 mp_a_x mul 336 moveto (6862 6917 6918 6931 6932) show
36 mp_a_x mul 336 moveto (SCB_STATUS 9120) show
0 324 moveto (REG_VER 6861) show
40 mp_a_x mul 324 moveto (9120 9504 9511) show
4 mp_a_x mul 312 moveto (6861 6909) show
36 mp_a_x mul 312 moveto (scb_status_word 9182) show
0 300 moveto (release 1567) show
40 mp_a_x mul 300 moveto (9182 9202 9203 9395 9396) show
4 mp_a_x mul 288 moveto (0332 1567 1570 1580 1735) show
40 mp_a_x mul 288 moveto (9500 9503 9509 9514 9517) show
4 mp_a_x mul 276 moveto (1748 1766 1783 1793 2091) show
40 mp_a_x mul 276 moveto (9521 9649 9650) show
4 mp_a_x mul 264 moveto (2095 2272 2298 2306 2328) show
36 mp_a_x mul 264 moveto (sched 2279) show
4 mp_a_x mul 252 moveto (2352 2377 2390 2434 2444) show
40 mp_a_x mul 252 moveto (2279 2282 2284 2297 2335) show
4 mp_a_x mul 240 moveto (2465 2469 2554 2563 2801) show
40 mp_a_x mul 240 moveto (2383 2516) show
4 mp_a_x mul 228 moveto (2824 2830 2834 3009 3256) show
36 mp_a_x mul 228 moveto (scheduler 2240) show
4 mp_a_x mul 216 moveto (3675 3680 4458 4475 4512) show
40 mp_a_x mul 216 moveto (0314 1318 1337 2240) show
4 mp_a_x mul 204 moveto (4625 4636 4691 4880 4898) show
36 mp_a_x mul 204 moveto (SCROLLLOCK 7164) show
4 mp_a_x mul 192 moveto (4910 4928 4960 4973 4982) show
40 mp_a_x mul 192 moveto (7164 7197) show
4 mp_a_x mul 180 moveto (5478 5482 5494 5513 5519) show
36 mp_a_x mul 180 moveto (SECTSIZE 1162) show
4 mp_a_x mul 168 moveto (6220 6235 6245 6258 6270) show
40 mp_a_x mul 168 moveto (1162 1176 1223 1237 1240) show
4 mp_a_x mul 156 moveto (7662 7674 7727 7797 7844) show
40 mp_a_x mul 156 moveto (1245) show
4 mp_a_x mul 144 moveto (9625 9812 9854 9942 9962) show
36 mp_a_x mul 144 moveto (SEG 0704) show
0 132 moveto (ring_alloc 9751) show
40 mp_a_x mul 132 moveto (0704 2134 2135 2139 2140) show
4 mp_a_x mul 120 moveto (9751 9808) show
36 mp_a_x mul 120 moveto (SEG16 0709) show
0 108 moveto (ring_init 9867) show
40 mp_a_x mul 108 moveto (0709 2136) show
4 mp_a_x mul 96 moveto (9403 9437 9867) show
36 mp_a_x mul 96 moveto (segdesc 0679) show
0 84 moveto (ring_printinfo 9731) show
40 mp_a_x mul 84 moveto (0471 0474 0679 0701 0704) show
4 mp_a_x mul 72 moveto (9402 9692 9731) show
40 mp_a_x mul 72 moveto (0709 2020) show
0 60 moveto (ROOTDEV 0161) show
36 mp_a_x mul 60 moveto (SEG_ASM 0608) show
grestore
restore
showpage
%%Page: 8 8
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 13) show
4 mp_a_x mul 648 moveto (0608 1028 1029 1118 1119) show
40 mp_a_x mul 648 moveto (3207 3213 4359 4375 4576) show
0 636 moveto (SEG_KCODE 1954) show
40 mp_a_x mul 636 moveto (4580 4718 4856 5454 5458) show
4 mp_a_x mul 624 moveto (1954 2134 3222 3223) show
40 mp_a_x mul 624 moveto (6156 6165 7358 7372 7682) show
0 612 moveto (SEG_KDATA 1955) show
40 mp_a_x mul 612 moveto (9372 9382 9390) show
4 mp_a_x mul 600 moveto (1955 2127 2135) show
36 mp_a_x mul 600 moveto (start 0962 1075 10007) show
0 588 moveto (SEG_NULL 0701) show
40 mp_a_x mul 588 moveto (0961 0962 1017 1074 1075) show
4 mp_a_x mul 576 moveto (0701 2133 2142 2143) show
40 mp_a_x mul 576 moveto (1110 1111 2730 2733 2734) show
0 564 moveto (SEG_NULLASM 0604) show
40 mp_a_x mul 564 moveto (2737 9807 9810 9824 9825) show
4 mp_a_x mul 552 moveto (0604 1027 1117) show
40 mp_a_x mul 552 moveto (9827 9828 9829 9830 9831) show
0 540 moveto (SEG_TSS 1958) show
40 mp_a_x mul 540 moveto (9832 9839 9840 9844 9845) show
4 mp_a_x mul 528 moveto (1958 2136 2137 2147) show
40 mp_a_x mul 528 moveto (9850 9851 9853 10006) show
0 516 moveto (SEG_UCODE 1956) show
40 mp_a_x mul 516 moveto (10007) show
4 mp_a_x mul 504 moveto (1956 2139 2142 2212) show
36 mp_a_x mul 504 moveto (stat 4100) show
0 492 moveto (SEG_UDATA 1957) show
40 mp_a_x mul 492 moveto (0210 0234 0252 4100 4715) show
4 mp_a_x mul 480 moveto (1957 2140 2143 2213) show
40 mp_a_x mul 480 moveto (5132 5534 5603 5704 8076) show
0 468 moveto (sem 1706) show
40 mp_a_x mul 468 moveto (8078 9229 9396 9509 9511) show
4 mp_a_x mul 456 moveto (1653 1654 1656 1657 1658) show
40 mp_a_x mul 456 moveto (9521 9522 9523 9525 9527) show
4 mp_a_x mul 444 moveto (1659 1660 1661 1662 1704) show
40 mp_a_x mul 444 moveto (9529 9531 9533 9650 9654) show
4 mp_a_x mul 432 moveto (1706 1712 1715 1716 1717) show
40 mp_a_x mul 432 moveto (9658 9672 9716 9721 9723) show
4 mp_a_x mul 420 moveto (1721 1723 1727 1729 1730) show
40 mp_a_x mul 420 moveto (9725 10053) show
4 mp_a_x mul 408 moveto (1731 1733 1735 1738 1740) show
36 mp_a_x mul 408 moveto (stati 5132) show
4 mp_a_x mul 396 moveto (1741 1743 1744 1745 1747) show
40 mp_a_x mul 396 moveto (0252 5132 5538) show
4 mp_a_x mul 384 moveto (1748 1750 1754 1755 1757) show
36 mp_a_x mul 384 moveto (STA_R 0617 0721) show
4 mp_a_x mul 372 moveto (1758 1759 1761 1763 1766) show
40 mp_a_x mul 372 moveto (0617 0721 1028 1118 2134) show
4 mp_a_x mul 360 moveto (1771 1775 1776 1778 1783) show
40 mp_a_x mul 360 moveto (2139) show
4 mp_a_x mul 348 moveto (1787 1791 1792 1793 1802) show
36 mp_a_x mul 348 moveto (STA_W 0616 0720) show
0 336 moveto (sem_t 1654) show
40 mp_a_x mul 336 moveto (0616 0720 1029 1119 2135) show
4 mp_a_x mul 324 moveto (1654 1656 1657 1658 1659) show
40 mp_a_x mul 324 moveto (2140) show
4 mp_a_x mul 312 moveto (1660 1661 1662 1712 1721) show
36 mp_a_x mul 312 moveto (STA_X 0613 0717) show
4 mp_a_x mul 300 moveto (1727 1738 1750 1771 1787) show
40 mp_a_x mul 300 moveto (0613 0717 1028 1118 2134) show
0 288 moveto (SETGATE 0808) show
40 mp_a_x mul 288 moveto (2139) show
4 mp_a_x mul 276 moveto (0808 3222 3223) show
36 mp_a_x mul 276 moveto (sti 0557) show
0 264 moveto (setupsegs 2122) show
40 mp_a_x mul 264 moveto (0557 0559 1316 1335 1585) show
4 mp_a_x mul 252 moveto (0315 1294 1328 2122 2260) show
36 mp_a_x mul 252 moveto (strlen 6416) show
4 mp_a_x mul 240 moveto (2269 3660 6112) show
40 mp_a_x mul 240 moveto (0339 6045 6081 6416) show
0 228 moveto (SHIFT 7158) show
40 mp_a_x mul 228 moveto (10319 10511) show
4 mp_a_x mul 216 moveto (7158 7186 7187 7335) show
36 mp_a_x mul 216 moveto (strncmp 6371) show
0 204 moveto (skipelem 5314) show
40 mp_a_x mul 204 moveto (0340 5220 6371) show
4 mp_a_x mul 192 moveto (5314 5364) show
36 mp_a_x mul 192 moveto (strncpy 6381) show
0 180 moveto (sleep 2361) show
40 mp_a_x mul 180 moveto (0341 5279 6381) show
4 mp_a_x mul 168 moveto (0316 1744 2361 2364 2367) show
36 mp_a_x mul 168 moveto (STS_IG32 0735) show
4 mp_a_x mul 156 moveto (2568 2581 3678 4508 4621) show
40 mp_a_x mul 156 moveto (0735 0814) show
4 mp_a_x mul 144 moveto (4926 6239 6261 7802 9618) show
36 mp_a_x mul 144 moveto (STS_T32A 0732) show
4 mp_a_x mul 132 moveto (9939 10129) show
40 mp_a_x mul 132 moveto (0732 2136) show
0 120 moveto (spinlock 1403) show
36 mp_a_x mul 120 moveto (STS_TG32 0736) show
4 mp_a_x mul 108 moveto (0209 0316 0317 0328 0330) show
40 mp_a_x mul 108 moveto (0736 0814) show
4 mp_a_x mul 96 moveto (0331 0332 0360 1403 1508) show
36 mp_a_x mul 96 moveto (STUB 10103 10110 10111 10112 10113) show
4 mp_a_x mul 84 moveto (1513 1526 1567 1620 1702) show
40 mp_a_x mul 84 moveto (10110 10111 10112 10113) show
4 mp_a_x mul 72 moveto (1707 1950 2025 2030 2056) show
40 mp_a_x mul 72 moveto (10114 10115 10116 10117) show
4 mp_a_x mul 60 moveto (2059 2313 2361 2710 2713) show
40 mp_a_x mul 60 moveto (10118 10119 10120 10121) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 14) show
4 mp_a_x mul 648 moveto (10122 10123 10124 10125) show
40 mp_a_x mul 648 moveto (3374 3547) show
4 mp_a_x mul 636 moveto (10126 10127 10128 10129) show
36 mp_a_x mul 636 moveto (SYS_mkdir 3365) show
4 mp_a_x mul 624 moveto (10130 10131 10132 10133) show
40 mp_a_x mul 624 moveto (3365 3533) show
4 mp_a_x mul 612 moveto (10134 10135 10136 10137) show
36 mp_a_x mul 612 moveto (SYS_mknod 3361) show
4 mp_a_x mul 600 moveto (10138 10139 10140 10141) show
40 mp_a_x mul 600 moveto (3361 3534) show
4 mp_a_x mul 588 moveto (10142 10143 10144 10145) show
36 mp_a_x mul 588 moveto (SYS_open 3360) show
0 576 moveto (sum 6575) show
40 mp_a_x mul 576 moveto (3360 3535) show
4 mp_a_x mul 564 moveto (6575 6577 6579 6581 6582) show
36 mp_a_x mul 564 moveto (SYS_pipe 3354) show
4 mp_a_x mul 552 moveto (6593 6642) show
40 mp_a_x mul 552 moveto (3354 3536) show
0 540 moveto (superblock 4210) show
36 mp_a_x mul 540 moveto (SYS_read 3356) show
4 mp_a_x mul 528 moveto (4210 4729 4771 4805 5007) show
40 mp_a_x mul 528 moveto (3356 3537) show
0 516 moveto (SVR 6711) show
36 mp_a_x mul 516 moveto (SYS_recv 3376) show
4 mp_a_x mul 504 moveto (6711 6743) show
40 mp_a_x mul 504 moveto (3376 3549) show
0 492 moveto (swtch 2656) show
36 mp_a_x mul 492 moveto (SYS_recvfrom 3377) show
4 mp_a_x mul 480 moveto (0325 2263 2288 2655 2656) show
40 mp_a_x mul 480 moveto (3377 3550) show
0 468 moveto (syscall 3563) show
36 mp_a_x mul 468 moveto (SYS_sbrk 3369) show
4 mp_a_x mul 456 moveto (0350 3241 3406 3563) show
40 mp_a_x mul 456 moveto (3369 3538) show
0 444 moveto (SYS_accept 3375) show
36 mp_a_x mul 444 moveto (SYS_send 3378) show
4 mp_a_x mul 432 moveto (3375 3548) show
40 mp_a_x mul 432 moveto (3378 3551) show
0 420 moveto (SYS_bind 3373) show
36 mp_a_x mul 420 moveto (SYS_sendto 3379) show
4 mp_a_x mul 408 moveto (3373 3546) show
40 mp_a_x mul 408 moveto (3379 3552) show
0 396 moveto (SYS_chdir 3366) show
36 mp_a_x mul 396 moveto (SYS_setsockopt 3382) show
4 mp_a_x mul 384 moveto (3366 3523) show
40 mp_a_x mul 384 moveto (3382 3555) show
0 372 moveto (SYS_close 3357) show
36 mp_a_x mul 372 moveto (SYS_shutdown 3380) show
4 mp_a_x mul 360 moveto (3357 3524) show
40 mp_a_x mul 360 moveto (3380 3553) show
0 348 moveto (SYS_connect 3384) show
36 mp_a_x mul 348 moveto (SYS_sleep 3370) show
4 mp_a_x mul 336 moveto (3384 3557) show
40 mp_a_x mul 336 moveto (3370 3539) show
0 324 moveto (SYS_dup 3367) show
36 mp_a_x mul 324 moveto (SYS_sockclose 3383) show
4 mp_a_x mul 312 moveto (3367 3525) show
40 mp_a_x mul 312 moveto (3383 3556) show
0 300 moveto (SYS_exec 3359) show
36 mp_a_x mul 300 moveto (SYS_socket 3372) show
4 mp_a_x mul 288 moveto (3359 3526 10011) show
40 mp_a_x mul 288 moveto (3372 3545) show
0 276 moveto (SYS_exit 3352) show
36 mp_a_x mul 276 moveto (sys_timeouts 2907) show
4 mp_a_x mul 264 moveto (3352 3527 10016) show
40 mp_a_x mul 264 moveto (2907 2915) show
0 252 moveto (SYS_fork 3351) show
36 mp_a_x mul 252 moveto (SYS_TIMEOUTS_DEFINED 2905) show
4 mp_a_x mul 240 moveto (3351 3528) show
40 mp_a_x mul 240 moveto (2904 2905) show
0 228 moveto (SYS_fstat 3363) show
36 mp_a_x mul 228 moveto (SYS_unlink 3362) show
4 mp_a_x mul 216 moveto (3363 3529) show
40 mp_a_x mul 216 moveto (3362 3540) show
0 204 moveto (SYS_getpeername 3385) show
36 mp_a_x mul 204 moveto (SYS_upmsec 3371) show
4 mp_a_x mul 192 moveto (3385 3558) show
40 mp_a_x mul 192 moveto (3371 3543) show
0 180 moveto (SYS_getpid 3368) show
36 mp_a_x mul 180 moveto (SYS_wait 3353) show
4 mp_a_x mul 168 moveto (3368 3530) show
40 mp_a_x mul 168 moveto (3353 3541) show
0 156 moveto (SYS_getsockname 3386) show
36 mp_a_x mul 156 moveto (SYS_write 3355) show
4 mp_a_x mul 144 moveto (3386 3559) show
40 mp_a_x mul 144 moveto (3355 3542) show
0 132 moveto (SYS_getsockopt 3381) show
36 mp_a_x mul 132 moveto (taskstate 0739) show
4 mp_a_x mul 120 moveto (3381 3554) show
40 mp_a_x mul 120 moveto (0739 2019) show
0 108 moveto (SYS_kill 3358) show
36 mp_a_x mul 108 moveto (TBD_DATA_LIMIT 9306) show
4 mp_a_x mul 96 moveto (3358 3531) show
40 mp_a_x mul 96 moveto (9306 9804) show
0 84 moveto (SYS_link 3364) show
36 mp_a_x mul 84 moveto (TCCR 6731) show
4 mp_a_x mul 72 moveto (3364 3532) show
40 mp_a_x mul 72 moveto (6731 6753) show
0 60 moveto (SYS_listen 3374) show
36 mp_a_x mul 60 moveto (TDCR 6732) show
grestore
restore
showpage
%%Page: 9 9
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 15) show
4 mp_a_x mul 648 moveto (6732 6751) show
40 mp_a_x mul 648 moveto (4233 5873) show
0 636 moveto (thread 2912) show
36 mp_a_x mul 636 moveto (T_SYSCALL 3076) show
4 mp_a_x mul 624 moveto (1997 2057 2902 2912 2920) show
40 mp_a_x mul 624 moveto (3076 3223 3237 10012) show
4 mp_a_x mul 612 moveto (2952 2957 2964 2984 3000) show
40 mp_a_x mul 612 moveto (10017 10107) show
4 mp_a_x mul 600 moveto (3002 3004 3007 3010 7363) show
36 mp_a_x mul 600 moveto (uint16_t 0105) show
4 mp_a_x mul 588 moveto (9363 9468) show
40 mp_a_x mul 588 moveto (0105 8050 8051 9201 9221) show
0 576 moveto (thread_stub 7731) show
40 mp_a_x mul 576 moveto (9227 9236 9252 9282 9285) show
4 mp_a_x mul 564 moveto (7731 7736) show
36 mp_a_x mul 564 moveto (uint32_t 0103) show
0 552 moveto (ticks 3214) show
40 mp_a_x mul 552 moveto (0103 2315 2316 7963 7964) show
4 mp_a_x mul 540 moveto (0358 3214 3254 3255 3672) show
40 mp_a_x mul 540 moveto (7966 7967 7969 7970 7976) show
4 mp_a_x mul 528 moveto (3673 3678 7936) show
40 mp_a_x mul 528 moveto (8763 8764 8774 8801 8802) show
0 516 moveto (tickslock 3213) show
40 mp_a_x mul 516 moveto (8803 8804 8812 8817 8818) show
4 mp_a_x mul 504 moveto (0360 3213 3225 3253 3256) show
40 mp_a_x mul 504 moveto (8825 8832 8835 8872 8887) show
4 mp_a_x mul 492 moveto (3671 3675 3678 3680) show
40 mp_a_x mul 492 moveto (8928 8929 8973 8974 8978) show
0 480 moveto (TICR 6730) show
40 mp_a_x mul 480 moveto (8982 8988 9105 9106 9268) show
4 mp_a_x mul 468 moveto (6730 6752) show
40 mp_a_x mul 468 moveto (9280 9369 9370 9373 9374) show
0 456 moveto (TIMER 6722) show
40 mp_a_x mul 456 moveto (9377 9383 9384 9385 9421) show
4 mp_a_x mul 444 moveto (6722 6754) show
40 mp_a_x mul 444 moveto (9428 9578 9751 9767 9768) show
0 432 moveto (TIMER_16BIT 7921) show
40 mp_a_x mul 432 moveto (9788 9789 9801 9859 9886) show
4 mp_a_x mul 420 moveto (7921 7927) show
40 mp_a_x mul 420 moveto (9909 9925) show
0 408 moveto (TIMER_DIV 7916) show
36 mp_a_x mul 408 moveto (uint8_t 0107) show
4 mp_a_x mul 396 moveto (7916 7928 7929) show
40 mp_a_x mul 396 moveto (0107 7971 8111 8112 8113) show
0 384 moveto (TIMER_FREQ 7915) show
40 mp_a_x mul 384 moveto (8114 8550 8551 8552 8553) show
4 mp_a_x mul 372 moveto (7915 7916) show
40 mp_a_x mul 372 moveto (8658 8663 8664 8665 8684) show
0 360 moveto (timer_init 7924) show
40 mp_a_x mul 360 moveto (8685 8686 9273 9274 9397) show
4 mp_a_x mul 348 moveto (0353 1310 7924) show
40 mp_a_x mul 348 moveto (9569) show
0 336 moveto (TIMER_MODE 7918) show
36 mp_a_x mul 336 moveto (userinit 2202) show
4 mp_a_x mul 324 moveto (7918 7927) show
40 mp_a_x mul 324 moveto (0318 1311 2202) show
0 312 moveto (TIMER_RATEGEN 7920) show
36 mp_a_x mul 312 moveto (VER 6708) show
4 mp_a_x mul 300 moveto (7920 7927) show
40 mp_a_x mul 300 moveto (6708 6762) show
0 288 moveto (TIMER_SEL0 7919) show
36 mp_a_x mul 288 moveto (wait 2523) show
4 mp_a_x mul 276 moveto (7919 7927) show
40 mp_a_x mul 276 moveto (0319 2523 2540 3628) show
0 264 moveto (TPR 6709) show
40 mp_a_x mul 264 moveto (10083 10112 10244 10270) show
4 mp_a_x mul 252 moveto (6709 6782) show
40 mp_a_x mul 252 moveto (10271 10326) show
0 240 moveto (trap 3235) show
36 mp_a_x mul 240 moveto (waitdisk 1201) show
4 mp_a_x mul 228 moveto (3102 3104 3169 3235 3286) show
40 mp_a_x mul 228 moveto (1201 1213 1222) show
4 mp_a_x mul 216 moveto (3293) show
36 mp_a_x mul 216 moveto (wakeup 2440) show
0 204 moveto (trapframe 0564) show
40 mp_a_x mul 204 moveto (0320 2440 3255 4469 4689) show
4 mp_a_x mul 192 moveto (0564 1995 2067 2168 3235) show
40 mp_a_x mul 192 moveto (4959 4979 6215 6218 6238) show
4 mp_a_x mul 180 moveto (4395 6954 9400 9629) show
40 mp_a_x mul 180 moveto (6244 6269 7721 9663 9665) show
0 168 moveto (trapret 3174) show
36 mp_a_x mul 168 moveto (wakeup1 2403) show
4 mp_a_x mul 156 moveto (3173 3174 3186) show
40 mp_a_x mul 156 moveto (2403 2443 2499 2505) show
0 144 moveto (tvinit 3217) show
36 mp_a_x mul 144 moveto (wakeup_one 2430) show
4 mp_a_x mul 132 moveto (0359 1290 3217) show
40 mp_a_x mul 132 moveto (0321 1733 2430) show
0 120 moveto (T_DEV 4234) show
36 mp_a_x mul 120 moveto (wakeup_one1 2416) show
4 mp_a_x mul 108 moveto (4234 5158 5185 5914) show
40 mp_a_x mul 108 moveto (2416 2433) show
0 96 moveto (T_DIR 4232) show
36 mp_a_x mul 96 moveto (writei 5180) show
4 mp_a_x mul 84 moveto (4232 5233 5368 5723 5794) show
40 mp_a_x mul 84 moveto (0253 5180 5281 5582 5801) show
4 mp_a_x mul 72 moveto (5850 5879 5926 5941) show
40 mp_a_x mul 72 moveto (5802) show
0 60 moveto (T_FILE 4233) show
36 mp_a_x mul 60 moveto (XV6_ASSERT_H_ 1851) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  cross-references  Page 16) show
4 mp_a_x mul 648 moveto (1850 1851) show
36 mp_a_x mul 648 moveto (XV6_SPINLOCK_H_ 1401) show
0 636 moveto (XV6_DEFS_H_ 0201) show
40 mp_a_x mul 636 moveto (1400 1401) show
4 mp_a_x mul 624 moveto (0200 0201) show
36 mp_a_x mul 624 moveto (XV6_THREAD_H_ 2901) show
0 612 moveto (XV6_E100_H_ 9101) show
40 mp_a_x mul 612 moveto (2900 2901) show
4 mp_a_x mul 600 moveto (9100 9101) show
36 mp_a_x mul 600 moveto (XV6_TYPES_H_ 0101) show
0 588 moveto (XV6_MMU_H_ 0651) show
40 mp_a_x mul 588 moveto (0100 0101) show
4 mp_a_x mul 576 moveto (0650 0651) show
36 mp_a_x mul 576 moveto (XV6_X86_H_ 0401) show
0 564 moveto (XV6_PARAM_H_ 0151) show
40 mp_a_x mul 564 moveto (0400 0401) show
4 mp_a_x mul 552 moveto (0150 0151) show
36 mp_a_x mul 552 moveto (yield 2293) show
0 540 moveto (XV6_PCI_H_ 7951) show
40 mp_a_x mul 540 moveto (0322 2293 3311) show
4 mp_a_x mul 528 moveto (7950 7951) show
36 mp_a_x mul 528 moveto (_DEV_PCI_PCIREG_H_ 8034) show
0 516 moveto (XV6_PICIRQ_H_ 6951) show
40 mp_a_x mul 516 moveto (8033 8034 8722) show
4 mp_a_x mul 504 moveto (6950 6951) show
36 mp_a_x mul 504 moveto (_namei 5354) show
0 492 moveto (XV6_SEM_H_ 1651) show
40 mp_a_x mul 492 moveto (5354 5395 5403) show
4 mp_a_x mul 480 moveto (1650 1651) show
grestore
restore
showpage
%%Page: 10 10
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/types.h  Page 1) show
0 648 moveto (0100 #ifndef XV6_TYPES_H_) show
0 636 moveto (0101 #define XV6_TYPES_H_) show
0 624 moveto (0102 typedef unsigned int   uint;) show
0 612 moveto (0103 typedef unsigned int   uint32_t;) show
0 600 moveto (0104 typedef unsigned short ushort;) show
0 588 moveto (0105 typedef unsigned short uint16_t;) show
0 576 moveto (0106 typedef unsigned char  uchar;) show
0 564 moveto (0107 typedef unsigned char  uint8_t;) show
0 552 moveto (0108 #endif // XV6_TYPES_H_) show
0 540 moveto (0109 ) show
0 528 moveto (0110 ) show
0 516 moveto (0111 ) show
0 504 moveto (0112 ) show
0 492 moveto (0113 ) show
0 480 moveto (0114 ) show
0 468 moveto (0115 ) show
0 456 moveto (0116 ) show
0 444 moveto (0117 ) show
0 432 moveto (0118 ) show
0 420 moveto (0119 ) show
0 408 moveto (0120 ) show
0 396 moveto (0121 ) show
0 384 moveto (0122 ) show
0 372 moveto (0123 ) show
0 360 moveto (0124 ) show
0 348 moveto (0125 ) show
0 336 moveto (0126 ) show
0 324 moveto (0127 ) show
0 312 moveto (0128 ) show
0 300 moveto (0129 ) show
0 288 moveto (0130 ) show
0 276 moveto (0131 ) show
0 264 moveto (0132 ) show
0 252 moveto (0133 ) show
0 240 moveto (0134 ) show
0 228 moveto (0135 ) show
0 216 moveto (0136 ) show
0 204 moveto (0137 ) show
0 192 moveto (0138 ) show
0 180 moveto (0139 ) show
0 168 moveto (0140 ) show
0 156 moveto (0141 ) show
0 144 moveto (0142 ) show
0 132 moveto (0143 ) show
0 120 moveto (0144 ) show
0 108 moveto (0145 ) show
0 96 moveto (0146 ) show
0 84 moveto (0147 ) show
0 72 moveto (0148 ) show
0 60 moveto (0149 ) show
0 24 moveto (Sheet 01) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/param.h  Page 1) show
0 648 moveto (0150 #ifndef XV6_PARAM_H_) show
0 636 moveto (0151 #define XV6_PARAM_H_) show
0 624 moveto (0152 #define NPROC        64  // maximum number of processes) show
0 612 moveto (0153 #define PAGE       4096  // granularity of user-space memory allocation) show
0 600 moveto (0154 #define KSTACKSIZE PAGE  // size of per-process kernel stack) show
0 588 moveto (0155 #define NCPU          1  // maximum number of CPUs) show
0 576 moveto (0156 #define NOFILE       16  // open files per process) show
0 564 moveto (0157 #define NFILE       100  // open files per system) show
0 552 moveto (0158 #define NBUF         10  // size of disk block cache) show
0 540 moveto (0159 #define NINODE       50  // maximum number of active i-nodes) show
0 528 moveto (0160 #define NDEV         10  // maximum major device number) show
0 516 moveto (0161 #define ROOTDEV       1  // device number of file system root disk) show
0 504 moveto (0162 ) show
0 492 moveto (0163 #endif // XV6_PARAM_H_) show
0 480 moveto (0164 ) show
0 468 moveto (0165 ) show
0 456 moveto (0166 ) show
0 444 moveto (0167 ) show
0 432 moveto (0168 ) show
0 420 moveto (0169 ) show
0 408 moveto (0170 ) show
0 396 moveto (0171 ) show
0 384 moveto (0172 ) show
0 372 moveto (0173 ) show
0 360 moveto (0174 ) show
0 348 moveto (0175 ) show
0 336 moveto (0176 ) show
0 324 moveto (0177 ) show
0 312 moveto (0178 ) show
0 300 moveto (0179 ) show
0 288 moveto (0180 ) show
0 276 moveto (0181 ) show
0 264 moveto (0182 ) show
0 252 moveto (0183 ) show
0 240 moveto (0184 ) show
0 228 moveto (0185 ) show
0 216 moveto (0186 ) show
0 204 moveto (0187 ) show
0 192 moveto (0188 ) show
0 180 moveto (0189 ) show
0 168 moveto (0190 ) show
0 156 moveto (0191 ) show
0 144 moveto (0192 ) show
0 132 moveto (0193 ) show
0 120 moveto (0194 ) show
0 108 moveto (0195 ) show
0 96 moveto (0196 ) show
0 84 moveto (0197 ) show
0 72 moveto (0198 ) show
0 60 moveto (0199 ) show
0 24 moveto (Sheet 01) show
grestore
restore
showpage
%%Page: 11 11
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/defs.h  Page 1) show
0 648 moveto (0200 #ifndef XV6_DEFS_H_) show
0 636 moveto (0201 #define XV6_DEFS_H_) show
0 624 moveto (0202 #include "types.h") show
0 612 moveto (0203 struct buf;) show
0 600 moveto (0204 struct context;) show
0 588 moveto (0205 struct file;) show
0 576 moveto (0206 struct inode;) show
0 564 moveto (0207 struct pipe;) show
0 552 moveto (0208 struct proc;) show
0 540 moveto (0209 struct spinlock;) show
0 528 moveto (0210 struct stat;) show
0 516 moveto (0211 ) show
0 504 moveto (0212 // bio.c) show
0 492 moveto (0213 void            binit\(void\);) show
0 480 moveto (0214 struct buf*     bread\(uint, uint\);) show
0 468 moveto (0215 void            brelse\(struct buf*\);) show
0 456 moveto (0216 void            bwrite\(struct buf*\);) show
0 444 moveto (0217 ) show
0 432 moveto (0218 // console.c) show
0 420 moveto (0219 void            console_init\(void\);) show
0 408 moveto (0220 void            cprintf\(char*, ...\);) show
0 396 moveto (0221 void            console_intr\(int\(*\)\(void\)\);) show
0 384 moveto (0222 void            panic\(char*\) __attribute__\(\(noreturn\)\);) show
0 372 moveto (0223 void            printstack\(void\);) show
0 360 moveto (0224 ) show
0 348 moveto (0225 // exec.c) show
0 336 moveto (0226 int             exec\(char*, char**\);) show
0 324 moveto (0227 ) show
0 312 moveto (0228 // file.c) show
0 300 moveto (0229 struct file*    filealloc\(void\);) show
0 288 moveto (0230 void            fileclose\(struct file*\);) show
0 276 moveto (0231 struct file*    filedup\(struct file*\);) show
0 264 moveto (0232 void            fileinit\(void\);) show
0 252 moveto (0233 int             fileread\(struct file*, char*, int n\);) show
0 240 moveto (0234 int             filestat\(struct file*, struct stat*\);) show
0 228 moveto (0235 int             filewrite\(struct file*, char*, int n\);) show
0 216 moveto (0236 ) show
0 204 moveto (0237 // fs.c) show
0 192 moveto (0238 int             dirlink\(struct inode*, char*, uint\);) show
0 180 moveto (0239 struct inode*   dirlookup\(struct inode*, char*, uint*\);) show
0 168 moveto (0240 struct inode*   ialloc\(uint, short\);) show
0 156 moveto (0241 struct inode*   idup\(struct inode*\);) show
0 144 moveto (0242 void            iinit\(void\);) show
0 132 moveto (0243 void            ilock\(struct inode*\);) show
0 120 moveto (0244 void            iput\(struct inode*\);) show
0 108 moveto (0245 void            iunlock\(struct inode*\);) show
0 96 moveto (0246 void            iunlockput\(struct inode*\);) show
0 84 moveto (0247 void            iupdate\(struct inode*\);) show
0 72 moveto (0248 int             namecmp\(const char*, const char*\);) show
0 60 moveto (0249 struct inode*   namei\(char*\);) show
0 24 moveto (Sheet 02) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/defs.h  Page 2) show
0 648 moveto (0250 struct inode*   nameiparent\(char*, char*\);) show
0 636 moveto (0251 int             readi\(struct inode*, char*, uint, uint\);) show
0 624 moveto (0252 void            stati\(struct inode*, struct stat*\);) show
0 612 moveto (0253 int             writei\(struct inode*, char*, uint, uint\);) show
0 600 moveto (0254 ) show
0 588 moveto (0255 // ide.c) show
0 576 moveto (0256 void            ide_init\(void\);) show
0 564 moveto (0257 void            ide_intr\(void\);) show
0 552 moveto (0258 void            ide_rw\(struct buf *\);) show
0 540 moveto (0259 ) show
0 528 moveto (0260 // ioapic.c) show
0 516 moveto (0261 void            ioapic_enable\(int irq, int cpu\);) show
0 504 moveto (0262 extern uchar    ioapic_id;) show
0 492 moveto (0263 void            ioapic_init\(void\);) show
0 480 moveto (0264 ) show
0 468 moveto (0265 // kalloc.c) show
0 456 moveto (0266 char*           kalloc\(int\);) show
0 444 moveto (0267 void            kfree\(char*, int\);) show
0 432 moveto (0268 void*           kmalloc\(int\);) show
0 420 moveto (0269 void            kmfree\(void*, int\);) show
0 408 moveto (0270 void            kinit\(void\);) show
0 396 moveto (0271 ) show
0 384 moveto (0272 // kbd.c) show
0 372 moveto (0273 void            kbd_intr\(void\);) show
0 360 moveto (0274 ) show
0 348 moveto (0275 // lapic.c) show
0 336 moveto (0276 int             cpu\(void\);) show
0 324 moveto (0277 extern volatile uint*    lapic;) show
0 312 moveto (0278 void            lapic_disableintr\(void\);) show
0 300 moveto (0279 void            lapic_enableintr\(void\);) show
0 288 moveto (0280 void            lapic_eoi\(void\);) show
0 276 moveto (0281 void            lapic_init\(int\);) show
0 264 moveto (0282 void            lapic_startap\(uchar, uint\);) show
0 252 moveto (0283 void            lapic_timerinit\(void\);) show
0 240 moveto (0284 void            lapic_timerintr\(void\);) show
0 228 moveto (0285 ) show
0 216 moveto (0286 // mp.c) show
0 204 moveto (0287 extern int      ismp;) show
0 192 moveto (0288 int             mp_bcpu\(void\);) show
0 180 moveto (0289 void            mp_init\(void\);) show
0 168 moveto (0290 void            mp_startthem\(void\);) show
0 156 moveto (0291 ) show
0 144 moveto (0292 // picirq.c) show
0 132 moveto (0293 void            pic_enable\(int\);) show
0 120 moveto (0294 void            pic_init\(void\);) show
0 108 moveto (0295 ) show
0 96 moveto (0296 ) show
0 84 moveto (0297 ) show
0 72 moveto (0298 ) show
0 60 moveto (0299 ) show
0 24 moveto (Sheet 02) show
grestore
restore
showpage
%%Page: 12 12
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/defs.h  Page 3) show
0 648 moveto (0300 // pipe.c) show
0 636 moveto (0301 int             pipealloc\(struct file**, struct file**\);) show
0 624 moveto (0302 void            pipeclose\(struct pipe*, int\);) show
0 612 moveto (0303 int             piperead\(struct pipe*, char*, int\);) show
0 600 moveto (0304 int             pipewrite\(struct pipe*, char*, int\);) show
0 588 moveto (0305 ) show
0 576 moveto (0306 // proc.c) show
0 564 moveto (0307 struct proc*    copyproc\(struct proc*\);) show
0 552 moveto (0308 struct proc*    allocproc\(void\);) show
0 540 moveto (0309 void            exit\(void\);) show
0 528 moveto (0310 int             growproc\(int\);) show
0 516 moveto (0311 int             kill\(int\);) show
0 504 moveto (0312 void            pinit\(void\);) show
0 492 moveto (0313 void            procdump\(void\);) show
0 480 moveto (0314 void            scheduler\(void\) __attribute__\(\(noreturn\)\);) show
0 468 moveto (0315 void            setupsegs\(struct proc*\);) show
0 456 moveto (0316 void            sleep\(void*, struct spinlock*\);) show
0 444 moveto (0317 int             msleep_spin\(void*, struct spinlock*, int\);) show
0 432 moveto (0318 void            userinit\(void\);) show
0 420 moveto (0319 int             wait\(void\);) show
0 408 moveto (0320 void            wakeup\(void*\);) show
0 396 moveto (0321 void            wakeup_one\(void*\);) show
0 384 moveto (0322 void            yield\(void\);) show
0 372 moveto (0323 ) show
0 360 moveto (0324 // swtch.S) show
0 348 moveto (0325 void            swtch\(struct context*, struct context*\);) show
0 336 moveto (0326 ) show
0 324 moveto (0327 // spinlock.c) show
0 312 moveto (0328 void            acquire\(struct spinlock*\);) show
0 300 moveto (0329 void            getcallerpcs\(void*, uint*\);) show
0 288 moveto (0330 int             holding\(struct spinlock*\);) show
0 276 moveto (0331 void            initlock\(struct spinlock*, char*\);) show
0 264 moveto (0332 void            release\(struct spinlock*\);) show
0 252 moveto (0333 ) show
0 240 moveto (0334 // string.c) show
0 228 moveto (0335 int             memcmp\(const void*, const void*, uint\);) show
0 216 moveto (0336 void*           memmove\(void*, const void*, uint\);) show
0 204 moveto (0337 void*           memset\(void*, int, uint\);) show
0 192 moveto (0338 char*           safestrcpy\(char*, const char*, int\);) show
0 180 moveto (0339 int             strlen\(const char*\);) show
0 168 moveto (0340 int             strncmp\(const char*, const char*, uint\);) show
0 156 moveto (0341 char*           strncpy\(char*, const char*, int\);) show
0 144 moveto (0342 void*           memcpy\(void *dst, const void *src, uint n\);) show
0 132 moveto (0343 ) show
0 120 moveto (0344 // syscall.c) show
0 108 moveto (0345 int             argint\(int, int*\);) show
0 96 moveto (0346 int             argptr\(int, char**, int\);) show
0 84 moveto (0347 int             argstr\(int, char**\);) show
0 72 moveto (0348 int             fetchint\(struct proc*, uint, int*\);) show
0 60 moveto (0349 int             fetchstr\(struct proc*, uint, char**\);) show
0 24 moveto (Sheet 03) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/defs.h  Page 4) show
0 648 moveto (0350 void            syscall\(void\);) show
0 636 moveto (0351 ) show
0 624 moveto (0352 // timer.c) show
0 612 moveto (0353 void            timer_init\(void\);) show
0 600 moveto (0354 int             millitime\(void\);) show
0 588 moveto (0355 ) show
0 576 moveto (0356 // trap.c) show
0 564 moveto (0357 void            idtinit\(void\);) show
0 552 moveto (0358 extern int      ticks;) show
0 540 moveto (0359 void            tvinit\(void\);) show
0 528 moveto (0360 extern struct spinlock tickslock;) show
0 516 moveto (0361 ) show
0 504 moveto (0362 // number of elements in fixed-size array) show
0 492 moveto (0363 #define NELEM\(x\) \(sizeof\(x\)/sizeof\(\(x\)[0]\)\)) show
0 480 moveto (0364 ) show
0 468 moveto (0365 #ifndef NULL) show
0 456 moveto (0366 #define NULL    0) show
0 444 moveto (0367 #endif) show
0 432 moveto (0368 ) show
0 420 moveto (0369 #endif // XV6_DEFS_H_) show
0 408 moveto (0370 ) show
0 396 moveto (0371 ) show
0 384 moveto (0372 ) show
0 372 moveto (0373 ) show
0 360 moveto (0374 ) show
0 348 moveto (0375 ) show
0 336 moveto (0376 ) show
0 324 moveto (0377 ) show
0 312 moveto (0378 ) show
0 300 moveto (0379 ) show
0 288 moveto (0380 ) show
0 276 moveto (0381 ) show
0 264 moveto (0382 ) show
0 252 moveto (0383 ) show
0 240 moveto (0384 ) show
0 228 moveto (0385 ) show
0 216 moveto (0386 ) show
0 204 moveto (0387 ) show
0 192 moveto (0388 ) show
0 180 moveto (0389 ) show
0 168 moveto (0390 ) show
0 156 moveto (0391 ) show
0 144 moveto (0392 ) show
0 132 moveto (0393 ) show
0 120 moveto (0394 ) show
0 108 moveto (0395 ) show
0 96 moveto (0396 ) show
0 84 moveto (0397 ) show
0 72 moveto (0398 ) show
0 60 moveto (0399 ) show
0 24 moveto (Sheet 03) show
grestore
restore
showpage
%%Page: 13 13
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/x86.h  Page 1) show
0 648 moveto (0400 #ifndef XV6_X86_H_) show
0 636 moveto (0401 #define XV6_X86_H_) show
0 624 moveto (0402 // Routines to let C code use special x86 instructions.) show
0 612 moveto (0403 ) show
0 600 moveto (0404 static inline uchar) show
0 588 moveto (0405 inb\(ushort port\)) show
0 576 moveto (0406 {) show
0 564 moveto (0407   uchar data;) show
0 552 moveto (0408 ) show
0 540 moveto (0409   asm volatile\("in %1,%0" : "=a" \(data\) : "d" \(port\)\);) show
0 528 moveto (0410   return data;) show
0 516 moveto (0411 }) show
0 504 moveto (0412 ) show
0 492 moveto (0413 static inline uint) show
0 480 moveto (0414 inl\(ushort port\)) show
0 468 moveto (0415 {) show
0 456 moveto (0416     uint data;) show
0 444 moveto (0417 ) show
0 432 moveto (0418     asm volatile\("in %1,%0" : "=a" \(data\) : "d" \(port\)\);) show
0 420 moveto (0419     return data;) show
0 408 moveto (0420 }) show
0 396 moveto (0421 ) show
0 384 moveto (0422 static inline ushort) show
0 372 moveto (0423 inw\(ushort port\)) show
0 360 moveto (0424 {) show
0 348 moveto (0425     ushort data;) show
0 336 moveto (0426 ) show
0 324 moveto (0427     asm volatile\("in %1,%0" : "=a" \(data\) : "d" \(port\)\);) show
0 312 moveto (0428     return data;) show
0 300 moveto (0429 }) show
0 288 moveto (0430 ) show
0 276 moveto (0431 static inline void) show
0 264 moveto (0432 insl\(int port, void *addr, int cnt\)) show
0 252 moveto (0433 {) show
0 240 moveto (0434   asm volatile\("cld\\n\\trepne\\n\\tinsl"     :) show
0 228 moveto (0435                    "=D" \(addr\), "=c" \(cnt\)    :) show
0 216 moveto (0436                    "d" \(port\), "0" \(addr\), "1" \(cnt\)  :) show
0 204 moveto (0437                    "memory", "cc"\);) show
0 192 moveto (0438 }) show
0 180 moveto (0439 ) show
0 168 moveto (0440 static inline void) show
0 156 moveto (0441 outb\(ushort port, uchar data\)) show
0 144 moveto (0442 {) show
0 132 moveto (0443   asm volatile\("out %0,%1" : : "a" \(data\), "d" \(port\)\);) show
0 120 moveto (0444 }) show
0 108 moveto (0445 ) show
0 96 moveto (0446 ) show
0 84 moveto (0447 ) show
0 72 moveto (0448 ) show
0 60 moveto (0449 ) show
0 24 moveto (Sheet 04) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/x86.h  Page 2) show
0 648 moveto (0450 static inline void) show
0 636 moveto (0451 outw\(ushort port, ushort data\)) show
0 624 moveto (0452 {) show
0 612 moveto (0453   asm volatile\("out %0,%1" : : "a" \(data\), "d" \(port\)\);) show
0 600 moveto (0454 }) show
0 588 moveto (0455 ) show
0 576 moveto (0456 static inline void) show
0 564 moveto (0457 outl\(ushort port, uint data\)) show
0 552 moveto (0458 {) show
0 540 moveto (0459     asm volatile\("out %0,%1" : : "a" \(data\), "d" \(port\)\);) show
0 528 moveto (0460 }) show
0 516 moveto (0461 ) show
0 504 moveto (0462 static inline void) show
0 492 moveto (0463 outsl\(int port, const void *addr, int cnt\)) show
0 480 moveto (0464 {) show
0 468 moveto (0465   asm volatile\("cld\\n\\trepne\\n\\toutsl"    :) show
0 456 moveto (0466                    "=S" \(addr\), "=c" \(cnt\)    :) show
0 444 moveto (0467                    "d" \(port\), "0" \(addr\), "1" \(cnt\)  :) show
0 432 moveto (0468                    "cc"\);) show
0 420 moveto (0469 }) show
0 408 moveto (0470 ) show
0 396 moveto (0471 struct segdesc;) show
0 384 moveto (0472 ) show
0 372 moveto (0473 static inline void) show
0 360 moveto (0474 lgdt\(struct segdesc *p, int size\)) show
0 348 moveto (0475 {) show
0 336 moveto (0476   volatile ushort pd[3];) show
0 324 moveto (0477 ) show
0 312 moveto (0478   pd[0] = size-1;) show
0 300 moveto (0479   pd[1] = \(uint\)p;) show
0 288 moveto (0480   pd[2] = \(uint\)p >> 16;) show
0 276 moveto (0481 ) show
0 264 moveto (0482   asm volatile\("lgdt \(%0\)" : : "r" \(pd\)\);) show
0 252 moveto (0483 }) show
0 240 moveto (0484 ) show
0 228 moveto (0485 struct gatedesc;) show
0 216 moveto (0486 ) show
0 204 moveto (0487 static inline void) show
0 192 moveto (0488 lidt\(struct gatedesc *p, int size\)) show
0 180 moveto (0489 {) show
0 168 moveto (0490   volatile ushort pd[3];) show
0 156 moveto (0491 ) show
0 144 moveto (0492   pd[0] = size-1;) show
0 132 moveto (0493   pd[1] = \(uint\)p;) show
0 120 moveto (0494   pd[2] = \(uint\)p >> 16;) show
0 108 moveto (0495 ) show
0 96 moveto (0496   asm volatile\("lidt \(%0\)" : : "r" \(pd\)\);) show
0 84 moveto (0497 }) show
0 72 moveto (0498 ) show
0 60 moveto (0499 ) show
0 24 moveto (Sheet 04) show
grestore
restore
showpage
%%Page: 14 14
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/x86.h  Page 3) show
0 648 moveto (0500 static inline void) show
0 636 moveto (0501 ltr\(ushort sel\)) show
0 624 moveto (0502 {) show
0 612 moveto (0503   asm volatile\("ltr %0" : : "r" \(sel\)\);) show
0 600 moveto (0504 }) show
0 588 moveto (0505 ) show
0 576 moveto (0506 static inline uint) show
0 564 moveto (0507 read_eflags\(void\)) show
0 552 moveto (0508 {) show
0 540 moveto (0509   uint eflags;) show
0 528 moveto (0510   asm volatile\("pushfl; popl %0" : "=r" \(eflags\)\);) show
0 516 moveto (0511   return eflags;) show
0 504 moveto (0512 }) show
0 492 moveto (0513 ) show
0 480 moveto (0514 static inline void) show
0 468 moveto (0515 write_eflags\(uint eflags\)) show
0 456 moveto (0516 {) show
0 444 moveto (0517   asm volatile\("pushl %0; popfl" : : "r" \(eflags\)\);) show
0 432 moveto (0518 }) show
0 420 moveto (0519 ) show
0 408 moveto (0520 static inline void) show
0 396 moveto (0521 cpuid\(uint info, uint *eaxp, uint *ebxp, uint *ecxp, uint *edxp\)) show
0 384 moveto (0522 {) show
0 372 moveto (0523   uint eax, ebx, ecx, edx;) show
0 360 moveto (0524 ) show
0 348 moveto (0525   asm volatile\("cpuid" :) show
0 336 moveto (0526                "=a" \(eax\), "=b" \(ebx\), "=c" \(ecx\), "=d" \(edx\) :) show
0 324 moveto (0527                "a" \(info\)\);) show
0 312 moveto (0528   if\(eaxp\)) show
0 300 moveto (0529     *eaxp = eax;) show
0 288 moveto (0530   if\(ebxp\)) show
0 276 moveto (0531     *ebxp = ebx;) show
0 264 moveto (0532   if\(ecxp\)) show
0 252 moveto (0533     *ecxp = ecx;) show
0 240 moveto (0534   if\(edxp\)) show
0 228 moveto (0535     *edxp = edx;) show
0 216 moveto (0536 }) show
0 204 moveto (0537 ) show
0 192 moveto (0538 static inline uint) show
0 180 moveto (0539 cmpxchg\(uint oldval, uint newval, volatile uint* lock_addr\)) show
0 168 moveto (0540 {) show
0 156 moveto (0541   uint result;) show
0 144 moveto (0542 ) show
0 132 moveto (0543   // The + in "+m" denotes a read-modify-write operand.) show
0 120 moveto (0544   asm volatile\("lock; cmpxchgl %2, %0" :) show
0 108 moveto (0545                        "+m" \(*lock_addr\), "=a" \(result\) :) show
0 96 moveto (0546                        "r"\(newval\), "1"\(oldval\) :) show
0 84 moveto (0547                        "cc"\);) show
0 72 moveto (0548   return result;) show
0 60 moveto (0549 }) show
0 24 moveto (Sheet 05) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/x86.h  Page 4) show
0 648 moveto (0550 static inline void) show
0 636 moveto (0551 cli\(void\)) show
0 624 moveto (0552 {) show
0 612 moveto (0553   asm volatile\("cli"\);) show
0 600 moveto (0554 }) show
0 588 moveto (0555 ) show
0 576 moveto (0556 static inline void) show
0 564 moveto (0557 sti\(void\)) show
0 552 moveto (0558 {) show
0 540 moveto (0559   asm volatile\("sti"\);) show
0 528 moveto (0560 }) show
0 516 moveto (0561 ) show
0 504 moveto (0562 // Layout of the trap frame built on the stack by the) show
0 492 moveto (0563 // hardware and by trapasm.S, and passed to trap\(\).) show
0 480 moveto (0564 struct trapframe {) show
0 468 moveto (0565   // registers as pushed by pusha) show
0 456 moveto (0566   uint edi;) show
0 444 moveto (0567   uint esi;) show
0 432 moveto (0568   uint ebp;) show
0 420 moveto (0569   uint oesp;      // useless & ignored) show
0 408 moveto (0570   uint ebx;) show
0 396 moveto (0571   uint edx;) show
0 384 moveto (0572   uint ecx;) show
0 372 moveto (0573   uint eax;) show
0 360 moveto (0574 ) show
0 348 moveto (0575   // rest of trap frame) show
0 336 moveto (0576   ushort es;) show
0 324 moveto (0577   ushort padding1;) show
0 312 moveto (0578   ushort ds;) show
0 300 moveto (0579   ushort padding2;) show
0 288 moveto (0580   uint trapno;) show
0 276 moveto (0581 ) show
0 264 moveto (0582   // below here defined by x86 hardware) show
0 252 moveto (0583   uint err;) show
0 240 moveto (0584   uint eip;) show
0 228 moveto (0585   ushort cs;) show
0 216 moveto (0586   ushort padding3;) show
0 204 moveto (0587   uint eflags;) show
0 192 moveto (0588 ) show
0 180 moveto (0589   // below here only when crossing rings, such as from user to kernel) show
0 168 moveto (0590   uint esp;) show
0 156 moveto (0591   ushort ss;) show
0 144 moveto (0592   ushort padding4;) show
0 132 moveto (0593 };) show
0 120 moveto (0594 #endif // XV6_X86_H_) show
0 108 moveto (0595 ) show
0 96 moveto (0596 ) show
0 84 moveto (0597 ) show
0 72 moveto (0598 ) show
0 60 moveto (0599 ) show
0 24 moveto (Sheet 05) show
grestore
restore
showpage
%%Page: 15 15
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/asm.h  Page 1) show
0 648 moveto (0600 //) show
0 636 moveto (0601 // assembler macros to create x86 segments) show
0 624 moveto (0602 //) show
0 612 moveto (0603 ) show
0 600 moveto (0604 #define SEG_NULLASM                                             \\) show
0 588 moveto (0605         .word 0, 0;                                             \\) show
0 576 moveto (0606         .byte 0, 0, 0, 0) show
0 564 moveto (0607 ) show
0 552 moveto (0608 #define SEG_ASM\(type,base,lim\)                                  \\) show
0 540 moveto (0609         .word \(\(\(lim\) >> 12\) & 0xffff\), \(\(base\) & 0xffff\);      \\) show
0 528 moveto (0610         .byte \(\(\(base\) >> 16\) & 0xff\), \(0x90 | \(type\)\),         \\) show
0 516 moveto (0611                 \(0xC0 | \(\(\(lim\) >> 28\) & 0xf\)\), \(\(\(base\) >> 24\) & 0xff\)) show
0 504 moveto (0612 ) show
0 492 moveto (0613 #define STA_X     0x8       // Executable segment) show
0 480 moveto (0614 #define STA_E     0x4       // Expand down \(non-executable segments\)) show
0 468 moveto (0615 #define STA_C     0x4       // Conforming code segment \(executable only\)) show
0 456 moveto (0616 #define STA_W     0x2       // Writeable \(non-executable segments\)) show
0 444 moveto (0617 #define STA_R     0x2       // Readable \(executable segments\)) show
0 432 moveto (0618 #define STA_A     0x1       // Accessed) show
0 420 moveto (0619 ) show
0 408 moveto (0620 ) show
0 396 moveto (0621 ) show
0 384 moveto (0622 ) show
0 372 moveto (0623 ) show
0 360 moveto (0624 ) show
0 348 moveto (0625 ) show
0 336 moveto (0626 ) show
0 324 moveto (0627 ) show
0 312 moveto (0628 ) show
0 300 moveto (0629 ) show
0 288 moveto (0630 ) show
0 276 moveto (0631 ) show
0 264 moveto (0632 ) show
0 252 moveto (0633 ) show
0 240 moveto (0634 ) show
0 228 moveto (0635 ) show
0 216 moveto (0636 ) show
0 204 moveto (0637 ) show
0 192 moveto (0638 ) show
0 180 moveto (0639 ) show
0 168 moveto (0640 ) show
0 156 moveto (0641 ) show
0 144 moveto (0642 ) show
0 132 moveto (0643 ) show
0 120 moveto (0644 ) show
0 108 moveto (0645 ) show
0 96 moveto (0646 ) show
0 84 moveto (0647 ) show
0 72 moveto (0648 ) show
0 60 moveto (0649 ) show
0 24 moveto (Sheet 06) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mmu.h  Page 1) show
0 648 moveto (0650 #ifndef XV6_MMU_H_) show
0 636 moveto (0651 #define XV6_MMU_H_) show
0 624 moveto (0652 // This file contains definitions for the) show
0 612 moveto (0653 // x86 memory management unit \(MMU\).) show
0 600 moveto (0654 ) show
0 588 moveto (0655 // Eflags register) show
0 576 moveto (0656 #define FL_CF           0x00000001      // Carry Flag) show
0 564 moveto (0657 #define FL_PF           0x00000004      // Parity Flag) show
0 552 moveto (0658 #define FL_AF           0x00000010      // Auxiliary carry Flag) show
0 540 moveto (0659 #define FL_ZF           0x00000040      // Zero Flag) show
0 528 moveto (0660 #define FL_SF           0x00000080      // Sign Flag) show
0 516 moveto (0661 #define FL_TF           0x00000100      // Trap Flag) show
0 504 moveto (0662 #define FL_IF           0x00000200      // Interrupt Enable) show
0 492 moveto (0663 #define FL_DF           0x00000400      // Direction Flag) show
0 480 moveto (0664 #define FL_OF           0x00000800      // Overflow Flag) show
0 468 moveto (0665 #define FL_IOPL_MASK    0x00003000      // I/O Privilege Level bitmask) show
0 456 moveto (0666 #define FL_IOPL_0       0x00000000      //   IOPL == 0) show
0 444 moveto (0667 #define FL_IOPL_1       0x00001000      //   IOPL == 1) show
0 432 moveto (0668 #define FL_IOPL_2       0x00002000      //   IOPL == 2) show
0 420 moveto (0669 #define FL_IOPL_3       0x00003000      //   IOPL == 3) show
0 408 moveto (0670 #define FL_NT           0x00004000      // Nested Task) show
0 396 moveto (0671 #define FL_RF           0x00010000      // Resume Flag) show
0 384 moveto (0672 #define FL_VM           0x00020000      // Virtual 8086 mode) show
0 372 moveto (0673 #define FL_AC           0x00040000      // Alignment Check) show
0 360 moveto (0674 #define FL_VIF          0x00080000      // Virtual Interrupt Flag) show
0 348 moveto (0675 #define FL_VIP          0x00100000      // Virtual Interrupt Pending) show
0 336 moveto (0676 #define FL_ID           0x00200000      // ID flag) show
0 324 moveto (0677 ) show
0 312 moveto (0678 // Segment Descriptor) show
0 300 moveto (0679 struct segdesc {) show
0 288 moveto (0680   uint lim_15_0 : 16;  // Low bits of segment limit) show
0 276 moveto (0681   uint base_15_0 : 16; // Low bits of segment base address) show
0 264 moveto (0682   uint base_23_16 : 8; // Middle bits of segment base address) show
0 252 moveto (0683   uint type : 4;       // Segment type \(see STS_ constants\)) show
0 240 moveto (0684   uint s : 1;          // 0 = system, 1 = application) show
0 228 moveto (0685   uint dpl : 2;        // Descriptor Privilege Level) show
0 216 moveto (0686   uint p : 1;          // Present) show
0 204 moveto (0687   uint lim_19_16 : 4;  // High bits of segment limit) show
0 192 moveto (0688   uint avl : 1;        // Unused \(available for software use\)) show
0 180 moveto (0689   uint rsv1 : 1;       // Reserved) show
0 168 moveto (0690   uint db : 1;         // 0 = 16-bit segment, 1 = 32-bit segment) show
0 156 moveto (0691   uint g : 1;          // Granularity: limit scaled by 4K when set) show
0 144 moveto (0692   uint base_31_24 : 8; // High bits of segment base address) show
0 132 moveto (0693 };) show
0 120 moveto (0694 ) show
0 108 moveto (0695 ) show
0 96 moveto (0696 ) show
0 84 moveto (0697 ) show
0 72 moveto (0698 ) show
0 60 moveto (0699 ) show
0 24 moveto (Sheet 06) show
grestore
restore
showpage
%%Page: 16 16
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mmu.h  Page 2) show
0 648 moveto (0700 // Null segment) show
0 636 moveto (0701 #define SEG_NULL        \(struct segdesc\){ 0,0,0,0,0,0,0,0,0,0,0,0,0 }) show
0 624 moveto (0702 ) show
0 612 moveto (0703 // Normal segment) show
0 600 moveto (0704 #define SEG\(type, base, lim, dpl\) \(struct segdesc\)                      \\) show
0 588 moveto (0705 { \(\(lim\) >> 12\) & 0xffff, \(base\) & 0xffff, \(\(base\) >> 16\) & 0xff,       \\) show
0 576 moveto (0706     type, 1, dpl, 1, \(uint\) \(lim\) >> 28, 0, 0, 1, 1,                    \\) show
0 564 moveto (0707     \(uint\) \(base\) >> 24 }) show
0 552 moveto (0708 ) show
0 540 moveto (0709 #define SEG16\(type, base, lim, dpl\) \(struct segdesc\)                    \\) show
0 528 moveto (0710 { \(lim\) & 0xffff, \(base\) & 0xffff, \(\(base\) >> 16\) & 0xff,               \\) show
0 516 moveto (0711     type, 1, dpl, 1, \(uint\) \(lim\) >> 16, 0, 0, 1, 0,                    \\) show
0 504 moveto (0712     \(uint\) \(base\) >> 24 }) show
0 492 moveto (0713 ) show
0 480 moveto (0714 #define DPL_USER    0x3     // User DPL) show
0 468 moveto (0715 ) show
0 456 moveto (0716 // Application segment type bits) show
0 444 moveto (0717 #define STA_X       0x8     // Executable segment) show
0 432 moveto (0718 #define STA_E       0x4     // Expand down \(non-executable segments\)) show
0 420 moveto (0719 #define STA_C       0x4     // Conforming code segment \(executable only\)) show
0 408 moveto (0720 #define STA_W       0x2     // Writeable \(non-executable segments\)) show
0 396 moveto (0721 #define STA_R       0x2     // Readable \(executable segments\)) show
0 384 moveto (0722 #define STA_A       0x1     // Accessed) show
0 372 moveto (0723 ) show
0 360 moveto (0724 // System segment type bits) show
0 348 moveto (0725 #define STS_T16A    0x1     // Available 16-bit TSS) show
0 336 moveto (0726 #define STS_LDT     0x2     // Local Descriptor Table) show
0 324 moveto (0727 #define STS_T16B    0x3     // Busy 16-bit TSS) show
0 312 moveto (0728 #define STS_CG16    0x4     // 16-bit Call Gate) show
0 300 moveto (0729 #define STS_TG      0x5     // Task Gate / Coum Transmitions) show
0 288 moveto (0730 #define STS_IG16    0x6     // 16-bit Interrupt Gate) show
0 276 moveto (0731 #define STS_TG16    0x7     // 16-bit Trap Gate) show
0 264 moveto (0732 #define STS_T32A    0x9     // Available 32-bit TSS) show
0 252 moveto (0733 #define STS_T32B    0xB     // Busy 32-bit TSS) show
0 240 moveto (0734 #define STS_CG32    0xC     // 32-bit Call Gate) show
0 228 moveto (0735 #define STS_IG32    0xE     // 32-bit Interrupt Gate) show
0 216 moveto (0736 #define STS_TG32    0xF     // 32-bit Trap Gate) show
0 204 moveto (0737 ) show
0 192 moveto (0738 // Task state segment format) show
0 180 moveto (0739 struct taskstate {) show
0 168 moveto (0740   uint link;         // Old ts selector) show
0 156 moveto (0741   uint esp0;         // Stack pointers and segment selectors) show
0 144 moveto (0742   ushort ss0;        //   after an increase in privilege level) show
0 132 moveto (0743   ushort padding1;) show
0 120 moveto (0744   uint *esp1;) show
0 108 moveto (0745   ushort ss1;) show
0 96 moveto (0746   ushort padding2;) show
0 84 moveto (0747   uint *esp2;) show
0 72 moveto (0748   ushort ss2;) show
0 60 moveto (0749   ushort padding3;) show
0 24 moveto (Sheet 07) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mmu.h  Page 3) show
0 648 moveto (0750   void *cr3;         // Page directory base) show
0 636 moveto (0751   uint *eip;         // Saved state from last task switch) show
0 624 moveto (0752   uint eflags;) show
0 612 moveto (0753   uint eax;          // More saved state \(registers\)) show
0 600 moveto (0754   uint ecx;) show
0 588 moveto (0755   uint edx;) show
0 576 moveto (0756   uint ebx;) show
0 564 moveto (0757   uint *esp;) show
0 552 moveto (0758   uint *ebp;) show
0 540 moveto (0759   uint esi;) show
0 528 moveto (0760   uint edi;) show
0 516 moveto (0761   ushort es;         // Even more saved state \(segment selectors\)) show
0 504 moveto (0762   ushort padding4;) show
0 492 moveto (0763   ushort cs;) show
0 480 moveto (0764   ushort padding5;) show
0 468 moveto (0765   ushort ss;) show
0 456 moveto (0766   ushort padding6;) show
0 444 moveto (0767   ushort ds;) show
0 432 moveto (0768   ushort padding7;) show
0 420 moveto (0769   ushort fs;) show
0 408 moveto (0770   ushort padding8;) show
0 396 moveto (0771   ushort gs;) show
0 384 moveto (0772   ushort padding9;) show
0 372 moveto (0773   ushort ldt;) show
0 360 moveto (0774   ushort padding10;) show
0 348 moveto (0775   ushort t;          // Trap on task switch) show
0 336 moveto (0776   ushort iomb;       // I/O map base address) show
0 324 moveto (0777 };) show
0 312 moveto (0778 ) show
0 300 moveto (0779 // Gate descriptors for interrupts and traps) show
0 288 moveto (0780 struct gatedesc {) show
0 276 moveto (0781   uint off_15_0 : 16;   // low 16 bits of offset in segment) show
0 264 moveto (0782   uint ss : 16;         // segment selector) show
0 252 moveto (0783   uint args : 5;        // # args, 0 for interrupt/trap gates) show
0 240 moveto (0784   uint rsv1 : 3;        // reserved\(should be zero I guess\)) show
0 228 moveto (0785   uint type : 4;        // type\(STS_{TG,IG32,TG32}\)) show
0 216 moveto (0786   uint s : 1;           // must be 0 \(system\)) show
0 204 moveto (0787   uint dpl : 2;         // descriptor\(meaning new\) privilege level) show
0 192 moveto (0788   uint p : 1;           // Present) show
0 180 moveto (0789   uint off_31_16 : 16;  // high bits of offset in segment) show
0 168 moveto (0790 };) show
0 156 moveto (0791 ) show
0 144 moveto (0792 ) show
0 132 moveto (0793 ) show
0 120 moveto (0794 ) show
0 108 moveto (0795 ) show
0 96 moveto (0796 ) show
0 84 moveto (0797 ) show
0 72 moveto (0798 ) show
0 60 moveto (0799 ) show
0 24 moveto (Sheet 07) show
grestore
restore
showpage
%%Page: 17 17
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mmu.h  Page 4) show
0 648 moveto (0800 // Set up a normal interrupt/trap gate descriptor.) show
0 636 moveto (0801 // - istrap: 1 for a trap \(= exception\) gate, 0 for an interrupt gate.) show
0 624 moveto (0802 //   interrupt gate clears FL_IF, trap gate leaves FL_IF alone) show
0 612 moveto (0803 // - sel: Code segment selector for interrupt/trap handler) show
0 600 moveto (0804 // - off: Offset in code segment for interrupt/trap handler) show
0 588 moveto (0805 // - dpl: Descriptor Privilege Level -) show
0 576 moveto (0806 //        the privilege level required for software to invoke) show
0 564 moveto (0807 //        this interrupt/trap gate explicitly using an int instruction.) show
0 552 moveto (0808 #define SETGATE\(gate, istrap, sel, off, d\)                \\) show
0 540 moveto (0809 {                                                         \\) show
0 528 moveto (0810   \(gate\).off_15_0 = \(uint\) \(off\) & 0xffff;                \\) show
0 516 moveto (0811   \(gate\).ss = \(sel\);                                      \\) show
0 504 moveto (0812   \(gate\).args = 0;                                        \\) show
0 492 moveto (0813   \(gate\).rsv1 = 0;                                        \\) show
0 480 moveto (0814   \(gate\).type = \(istrap\) ? STS_TG32 : STS_IG32;           \\) show
0 468 moveto (0815   \(gate\).s = 0;                                           \\) show
0 456 moveto (0816   \(gate\).dpl = \(d\);                                       \\) show
0 444 moveto (0817   \(gate\).p = 1;                                           \\) show
0 432 moveto (0818   \(gate\).off_31_16 = \(uint\) \(off\) >> 16;                  \\) show
0 420 moveto (0819 }) show
0 408 moveto (0820 ) show
0 396 moveto (0821 #endif // XV6_MMU_H_) show
0 384 moveto (0822 ) show
0 372 moveto (0823 ) show
0 360 moveto (0824 ) show
0 348 moveto (0825 ) show
0 336 moveto (0826 ) show
0 324 moveto (0827 ) show
0 312 moveto (0828 ) show
0 300 moveto (0829 ) show
0 288 moveto (0830 ) show
0 276 moveto (0831 ) show
0 264 moveto (0832 ) show
0 252 moveto (0833 ) show
0 240 moveto (0834 ) show
0 228 moveto (0835 ) show
0 216 moveto (0836 ) show
0 204 moveto (0837 ) show
0 192 moveto (0838 ) show
0 180 moveto (0839 ) show
0 168 moveto (0840 ) show
0 156 moveto (0841 ) show
0 144 moveto (0842 ) show
0 132 moveto (0843 ) show
0 120 moveto (0844 ) show
0 108 moveto (0845 ) show
0 96 moveto (0846 ) show
0 84 moveto (0847 ) show
0 72 moveto (0848 ) show
0 60 moveto (0849 ) show
0 24 moveto (Sheet 08) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/elf.h  Page 1) show
0 648 moveto (0850 // Format of an ELF executable file) show
0 636 moveto (0851 ) show
0 624 moveto (0852 #define ELF_MAGIC 0x464C457FU  // "\\x7FELF" in little endian) show
0 612 moveto (0853 ) show
0 600 moveto (0854 // File header) show
0 588 moveto (0855 struct elfhdr {) show
0 576 moveto (0856   uint magic;  // must equal ELF_MAGIC) show
0 564 moveto (0857   uchar elf[12];) show
0 552 moveto (0858   ushort type;) show
0 540 moveto (0859   ushort machine;) show
0 528 moveto (0860   uint version;) show
0 516 moveto (0861   uint entry;) show
0 504 moveto (0862   uint phoff;) show
0 492 moveto (0863   uint shoff;) show
0 480 moveto (0864   uint flags;) show
0 468 moveto (0865   ushort ehsize;) show
0 456 moveto (0866   ushort phentsize;) show
0 444 moveto (0867   ushort phnum;) show
0 432 moveto (0868   ushort shentsize;) show
0 420 moveto (0869   ushort shnum;) show
0 408 moveto (0870   ushort shstrndx;) show
0 396 moveto (0871 };) show
0 384 moveto (0872 ) show
0 372 moveto (0873 // Program section header) show
0 360 moveto (0874 struct proghdr {) show
0 348 moveto (0875   uint type;) show
0 336 moveto (0876   uint offset;) show
0 324 moveto (0877   uint va;) show
0 312 moveto (0878   uint pa;) show
0 300 moveto (0879   uint filesz;) show
0 288 moveto (0880   uint memsz;) show
0 276 moveto (0881   uint flags;) show
0 264 moveto (0882   uint align;) show
0 252 moveto (0883 };) show
0 240 moveto (0884 ) show
0 228 moveto (0885 // Values for Proghdr type) show
0 216 moveto (0886 #define ELF_PROG_LOAD           1) show
0 204 moveto (0887 ) show
0 192 moveto (0888 // Flag bits for Proghdr flags) show
0 180 moveto (0889 #define ELF_PROG_FLAG_EXEC      1) show
0 168 moveto (0890 #define ELF_PROG_FLAG_WRITE     2) show
0 156 moveto (0891 #define ELF_PROG_FLAG_READ      4) show
0 144 moveto (0892 ) show
0 132 moveto (0893 ) show
0 120 moveto (0894 ) show
0 108 moveto (0895 ) show
0 96 moveto (0896 ) show
0 84 moveto (0897 ) show
0 72 moveto (0898 ) show
0 60 moveto (0899 ) show
0 24 moveto (Sheet 08) show
grestore
restore
showpage
%%Page: 18 18
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/elf.h  Page 2) show
0 648 moveto (0900 // Blank page.) show
0 636 moveto (0901 ) show
0 624 moveto (0902 ) show
0 612 moveto (0903 ) show
0 600 moveto (0904 ) show
0 588 moveto (0905 ) show
0 576 moveto (0906 ) show
0 564 moveto (0907 ) show
0 552 moveto (0908 ) show
0 540 moveto (0909 ) show
0 528 moveto (0910 ) show
0 516 moveto (0911 ) show
0 504 moveto (0912 ) show
0 492 moveto (0913 ) show
0 480 moveto (0914 ) show
0 468 moveto (0915 ) show
0 456 moveto (0916 ) show
0 444 moveto (0917 ) show
0 432 moveto (0918 ) show
0 420 moveto (0919 ) show
0 408 moveto (0920 ) show
0 396 moveto (0921 ) show
0 384 moveto (0922 ) show
0 372 moveto (0923 ) show
0 360 moveto (0924 ) show
0 348 moveto (0925 ) show
0 336 moveto (0926 ) show
0 324 moveto (0927 ) show
0 312 moveto (0928 ) show
0 300 moveto (0929 ) show
0 288 moveto (0930 ) show
0 276 moveto (0931 ) show
0 264 moveto (0932 ) show
0 252 moveto (0933 ) show
0 240 moveto (0934 ) show
0 228 moveto (0935 ) show
0 216 moveto (0936 ) show
0 204 moveto (0937 ) show
0 192 moveto (0938 ) show
0 180 moveto (0939 ) show
0 168 moveto (0940 ) show
0 156 moveto (0941 ) show
0 144 moveto (0942 ) show
0 132 moveto (0943 ) show
0 120 moveto (0944 ) show
0 108 moveto (0945 ) show
0 96 moveto (0946 ) show
0 84 moveto (0947 ) show
0 72 moveto (0948 ) show
0 60 moveto (0949 ) show
0 24 moveto (Sheet 09) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bootasm.S  Page 1) show
0 648 moveto (0950 #include "asm.h") show
0 636 moveto (0951 ) show
0 624 moveto (0952 # Start the first CPU: switch to 32-bit protected mode, jump into C.) show
0 612 moveto (0953 # The BIOS loads this code from the first sector of the hard disk into) show
0 600 moveto (0954 # memory at physical address 0x7c00 and starts executing in real mode) show
0 588 moveto (0955 # with %cs=0 %ip=7c00.) show
0 576 moveto (0956 ) show
0 564 moveto (0957 .set PROT_MODE_CSEG, 0x8         # kernel code segment selector) show
0 552 moveto (0958 .set PROT_MODE_DSEG, 0x10        # kernel data segment selector) show
0 540 moveto (0959 .set CR0_PE_ON,      0x1         # protected mode enable flag) show
0 528 moveto (0960 ) show
0 516 moveto (0961 .globl start) show
0 504 moveto (0962 start:) show
0 492 moveto (0963   .code16                     # Assemble for 16-bit mode) show
0 480 moveto (0964   cli                         # Disable interrupts) show
0 468 moveto (0965   cld                         # String operations increment) show
0 456 moveto (0966 ) show
0 444 moveto (0967   # Set up the important data segment registers \(DS, ES, SS\).) show
0 432 moveto (0968   xorw    %ax,%ax             # Segment number zero) show
0 420 moveto (0969   movw    %ax,%ds             # -> Data Segment) show
0 408 moveto (0970   movw    %ax,%es             # -> Extra Segment) show
0 396 moveto (0971   movw    %ax,%ss             # -> Stack Segment) show
0 384 moveto (0972 ) show
0 372 moveto (0973   # Enable A20:) show
0 360 moveto (0974   #   For backwards compatibility with the earliest PCs, physical) show
0 348 moveto (0975   #   address line 20 is tied low, so that addresses higher than) show
0 336 moveto (0976   #   1MB wrap around to zero by default.  This code undoes this.) show
0 324 moveto (0977 seta20.1:) show
0 312 moveto (0978   inb     $0x64,%al               # Wait for not busy) show
0 300 moveto (0979   testb   $0x2,%al) show
0 288 moveto (0980   jnz     seta20.1) show
0 276 moveto (0981 ) show
0 264 moveto (0982   movb    $0xd1,%al               # 0xd1 -> port 0x64) show
0 252 moveto (0983   outb    %al,$0x64) show
0 240 moveto (0984 ) show
0 228 moveto (0985 seta20.2:) show
0 216 moveto (0986   inb     $0x64,%al               # Wait for not busy) show
0 204 moveto (0987   testb   $0x2,%al) show
0 192 moveto (0988   jnz     seta20.2) show
0 180 moveto (0989 ) show
0 168 moveto (0990   movb    $0xdf,%al               # 0xdf -> port 0x60) show
0 156 moveto (0991   outb    %al,$0x60) show
0 144 moveto (0992 ) show
0 132 moveto (0993   # Switch from real to protected mode, using a bootstrap GDT) show
0 120 moveto (0994   # and segment translation that makes virtual addresses) show
0 108 moveto (0995   # identical to their physical addresses, so that the) show
0 96 moveto (0996   # effective memory map does not change during the switch.) show
0 84 moveto (0997   lgdt    gdtdesc) show
0 72 moveto (0998   movl    %cr0, %eax) show
0 60 moveto (0999   orl     $CR0_PE_ON, %eax) show
0 24 moveto (Sheet 09) show
grestore
restore
showpage
%%Page: 19 19
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bootasm.S  Page 2) show
0 648 moveto (1000   movl    %eax, %cr0) show
0 636 moveto (1001 ) show
0 624 moveto (1002   # Jump to next instruction, but in 32-bit code segment.) show
0 612 moveto (1003   # Switches processor into 32-bit mode.) show
0 600 moveto (1004   ljmp    $PROT_MODE_CSEG, $protcseg) show
0 588 moveto (1005 ) show
0 576 moveto (1006   .code32                     # Assemble for 32-bit mode) show
0 564 moveto (1007 protcseg:) show
0 552 moveto (1008   # Set up the protected-mode data segment registers) show
0 540 moveto (1009   movw    $PROT_MODE_DSEG, %ax    # Our data segment selector) show
0 528 moveto (1010   movw    %ax, %ds                # -> DS: Data Segment) show
0 516 moveto (1011   movw    %ax, %es                # -> ES: Extra Segment) show
0 504 moveto (1012   movw    %ax, %fs                # -> FS) show
0 492 moveto (1013   movw    %ax, %gs                # -> GS) show
0 480 moveto (1014   movw    %ax, %ss                # -> SS: Stack Segment) show
0 468 moveto (1015 ) show
0 456 moveto (1016   # Set up the stack pointer and call into C.) show
0 444 moveto (1017   movl    $start, %esp) show
0 432 moveto (1018   call    bootmain) show
0 420 moveto (1019 ) show
0 408 moveto (1020   # If bootmain returns \(it shouldn't\), loop.) show
0 396 moveto (1021 spin:) show
0 384 moveto (1022   jmp     spin) show
0 372 moveto (1023 ) show
0 360 moveto (1024 # Bootstrap GDT) show
0 348 moveto (1025 .p2align 2                                # force 4 byte alignment) show
0 336 moveto (1026 gdt:) show
0 324 moveto (1027   SEG_NULLASM                             # null seg) show
0 312 moveto (1028   SEG_ASM\(STA_X|STA_R, 0x0, 0xffffffff\)   # code seg) show
0 300 moveto (1029   SEG_ASM\(STA_W, 0x0, 0xffffffff\)         # data seg) show
0 288 moveto (1030 ) show
0 276 moveto (1031 gdtdesc:) show
0 264 moveto (1032   .word   0x17                            # sizeof\(gdt\) - 1) show
0 252 moveto (1033   .long   gdt                             # address gdt) show
0 240 moveto (1034 ) show
0 228 moveto (1035 ) show
0 216 moveto (1036 ) show
0 204 moveto (1037 ) show
0 192 moveto (1038 ) show
0 180 moveto (1039 ) show
0 168 moveto (1040 ) show
0 156 moveto (1041 ) show
0 144 moveto (1042 ) show
0 132 moveto (1043 ) show
0 120 moveto (1044 ) show
0 108 moveto (1045 ) show
0 96 moveto (1046 ) show
0 84 moveto (1047 ) show
0 72 moveto (1048 ) show
0 60 moveto (1049 ) show
0 24 moveto (Sheet 10) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bootother.S  Page 1) show
0 648 moveto (1050 #include "asm.h") show
0 636 moveto (1051 ) show
0 624 moveto (1052 # Start an Application Processor. This must be placed on a 4KB boundary) show
0 612 moveto (1053 # somewhere in the 1st MB of conventional memory \(APBOOTSTRAP\). However,) show
0 600 moveto (1054 # due to some shortcuts below it's restricted further to within the 1st) show
0 588 moveto (1055 # 64KB. The AP starts in real-mode, with) show
0 576 moveto (1056 #   CS selector set to the startup memory address/16;) show
0 564 moveto (1057 #   CS base set to startup memory address;) show
0 552 moveto (1058 #   CS limit set to 64KB;) show
0 540 moveto (1059 #   CPL and IP set to 0.) show
0 528 moveto (1060 #) show
0 516 moveto (1061 # Bootothers \(in main.c\) starts each non-boot CPU in turn.) show
0 504 moveto (1062 # It puts the correct %esp in start-4,) show
0 492 moveto (1063 # and the place to jump to in start-8.) show
0 480 moveto (1064 #) show
0 468 moveto (1065 # This code is identical to bootasm.S except:) show
0 456 moveto (1066 #   - it does not need to enable A20) show
0 444 moveto (1067 #   - it uses the address at start-4 for the %esp) show
0 432 moveto (1068 #   - it jumps to the address at start-8 instead of calling bootmain) show
0 420 moveto (1069 ) show
0 408 moveto (1070 .set PROT_MODE_CSEG, 0x8         # kernel code segment selector) show
0 396 moveto (1071 .set PROT_MODE_DSEG, 0x10        # kernel data segment selector) show
0 384 moveto (1072 .set CR0_PE_ON,      0x1         # protected mode enable flag) show
0 372 moveto (1073 ) show
0 360 moveto (1074 .globl start) show
0 348 moveto (1075 start:) show
0 336 moveto (1076   .code16                     # Assemble for 16-bit mode) show
0 324 moveto (1077   cli                         # Disable interrupts) show
0 312 moveto (1078   cld                         # String operations increment) show
0 300 moveto (1079 ) show
0 288 moveto (1080   # Set up the important data segment registers \(DS, ES, SS\).) show
0 276 moveto (1081   xorw    %ax,%ax             # Segment number zero) show
0 264 moveto (1082   movw    %ax,%ds             # -> Data Segment) show
0 252 moveto (1083   movw    %ax,%es             # -> Extra Segment) show
0 240 moveto (1084   movw    %ax,%ss             # -> Stack Segment) show
0 228 moveto (1085 ) show
0 216 moveto (1086   # Switch from real to protected mode, using a bootstrap GDT) show
0 204 moveto (1087   # and segment translation that makes virtual addresses) show
0 192 moveto (1088   # identical to their physical addresses, so that the) show
0 180 moveto (1089   # effective memory map does not change during the switch.) show
0 168 moveto (1090   lgdt    gdtdesc) show
0 156 moveto (1091   movl    %cr0, %eax) show
0 144 moveto (1092   orl     $CR0_PE_ON, %eax) show
0 132 moveto (1093   movl    %eax, %cr0) show
0 120 moveto (1094 ) show
0 108 moveto (1095   # Jump to next instruction, but in 32-bit code segment.) show
0 96 moveto (1096   # Switches processor into 32-bit mode.) show
0 84 moveto (1097   ljmp    $PROT_MODE_CSEG, $protcseg) show
0 72 moveto (1098 ) show
0 60 moveto (1099 ) show
0 24 moveto (Sheet 10) show
grestore
restore
showpage
%%Page: 20 20
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bootother.S  Page 2) show
0 648 moveto (1100   .code32                     # Assemble for 32-bit mode) show
0 636 moveto (1101 protcseg:) show
0 624 moveto (1102   # Set up the protected-mode data segment registers) show
0 612 moveto (1103   movw    $PROT_MODE_DSEG, %ax    # Our data segment selector) show
0 600 moveto (1104   movw    %ax, %ds                # -> DS: Data Segment) show
0 588 moveto (1105   movw    %ax, %es                # -> ES: Extra Segment) show
0 576 moveto (1106   movw    %ax, %fs                # -> FS) show
0 564 moveto (1107   movw    %ax, %gs                # -> GS) show
0 552 moveto (1108   movw    %ax, %ss                # -> SS: Stack Segment) show
0 540 moveto (1109 ) show
0 528 moveto (1110   movl    start-4, %esp) show
0 516 moveto (1111   movl    start-8, %eax) show
0 504 moveto (1112   jmp     *%eax) show
0 492 moveto (1113 ) show
0 480 moveto (1114 # Bootstrap GDT) show
0 468 moveto (1115 .p2align 2                                # force 4 byte alignment) show
0 456 moveto (1116 gdt:) show
0 444 moveto (1117   SEG_NULLASM                             # null seg) show
0 432 moveto (1118   SEG_ASM\(STA_X|STA_R, 0x0, 0xffffffff\)   # code seg) show
0 420 moveto (1119   SEG_ASM\(STA_W, 0x0, 0xffffffff\)         # data seg) show
0 408 moveto (1120 ) show
0 396 moveto (1121 gdtdesc:) show
0 384 moveto (1122   .word   0x17                            # sizeof\(gdt\) - 1) show
0 372 moveto (1123   .long   gdt                             # address gdt) show
0 360 moveto (1124 ) show
0 348 moveto (1125 ) show
0 336 moveto (1126 ) show
0 324 moveto (1127 ) show
0 312 moveto (1128 ) show
0 300 moveto (1129 ) show
0 288 moveto (1130 ) show
0 276 moveto (1131 ) show
0 264 moveto (1132 ) show
0 252 moveto (1133 ) show
0 240 moveto (1134 ) show
0 228 moveto (1135 ) show
0 216 moveto (1136 ) show
0 204 moveto (1137 ) show
0 192 moveto (1138 ) show
0 180 moveto (1139 ) show
0 168 moveto (1140 ) show
0 156 moveto (1141 ) show
0 144 moveto (1142 ) show
0 132 moveto (1143 ) show
0 120 moveto (1144 ) show
0 108 moveto (1145 ) show
0 96 moveto (1146 ) show
0 84 moveto (1147 ) show
0 72 moveto (1148 ) show
0 60 moveto (1149 ) show
0 24 moveto (Sheet 11) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bootmain.c  Page 1) show
0 648 moveto (1150 // Boot loader.) show
0 636 moveto (1151 //) show
0 624 moveto (1152 // The BIOS loads boot sector \(bootasm.S\) from sector 0 of the disk) show
0 612 moveto (1153 // into memory and executes it.  The boot sector puts the processor) show
0 600 moveto (1154 // in 32-bit mode and calls bootmain below, which loads an ELF kernel) show
0 588 moveto (1155 // image from the disk starting at sector 1 and then jumps to the) show
0 576 moveto (1156 // kernel entry routine.) show
0 564 moveto (1157 ) show
0 552 moveto (1158 #include "types.h") show
0 540 moveto (1159 #include "elf.h") show
0 528 moveto (1160 #include "x86.h") show
0 516 moveto (1161 ) show
0 504 moveto (1162 #define SECTSIZE  512) show
0 492 moveto (1163 ) show
0 480 moveto (1164 void readseg\(uint, uint, uint\);) show
0 468 moveto (1165 ) show
0 456 moveto (1166 void) show
0 444 moveto (1167 bootmain\(void\)) show
0 432 moveto (1168 {) show
0 420 moveto (1169   struct elfhdr *elf;) show
0 408 moveto (1170   struct proghdr *ph, *eph;) show
0 396 moveto (1171   void \(*entry\)\(void\);) show
0 384 moveto (1172 ) show
0 372 moveto (1173   elf = \(struct elfhdr*\)0x10000;  // scratch space) show
0 360 moveto (1174 ) show
0 348 moveto (1175   // Read 1st page off disk) show
0 336 moveto (1176   readseg\(\(uint\)elf, SECTSIZE*8, 0\);) show
0 324 moveto (1177 ) show
0 312 moveto (1178   // Is this an ELF executable?) show
0 300 moveto (1179   if\(elf->magic != ELF_MAGIC\)) show
0 288 moveto (1180     goto bad;) show
0 276 moveto (1181 ) show
0 264 moveto (1182   // Load each program segment \(ignores ph flags\).) show
0 252 moveto (1183   ph = \(struct proghdr*\)\(\(uchar*\)elf + elf->phoff\);) show
0 240 moveto (1184   eph = ph + elf->phnum;) show
0 228 moveto (1185   for\(; ph < eph; ph++\)) show
0 216 moveto (1186     readseg\(ph->va, ph->memsz, ph->offset\);) show
0 204 moveto (1187 ) show
0 192 moveto (1188   // Call the entry point from the ELF header.) show
0 180 moveto (1189   // Does not return!) show
0 168 moveto (1190   entry = \(void\(*\)\(void\)\)\(elf->entry & 0xFFFFFF\);) show
0 156 moveto (1191   entry\(\);) show
0 144 moveto (1192 ) show
0 132 moveto (1193 bad:) show
0 120 moveto (1194   outw\(0x8A00, 0x8A00\);) show
0 108 moveto (1195   outw\(0x8A00, 0x8E00\);) show
0 96 moveto (1196   for\(;;\)) show
0 84 moveto (1197     ;) show
0 72 moveto (1198 }) show
0 60 moveto (1199 ) show
0 24 moveto (Sheet 11) show
grestore
restore
showpage
%%Page: 21 21
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bootmain.c  Page 2) show
0 648 moveto (1200 void) show
0 636 moveto (1201 waitdisk\(void\)) show
0 624 moveto (1202 {) show
0 612 moveto (1203   // Wait for disk ready.) show
0 600 moveto (1204   while\(\(inb\(0x1F7\) & 0xC0\) != 0x40\)) show
0 588 moveto (1205     ;) show
0 576 moveto (1206 }) show
0 564 moveto (1207 ) show
0 552 moveto (1208 // Read a single sector at offset into dst.) show
0 540 moveto (1209 void) show
0 528 moveto (1210 readsect\(void *dst, uint offset\)) show
0 516 moveto (1211 {) show
0 504 moveto (1212   // Issue command.) show
0 492 moveto (1213   waitdisk\(\);) show
0 480 moveto (1214   outb\(0x1F2, 1\);   // count = 1) show
0 468 moveto (1215   outb\(0x1F3, offset\);) show
0 456 moveto (1216   outb\(0x1F4, offset >> 8\);) show
0 444 moveto (1217   outb\(0x1F5, offset >> 16\);) show
0 432 moveto (1218   outb\(0x1F6, \(offset >> 24\) | 0xE0\);) show
0 420 moveto (1219   outb\(0x1F7, 0x20\);  // cmd 0x20 - read sectors) show
0 408 moveto (1220 ) show
0 396 moveto (1221   // Read data.) show
0 384 moveto (1222   waitdisk\(\);) show
0 372 moveto (1223   insl\(0x1F0, dst, SECTSIZE/4\);) show
0 360 moveto (1224 }) show
0 348 moveto (1225 ) show
0 336 moveto (1226 // Read 'count' bytes at 'offset' from kernel into virtual address 'va'.) show
0 324 moveto (1227 // Might copy more than asked.) show
0 312 moveto (1228 void) show
0 300 moveto (1229 readseg\(uint va, uint count, uint offset\)) show
0 288 moveto (1230 {) show
0 276 moveto (1231   uint eva;) show
0 264 moveto (1232 ) show
0 252 moveto (1233   va &= 0xFFFFFF;) show
0 240 moveto (1234   eva = va + count;) show
0 228 moveto (1235 ) show
0 216 moveto (1236   // Round down to sector boundary.) show
0 204 moveto (1237   va &= ~\(SECTSIZE - 1\);) show
0 192 moveto (1238 ) show
0 180 moveto (1239   // Translate from bytes to sectors; kernel starts at sector 1.) show
0 168 moveto (1240   offset = \(offset / SECTSIZE\) + 1;) show
0 156 moveto (1241 ) show
0 144 moveto (1242   // If this is too slow, we could read lots of sectors at a time.) show
0 132 moveto (1243   // We'd write more to memory than asked, but it doesn't matter --) show
0 120 moveto (1244   // we load in increasing order.) show
0 108 moveto (1245   for\(; va < eva; va += SECTSIZE, offset++\)) show
0 96 moveto (1246     readsect\(\(uchar*\)va, offset\);) show
0 84 moveto (1247 }) show
0 72 moveto (1248 ) show
0 60 moveto (1249 ) show
0 24 moveto (Sheet 12) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/main.c  Page 1) show
0 648 moveto (1250 #include "types.h") show
0 636 moveto (1251 #include "defs.h") show
0 624 moveto (1252 #include "param.h") show
0 612 moveto (1253 #include "mmu.h") show
0 600 moveto (1254 #include "proc.h") show
0 588 moveto (1255 #include "x86.h") show
0 576 moveto (1256 #include "pci.h") show
0 564 moveto (1257 ) show
0 552 moveto (1258 static void bootothers\(void\);) show
0 540 moveto (1259 ) show
0 528 moveto (1260 // Bootstrap processor starts running C code here.) show
0 516 moveto (1261 int) show
0 504 moveto (1262 main\(void\)) show
0 492 moveto (1263 {) show
0 480 moveto (1264   int i;) show
0 468 moveto (1265   static volatile int bcpu;  // cannot be on stack) show
0 456 moveto (1266   extern char edata[], end[];) show
0 444 moveto (1267 ) show
0 432 moveto (1268   // clear BSS) show
0 420 moveto (1269   memset\(edata, 0, end - edata\);) show
0 408 moveto (1270 ) show
0 396 moveto (1271   // Prevent release\(\) from enabling interrupts.) show
0 384 moveto (1272   for\(i=0; i<NCPU; i++\)) show
0 372 moveto (1273     cpus[i].nlock = 1;) show
0 360 moveto (1274 ) show
0 348 moveto (1275 //  mp_init\(\); // collect info about this machine) show
0 336 moveto (1276   bcpu = mp_bcpu\(\);) show
0 324 moveto (1277 ) show
0 312 moveto (1278   // Switch to bootstrap processor's stack) show
0 300 moveto (1279   asm volatile\("movl %0, %%esp" : : "r" \(cpus[bcpu].mpstack+MPSTACK-32\)\);) show
0 288 moveto (1280   asm volatile\("movl %0, %%ebp" : : "r" \(cpus[bcpu].mpstack+MPSTACK\)\);) show
0 276 moveto (1281 ) show
0 264 moveto (1282   lapic_init\(bcpu\);) show
0 252 moveto (1283   cprintf\("\\ncpu%d: starting xv6\\n\\n", cpu\(\)\);) show
0 240 moveto (1284 ) show
0 228 moveto (1285   pinit\(\);         // process table) show
0 216 moveto (1286   binit\(\);         // buffer cache) show
0 204 moveto (1287   pic_init\(\);      // interrupt controller) show
0 192 moveto (1288   ioapic_init\(\);   // another interrupt controller) show
0 180 moveto (1289   kinit\(\);         // physical memory allocator) show
0 168 moveto (1290   tvinit\(\);        // trap vectors) show
0 156 moveto (1291   idtinit\(\);       // interrupt descriptor table) show
0 144 moveto (1292   fileinit\(\);      // file table) show
0 132 moveto (1293   iinit\(\);         // inode cache) show
0 120 moveto (1294   setupsegs\(0\);    // segments & TSS) show
0 108 moveto (1295   console_init\(\);  // I/O devices & their interrupts) show
0 96 moveto (1296   ide_init\(\);      // disk) show
0 84 moveto (1297 ) show
0 72 moveto (1298 ) show
0 60 moveto (1299 ) show
0 24 moveto (Sheet 12) show
grestore
restore
showpage
%%Page: 22 22
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/main.c  Page 2) show
0 648 moveto (1300   // lwIP init) show
0 636 moveto (1301   memp_init\(\);) show
0 624 moveto (1302   mem_init\(\);) show
0 612 moveto (1303   netif_init\(\);) show
0 600 moveto (1304   pbuf_init\(\);) show
0 588 moveto (1305   tcpip_init\(0, 0\);) show
0 576 moveto (1306 ) show
0 564 moveto (1307   pci_init\(\);      // PCI) show
0 552 moveto (1308   bootothers\(\);    // boot other CPUs) show
0 540 moveto (1309   if\(!ismp\)) show
0 528 moveto (1310     timer_init\(\); // uniprocessor timer) show
0 516 moveto (1311   userinit\(\);      // first user process) show
0 504 moveto (1312 ) show
0 492 moveto (1313   // enable interrupts on this processor.) show
0 480 moveto (1314   cpus[cpu\(\)].nlock--;) show
0 468 moveto (1315   if \(cpus[cpu\(\)].nlock == 0\)) show
0 456 moveto (1316     sti\(\);) show
0 444 moveto (1317 ) show
0 432 moveto (1318   scheduler\(\);) show
0 420 moveto (1319 }) show
0 408 moveto (1320 ) show
0 396 moveto (1321 // Additional processors start here.) show
0 384 moveto (1322 static void) show
0 372 moveto (1323 mpmain\(void\)) show
0 360 moveto (1324 {) show
0 348 moveto (1325   cprintf\("cpu%d: starting\\n", cpu\(\)\);) show
0 336 moveto (1326   idtinit\(\);) show
0 324 moveto (1327   lapic_init\(cpu\(\)\);) show
0 312 moveto (1328   setupsegs\(0\);) show
0 300 moveto (1329   cpuid\(0, 0, 0, 0, 0\);  // memory barrier) show
0 288 moveto (1330   cpus[cpu\(\)].booted = 1;) show
0 276 moveto (1331 ) show
0 264 moveto (1332   // Enable interrupts on this processor.) show
0 252 moveto (1333   cpus[cpu\(\)].nlock--;) show
0 240 moveto (1334   if \(cpus[cpu\(\)].nlock == 0\)) show
0 228 moveto (1335     sti\(\);) show
0 216 moveto (1336 ) show
0 204 moveto (1337   scheduler\(\);) show
0 192 moveto (1338 }) show
0 180 moveto (1339 ) show
0 168 moveto (1340 ) show
0 156 moveto (1341 ) show
0 144 moveto (1342 ) show
0 132 moveto (1343 ) show
0 120 moveto (1344 ) show
0 108 moveto (1345 ) show
0 96 moveto (1346 ) show
0 84 moveto (1347 ) show
0 72 moveto (1348 ) show
0 60 moveto (1349 ) show
0 24 moveto (Sheet 13) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/main.c  Page 3) show
0 648 moveto (1350 static void) show
0 636 moveto (1351 bootothers\(void\)) show
0 624 moveto (1352 {) show
0 612 moveto (1353   extern uchar _binary_bootother_start[], _binary_bootother_size[];) show
0 600 moveto (1354   uchar *code;) show
0 588 moveto (1355   struct cpu *c;) show
0 576 moveto (1356 ) show
0 564 moveto (1357   // Write bootstrap code to unused memory at 0x7000.) show
0 552 moveto (1358   code = \(uchar*\)0x7000;) show
0 540 moveto (1359   memmove\(code, _binary_bootother_start, \(uint\)_binary_bootother_size\);) show
0 528 moveto (1360 ) show
0 516 moveto (1361   for\(c = cpus; c < cpus+ncpu; c++\){) show
0 504 moveto (1362     if\(c == cpus+cpu\(\)\)  // We've started already.) show
0 492 moveto (1363       continue;) show
0 480 moveto (1364 ) show
0 468 moveto (1365     // Fill in %esp, %eip and start code on cpu.) show
0 456 moveto (1366     *\(void**\)\(code-4\) = c->mpstack + MPSTACK;) show
0 444 moveto (1367     *\(void**\)\(code-8\) = mpmain;) show
0 432 moveto (1368     lapic_startap\(c->apicid, \(uint\)code\);) show
0 420 moveto (1369 ) show
0 408 moveto (1370     // Wait for cpu to get through bootstrap.) show
0 396 moveto (1371     while\(c->booted == 0\)) show
0 384 moveto (1372       ;) show
0 372 moveto (1373   }) show
0 360 moveto (1374 }) show
0 348 moveto (1375 ) show
0 336 moveto (1376 ) show
0 324 moveto (1377 ) show
0 312 moveto (1378 ) show
0 300 moveto (1379 ) show
0 288 moveto (1380 ) show
0 276 moveto (1381 ) show
0 264 moveto (1382 ) show
0 252 moveto (1383 ) show
0 240 moveto (1384 ) show
0 228 moveto (1385 ) show
0 216 moveto (1386 ) show
0 204 moveto (1387 ) show
0 192 moveto (1388 ) show
0 180 moveto (1389 ) show
0 168 moveto (1390 ) show
0 156 moveto (1391 ) show
0 144 moveto (1392 ) show
0 132 moveto (1393 ) show
0 120 moveto (1394 ) show
0 108 moveto (1395 ) show
0 96 moveto (1396 ) show
0 84 moveto (1397 ) show
0 72 moveto (1398 ) show
0 60 moveto (1399 ) show
0 24 moveto (Sheet 13) show
grestore
restore
showpage
%%Page: 23 23
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/spinlock.h  Page 1) show
0 648 moveto (1400 #ifndef XV6_SPINLOCK_H_) show
0 636 moveto (1401 #define XV6_SPINLOCK_H_) show
0 624 moveto (1402 // Mutual exclusion lock.) show
0 612 moveto (1403 struct spinlock {) show
0 600 moveto (1404   uint locked;   // Is the lock held?) show
0 588 moveto (1405 ) show
0 576 moveto (1406   // For debugging:) show
0 564 moveto (1407   char *name;    // Name of lock.) show
0 552 moveto (1408   int  cpu;      // The number of the cpu holding the lock.) show
0 540 moveto (1409   uint pcs[10];  // The call stack \(an array of program counters\)) show
0 528 moveto (1410                  // that locked the lock.) show
0 516 moveto (1411 };) show
0 504 moveto (1412 #endif // XV6_SPINLOCK_H_) show
0 492 moveto (1413 ) show
0 480 moveto (1414 ) show
0 468 moveto (1415 ) show
0 456 moveto (1416 ) show
0 444 moveto (1417 ) show
0 432 moveto (1418 ) show
0 420 moveto (1419 ) show
0 408 moveto (1420 ) show
0 396 moveto (1421 ) show
0 384 moveto (1422 ) show
0 372 moveto (1423 ) show
0 360 moveto (1424 ) show
0 348 moveto (1425 ) show
0 336 moveto (1426 ) show
0 324 moveto (1427 ) show
0 312 moveto (1428 ) show
0 300 moveto (1429 ) show
0 288 moveto (1430 ) show
0 276 moveto (1431 ) show
0 264 moveto (1432 ) show
0 252 moveto (1433 ) show
0 240 moveto (1434 ) show
0 228 moveto (1435 ) show
0 216 moveto (1436 ) show
0 204 moveto (1437 ) show
0 192 moveto (1438 ) show
0 180 moveto (1439 ) show
0 168 moveto (1440 ) show
0 156 moveto (1441 ) show
0 144 moveto (1442 ) show
0 132 moveto (1443 ) show
0 120 moveto (1444 ) show
0 108 moveto (1445 ) show
0 96 moveto (1446 ) show
0 84 moveto (1447 ) show
0 72 moveto (1448 ) show
0 60 moveto (1449 ) show
0 24 moveto (Sheet 14) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/spinlock.h  Page 2) show
0 648 moveto (1450 // Blank page.) show
0 636 moveto (1451 ) show
0 624 moveto (1452 ) show
0 612 moveto (1453 ) show
0 600 moveto (1454 ) show
0 588 moveto (1455 ) show
0 576 moveto (1456 ) show
0 564 moveto (1457 ) show
0 552 moveto (1458 ) show
0 540 moveto (1459 ) show
0 528 moveto (1460 ) show
0 516 moveto (1461 ) show
0 504 moveto (1462 ) show
0 492 moveto (1463 ) show
0 480 moveto (1464 ) show
0 468 moveto (1465 ) show
0 456 moveto (1466 ) show
0 444 moveto (1467 ) show
0 432 moveto (1468 ) show
0 420 moveto (1469 ) show
0 408 moveto (1470 ) show
0 396 moveto (1471 ) show
0 384 moveto (1472 ) show
0 372 moveto (1473 ) show
0 360 moveto (1474 ) show
0 348 moveto (1475 ) show
0 336 moveto (1476 ) show
0 324 moveto (1477 ) show
0 312 moveto (1478 ) show
0 300 moveto (1479 ) show
0 288 moveto (1480 ) show
0 276 moveto (1481 ) show
0 264 moveto (1482 ) show
0 252 moveto (1483 ) show
0 240 moveto (1484 ) show
0 228 moveto (1485 ) show
0 216 moveto (1486 ) show
0 204 moveto (1487 ) show
0 192 moveto (1488 ) show
0 180 moveto (1489 ) show
0 168 moveto (1490 ) show
0 156 moveto (1491 ) show
0 144 moveto (1492 ) show
0 132 moveto (1493 ) show
0 120 moveto (1494 ) show
0 108 moveto (1495 ) show
0 96 moveto (1496 ) show
0 84 moveto (1497 ) show
0 72 moveto (1498 ) show
0 60 moveto (1499 ) show
0 24 moveto (Sheet 14) show
grestore
restore
showpage
%%Page: 24 24
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/spinlock.c  Page 1) show
0 648 moveto (1500 // Mutual exclusion spin locks.) show
0 636 moveto (1501 ) show
0 624 moveto (1502 #include "types.h") show
0 612 moveto (1503 #include "defs.h") show
0 600 moveto (1504 #include "param.h") show
0 588 moveto (1505 #include "x86.h") show
0 576 moveto (1506 #include "mmu.h") show
0 564 moveto (1507 #include "proc.h") show
0 552 moveto (1508 #include "spinlock.h") show
0 540 moveto (1509 ) show
0 528 moveto (1510 extern int use_console_lock;) show
0 516 moveto (1511 ) show
0 504 moveto (1512 void) show
0 492 moveto (1513 initlock\(struct spinlock *lock, char *name\)) show
0 480 moveto (1514 {) show
0 468 moveto (1515   lock->name = name;) show
0 456 moveto (1516   lock->locked = 0;) show
0 444 moveto (1517   lock->cpu = 0xffffffff;) show
0 432 moveto (1518 }) show
0 420 moveto (1519 ) show
0 408 moveto (1520 int int_enabled;) show
0 396 moveto (1521 // Acquire the lock.) show
0 384 moveto (1522 // Loops \(spins\) until the lock is acquired.) show
0 372 moveto (1523 // Holding a lock for a long time may cause) show
0 360 moveto (1524 // other CPUs to waste time spinning to acquire it.) show
0 348 moveto (1525 void) show
0 336 moveto (1526 acquire\(struct spinlock *lock\)) show
0 324 moveto (1527 {) show
0 312 moveto (1528   if\(holding\(lock\)\)) show
0 300 moveto (1529   {) show
0 288 moveto (1530     cprintf\("lock already acquired by:\\n"\);) show
0 276 moveto (1531     int i;) show
0 264 moveto (1532     for \(i=0; i<10; i++\)) show
0 252 moveto (1533     {) show
0 240 moveto (1534         if \(\(lock->pcs[i] == 0\) || \(lock->pcs[i] == 0xffffffff\)\)) show
0 228 moveto (1535             break;) show
0 216 moveto (1536         cprintf\("0x%08x ", lock->pcs[i]\);) show
0 204 moveto (1537     }) show
0 192 moveto (1538     cprintf\("\\n"\);) show
0 180 moveto (1539     panic\("acquire"\);) show
0 168 moveto (1540   }) show
0 156 moveto (1541 ) show
0 144 moveto (1542 //  if\(cpus[cpu\(\)].nlock == 0\)) show
0 132 moveto (1543 //  {) show
0 120 moveto (1544 //    int_enabled = 0;) show
0 108 moveto (1545     cli\(\);) show
0 96 moveto (1546 //    cprintf\("!D"\);) show
0 84 moveto (1547 // }) show
0 72 moveto (1548   cpus[cpu\(\)].nlock++;) show
0 60 moveto (1549   cpus[cpu\(\)].locks[cpus[cpu\(\)].nlock] = lock;) show
0 24 moveto (Sheet 15) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/spinlock.c  Page 2) show
0 648 moveto (1550   while\(cmpxchg\(0, 1, &lock->locked\) == 1\)) show
0 636 moveto (1551     ;) show
0 624 moveto (1552 ) show
0 612 moveto (1553   // Serialize instructions: now that lock is acquired, make sure) show
0 600 moveto (1554   // we wait for all pending writes from other processors.) show
0 588 moveto (1555   cpuid\(0, 0, 0, 0, 0\);  // memory barrier \(see Ch 7, IA-32 manual vol 3\)) show
0 576 moveto (1556 ) show
0 564 moveto (1557   // Record info about lock acquisition for debugging.) show
0 552 moveto (1558   // The +10 is only so that we can tell the difference) show
0 540 moveto (1559   // between forgetting to initialize lock->cpu) show
0 528 moveto (1560   // and holding a lock on cpu 0.) show
0 516 moveto (1561   lock->cpu = cpu\(\) + 10;) show
0 504 moveto (1562   getcallerpcs\(&lock, lock->pcs\);) show
0 492 moveto (1563 }) show
0 480 moveto (1564 ) show
0 468 moveto (1565 // Release the lock.) show
0 456 moveto (1566 void) show
0 444 moveto (1567 release\(struct spinlock *lock\)) show
0 432 moveto (1568 {) show
0 420 moveto (1569   if\(!holding\(lock\)\)) show
0 408 moveto (1570     panic\("release"\);) show
0 396 moveto (1571 ) show
0 384 moveto (1572   lock->pcs[0] = 0;) show
0 372 moveto (1573   lock->cpu = 0xffffffff;) show
0 360 moveto (1574 ) show
0 348 moveto (1575   // Serialize instructions: before unlocking the lock, make sure) show
0 336 moveto (1576   // to flush any pending memory writes from this processor.) show
0 324 moveto (1577   cpuid\(0, 0, 0, 0, 0\);  // memory barrier \(see Ch 7, IA-32 manual vol 3\)) show
0 312 moveto (1578 ) show
0 300 moveto (1579   if \(int_enabled\)) show
0 288 moveto (1580       panic\("release when interrupts enabled"\);) show
0 276 moveto (1581   lock->locked = 0;) show
0 264 moveto (1582   if\(--cpus[cpu\(\)].nlock == 0\)) show
0 252 moveto (1583   {) show
0 240 moveto (1584 //      int_enabled = 1;) show
0 228 moveto (1585     sti\(\);) show
0 216 moveto (1586  //   cprintf\("!E"\);) show
0 204 moveto (1587   }) show
0 192 moveto (1588 }) show
0 180 moveto (1589 ) show
0 168 moveto (1590 ) show
0 156 moveto (1591 ) show
0 144 moveto (1592 ) show
0 132 moveto (1593 ) show
0 120 moveto (1594 ) show
0 108 moveto (1595 ) show
0 96 moveto (1596 ) show
0 84 moveto (1597 ) show
0 72 moveto (1598 ) show
0 60 moveto (1599 ) show
0 24 moveto (Sheet 15) show
grestore
restore
showpage
%%Page: 25 25
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/spinlock.c  Page 3) show
0 648 moveto (1600 // Record the current call stack in pcs[] by following the %ebp chain.) show
0 636 moveto (1601 void) show
0 624 moveto (1602 getcallerpcs\(void *v, uint pcs[]\)) show
0 612 moveto (1603 {) show
0 600 moveto (1604   uint *ebp;) show
0 588 moveto (1605   int i;) show
0 576 moveto (1606 ) show
0 564 moveto (1607   ebp = \(uint*\)v - 2;) show
0 552 moveto (1608   for\(i = 0; i < 10; i++\){) show
0 540 moveto (1609     if\(ebp == 0 || ebp == \(uint*\)0xffffffff\)) show
0 528 moveto (1610       break;) show
0 516 moveto (1611     pcs[i] = ebp[1];     // saved %eip) show
0 504 moveto (1612     ebp = \(uint*\)ebp[0]; // saved %ebp) show
0 492 moveto (1613   }) show
0 480 moveto (1614   for\(; i < 10; i++\)) show
0 468 moveto (1615     pcs[i] = 0;) show
0 456 moveto (1616 }) show
0 444 moveto (1617 ) show
0 432 moveto (1618 // Check whether this cpu is holding the lock.) show
0 420 moveto (1619 int) show
0 408 moveto (1620 holding\(struct spinlock *lock\)) show
0 396 moveto (1621 {) show
0 384 moveto (1622   return lock->locked && lock->cpu == cpu\(\) + 10;) show
0 372 moveto (1623 }) show
0 360 moveto (1624 ) show
0 348 moveto (1625 ) show
0 336 moveto (1626 ) show
0 324 moveto (1627 ) show
0 312 moveto (1628 ) show
0 300 moveto (1629 ) show
0 288 moveto (1630 ) show
0 276 moveto (1631 ) show
0 264 moveto (1632 ) show
0 252 moveto (1633 ) show
0 240 moveto (1634 ) show
0 228 moveto (1635 ) show
0 216 moveto (1636 ) show
0 204 moveto (1637 ) show
0 192 moveto (1638 ) show
0 180 moveto (1639 ) show
0 168 moveto (1640 ) show
0 156 moveto (1641 ) show
0 144 moveto (1642 ) show
0 132 moveto (1643 ) show
0 120 moveto (1644 ) show
0 108 moveto (1645 ) show
0 96 moveto (1646 ) show
0 84 moveto (1647 ) show
0 72 moveto (1648 ) show
0 60 moveto (1649 ) show
0 24 moveto (Sheet 16) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sem.h  Page 1) show
0 648 moveto (1650 #ifndef XV6_SEM_H_) show
0 636 moveto (1651 #define XV6_SEM_H_) show
0 624 moveto (1652 ) show
0 612 moveto (1653 struct sem;) show
0 600 moveto (1654 typedef struct sem sem_t;) show
0 588 moveto (1655 ) show
0 576 moveto (1656 int sem_init\(sem_t *sem, unsigned int value\);) show
0 564 moveto (1657 int sem_destroy\(sem_t *sem\);) show
0 552 moveto (1658 void sem_post\(sem_t *sem\);) show
0 540 moveto (1659 void sem_wait\(sem_t *sem\);) show
0 528 moveto (1660 int sem_timedwait\(sem_t *sem, int timo\);) show
0 516 moveto (1661 int sem_trywait\(sem_t *sem\);) show
0 504 moveto (1662 int sem_value\(sem_t *sem\);) show
0 492 moveto (1663 int sem_size\(\);) show
0 480 moveto (1664 ) show
0 468 moveto (1665 #endif // XV6_SEM_H_) show
0 456 moveto (1666 ) show
0 444 moveto (1667 ) show
0 432 moveto (1668 ) show
0 420 moveto (1669 ) show
0 408 moveto (1670 ) show
0 396 moveto (1671 ) show
0 384 moveto (1672 ) show
0 372 moveto (1673 ) show
0 360 moveto (1674 ) show
0 348 moveto (1675 ) show
0 336 moveto (1676 ) show
0 324 moveto (1677 ) show
0 312 moveto (1678 ) show
0 300 moveto (1679 ) show
0 288 moveto (1680 ) show
0 276 moveto (1681 ) show
0 264 moveto (1682 ) show
0 252 moveto (1683 ) show
0 240 moveto (1684 ) show
0 228 moveto (1685 ) show
0 216 moveto (1686 ) show
0 204 moveto (1687 ) show
0 192 moveto (1688 ) show
0 180 moveto (1689 ) show
0 168 moveto (1690 ) show
0 156 moveto (1691 ) show
0 144 moveto (1692 ) show
0 132 moveto (1693 ) show
0 120 moveto (1694 ) show
0 108 moveto (1695 ) show
0 96 moveto (1696 ) show
0 84 moveto (1697 ) show
0 72 moveto (1698 ) show
0 60 moveto (1699 ) show
0 24 moveto (Sheet 16) show
grestore
restore
showpage
%%Page: 26 26
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sem.c  Page 1) show
0 648 moveto (1700 #include "assert.h") show
0 636 moveto (1701 #include "types.h") show
0 624 moveto (1702 #include "spinlock.h") show
0 612 moveto (1703 #include "defs.h") show
0 600 moveto (1704 #include "sem.h") show
0 588 moveto (1705 ) show
0 576 moveto (1706 struct sem {) show
0 564 moveto (1707     struct spinlock lock;) show
0 552 moveto (1708     int val;) show
0 540 moveto (1709     int waiters;) show
0 528 moveto (1710 };) show
0 516 moveto (1711 ) show
0 504 moveto (1712 int sem_init\(sem_t *sem, unsigned int value\)) show
0 492 moveto (1713 {) show
0 480 moveto (1714     assert\(value >= 0\);) show
0 468 moveto (1715     initlock\(&sem->lock, "sem lock"\);) show
0 456 moveto (1716     sem->val = value;) show
0 444 moveto (1717     sem->waiters = 0;) show
0 432 moveto (1718     return 0;) show
0 420 moveto (1719 }) show
0 408 moveto (1720 ) show
0 396 moveto (1721 int sem_destroy\(sem_t *sem\)) show
0 384 moveto (1722 {) show
0 372 moveto (1723     assert\(sem->waiters == 0\);) show
0 360 moveto (1724     return 0;) show
0 348 moveto (1725 }) show
0 336 moveto (1726 ) show
0 324 moveto (1727 void sem_post\(sem_t *sem\)) show
0 312 moveto (1728 {) show
0 300 moveto (1729     acquire\(&sem->lock\);) show
0 288 moveto (1730     sem->val++;) show
0 276 moveto (1731     if \(\(sem->waiters\) && \(sem->val > 0\)\)) show
0 264 moveto (1732     {) show
0 252 moveto (1733         wakeup_one\(sem\); // XXX maybe wakeup?) show
0 240 moveto (1734     }) show
0 228 moveto (1735     release\(&sem->lock\);) show
0 216 moveto (1736 }) show
0 204 moveto (1737 ) show
0 192 moveto (1738 void sem_wait\(sem_t *sem\)) show
0 180 moveto (1739 {) show
0 168 moveto (1740     acquire\(&sem->lock\);) show
0 156 moveto (1741     while \(sem->val == 0\)) show
0 144 moveto (1742     {) show
0 132 moveto (1743         sem->waiters++;) show
0 120 moveto (1744         sleep\(sem, &sem->lock\);) show
0 108 moveto (1745         sem->waiters--;) show
0 96 moveto (1746     }) show
0 84 moveto (1747     sem->val--;) show
0 72 moveto (1748     release\(&sem->lock\);) show
0 60 moveto (1749 }) show
0 24 moveto (Sheet 17) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sem.c  Page 2) show
0 648 moveto (1750 int sem_timedwait\(sem_t *sem, int timo\)) show
0 636 moveto (1751 {) show
0 624 moveto (1752     int ret;) show
0 612 moveto (1753 ) show
0 600 moveto (1754     acquire\(&sem->lock\);) show
0 588 moveto (1755     for \(ret = 0; sem->val == 0 && ret == 0;\)) show
0 576 moveto (1756     {) show
0 564 moveto (1757         sem->waiters++;) show
0 552 moveto (1758         ret = msleep_spin\(sem, &sem->lock, timo\);) show
0 540 moveto (1759         sem->waiters--;) show
0 528 moveto (1760     }) show
0 516 moveto (1761     if \(sem->val > 0\)) show
0 504 moveto (1762     {) show
0 492 moveto (1763         sem->val--;) show
0 480 moveto (1764         ret = 0;) show
0 468 moveto (1765     }) show
0 456 moveto (1766     release\(&sem->lock\);) show
0 444 moveto (1767 ) show
0 432 moveto (1768     return ret;) show
0 420 moveto (1769 }) show
0 408 moveto (1770 ) show
0 396 moveto (1771 int sem_trywait\(sem_t *sem\)) show
0 384 moveto (1772 {) show
0 372 moveto (1773     int ret;) show
0 360 moveto (1774 ) show
0 348 moveto (1775     acquire\(&sem->lock\);) show
0 336 moveto (1776     if \(sem->val > 0\)) show
0 324 moveto (1777     {) show
0 312 moveto (1778         sem->val--;) show
0 300 moveto (1779         ret = 1;) show
0 288 moveto (1780     } else {) show
0 276 moveto (1781         ret = 0;) show
0 264 moveto (1782     }) show
0 252 moveto (1783     release\(&sem->lock\);) show
0 240 moveto (1784     return ret;) show
0 228 moveto (1785 }) show
0 216 moveto (1786 ) show
0 204 moveto (1787 int sem_value\(sem_t *sem\)) show
0 192 moveto (1788 {) show
0 180 moveto (1789     int ret;) show
0 168 moveto (1790 ) show
0 156 moveto (1791     acquire\(&sem->lock\);) show
0 144 moveto (1792     ret = sem->val;) show
0 132 moveto (1793     release\(&sem->lock\);) show
0 120 moveto (1794     return ret;) show
0 108 moveto (1795 }) show
0 96 moveto (1796 ) show
0 84 moveto (1797 ) show
0 72 moveto (1798 ) show
0 60 moveto (1799 ) show
0 24 moveto (Sheet 17) show
grestore
restore
showpage
%%Page: 27 27
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sem.c  Page 3) show
0 648 moveto (1800 int sem_size\(\)) show
0 636 moveto (1801 {) show
0 624 moveto (1802     return sizeof\(struct sem\);) show
0 612 moveto (1803 }) show
0 600 moveto (1804 ) show
0 588 moveto (1805 ) show
0 576 moveto (1806 ) show
0 564 moveto (1807 ) show
0 552 moveto (1808 ) show
0 540 moveto (1809 ) show
0 528 moveto (1810 ) show
0 516 moveto (1811 ) show
0 504 moveto (1812 ) show
0 492 moveto (1813 ) show
0 480 moveto (1814 ) show
0 468 moveto (1815 ) show
0 456 moveto (1816 ) show
0 444 moveto (1817 ) show
0 432 moveto (1818 ) show
0 420 moveto (1819 ) show
0 408 moveto (1820 ) show
0 396 moveto (1821 ) show
0 384 moveto (1822 ) show
0 372 moveto (1823 ) show
0 360 moveto (1824 ) show
0 348 moveto (1825 ) show
0 336 moveto (1826 ) show
0 324 moveto (1827 ) show
0 312 moveto (1828 ) show
0 300 moveto (1829 ) show
0 288 moveto (1830 ) show
0 276 moveto (1831 ) show
0 264 moveto (1832 ) show
0 252 moveto (1833 ) show
0 240 moveto (1834 ) show
0 228 moveto (1835 ) show
0 216 moveto (1836 ) show
0 204 moveto (1837 ) show
0 192 moveto (1838 ) show
0 180 moveto (1839 ) show
0 168 moveto (1840 ) show
0 156 moveto (1841 ) show
0 144 moveto (1842 ) show
0 132 moveto (1843 ) show
0 120 moveto (1844 ) show
0 108 moveto (1845 ) show
0 96 moveto (1846 ) show
0 84 moveto (1847 ) show
0 72 moveto (1848 ) show
0 60 moveto (1849 ) show
0 24 moveto (Sheet 18) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/assert.h  Page 1) show
0 648 moveto (1850 #ifndef XV6_ASSERT_H_) show
0 636 moveto (1851 #define XV6_ASSERT_H_) show
0 624 moveto (1852 ) show
0 612 moveto (1853 #define assert\(expr\) \\) show
0 600 moveto (1854     \(\(expr\) ? \(void\)0 : __assert\(__func__, __FILE__, \\) show
0 588 moveto (1855         __LINE__, #expr\)\)) show
0 576 moveto (1856 ) show
0 564 moveto (1857 void __assert\(const char *, const char *, int, const char *\);) show
0 552 moveto (1858 ) show
0 540 moveto (1859 #endif // XV6_ASSERT_H_) show
0 528 moveto (1860 ) show
0 516 moveto (1861 ) show
0 504 moveto (1862 ) show
0 492 moveto (1863 ) show
0 480 moveto (1864 ) show
0 468 moveto (1865 ) show
0 456 moveto (1866 ) show
0 444 moveto (1867 ) show
0 432 moveto (1868 ) show
0 420 moveto (1869 ) show
0 408 moveto (1870 ) show
0 396 moveto (1871 ) show
0 384 moveto (1872 ) show
0 372 moveto (1873 ) show
0 360 moveto (1874 ) show
0 348 moveto (1875 ) show
0 336 moveto (1876 ) show
0 324 moveto (1877 ) show
0 312 moveto (1878 ) show
0 300 moveto (1879 ) show
0 288 moveto (1880 ) show
0 276 moveto (1881 ) show
0 264 moveto (1882 ) show
0 252 moveto (1883 ) show
0 240 moveto (1884 ) show
0 228 moveto (1885 ) show
0 216 moveto (1886 ) show
0 204 moveto (1887 ) show
0 192 moveto (1888 ) show
0 180 moveto (1889 ) show
0 168 moveto (1890 ) show
0 156 moveto (1891 ) show
0 144 moveto (1892 ) show
0 132 moveto (1893 ) show
0 120 moveto (1894 ) show
0 108 moveto (1895 ) show
0 96 moveto (1896 ) show
0 84 moveto (1897 ) show
0 72 moveto (1898 ) show
0 60 moveto (1899 ) show
0 24 moveto (Sheet 18) show
grestore
restore
showpage
%%Page: 28 28
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/assert.c  Page 1) show
0 648 moveto (1900 #include "assert.h") show
0 636 moveto (1901 #include "types.h") show
0 624 moveto (1902 #include "defs.h") show
0 612 moveto (1903 ) show
0 600 moveto (1904 void __assert\(const char *func, const char *file,) show
0 588 moveto (1905         int line, const char *expr\)) show
0 576 moveto (1906 {) show
0 564 moveto (1907     cprintf\("assert failed: %s at %s:%d, expression %s\\n",) show
0 552 moveto (1908             func, file, line, expr\);) show
0 540 moveto (1909 }) show
0 528 moveto (1910 ) show
0 516 moveto (1911 ) show
0 504 moveto (1912 ) show
0 492 moveto (1913 ) show
0 480 moveto (1914 ) show
0 468 moveto (1915 ) show
0 456 moveto (1916 ) show
0 444 moveto (1917 ) show
0 432 moveto (1918 ) show
0 420 moveto (1919 ) show
0 408 moveto (1920 ) show
0 396 moveto (1921 ) show
0 384 moveto (1922 ) show
0 372 moveto (1923 ) show
0 360 moveto (1924 ) show
0 348 moveto (1925 ) show
0 336 moveto (1926 ) show
0 324 moveto (1927 ) show
0 312 moveto (1928 ) show
0 300 moveto (1929 ) show
0 288 moveto (1930 ) show
0 276 moveto (1931 ) show
0 264 moveto (1932 ) show
0 252 moveto (1933 ) show
0 240 moveto (1934 ) show
0 228 moveto (1935 ) show
0 216 moveto (1936 ) show
0 204 moveto (1937 ) show
0 192 moveto (1938 ) show
0 180 moveto (1939 ) show
0 168 moveto (1940 ) show
0 156 moveto (1941 ) show
0 144 moveto (1942 ) show
0 132 moveto (1943 ) show
0 120 moveto (1944 ) show
0 108 moveto (1945 ) show
0 96 moveto (1946 ) show
0 84 moveto (1947 ) show
0 72 moveto (1948 ) show
0 60 moveto (1949 ) show
0 24 moveto (Sheet 19) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.h  Page 1) show
0 648 moveto (1950 #include "spinlock.h") show
0 636 moveto (1951 #include "param.h") show
0 624 moveto (1952 #include "mmu.h") show
0 612 moveto (1953 // Segments in proc->gdt) show
0 600 moveto (1954 #define SEG_KCODE 1  // kernel code) show
0 588 moveto (1955 #define SEG_KDATA 2  // kernel data+stack) show
0 576 moveto (1956 #define SEG_UCODE 3) show
0 564 moveto (1957 #define SEG_UDATA 4) show
0 552 moveto (1958 #define SEG_TSS   5  // this process's task state) show
0 540 moveto (1959 #define NSEGS     6) show
0 528 moveto (1960 ) show
0 516 moveto (1961 // Saved registers for kernel context switches.) show
0 504 moveto (1962 // Don't need to save all the %fs etc. segment registers,) show
0 492 moveto (1963 // because they are constant across kernel contexts.) show
0 480 moveto (1964 // Save all the regular registers so we don't need to care) show
0 468 moveto (1965 // which are caller save, but not the return register %eax.) show
0 456 moveto (1966 // \(Not saving %eax just simplifies the switching code.\)) show
0 444 moveto (1967 // The layout of context must match code in swtch.S.) show
0 432 moveto (1968 struct context {) show
0 420 moveto (1969   int eip;) show
0 408 moveto (1970   int esp;) show
0 396 moveto (1971   int ebx;) show
0 384 moveto (1972   int ecx;) show
0 372 moveto (1973   int edx;) show
0 360 moveto (1974   int esi;) show
0 348 moveto (1975   int edi;) show
0 336 moveto (1976   int ebp;) show
0 324 moveto (1977 };) show
0 312 moveto (1978 ) show
0 300 moveto (1979 enum proc_state { UNUSED, EMBRYO, SLEEPING, RUNNABLE,) show
0 288 moveto (1980     RUNNING, ZOMBIE, MSLEEPING};) show
0 276 moveto (1981 ) show
0 264 moveto (1982 // Per-process state) show
0 252 moveto (1983 struct proc {) show
0 240 moveto (1984   char *mem;                // Start of process memory \(kernel address\)) show
0 228 moveto (1985   uint sz;                  // Size of process memory \(bytes\)) show
0 216 moveto (1986   char *kstack;             // Bottom of kernel stack for this process) show
0 204 moveto (1987   enum proc_state state;    // Process state) show
0 192 moveto (1988   int pid;                  // Process ID) show
0 180 moveto (1989   struct proc *parent;      // Parent process) show
0 168 moveto (1990   void *chan;               // If non-zero, sleeping on chan) show
0 156 moveto (1991   int killed;               // If non-zero, have been killed) show
0 144 moveto (1992   struct file *ofile[NOFILE];  // Open files) show
0 132 moveto (1993   struct inode *cwd;        // Current directory) show
0 120 moveto (1994   struct context context;   // Switch here to run process) show
0 108 moveto (1995   struct trapframe *tf;     // Trap frame for current interrupt) show
0 96 moveto (1996   char name[32];            // Process name \(debugging\)) show
0 84 moveto (1997   struct thread *thr;) show
0 72 moveto (1998 };) show
0 60 moveto (1999 ) show
0 24 moveto (Sheet 19) show
grestore
restore
showpage
%%Page: 29 29
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.h  Page 2) show
0 648 moveto (2000 // Process memory is laid out contiguously, low addresses first:) show
0 636 moveto (2001 //   text) show
0 624 moveto (2002 //   original data and bss) show
0 612 moveto (2003 //   fixed-size stack) show
0 600 moveto (2004 //   expandable heap) show
0 588 moveto (2005 ) show
0 576 moveto (2006 // Arrange that cp point to the struct proc that this) show
0 564 moveto (2007 // CPU is currently running.  Such preprocessor) show
0 552 moveto (2008 // subterfuge can be confusing, but saves a lot of typing.) show
0 540 moveto (2009 extern struct proc *curproc[NCPU];  // Current \(running\) process per CPU) show
0 528 moveto (2010 #define cp \(curproc[cpu\(\)]\)  // Current process on this CPU) show
0 516 moveto (2011 ) show
0 504 moveto (2012 ) show
0 492 moveto (2013 #define MPSTACK 4096) show
0 480 moveto (2014 ) show
0 468 moveto (2015 // Per-CPU state) show
0 456 moveto (2016 struct cpu {) show
0 444 moveto (2017   uchar apicid;               // Local APIC ID) show
0 432 moveto (2018   struct context context;     // Switch here to enter scheduler) show
0 420 moveto (2019   struct taskstate ts;        // Used by x86 to find stack for interrupt) show
0 408 moveto (2020   struct segdesc gdt[NSEGS];  // x86 global descriptor table) show
0 396 moveto (2021   char mpstack[MPSTACK];      // Per-CPU startup stack) show
0 384 moveto (2022   volatile int booted;        // Has the CPU started?) show
0 372 moveto (2023   int nlock;                  // Number of locks currently held) show
0 360 moveto (2024 #define MAX_LOCKS   10) show
0 348 moveto (2025   struct spinlock *locks[MAX_LOCKS];) show
0 336 moveto (2026 };) show
0 324 moveto (2027 ) show
0 312 moveto (2028 extern struct cpu cpus[NCPU];) show
0 300 moveto (2029 extern int ncpu;) show
0 288 moveto (2030 extern struct spinlock proc_table_lock;) show
0 276 moveto (2031 ) show
0 264 moveto (2032 ) show
0 252 moveto (2033 ) show
0 240 moveto (2034 ) show
0 228 moveto (2035 ) show
0 216 moveto (2036 ) show
0 204 moveto (2037 ) show
0 192 moveto (2038 ) show
0 180 moveto (2039 ) show
0 168 moveto (2040 ) show
0 156 moveto (2041 ) show
0 144 moveto (2042 ) show
0 132 moveto (2043 ) show
0 120 moveto (2044 ) show
0 108 moveto (2045 ) show
0 96 moveto (2046 ) show
0 84 moveto (2047 ) show
0 72 moveto (2048 ) show
0 60 moveto (2049 ) show
0 24 moveto (Sheet 20) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 1) show
0 648 moveto (2050 #include "types.h") show
0 636 moveto (2051 #include "defs.h") show
0 624 moveto (2052 #include "param.h") show
0 612 moveto (2053 #include "mmu.h") show
0 600 moveto (2054 #include "x86.h") show
0 588 moveto (2055 #include "proc.h") show
0 576 moveto (2056 #include "spinlock.h") show
0 564 moveto (2057 #include "thread.h") show
0 552 moveto (2058 ) show
0 540 moveto (2059 struct spinlock proc_table_lock;) show
0 528 moveto (2060 ) show
0 516 moveto (2061 struct proc proc[NPROC];) show
0 504 moveto (2062 struct proc *curproc[NCPU];) show
0 492 moveto (2063 struct proc *initproc;) show
0 480 moveto (2064 ) show
0 468 moveto (2065 int nextpid = 1;) show
0 456 moveto (2066 extern void forkret\(void\);) show
0 444 moveto (2067 extern void forkret1\(struct trapframe*\);) show
0 432 moveto (2068 ) show
0 420 moveto (2069 void) show
0 408 moveto (2070 pinit\(void\)) show
0 396 moveto (2071 {) show
0 384 moveto (2072   initlock\(&proc_table_lock, "proc_table"\);) show
0 372 moveto (2073 }) show
0 360 moveto (2074 ) show
0 348 moveto (2075 // Look in the process table for an UNUSED proc.) show
0 336 moveto (2076 // If found, change state to EMBRYO and return it.) show
0 324 moveto (2077 // Otherwise return 0.) show
0 312 moveto (2078 struct proc*) show
0 300 moveto (2079 allocproc\(void\)) show
0 288 moveto (2080 {) show
0 276 moveto (2081   int i;) show
0 264 moveto (2082   struct proc *p;) show
0 252 moveto (2083 ) show
0 240 moveto (2084   acquire\(&proc_table_lock\);) show
0 228 moveto (2085   for\(i = 0; i < NPROC; i++\){) show
0 216 moveto (2086     p = &proc[i];) show
0 204 moveto (2087     if\(p->state == UNUSED\){) show
0 192 moveto (2088       p->state = EMBRYO;) show
0 180 moveto (2089       p->pid = nextpid++;) show
0 168 moveto (2090       p->thr = 0;) show
0 156 moveto (2091       release\(&proc_table_lock\);) show
0 144 moveto (2092       return p;) show
0 132 moveto (2093     }) show
0 120 moveto (2094   }) show
0 108 moveto (2095   release\(&proc_table_lock\);) show
0 96 moveto (2096   return 0;) show
0 84 moveto (2097 }) show
0 72 moveto (2098 ) show
0 60 moveto (2099 ) show
0 24 moveto (Sheet 20) show
grestore
restore
showpage
%%Page: 30 30
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 2) show
0 648 moveto (2100 // Grow current process's memory by n bytes.) show
0 636 moveto (2101 // Return old size on success, -1 on failure.) show
0 624 moveto (2102 int) show
0 612 moveto (2103 growproc\(int n\)) show
0 600 moveto (2104 {) show
0 588 moveto (2105   char *newmem, *oldmem;) show
0 576 moveto (2106 ) show
0 564 moveto (2107   newmem = kalloc\(cp->sz + n\);) show
0 552 moveto (2108   if\(newmem == 0\)) show
0 540 moveto (2109     return -1;) show
0 528 moveto (2110   memmove\(newmem, cp->mem, cp->sz\);) show
0 516 moveto (2111   memset\(newmem + cp->sz, 0, n\);) show
0 504 moveto (2112   oldmem = cp->mem;) show
0 492 moveto (2113   cp->mem = newmem;) show
0 480 moveto (2114   kfree\(oldmem, cp->sz\);) show
0 468 moveto (2115   cp->sz += n;) show
0 456 moveto (2116   return cp->sz - n;) show
0 444 moveto (2117 }) show
0 432 moveto (2118 ) show
0 420 moveto (2119 // Set up CPU's segment descriptors and task state for a given process.) show
0 408 moveto (2120 // If p==0, set up for "idle" state for when scheduler\(\) is running.) show
0 396 moveto (2121 void) show
0 384 moveto (2122 setupsegs\(struct proc *p\)) show
0 372 moveto (2123 {) show
0 360 moveto (2124   struct cpu *c;) show
0 348 moveto (2125 ) show
0 336 moveto (2126   c = &cpus[cpu\(\)];) show
0 324 moveto (2127   c->ts.ss0 = SEG_KDATA << 3;) show
0 312 moveto (2128   if\(p\)) show
0 300 moveto (2129     c->ts.esp0 = \(uint\)\(p->kstack + KSTACKSIZE\);) show
0 288 moveto (2130   else) show
0 276 moveto (2131     c->ts.esp0 = 0xffffffff;) show
0 264 moveto (2132 ) show
0 252 moveto (2133   c->gdt[0] = SEG_NULL;) show
0 240 moveto (2134   c->gdt[SEG_KCODE] = SEG\(STA_X|STA_R, 0, 0x100000 + 64*1024-1, 0\);) show
0 228 moveto (2135   c->gdt[SEG_KDATA] = SEG\(STA_W, 0, 0xffffffff, 0\);) show
0 216 moveto (2136   c->gdt[SEG_TSS] = SEG16\(STS_T32A, \(uint\)&c->ts, sizeof\(c->ts\)-1, 0\);) show
0 204 moveto (2137   c->gdt[SEG_TSS].s = 0;) show
0 192 moveto (2138   if\(p\){) show
0 180 moveto (2139     c->gdt[SEG_UCODE] = SEG\(STA_X|STA_R, \(uint\)p->mem, p->sz-1, DPL_USER\);) show
0 168 moveto (2140     c->gdt[SEG_UDATA] = SEG\(STA_W, \(uint\)p->mem, p->sz-1, DPL_USER\);) show
0 156 moveto (2141   } else {) show
0 144 moveto (2142     c->gdt[SEG_UCODE] = SEG_NULL;) show
0 132 moveto (2143     c->gdt[SEG_UDATA] = SEG_NULL;) show
0 120 moveto (2144   }) show
0 108 moveto (2145 ) show
0 96 moveto (2146   lgdt\(c->gdt, sizeof\(c->gdt\)\);) show
0 84 moveto (2147   ltr\(SEG_TSS << 3\);) show
0 72 moveto (2148 }) show
0 60 moveto (2149 ) show
0 24 moveto (Sheet 21) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 3) show
0 648 moveto (2150 // Create a new process copying p as the parent.) show
0 636 moveto (2151 // Sets up stack to return as if from system call.) show
0 624 moveto (2152 // Caller must set state of returned proc to RUNNABLE.) show
0 612 moveto (2153 struct proc*) show
0 600 moveto (2154 copyproc\(struct proc *p\)) show
0 588 moveto (2155 {) show
0 576 moveto (2156   int i;) show
0 564 moveto (2157   struct proc *np;) show
0 552 moveto (2158 ) show
0 540 moveto (2159   // Allocate process.) show
0 528 moveto (2160   if\(\(np = allocproc\(\)\) == 0\)) show
0 516 moveto (2161     return 0;) show
0 504 moveto (2162 ) show
0 492 moveto (2163   // Allocate kernel stack.) show
0 480 moveto (2164   if\(\(np->kstack = kalloc\(KSTACKSIZE\)\) == 0\){) show
0 468 moveto (2165     np->state = UNUSED;) show
0 456 moveto (2166     return 0;) show
0 444 moveto (2167   }) show
0 432 moveto (2168   np->tf = \(struct trapframe*\)\(np->kstack + KSTACKSIZE\) - 1;) show
0 420 moveto (2169 ) show
0 408 moveto (2170   if\(p\){  // Copy process state from p.) show
0 396 moveto (2171     np->parent = p;) show
0 384 moveto (2172     memmove\(np->tf, p->tf, sizeof\(*np->tf\)\);) show
0 372 moveto (2173 ) show
0 360 moveto (2174     np->sz = p->sz;) show
0 348 moveto (2175     if\(\(np->mem = kalloc\(np->sz\)\) == 0\){) show
0 336 moveto (2176       kfree\(np->kstack, KSTACKSIZE\);) show
0 324 moveto (2177       np->kstack = 0;) show
0 312 moveto (2178       np->state = UNUSED;) show
0 300 moveto (2179       return 0;) show
0 288 moveto (2180     }) show
0 276 moveto (2181     memmove\(np->mem, p->mem, np->sz\);) show
0 264 moveto (2182 ) show
0 252 moveto (2183     for\(i = 0; i < NOFILE; i++\)) show
0 240 moveto (2184       if\(p->ofile[i]\)) show
0 228 moveto (2185         np->ofile[i] = filedup\(p->ofile[i]\);) show
0 216 moveto (2186     np->cwd = idup\(p->cwd\);) show
0 204 moveto (2187     np->thr = p->thr;) show
0 192 moveto (2188   }) show
0 180 moveto (2189 ) show
0 168 moveto (2190   // Set up new context to start executing at forkret \(see below\).) show
0 156 moveto (2191   memset\(&np->context, 0, sizeof\(np->context\)\);) show
0 144 moveto (2192   np->context.eip = \(uint\)forkret;) show
0 132 moveto (2193   np->context.esp = \(uint\)np->tf;) show
0 120 moveto (2194 ) show
0 108 moveto (2195   // Clear %eax so that fork system call returns 0 in child.) show
0 96 moveto (2196   np->tf->eax = 0;) show
0 84 moveto (2197   return np;) show
0 72 moveto (2198 }) show
0 60 moveto (2199 ) show
0 24 moveto (Sheet 21) show
grestore
restore
showpage
%%Page: 31 31
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 4) show
0 648 moveto (2200 // Set up first user process.) show
0 636 moveto (2201 void) show
0 624 moveto (2202 userinit\(void\)) show
0 612 moveto (2203 {) show
0 600 moveto (2204   struct proc *p;) show
0 588 moveto (2205   extern uchar _binary_initcode_start[], _binary_initcode_size[];) show
0 576 moveto (2206 ) show
0 564 moveto (2207   p = copyproc\(0\);) show
0 552 moveto (2208   p->sz = PAGE;) show
0 540 moveto (2209   p->mem = kalloc\(p->sz\);) show
0 528 moveto (2210   p->cwd = namei\("/"\);) show
0 516 moveto (2211   memset\(p->tf, 0, sizeof\(*p->tf\)\);) show
0 504 moveto (2212   p->tf->cs = \(SEG_UCODE << 3\) | DPL_USER;) show
0 492 moveto (2213   p->tf->ds = \(SEG_UDATA << 3\) | DPL_USER;) show
0 480 moveto (2214   p->tf->es = p->tf->ds;) show
0 468 moveto (2215   p->tf->ss = p->tf->ds;) show
0 456 moveto (2216   p->tf->eflags = FL_IF;) show
0 444 moveto (2217   p->tf->esp = p->sz;) show
0 432 moveto (2218 ) show
0 420 moveto (2219   // Make return address readable; needed for some gcc.) show
0 408 moveto (2220   p->tf->esp -= 4;) show
0 396 moveto (2221   *\(uint*\)\(p->mem + p->tf->esp\) = 0xefefefef;) show
0 384 moveto (2222 ) show
0 372 moveto (2223   // On entry to user space, start executing at beginning of initcode.S.) show
0 360 moveto (2224   p->tf->eip = 0;) show
0 348 moveto (2225   memmove\(p->mem, _binary_initcode_start, \(int\)_binary_initcode_size\);) show
0 336 moveto (2226   safestrcpy\(p->name, "initcode", sizeof\(p->name\)\);) show
0 324 moveto (2227   p->state = RUNNABLE;) show
0 312 moveto (2228 ) show
0 300 moveto (2229   initproc = p;) show
0 288 moveto (2230 }) show
0 276 moveto (2231 ) show
0 264 moveto (2232 // Per-CPU process scheduler.) show
0 252 moveto (2233 // Each CPU calls scheduler\(\) after setting itself up.) show
0 240 moveto (2234 // Scheduler never returns.  It loops, doing:) show
0 228 moveto (2235 //  - choose a process to run) show
0 216 moveto (2236 //  - swtch to start running that process) show
0 204 moveto (2237 //  - eventually that process transfers control) show
0 192 moveto (2238 //      via swtch back to the scheduler.) show
0 180 moveto (2239 void) show
0 168 moveto (2240 scheduler\(void\)) show
0 156 moveto (2241 {) show
0 144 moveto (2242   struct proc *p;) show
0 132 moveto (2243   int i;) show
0 120 moveto (2244 ) show
0 108 moveto (2245   for\(;;\){) show
0 96 moveto (2246     // Loop over process table looking for process to run.) show
0 84 moveto (2247     acquire\(&proc_table_lock\);) show
0 72 moveto (2248 ) show
0 60 moveto (2249 ) show
0 24 moveto (Sheet 22) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 5) show
0 648 moveto (2250     for\(i = 0; i < NPROC; i++\){) show
0 636 moveto (2251       p = &proc[i];) show
0 624 moveto (2252       if\(\(p->state != RUNNABLE\) && \(p->state != MSLEEPING\)\)) show
0 612 moveto (2253         continue;) show
0 600 moveto (2254 ) show
0 588 moveto (2255 //      cprintf\("switch to %s eip: 0x%08x...\\n", p->name, p->context.eip\);) show
0 576 moveto (2256       // Switch to chosen process.  It is the process's job) show
0 564 moveto (2257       // to release proc_table_lock and then reacquire it) show
0 552 moveto (2258       // before jumping back to us.) show
0 540 moveto (2259       cp = p;) show
0 528 moveto (2260       setupsegs\(p\);) show
0 516 moveto (2261       if \(p->state == RUNNABLE\)) show
0 504 moveto (2262         p->state = RUNNING;) show
0 492 moveto (2263       swtch\(&cpus[cpu\(\)].context, &p->context\);) show
0 480 moveto (2264 ) show
0 468 moveto (2265 //      cprintf\("done.\\n"\);) show
0 456 moveto (2266       // Process is done running for now.) show
0 444 moveto (2267       // It should have changed its p->state before coming back.) show
0 432 moveto (2268       cp = 0;) show
0 420 moveto (2269       setupsegs\(0\);) show
0 408 moveto (2270     }) show
0 396 moveto (2271 ) show
0 384 moveto (2272     release\(&proc_table_lock\);) show
0 372 moveto (2273   }) show
0 360 moveto (2274 }) show
0 348 moveto (2275 ) show
0 336 moveto (2276 // Enter scheduler.  Must already hold proc_table_lock) show
0 324 moveto (2277 // and have changed curproc[cpu\(\)]->state.) show
0 312 moveto (2278 void) show
0 300 moveto (2279 sched\(void\)) show
0 288 moveto (2280 {) show
0 276 moveto (2281   if\(cp->state == RUNNING\)) show
0 264 moveto (2282     panic\("sched running"\);) show
0 252 moveto (2283   if\(!holding\(&proc_table_lock\)\)) show
0 240 moveto (2284     panic\("sched proc_table_lock"\);) show
0 228 moveto (2285 //  if\(cpus[cpu\(\)].nlock != 1\)) show
0 216 moveto (2286 //    panic\("sched locks"\);) show
0 204 moveto (2287 ) show
0 192 moveto (2288   swtch\(&cp->context, &cpus[cpu\(\)].context\);) show
0 180 moveto (2289 }) show
0 168 moveto (2290 ) show
0 156 moveto (2291 // Give up the CPU for one scheduling round.) show
0 144 moveto (2292 void) show
0 132 moveto (2293 yield\(void\)) show
0 120 moveto (2294 {) show
0 108 moveto (2295   acquire\(&proc_table_lock\);) show
0 96 moveto (2296   cp->state = RUNNABLE;) show
0 84 moveto (2297   sched\(\);) show
0 72 moveto (2298   release\(&proc_table_lock\);) show
0 60 moveto (2299 }) show
0 24 moveto (Sheet 22) show
grestore
restore
showpage
%%Page: 32 32
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 6) show
0 648 moveto (2300 // A fork child's very first scheduling by scheduler\(\)) show
0 636 moveto (2301 // will swtch here.  "Return" to user space.) show
0 624 moveto (2302 void) show
0 612 moveto (2303 forkret\(void\)) show
0 600 moveto (2304 {) show
0 588 moveto (2305   // Still holding proc_table_lock from scheduler.) show
0 576 moveto (2306   release\(&proc_table_lock\);) show
0 564 moveto (2307 ) show
0 552 moveto (2308   // Jump into assembly, never to return.) show
0 540 moveto (2309   forkret1\(cp->tf\);) show
0 528 moveto (2310 }) show
0 516 moveto (2311 ) show
0 504 moveto (2312 int) show
0 492 moveto (2313 msleep_spin\(void *chan, struct spinlock *lk, int timo\)) show
0 480 moveto (2314 {) show
0 468 moveto (2315     uint32_t s = millitime\(\);) show
0 456 moveto (2316     uint32_t p = s;) show
0 444 moveto (2317     int ret = 1; // Time Out) show
0 432 moveto (2318     s += timo;) show
0 420 moveto (2319 ) show
0 408 moveto (2320     if \(cp == 0\)) show
0 396 moveto (2321         panic\("msleep with cp == 0"\);) show
0 384 moveto (2322     if \(lk == 0\)) show
0 372 moveto (2323         panic\("msleep without lock"\);) show
0 360 moveto (2324 ) show
0 348 moveto (2325     if \(lk != &proc_table_lock\)) show
0 336 moveto (2326     {) show
0 324 moveto (2327         acquire\(&proc_table_lock\);) show
0 312 moveto (2328         release\(lk\);) show
0 300 moveto (2329     }) show
0 288 moveto (2330 ) show
0 276 moveto (2331     cp->chan = chan;) show
0 264 moveto (2332     cp->state = MSLEEPING;) show
0 252 moveto (2333     while \(p < s\)) show
0 240 moveto (2334     {) show
0 228 moveto (2335         sched\(\);) show
0 216 moveto (2336         if \(cp->state == RUNNING\)) show
0 204 moveto (2337         {) show
0 192 moveto (2338             ret = 0;) show
0 180 moveto (2339             break;) show
0 168 moveto (2340         }) show
0 156 moveto (2341         p = millitime\(\);) show
0 144 moveto (2342     }) show
0 132 moveto (2343     cp->chan = 0;) show
0 120 moveto (2344     cp->state = RUNNING;) show
0 108 moveto (2345 ) show
0 96 moveto (2346 ) show
0 84 moveto (2347 ) show
0 72 moveto (2348 ) show
0 60 moveto (2349 ) show
0 24 moveto (Sheet 23) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 7) show
0 648 moveto (2350     if \(lk != &proc_table_lock\)) show
0 636 moveto (2351     {) show
0 624 moveto (2352         release\(&proc_table_lock\);) show
0 612 moveto (2353         acquire\(lk\);) show
0 600 moveto (2354     }) show
0 588 moveto (2355     return ret;) show
0 576 moveto (2356 }) show
0 564 moveto (2357 ) show
0 552 moveto (2358 // Atomically release lock and sleep on chan.) show
0 540 moveto (2359 // Reacquires lock when reawakened.) show
0 528 moveto (2360 void) show
0 516 moveto (2361 sleep\(void *chan, struct spinlock *lk\)) show
0 504 moveto (2362 {) show
0 492 moveto (2363   if\(cp == 0\)) show
0 480 moveto (2364     panic\("sleep"\);) show
0 468 moveto (2365 ) show
0 456 moveto (2366   if\(lk == 0\)) show
0 444 moveto (2367     panic\("sleep without lk"\);) show
0 432 moveto (2368 ) show
0 420 moveto (2369   // Must acquire proc_table_lock in order to) show
0 408 moveto (2370   // change p->state and then call sched.) show
0 396 moveto (2371   // Once we hold proc_table_lock, we can be) show
0 384 moveto (2372   // guaranteed that we won't miss any wakeup) show
0 372 moveto (2373   // \(wakeup runs with proc_table_lock locked\),) show
0 360 moveto (2374   // so it's okay to release lk.) show
0 348 moveto (2375   if\(lk != &proc_table_lock\){) show
0 336 moveto (2376     acquire\(&proc_table_lock\);) show
0 324 moveto (2377     release\(lk\);) show
0 312 moveto (2378   }) show
0 300 moveto (2379 ) show
0 288 moveto (2380   // Go to sleep.) show
0 276 moveto (2381   cp->chan = chan;) show
0 264 moveto (2382   cp->state = SLEEPING;) show
0 252 moveto (2383   sched\(\);) show
0 240 moveto (2384 ) show
0 228 moveto (2385   // Tidy up.) show
0 216 moveto (2386   cp->chan = 0;) show
0 204 moveto (2387 ) show
0 192 moveto (2388   // Reacquire original lock.) show
0 180 moveto (2389   if\(lk != &proc_table_lock\){) show
0 168 moveto (2390     release\(&proc_table_lock\);) show
0 156 moveto (2391     acquire\(lk\);) show
0 144 moveto (2392   }) show
0 132 moveto (2393 }) show
0 120 moveto (2394 ) show
0 108 moveto (2395 ) show
0 96 moveto (2396 ) show
0 84 moveto (2397 ) show
0 72 moveto (2398 ) show
0 60 moveto (2399 ) show
0 24 moveto (Sheet 23) show
grestore
restore
showpage
%%Page: 33 33
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 8) show
0 648 moveto (2400 // Wake up all processes sleeping on chan.) show
0 636 moveto (2401 // Proc_table_lock must be held.) show
0 624 moveto (2402 static void) show
0 612 moveto (2403 wakeup1\(void *chan\)) show
0 600 moveto (2404 {) show
0 588 moveto (2405   struct proc *p;) show
0 576 moveto (2406 ) show
0 564 moveto (2407   for\(p = proc; p < &proc[NPROC]; p++\)) show
0 552 moveto (2408     if\(\(\(p->state == SLEEPING\) ||) show
0 540 moveto (2409                 \(p->state == MSLEEPING\)\) && p->chan == chan\)) show
0 528 moveto (2410       p->state = RUNNABLE;) show
0 516 moveto (2411 }) show
0 504 moveto (2412 ) show
0 492 moveto (2413 // Wake up all processes sleeping on chan.) show
0 480 moveto (2414 // Proc_table_lock must be held.) show
0 468 moveto (2415 static void) show
0 456 moveto (2416 wakeup_one1\(void *chan\)) show
0 444 moveto (2417 {) show
0 432 moveto (2418   struct proc *p;) show
0 420 moveto (2419 ) show
0 408 moveto (2420   for\(p = proc; p < &proc[NPROC]; p++\)) show
0 396 moveto (2421     if\(\(\(p->state == SLEEPING\) ||) show
0 384 moveto (2422                 \(p->state == MSLEEPING\)\) && p->chan == chan\)) show
0 372 moveto (2423     {) show
0 360 moveto (2424       p->state = RUNNABLE;) show
0 348 moveto (2425       break;) show
0 336 moveto (2426     }) show
0 324 moveto (2427 }) show
0 312 moveto (2428 ) show
0 300 moveto (2429 void) show
0 288 moveto (2430 wakeup_one\(void *chan\)) show
0 276 moveto (2431 {) show
0 264 moveto (2432   acquire\(&proc_table_lock\);) show
0 252 moveto (2433   wakeup_one1\(chan\);) show
0 240 moveto (2434   release\(&proc_table_lock\);) show
0 228 moveto (2435 }) show
0 216 moveto (2436 ) show
0 204 moveto (2437 // Wake up all processes sleeping on chan.) show
0 192 moveto (2438 // Proc_table_lock is acquired and released.) show
0 180 moveto (2439 void) show
0 168 moveto (2440 wakeup\(void *chan\)) show
0 156 moveto (2441 {) show
0 144 moveto (2442   acquire\(&proc_table_lock\);) show
0 132 moveto (2443   wakeup1\(chan\);) show
0 120 moveto (2444   release\(&proc_table_lock\);) show
0 108 moveto (2445 }) show
0 96 moveto (2446 ) show
0 84 moveto (2447 ) show
0 72 moveto (2448 ) show
0 60 moveto (2449 ) show
0 24 moveto (Sheet 24) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 9) show
0 648 moveto (2450 // Kill the process with the given pid.) show
0 636 moveto (2451 // Process won't actually exit until it returns) show
0 624 moveto (2452 // to user space \(see trap in trap.c\).) show
0 612 moveto (2453 int) show
0 600 moveto (2454 kill\(int pid\)) show
0 588 moveto (2455 {) show
0 576 moveto (2456   struct proc *p;) show
0 564 moveto (2457 ) show
0 552 moveto (2458   acquire\(&proc_table_lock\);) show
0 540 moveto (2459   for\(p = proc; p < &proc[NPROC]; p++\){) show
0 528 moveto (2460     if\(p->pid == pid\){) show
0 516 moveto (2461       p->killed = 1;) show
0 504 moveto (2462       // Wake process from sleep if necessary.) show
0 492 moveto (2463       if\(p->state == SLEEPING\)) show
0 480 moveto (2464         p->state = RUNNABLE;) show
0 468 moveto (2465       release\(&proc_table_lock\);) show
0 456 moveto (2466       return 0;) show
0 444 moveto (2467     }) show
0 432 moveto (2468   }) show
0 420 moveto (2469   release\(&proc_table_lock\);) show
0 408 moveto (2470   return -1;) show
0 396 moveto (2471 }) show
0 384 moveto (2472 ) show
0 372 moveto (2473 // Exit the current process.  Does not return.) show
0 360 moveto (2474 // Exited processes remain in the zombie state) show
0 348 moveto (2475 // until their parent calls wait\(\) to find out they exited.) show
0 336 moveto (2476 void) show
0 324 moveto (2477 exit\(void\)) show
0 312 moveto (2478 {) show
0 300 moveto (2479   struct proc *p;) show
0 288 moveto (2480   int fd;) show
0 276 moveto (2481 ) show
0 264 moveto (2482   if\(cp == initproc\)) show
0 252 moveto (2483     panic\("init exiting"\);) show
0 240 moveto (2484 ) show
0 228 moveto (2485   // Close all open files.) show
0 216 moveto (2486   for\(fd = 0; fd < NOFILE; fd++\){) show
0 204 moveto (2487     if\(cp->ofile[fd]\){) show
0 192 moveto (2488       fileclose\(cp->ofile[fd]\);) show
0 180 moveto (2489       cp->ofile[fd] = 0;) show
0 168 moveto (2490     }) show
0 156 moveto (2491   }) show
0 144 moveto (2492 ) show
0 132 moveto (2493   iput\(cp->cwd\);) show
0 120 moveto (2494   cp->cwd = 0;) show
0 108 moveto (2495 ) show
0 96 moveto (2496   acquire\(&proc_table_lock\);) show
0 84 moveto (2497 ) show
0 72 moveto (2498   // Parent might be sleeping in proc_wait.) show
0 60 moveto (2499   wakeup1\(cp->parent\);) show
0 24 moveto (Sheet 24) show
grestore
restore
showpage
%%Page: 34 34
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 10) show
0 648 moveto (2500   // Pass abandoned children to init.) show
0 636 moveto (2501   for\(p = proc; p < &proc[NPROC]; p++\){) show
0 624 moveto (2502     if\(p->parent == cp\){) show
0 612 moveto (2503       p->parent = initproc;) show
0 600 moveto (2504       if\(p->state == ZOMBIE\)) show
0 588 moveto (2505         wakeup1\(initproc\);) show
0 576 moveto (2506     }) show
0 564 moveto (2507   }) show
0 552 moveto (2508 ) show
0 540 moveto (2509   if \(cp->thr\)) show
0 528 moveto (2510       kproc_free\(cp->thr\);) show
0 516 moveto (2511 ) show
0 504 moveto (2512   // Jump into the scheduler, never to return.) show
0 492 moveto (2513   cp->killed = 0;) show
0 480 moveto (2514   cp->state = ZOMBIE;) show
0 468 moveto (2515   cp->thr = 0;) show
0 456 moveto (2516   sched\(\);) show
0 444 moveto (2517   panic\("zombie exit"\);) show
0 432 moveto (2518 }) show
0 420 moveto (2519 ) show
0 408 moveto (2520 // Wait for a child process to exit and return its pid.) show
0 396 moveto (2521 // Return -1 if this process has no children.) show
0 384 moveto (2522 int) show
0 372 moveto (2523 wait\(void\)) show
0 360 moveto (2524 {) show
0 348 moveto (2525   struct proc *p;) show
0 336 moveto (2526   int i, havekids, pid;) show
0 324 moveto (2527 ) show
0 312 moveto (2528   acquire\(&proc_table_lock\);) show
0 300 moveto (2529   for\(;;\){) show
0 288 moveto (2530     // Scan through table looking for zombie children.) show
0 276 moveto (2531     havekids = 0;) show
0 264 moveto (2532     for\(i = 0; i < NPROC; i++\){) show
0 252 moveto (2533       p = &proc[i];) show
0 240 moveto (2534       if\(p->state == UNUSED\)) show
0 228 moveto (2535         continue;) show
0 216 moveto (2536       if\(p->parent == cp\){) show
0 204 moveto (2537         if\(p->state == ZOMBIE\){) show
0 192 moveto (2538           // Found one.) show
0 180 moveto (2539 #ifdef PROC_DEBUG) show
0 168 moveto (2540           cprintf\("wait: freeing ZOMBIE %d %s\\n", p->pid, p->name\);) show
0 156 moveto (2541           cprintf\("      freeing mem\\n"\);) show
0 144 moveto (2542 #endif) show
0 132 moveto (2543           if \(p->sz != 0\) // kernel thread doesn't have mem) show
0 120 moveto (2544             kfree\(p->mem, p->sz\);) show
0 108 moveto (2545 #ifdef PROC_DEBUG) show
0 96 moveto (2546           cprintf\("      freeing kstack\\n"\);) show
0 84 moveto (2547 #endif) show
0 72 moveto (2548           kfree\(p->kstack, KSTACKSIZE\);) show
0 60 moveto (2549           pid = p->pid;) show
0 24 moveto (Sheet 25) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 11) show
0 648 moveto (2550           p->state = UNUSED;) show
0 636 moveto (2551           p->pid = 0;) show
0 624 moveto (2552           p->parent = 0;) show
0 612 moveto (2553           p->name[0] = 0;) show
0 600 moveto (2554           release\(&proc_table_lock\);) show
0 588 moveto (2555           return pid;) show
0 576 moveto (2556         }) show
0 564 moveto (2557         havekids = 1;) show
0 552 moveto (2558       }) show
0 540 moveto (2559     }) show
0 528 moveto (2560 ) show
0 516 moveto (2561     // No point waiting if we don't have any children.) show
0 504 moveto (2562     if\(!havekids || cp->killed\){) show
0 492 moveto (2563       release\(&proc_table_lock\);) show
0 480 moveto (2564       return -1;) show
0 468 moveto (2565     }) show
0 456 moveto (2566 ) show
0 444 moveto (2567     // Wait for children to exit.  \(See wakeup1 call in proc_exit.\)) show
0 432 moveto (2568     sleep\(cp, &proc_table_lock\);) show
0 420 moveto (2569   }) show
0 408 moveto (2570 }) show
0 396 moveto (2571 ) show
0 384 moveto (2572 // Print a process listing to console.  For debugging.) show
0 372 moveto (2573 // Runs when user types ^P on console.) show
0 360 moveto (2574 // No lock to avoid wedging a stuck machine further.) show
0 348 moveto (2575 void) show
0 336 moveto (2576 procdump\(void\)) show
0 324 moveto (2577 {) show
0 312 moveto (2578   static char *states[] = {) show
0 300 moveto (2579   [UNUSED]    "unused",) show
0 288 moveto (2580   [EMBRYO]    "embryo",) show
0 276 moveto (2581   [SLEEPING]  "sleep ",) show
0 264 moveto (2582   [RUNNABLE]  "runble",) show
0 252 moveto (2583   [RUNNING]   "run   ",) show
0 240 moveto (2584   [ZOMBIE]    "zombie",) show
0 228 moveto (2585   [MSLEEPING] "msleep") show
0 216 moveto (2586   };) show
0 204 moveto (2587   int i, j;) show
0 192 moveto (2588   struct proc *p;) show
0 180 moveto (2589   char *state;) show
0 168 moveto (2590   uint pc[10];) show
0 156 moveto (2591 ) show
0 144 moveto (2592   for\(i = 0; i < NPROC; i++\){) show
0 132 moveto (2593     p = &proc[i];) show
0 120 moveto (2594     if\(p->state == UNUSED\)) show
0 108 moveto (2595       continue;) show
0 96 moveto (2596     if\(p->state >= 0 && p->state < NELEM\(states\) && states[p->state]\)) show
0 84 moveto (2597       state = states[p->state];) show
0 72 moveto (2598     else) show
0 60 moveto (2599       state = "???";) show
0 24 moveto (Sheet 25) show
grestore
restore
showpage
%%Page: 35 35
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/proc.c  Page 12) show
0 648 moveto (2600     cprintf\("%d %s %s", p->pid, state, p->name\);) show
0 636 moveto (2601     if\(\(p->state == SLEEPING\) || \(p->state == MSLEEPING\)\){) show
0 624 moveto (2602       getcallerpcs\(\(uint*\)p->context.ebp+2, pc\);) show
0 612 moveto (2603       for\(j=0; j<10 && pc[j] != 0; j++\)) show
0 600 moveto (2604         cprintf\(" %p", pc[j]\);) show
0 588 moveto (2605     }) show
0 576 moveto (2606     cprintf\("\\n"\);) show
0 564 moveto (2607   }) show
0 552 moveto (2608 }) show
0 540 moveto (2609 ) show
0 528 moveto (2610 ) show
0 516 moveto (2611 ) show
0 504 moveto (2612 ) show
0 492 moveto (2613 ) show
0 480 moveto (2614 ) show
0 468 moveto (2615 ) show
0 456 moveto (2616 ) show
0 444 moveto (2617 ) show
0 432 moveto (2618 ) show
0 420 moveto (2619 ) show
0 408 moveto (2620 ) show
0 396 moveto (2621 ) show
0 384 moveto (2622 ) show
0 372 moveto (2623 ) show
0 360 moveto (2624 ) show
0 348 moveto (2625 ) show
0 336 moveto (2626 ) show
0 324 moveto (2627 ) show
0 312 moveto (2628 ) show
0 300 moveto (2629 ) show
0 288 moveto (2630 ) show
0 276 moveto (2631 ) show
0 264 moveto (2632 ) show
0 252 moveto (2633 ) show
0 240 moveto (2634 ) show
0 228 moveto (2635 ) show
0 216 moveto (2636 ) show
0 204 moveto (2637 ) show
0 192 moveto (2638 ) show
0 180 moveto (2639 ) show
0 168 moveto (2640 ) show
0 156 moveto (2641 ) show
0 144 moveto (2642 ) show
0 132 moveto (2643 ) show
0 120 moveto (2644 ) show
0 108 moveto (2645 ) show
0 96 moveto (2646 ) show
0 84 moveto (2647 ) show
0 72 moveto (2648 ) show
0 60 moveto (2649 ) show
0 24 moveto (Sheet 26) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/swtch.S  Page 1) show
0 648 moveto (2650 #   void swtch\(struct context *old, struct context *new\);) show
0 636 moveto (2651 #) show
0 624 moveto (2652 # Save current register context in old) show
0 612 moveto (2653 # and then load register context from new.) show
0 600 moveto (2654 ) show
0 588 moveto (2655 .globl swtch) show
0 576 moveto (2656 swtch:) show
0 564 moveto (2657   # Save old registers) show
0 552 moveto (2658   movl 4\(%esp\), %eax) show
0 540 moveto (2659 ) show
0 528 moveto (2660   popl 0\(%eax\)  # %eip) show
0 516 moveto (2661   movl %esp, 4\(%eax\)) show
0 504 moveto (2662   movl %ebx, 8\(%eax\)) show
0 492 moveto (2663   movl %ecx, 12\(%eax\)) show
0 480 moveto (2664   movl %edx, 16\(%eax\)) show
0 468 moveto (2665   movl %esi, 20\(%eax\)) show
0 456 moveto (2666   movl %edi, 24\(%eax\)) show
0 444 moveto (2667   movl %ebp, 28\(%eax\)) show
0 432 moveto (2668 ) show
0 420 moveto (2669   # Load new registers) show
0 408 moveto (2670   movl 4\(%esp\), %eax  # not 8\(%esp\) - popped return address above) show
0 396 moveto (2671 ) show
0 384 moveto (2672   movl 28\(%eax\), %ebp) show
0 372 moveto (2673   movl 24\(%eax\), %edi) show
0 360 moveto (2674   movl 20\(%eax\), %esi) show
0 348 moveto (2675   movl 16\(%eax\), %edx) show
0 336 moveto (2676   movl 12\(%eax\), %ecx) show
0 324 moveto (2677   movl 8\(%eax\), %ebx) show
0 312 moveto (2678   movl 4\(%eax\), %esp) show
0 300 moveto (2679   pushl 0\(%eax\)  # %eip) show
0 288 moveto (2680 ) show
0 276 moveto (2681   ret) show
0 264 moveto (2682 ) show
0 252 moveto (2683 ) show
0 240 moveto (2684 ) show
0 228 moveto (2685 ) show
0 216 moveto (2686 ) show
0 204 moveto (2687 ) show
0 192 moveto (2688 ) show
0 180 moveto (2689 ) show
0 168 moveto (2690 ) show
0 156 moveto (2691 ) show
0 144 moveto (2692 ) show
0 132 moveto (2693 ) show
0 120 moveto (2694 ) show
0 108 moveto (2695 ) show
0 96 moveto (2696 ) show
0 84 moveto (2697 ) show
0 72 moveto (2698 ) show
0 60 moveto (2699 ) show
0 24 moveto (Sheet 26) show
grestore
restore
showpage
%%Page: 36 36
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kalloc.c  Page 1) show
0 648 moveto (2700 // Physical memory allocator, intended to allocate) show
0 636 moveto (2701 // memory for user processes. Allocates in 4096-byte "pages".) show
0 624 moveto (2702 // Free list is kept sorted and combines adjacent pages into) show
0 612 moveto (2703 // long runs, to make it easier to allocate big segments.) show
0 600 moveto (2704 // One reason the page size is 4k is that the x86 segment size) show
0 588 moveto (2705 // granularity is 4k.) show
0 576 moveto (2706 ) show
0 564 moveto (2707 #include "types.h") show
0 552 moveto (2708 #include "defs.h") show
0 540 moveto (2709 #include "param.h") show
0 528 moveto (2710 #include "spinlock.h") show
0 516 moveto (2711 ) show
0 504 moveto (2712 //#define MEM_DEBUG 1) show
0 492 moveto (2713 struct spinlock kalloc_lock;) show
0 480 moveto (2714 ) show
0 468 moveto (2715 struct run {) show
0 456 moveto (2716   struct run *next;) show
0 444 moveto (2717   int len; // bytes) show
0 432 moveto (2718 };) show
0 420 moveto (2719 struct run *freelist;) show
0 408 moveto (2720 ) show
0 396 moveto (2721 // Initialize free list of physical pages.) show
0 384 moveto (2722 // This code cheats by just considering one megabyte of) show
0 372 moveto (2723 // pages after _end.  Real systems would determine the) show
0 360 moveto (2724 // amount of memory available in the system and use it all.) show
0 348 moveto (2725 void) show
0 336 moveto (2726 kinit\(void\)) show
0 324 moveto (2727 {) show
0 312 moveto (2728   extern int end;) show
0 300 moveto (2729   uint mem;) show
0 288 moveto (2730   char *start;) show
0 276 moveto (2731 ) show
0 264 moveto (2732   initlock\(&kalloc_lock, "kalloc"\);) show
0 252 moveto (2733   start = \(char*\) &end;) show
0 240 moveto (2734   start = \(char*\) \(\(\(uint\)start + PAGE\) & ~\(PAGE-1\)\);) show
0 228 moveto (2735   mem = 256; // assume computer has 256 pages of RAM) show
0 216 moveto (2736   cprintf\("mem = %d\\n", mem * PAGE\);) show
0 204 moveto (2737   kfree\(start, mem * PAGE\);) show
0 192 moveto (2738 }) show
0 180 moveto (2739 ) show
0 168 moveto (2740 ) show
0 156 moveto (2741 ) show
0 144 moveto (2742 ) show
0 132 moveto (2743 ) show
0 120 moveto (2744 ) show
0 108 moveto (2745 ) show
0 96 moveto (2746 ) show
0 84 moveto (2747 ) show
0 72 moveto (2748 ) show
0 60 moveto (2749 ) show
0 24 moveto (Sheet 27) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kalloc.c  Page 2) show
0 648 moveto (2750 // Free the len bytes of memory pointed at by v,) show
0 636 moveto (2751 // which normally should have been returned by a) show
0 624 moveto (2752 // call to kalloc\(len\).  \(The exception is when) show
0 612 moveto (2753 // initializing the allocator; see kinit above.\)) show
0 600 moveto (2754 void) show
0 588 moveto (2755 kfree\(char *v, int len\)) show
0 576 moveto (2756 {) show
0 564 moveto (2757   struct run *r, *rend, **rp, *p, *pend;) show
0 552 moveto (2758 ) show
0 540 moveto (2759 #ifdef MEM_DEBUG) show
0 528 moveto (2760   cprintf\("kfree: %d pages\\n", len / PAGE\);) show
0 516 moveto (2761 #endif) show
0 504 moveto (2762   if\(len <= 0 || len % PAGE\)) show
0 492 moveto (2763   {) show
0 480 moveto (2764     cprintf\("kfree: length = %d\\n", len\);) show
0 468 moveto (2765     panic\("kfree"\);) show
0 456 moveto (2766   }) show
0 444 moveto (2767 ) show
0 432 moveto (2768   // Fill with junk to catch dangling refs.) show
0 420 moveto (2769   memset\(v, 1, len\);) show
0 408 moveto (2770 ) show
0 396 moveto (2771   acquire\(&kalloc_lock\);) show
0 384 moveto (2772   p = \(struct run*\)v;) show
0 372 moveto (2773   pend = \(struct run*\)\(v + len\);) show
0 360 moveto (2774   for\(rp=&freelist; \(r=*rp\) != 0 && r <= pend; rp=&r->next\){) show
0 348 moveto (2775     rend = \(struct run*\)\(\(char*\)r + r->len\);) show
0 336 moveto (2776     if\(r <= p && p < rend\)) show
0 324 moveto (2777       panic\("freeing free page"\);) show
0 312 moveto (2778     if\(pend == r\){  // p next to r: replace r with p) show
0 300 moveto (2779       p->len = len + r->len;) show
0 288 moveto (2780       p->next = r->next;) show
0 276 moveto (2781       *rp = p;) show
0 264 moveto (2782       goto out;) show
0 252 moveto (2783     }) show
0 240 moveto (2784     if\(rend == p\){  // r next to p: replace p with r) show
0 228 moveto (2785       r->len += len;) show
0 216 moveto (2786       if\(r->next && r->next == pend\){  // r now next to r->next?) show
0 204 moveto (2787         r->len += r->next->len;) show
0 192 moveto (2788         r->next = r->next->next;) show
0 180 moveto (2789       }) show
0 168 moveto (2790       goto out;) show
0 156 moveto (2791     }) show
0 144 moveto (2792   }) show
0 132 moveto (2793   // Insert p before r in list.) show
0 120 moveto (2794   p->len = len;) show
0 108 moveto (2795   p->next = r;) show
0 96 moveto (2796   *rp = p;) show
0 84 moveto (2797 ) show
0 72 moveto (2798 ) show
0 60 moveto (2799 ) show
0 24 moveto (Sheet 27) show
grestore
restore
showpage
%%Page: 37 37
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kalloc.c  Page 3) show
0 648 moveto (2800  out:) show
0 636 moveto (2801   release\(&kalloc_lock\);) show
0 624 moveto (2802 }) show
0 612 moveto (2803 ) show
0 600 moveto (2804 // Allocate n bytes of physical memory.) show
0 588 moveto (2805 // Returns a kernel-segment pointer.) show
0 576 moveto (2806 // Returns 0 if the memory cannot be allocated.) show
0 564 moveto (2807 char*) show
0 552 moveto (2808 kalloc\(int n\)) show
0 540 moveto (2809 {) show
0 528 moveto (2810   char *p;) show
0 516 moveto (2811   struct run *r, **rp;) show
0 504 moveto (2812 ) show
0 492 moveto (2813 #ifdef MEM_DEBUG) show
0 480 moveto (2814   cprintf\("kalloc: %d pages\\n", n / PAGE\);) show
0 468 moveto (2815   printstack\(\);) show
0 456 moveto (2816 #endif) show
0 444 moveto (2817   if\(n % PAGE || n <= 0\)) show
0 432 moveto (2818     panic\("kalloc"\);) show
0 420 moveto (2819 ) show
0 408 moveto (2820   acquire\(&kalloc_lock\);) show
0 396 moveto (2821   for\(rp=&freelist; \(r=*rp\) != 0; rp=&r->next\){) show
0 384 moveto (2822     if\(r->len == n\){) show
0 372 moveto (2823       *rp = r->next;) show
0 360 moveto (2824       release\(&kalloc_lock\);) show
0 348 moveto (2825       return \(char*\)r;) show
0 336 moveto (2826     }) show
0 324 moveto (2827     if\(r->len > n\){) show
0 312 moveto (2828       r->len -= n;) show
0 300 moveto (2829       p = \(char*\)r + r->len;) show
0 288 moveto (2830       release\(&kalloc_lock\);) show
0 276 moveto (2831       return p;) show
0 264 moveto (2832     }) show
0 252 moveto (2833   }) show
0 240 moveto (2834   release\(&kalloc_lock\);) show
0 228 moveto (2835 ) show
0 216 moveto (2836   cprintf\("kalloc: out of memory\\n"\);) show
0 204 moveto (2837   return 0;) show
0 192 moveto (2838 }) show
0 180 moveto (2839 ) show
0 168 moveto (2840 void *) show
0 156 moveto (2841 kmalloc\(int n\)) show
0 144 moveto (2842 {) show
0 132 moveto (2843 #ifdef MEM_DEBUG) show
0 120 moveto (2844     cprintf\("kmalloc: %d bytes\\n", n\);) show
0 108 moveto (2845 #endif) show
0 96 moveto (2846     return kalloc\(\(\(n - 1\) / PAGE + 1\) * PAGE\);) show
0 84 moveto (2847 }) show
0 72 moveto (2848 ) show
0 60 moveto (2849 ) show
0 24 moveto (Sheet 28) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kalloc.c  Page 4) show
0 648 moveto (2850 void) show
0 636 moveto (2851 kmfree\(void *p, int n\)) show
0 624 moveto (2852 {) show
0 612 moveto (2853 #ifdef MEM_DEBUG) show
0 600 moveto (2854     cprintf\("kmfree: %d bytes\\n", n\);) show
0 588 moveto (2855 #endif) show
0 576 moveto (2856     return kfree\(p, \(\(n - 1\) / PAGE + 1\) * PAGE\);) show
0 564 moveto (2857 }) show
0 552 moveto (2858 ) show
0 540 moveto (2859 ) show
0 528 moveto (2860 ) show
0 516 moveto (2861 ) show
0 504 moveto (2862 ) show
0 492 moveto (2863 ) show
0 480 moveto (2864 ) show
0 468 moveto (2865 ) show
0 456 moveto (2866 ) show
0 444 moveto (2867 ) show
0 432 moveto (2868 ) show
0 420 moveto (2869 ) show
0 408 moveto (2870 ) show
0 396 moveto (2871 ) show
0 384 moveto (2872 ) show
0 372 moveto (2873 ) show
0 360 moveto (2874 ) show
0 348 moveto (2875 ) show
0 336 moveto (2876 ) show
0 324 moveto (2877 ) show
0 312 moveto (2878 ) show
0 300 moveto (2879 ) show
0 288 moveto (2880 ) show
0 276 moveto (2881 ) show
0 264 moveto (2882 ) show
0 252 moveto (2883 ) show
0 240 moveto (2884 ) show
0 228 moveto (2885 ) show
0 216 moveto (2886 ) show
0 204 moveto (2887 ) show
0 192 moveto (2888 ) show
0 180 moveto (2889 ) show
0 168 moveto (2890 ) show
0 156 moveto (2891 ) show
0 144 moveto (2892 ) show
0 132 moveto (2893 ) show
0 120 moveto (2894 ) show
0 108 moveto (2895 ) show
0 96 moveto (2896 ) show
0 84 moveto (2897 ) show
0 72 moveto (2898 ) show
0 60 moveto (2899 ) show
0 24 moveto (Sheet 28) show
grestore
restore
showpage
%%Page: 38 38
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/thread.h  Page 1) show
0 648 moveto (2900 #ifndef XV6_THREAD_H_) show
0 636 moveto (2901 #define XV6_THREAD_H_) show
0 624 moveto (2902 typedef struct thread * kproc_t;) show
0 612 moveto (2903 ) show
0 600 moveto (2904 #ifndef SYS_TIMEOUTS_DEFINED) show
0 588 moveto (2905 #define SYS_TIMEOUTS_DEFINED) show
0 576 moveto (2906 ) show
0 564 moveto (2907 struct sys_timeouts {) show
0 552 moveto (2908     struct sys_timeout *next;) show
0 540 moveto (2909 };) show
0 528 moveto (2910 #endif // SYS_TIMEOUTS_DEFINED) show
0 516 moveto (2911 ) show
0 504 moveto (2912 struct thread {) show
0 492 moveto (2913     struct proc *p;) show
0 480 moveto (2914     void *data;) show
0 468 moveto (2915     struct sys_timeouts timeouts;) show
0 456 moveto (2916 };) show
0 444 moveto (2917 ) show
0 432 moveto (2918 kproc_t kproc_start\(void \(* proc\)\(void *arg\),) show
0 420 moveto (2919         void *arg, int prio, void *data, char *name\);) show
0 408 moveto (2920 void kproc_free\(kproc_t thread\);) show
0 396 moveto (2921 ) show
0 384 moveto (2922 #endif // XV6_THREAD_H_) show
0 372 moveto (2923 ) show
0 360 moveto (2924 ) show
0 348 moveto (2925 ) show
0 336 moveto (2926 ) show
0 324 moveto (2927 ) show
0 312 moveto (2928 ) show
0 300 moveto (2929 ) show
0 288 moveto (2930 ) show
0 276 moveto (2931 ) show
0 264 moveto (2932 ) show
0 252 moveto (2933 ) show
0 240 moveto (2934 ) show
0 228 moveto (2935 ) show
0 216 moveto (2936 ) show
0 204 moveto (2937 ) show
0 192 moveto (2938 ) show
0 180 moveto (2939 ) show
0 168 moveto (2940 ) show
0 156 moveto (2941 ) show
0 144 moveto (2942 ) show
0 132 moveto (2943 ) show
0 120 moveto (2944 ) show
0 108 moveto (2945 ) show
0 96 moveto (2946 ) show
0 84 moveto (2947 ) show
0 72 moveto (2948 ) show
0 60 moveto (2949 ) show
0 24 moveto (Sheet 29) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/thread.c  Page 1) show
0 648 moveto (2950 #include "types.h") show
0 636 moveto (2951 #include "defs.h") show
0 624 moveto (2952 #include "thread.h") show
0 612 moveto (2953 #include "param.h") show
0 600 moveto (2954 #include "mmu.h") show
0 588 moveto (2955 #include "proc.h") show
0 576 moveto (2956 ) show
0 564 moveto (2957 void thread_wrap\(void \(* thread\)\(void *arg\), void *arg\);) show
0 552 moveto (2958 ) show
0 540 moveto (2959 extern struct proc *initproc;) show
0 528 moveto (2960 ) show
0 516 moveto (2961 kproc_t kproc_start\(void \(* proc\)\(void *arg\),) show
0 504 moveto (2962         void *arg, int prio, void *data, char *name\)) show
0 492 moveto (2963 {) show
0 480 moveto (2964     kproc_t thr = \(kproc_t\)kmalloc\(sizeof\(struct thread\)\);) show
0 468 moveto (2965     if \(!thr\)) show
0 456 moveto (2966         return NULL;) show
0 444 moveto (2967     thr->p = allocproc\(\);) show
0 432 moveto (2968     struct proc *np = thr->p;) show
0 420 moveto (2969     if \(!np\)) show
0 408 moveto (2970         return NULL;) show
0 396 moveto (2971     if\(\(np->kstack = kmalloc\(KSTACKSIZE\)\) == 0\){) show
0 384 moveto (2972       np->state = UNUSED;) show
0 372 moveto (2973       return NULL;) show
0 360 moveto (2974     }) show
0 348 moveto (2975     np->thr = thr;) show
0 336 moveto (2976     np->parent = initproc;) show
0 324 moveto (2977     np->sz = 0;) show
0 312 moveto (2978     np->chan = 0;) show
0 300 moveto (2979     np->killed = 0;) show
0 288 moveto (2980     thr->data = data;) show
0 276 moveto (2981     memset\(&np->context, 0, sizeof\(np->context\)\);) show
0 264 moveto (2982     thr->timeouts.next = 0;) show
0 252 moveto (2983     if \(name == 0\)) show
0 240 moveto (2984         safestrcpy\(np->name,"[kernel thread]",sizeof\(np->name\)\);) show
0 228 moveto (2985     else) show
0 216 moveto (2986         safestrcpy\(np->name, name, sizeof\(np->name\)\);) show
0 204 moveto (2987     np->context.eip = \(uint\)thread_wrap;) show
0 192 moveto (2988     np->context.esp = \(uint\)np->kstack + KSTACKSIZE - 1;) show
0 180 moveto (2989     *\(void**\)\(np->context.esp+8\) = arg;) show
0 168 moveto (2990     *\(void**\)\(np->context.esp+4\) = proc;) show
0 156 moveto (2991     *\(void**\)\(np->context.esp\) = exit;) show
0 144 moveto (2992     np->cwd = namei\("/"\);) show
0 132 moveto (2993     np->state = RUNNABLE;) show
0 120 moveto (2994     return thr;) show
0 108 moveto (2995 }) show
0 96 moveto (2996 ) show
0 84 moveto (2997 ) show
0 72 moveto (2998 ) show
0 60 moveto (2999 ) show
0 24 moveto (Sheet 29) show
grestore
restore
showpage
%%Page: 39 39
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/thread.c  Page 2) show
0 648 moveto (3000 void kproc_free\(kproc_t thread\)) show
0 636 moveto (3001 {) show
0 624 moveto (3002     struct proc *p = thread->p;) show
0 612 moveto (3003     p->thr = 0;) show
0 600 moveto (3004     kmfree\(thread, sizeof\(struct thread\)\);) show
0 588 moveto (3005 }) show
0 576 moveto (3006 ) show
0 564 moveto (3007 void thread_wrap\(void \(* thread\)\(void *arg\), void *arg\)) show
0 552 moveto (3008 {) show
0 540 moveto (3009     release\(&proc_table_lock\);) show
0 528 moveto (3010     thread\(arg\);) show
0 516 moveto (3011 }) show
0 504 moveto (3012 ) show
0 492 moveto (3013 ) show
0 480 moveto (3014 ) show
0 468 moveto (3015 ) show
0 456 moveto (3016 ) show
0 444 moveto (3017 ) show
0 432 moveto (3018 ) show
0 420 moveto (3019 ) show
0 408 moveto (3020 ) show
0 396 moveto (3021 ) show
0 384 moveto (3022 ) show
0 372 moveto (3023 ) show
0 360 moveto (3024 ) show
0 348 moveto (3025 ) show
0 336 moveto (3026 ) show
0 324 moveto (3027 ) show
0 312 moveto (3028 ) show
0 300 moveto (3029 ) show
0 288 moveto (3030 ) show
0 276 moveto (3031 ) show
0 264 moveto (3032 ) show
0 252 moveto (3033 ) show
0 240 moveto (3034 ) show
0 228 moveto (3035 ) show
0 216 moveto (3036 ) show
0 204 moveto (3037 ) show
0 192 moveto (3038 ) show
0 180 moveto (3039 ) show
0 168 moveto (3040 ) show
0 156 moveto (3041 ) show
0 144 moveto (3042 ) show
0 132 moveto (3043 ) show
0 120 moveto (3044 ) show
0 108 moveto (3045 ) show
0 96 moveto (3046 ) show
0 84 moveto (3047 ) show
0 72 moveto (3048 ) show
0 60 moveto (3049 ) show
0 24 moveto (Sheet 30) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/traps.h  Page 1) show
0 648 moveto (3050 // x86 trap and interrupt constants.) show
0 636 moveto (3051 ) show
0 624 moveto (3052 // Processor-defined:) show
0 612 moveto (3053 #define T_DIVIDE         0      // divide error) show
0 600 moveto (3054 #define T_DEBUG          1      // debug exception) show
0 588 moveto (3055 #define T_NMI            2      // non-maskable interrupt) show
0 576 moveto (3056 #define T_BRKPT          3      // breakpoint) show
0 564 moveto (3057 #define T_OFLOW          4      // overflow) show
0 552 moveto (3058 #define T_BOUND          5      // bounds check) show
0 540 moveto (3059 #define T_ILLOP          6      // illegal opcode) show
0 528 moveto (3060 #define T_DEVICE         7      // device not available) show
0 516 moveto (3061 #define T_DBLFLT         8      // double fault) show
0 504 moveto (3062 // #define T_COPROC      9      // reserved \(not used since 486\)) show
0 492 moveto (3063 #define T_TSS           10      // invalid task switch segment) show
0 480 moveto (3064 #define T_SEGNP         11      // segment not present) show
0 468 moveto (3065 #define T_STACK         12      // stack exception) show
0 456 moveto (3066 #define T_GPFLT         13      // general protection fault) show
0 444 moveto (3067 #define T_PGFLT         14      // page fault) show
0 432 moveto (3068 // #define T_RES        15      // reserved) show
0 420 moveto (3069 #define T_FPERR         16      // floating point error) show
0 408 moveto (3070 #define T_ALIGN         17      // aligment check) show
0 396 moveto (3071 #define T_MCHK          18      // machine check) show
0 384 moveto (3072 #define T_SIMDERR       19      // SIMD floating point error) show
0 372 moveto (3073 ) show
0 360 moveto (3074 // These are arbitrarily chosen, but with care not to overlap) show
0 348 moveto (3075 // processor defined exceptions or interrupt vectors.) show
0 336 moveto (3076 #define T_SYSCALL       48      // system call) show
0 324 moveto (3077 #define T_DEFAULT      500      // catchall) show
0 312 moveto (3078 ) show
0 300 moveto (3079 #define IRQ_OFFSET      32      // IRQ 0 corresponds to int IRQ_OFFSET) show
0 288 moveto (3080 ) show
0 276 moveto (3081 #define IRQ_TIMER        0) show
0 264 moveto (3082 #define IRQ_KBD          1) show
0 252 moveto (3083 #define IRQ_IDE         14) show
0 240 moveto (3084 #define IRQ_IDE_2       15) show
0 228 moveto (3085 #define IRQ_ERROR       19) show
0 216 moveto (3086 #define IRQ_SPURIOUS    31) show
0 204 moveto (3087 ) show
0 192 moveto (3088 ) show
0 180 moveto (3089 ) show
0 168 moveto (3090 ) show
0 156 moveto (3091 ) show
0 144 moveto (3092 ) show
0 132 moveto (3093 ) show
0 120 moveto (3094 ) show
0 108 moveto (3095 ) show
0 96 moveto (3096 ) show
0 84 moveto (3097 ) show
0 72 moveto (3098 ) show
0 60 moveto (3099 ) show
0 24 moveto (Sheet 30) show
grestore
restore
showpage
%%Page: 40 40
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/vectors.pl  Page 1) show
0 648 moveto (3100 #!/usr/bin/perl -w) show
0 636 moveto (3101 ) show
0 624 moveto (3102 # Generate vectors.S, the trap/interrupt entry points.) show
0 612 moveto (3103 # There has to be one entry point per interrupt number) show
0 600 moveto (3104 # since otherwise there's no way for trap\(\) to discover) show
0 588 moveto (3105 # the interrupt number.) show
0 576 moveto (3106 ) show
0 564 moveto (3107 print "# generated by vectors.pl - do not edit\\n";) show
0 552 moveto (3108 print "# handlers\\n";) show
0 540 moveto (3109 print ".text\\n";) show
0 528 moveto (3110 print ".globl alltraps\\n";) show
0 516 moveto (3111 for\(my $i = 0; $i < 256; $i++\){) show
0 504 moveto (3112     print ".globl vector$i\\n";) show
0 492 moveto (3113     print "vector$i:\\n";) show
0 480 moveto (3114     if\(\($i < 8 || $i > 14\) && $i != 17\){) show
0 468 moveto (3115         print "  pushl \\$0\\n";) show
0 456 moveto (3116     }) show
0 444 moveto (3117     print "  pushl \\$$i\\n";) show
0 432 moveto (3118     print "  jmp alltraps\\n";) show
0 420 moveto (3119 }) show
0 408 moveto (3120 ) show
0 396 moveto (3121 print "\\n# vector table\\n";) show
0 384 moveto (3122 print ".data\\n";) show
0 372 moveto (3123 print ".globl vectors\\n";) show
0 360 moveto (3124 print "vectors:\\n";) show
0 348 moveto (3125 for\(my $i = 0; $i < 256; $i++\){) show
0 336 moveto (3126     print "  .long vector$i\\n";) show
0 324 moveto (3127 }) show
0 312 moveto (3128 ) show
0 300 moveto (3129 # sample output:) show
0 288 moveto (3130 #   # handlers) show
0 276 moveto (3131 #   .text) show
0 264 moveto (3132 #   .globl alltraps) show
0 252 moveto (3133 #   .globl vector0) show
0 240 moveto (3134 #   vector0:) show
0 228 moveto (3135 #     pushl $0) show
0 216 moveto (3136 #     pushl $0) show
0 204 moveto (3137 #     jmp alltraps) show
0 192 moveto (3138 #   ...) show
0 180 moveto (3139 #) show
0 168 moveto (3140 #   # vector table) show
0 156 moveto (3141 #   .data) show
0 144 moveto (3142 #   .globl vectors) show
0 132 moveto (3143 #   vectors:) show
0 120 moveto (3144 #     .long vector0) show
0 108 moveto (3145 #     .long vector1) show
0 96 moveto (3146 #     .long vector2) show
0 84 moveto (3147 #   ...) show
0 72 moveto (3148 ) show
0 60 moveto (3149 ) show
0 24 moveto (Sheet 31) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/trapasm.S  Page 1) show
0 648 moveto (3150 .text) show
0 636 moveto (3151 ) show
0 624 moveto (3152 .set SEG_KDATA_SEL, 0x10   # selector for SEG_KDATA) show
0 612 moveto (3153 ) show
0 600 moveto (3154   # vectors.S sends all traps here.) show
0 588 moveto (3155 .globl alltraps) show
0 576 moveto (3156 alltraps:) show
0 564 moveto (3157   # Build trap frame.) show
0 552 moveto (3158   pushl %ds) show
0 540 moveto (3159   pushl %es) show
0 528 moveto (3160   pushal) show
0 516 moveto (3161 ) show
0 504 moveto (3162   # Set up data segments.) show
0 492 moveto (3163   movl $SEG_KDATA_SEL, %eax) show
0 480 moveto (3164   movw %ax,%ds) show
0 468 moveto (3165   movw %ax,%es) show
0 456 moveto (3166 ) show
0 444 moveto (3167   # Call trap\(tf\), where tf=%esp) show
0 432 moveto (3168   pushl %esp) show
0 420 moveto (3169   call trap) show
0 408 moveto (3170   addl $4, %esp) show
0 396 moveto (3171 ) show
0 384 moveto (3172   # Return falls through to trapret...) show
0 372 moveto (3173 .globl trapret) show
0 360 moveto (3174 trapret:) show
0 348 moveto (3175   popal) show
0 336 moveto (3176   popl %es) show
0 324 moveto (3177   popl %ds) show
0 312 moveto (3178   addl $0x8, %esp  # trapno and errcode) show
0 300 moveto (3179   iret) show
0 288 moveto (3180 ) show
0 276 moveto (3181   # A forked process switches to user mode by calling) show
0 264 moveto (3182   # forkret1\(tf\), where tf is the trap frame to use.) show
0 252 moveto (3183 .globl forkret1) show
0 240 moveto (3184 forkret1:) show
0 228 moveto (3185   movl 4\(%esp\), %esp) show
0 216 moveto (3186   jmp trapret) show
0 204 moveto (3187 ) show
0 192 moveto (3188 ) show
0 180 moveto (3189 ) show
0 168 moveto (3190 ) show
0 156 moveto (3191 ) show
0 144 moveto (3192 ) show
0 132 moveto (3193 ) show
0 120 moveto (3194 ) show
0 108 moveto (3195 ) show
0 96 moveto (3196 ) show
0 84 moveto (3197 ) show
0 72 moveto (3198 ) show
0 60 moveto (3199 ) show
0 24 moveto (Sheet 31) show
grestore
restore
showpage
%%Page: 41 41
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/trap.c  Page 1) show
0 648 moveto (3200 #include "types.h") show
0 636 moveto (3201 #include "defs.h") show
0 624 moveto (3202 #include "param.h") show
0 612 moveto (3203 #include "mmu.h") show
0 600 moveto (3204 #include "proc.h") show
0 588 moveto (3205 #include "x86.h") show
0 576 moveto (3206 #include "traps.h") show
0 564 moveto (3207 #include "spinlock.h") show
0 552 moveto (3208 #include "picirq.h") show
0 540 moveto (3209 ) show
0 528 moveto (3210 // Interrupt descriptor table \(shared by all CPUs\).) show
0 516 moveto (3211 struct gatedesc idt[256];) show
0 504 moveto (3212 extern uint vectors[];  // in vectors.S: array of 256 entry pointers) show
0 492 moveto (3213 struct spinlock tickslock;) show
0 480 moveto (3214 int ticks;) show
0 468 moveto (3215 ) show
0 456 moveto (3216 void) show
0 444 moveto (3217 tvinit\(void\)) show
0 432 moveto (3218 {) show
0 420 moveto (3219   int i;) show
0 408 moveto (3220 ) show
0 396 moveto (3221   for\(i = 0; i < 256; i++\)) show
0 384 moveto (3222     SETGATE\(idt[i], 0, SEG_KCODE<<3, vectors[i], 0\);) show
0 372 moveto (3223   SETGATE\(idt[T_SYSCALL], 0, SEG_KCODE<<3, vectors[T_SYSCALL], DPL_USER\);) show
0 360 moveto (3224 ) show
0 348 moveto (3225   initlock\(&tickslock, "time"\);) show
0 336 moveto (3226 }) show
0 324 moveto (3227 ) show
0 312 moveto (3228 void) show
0 300 moveto (3229 idtinit\(void\)) show
0 288 moveto (3230 {) show
0 276 moveto (3231   lidt\(idt, sizeof\(idt\)\);) show
0 264 moveto (3232 }) show
0 252 moveto (3233 ) show
0 240 moveto (3234 void) show
0 228 moveto (3235 trap\(struct trapframe *tf\)) show
0 216 moveto (3236 {) show
0 204 moveto (3237   if\(tf->trapno == T_SYSCALL\){) show
0 192 moveto (3238     if\(cp->killed\)) show
0 180 moveto (3239       exit\(\);) show
0 168 moveto (3240     cp->tf = tf;) show
0 156 moveto (3241     syscall\(\);) show
0 144 moveto (3242     if\(cp->killed\)) show
0 132 moveto (3243       exit\(\);) show
0 120 moveto (3244     return;) show
0 108 moveto (3245   }) show
0 96 moveto (3246 ) show
0 84 moveto (3247   // Increment nlock to make sure interrupts stay off) show
0 72 moveto (3248   // during interrupt handler.  Decrement before returning.) show
0 60 moveto (3249   cpus[cpu\(\)].nlock++;) show
0 24 moveto (Sheet 32) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/trap.c  Page 2) show
0 648 moveto (3250   switch\(tf->trapno\){) show
0 636 moveto (3251   case IRQ_OFFSET + IRQ_TIMER:) show
0 624 moveto (3252     if\(cpu\(\) == 0\){) show
0 612 moveto (3253       acquire\(&tickslock\);) show
0 600 moveto (3254       ticks++;) show
0 588 moveto (3255       wakeup\(&ticks\);) show
0 576 moveto (3256       release\(&tickslock\);) show
0 564 moveto (3257     }) show
0 552 moveto (3258     lapic_eoi\(\);) show
0 540 moveto (3259     break;) show
0 528 moveto (3260   case IRQ_OFFSET + IRQ_IDE:) show
0 516 moveto (3261     ide_intr\(\);) show
0 504 moveto (3262     lapic_eoi\(\);) show
0 492 moveto (3263     break;) show
0 480 moveto (3264   case IRQ_OFFSET + IRQ_KBD:) show
0 468 moveto (3265     kbd_intr\(\);) show
0 456 moveto (3266     lapic_eoi\(\);) show
0 444 moveto (3267     break;) show
0 432 moveto (3268   case IRQ_OFFSET + IRQ_SPURIOUS:) show
0 420 moveto (3269     cprintf\("spurious interrupt from cpu %d eip %x\\n", cpu\(\), tf->eip\);) show
0 408 moveto (3270     lapic_eoi\(\);) show
0 396 moveto (3271     break;) show
0 384 moveto (3272 ) show
0 372 moveto (3273   default:) show
0 360 moveto (3274 //    if \(tf->trapno <= 30\)) show
0 348 moveto (3275 //    {) show
0 336 moveto (3276     if \(\(tf->trapno >= IRQ_OFFSET\) && \(tf->trapno <= IRQ_MAX\)\)) show
0 324 moveto (3277         if \(irq_handler[tf->trapno - IRQ_OFFSET]\)) show
0 312 moveto (3278         {) show
0 300 moveto (3279 //            cprintf\("IRQ %d goes to handler\\n", tf->trapno\);) show
0 288 moveto (3280             irq_handler[tf->trapno - IRQ_OFFSET]\(tf\);) show
0 276 moveto (3281             lapic_eoi\(\);) show
0 264 moveto (3282             break;) show
0 252 moveto (3283         }) show
0 240 moveto (3284     if\(cp == 0\){) show
0 228 moveto (3285       // Otherwise it's our mistake.) show
0 216 moveto (3286       cprintf\("unexpected trap %d from cpu %d eip %x\\n",) show
0 204 moveto (3287               tf->trapno, cpu\(\), tf->eip\);) show
0 192 moveto (3288 //      panic\("trap"\);) show
0 180 moveto (3289     }) show
0 168 moveto (3290     else) show
0 156 moveto (3291     {) show
0 144 moveto (3292         // Assume process divided by zero or dereferenced null, etc.) show
0 132 moveto (3293         cprintf\("pid %d %s: trap %d err %d") show
0 120 moveto (3294                 "on cpu %d eip %x -- kill proc\\n",) show
0 108 moveto (3295             cp->pid, cp->name, tf->trapno, tf->err, cpu\(\), tf->eip\);) show
0 96 moveto (3296         cp->killed = 1;) show
0 84 moveto (3297     }) show
0 72 moveto (3298 //    }) show
0 60 moveto (3299   }) show
0 24 moveto (Sheet 32) show
grestore
restore
showpage
%%Page: 42 42
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/trap.c  Page 3) show
0 648 moveto (3300   cpus[cpu\(\)].nlock--;) show
0 636 moveto (3301 ) show
0 624 moveto (3302   // Force process exit if it has been killed and is in user space.) show
0 612 moveto (3303   // \(If it is still executing in the kernel, let it keep running) show
0 600 moveto (3304   // until it gets to the regular system call return.\)) show
0 588 moveto (3305   if\(cp && cp->killed && \(tf->cs&3\) == DPL_USER\)) show
0 576 moveto (3306     exit\(\);) show
0 564 moveto (3307 ) show
0 552 moveto (3308   // Force process to give up CPU on clock tick.) show
0 540 moveto (3309   // If interrupts were on while locks held, would need to check nlock.) show
0 528 moveto (3310   if\(cp && cp->state == RUNNING && tf->trapno == IRQ_OFFSET+IRQ_TIMER\)) show
0 516 moveto (3311     yield\(\);) show
0 504 moveto (3312 }) show
0 492 moveto (3313 ) show
0 480 moveto (3314 ) show
0 468 moveto (3315 ) show
0 456 moveto (3316 ) show
0 444 moveto (3317 ) show
0 432 moveto (3318 ) show
0 420 moveto (3319 ) show
0 408 moveto (3320 ) show
0 396 moveto (3321 ) show
0 384 moveto (3322 ) show
0 372 moveto (3323 ) show
0 360 moveto (3324 ) show
0 348 moveto (3325 ) show
0 336 moveto (3326 ) show
0 324 moveto (3327 ) show
0 312 moveto (3328 ) show
0 300 moveto (3329 ) show
0 288 moveto (3330 ) show
0 276 moveto (3331 ) show
0 264 moveto (3332 ) show
0 252 moveto (3333 ) show
0 240 moveto (3334 ) show
0 228 moveto (3335 ) show
0 216 moveto (3336 ) show
0 204 moveto (3337 ) show
0 192 moveto (3338 ) show
0 180 moveto (3339 ) show
0 168 moveto (3340 ) show
0 156 moveto (3341 ) show
0 144 moveto (3342 ) show
0 132 moveto (3343 ) show
0 120 moveto (3344 ) show
0 108 moveto (3345 ) show
0 96 moveto (3346 ) show
0 84 moveto (3347 ) show
0 72 moveto (3348 ) show
0 60 moveto (3349 ) show
0 24 moveto (Sheet 33) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/syscall.h  Page 1) show
0 648 moveto (3350 // System call numbers) show
0 636 moveto (3351 #define SYS_fork    1) show
0 624 moveto (3352 #define SYS_exit    2) show
0 612 moveto (3353 #define SYS_wait    3) show
0 600 moveto (3354 #define SYS_pipe    4) show
0 588 moveto (3355 #define SYS_write   5) show
0 576 moveto (3356 #define SYS_read    6) show
0 564 moveto (3357 #define SYS_close   7) show
0 552 moveto (3358 #define SYS_kill    8) show
0 540 moveto (3359 #define SYS_exec    9) show
0 528 moveto (3360 #define SYS_open   10) show
0 516 moveto (3361 #define SYS_mknod  11) show
0 504 moveto (3362 #define SYS_unlink 12) show
0 492 moveto (3363 #define SYS_fstat  13) show
0 480 moveto (3364 #define SYS_link   14) show
0 468 moveto (3365 #define SYS_mkdir  15) show
0 456 moveto (3366 #define SYS_chdir  16) show
0 444 moveto (3367 #define SYS_dup    17) show
0 432 moveto (3368 #define SYS_getpid 18) show
0 420 moveto (3369 #define SYS_sbrk   19) show
0 408 moveto (3370 #define SYS_sleep  20) show
0 396 moveto (3371 #define SYS_upmsec 21) show
0 384 moveto (3372 #define SYS_socket 22) show
0 372 moveto (3373 #define SYS_bind   23) show
0 360 moveto (3374 #define SYS_listen 24) show
0 348 moveto (3375 #define SYS_accept 25) show
0 336 moveto (3376 #define SYS_recv   26) show
0 324 moveto (3377 #define SYS_recvfrom 27) show
0 312 moveto (3378 #define SYS_send    28) show
0 300 moveto (3379 #define SYS_sendto  29) show
0 288 moveto (3380 #define SYS_shutdown 30) show
0 276 moveto (3381 #define SYS_getsockopt 31) show
0 264 moveto (3382 #define SYS_setsockopt 32) show
0 252 moveto (3383 #define SYS_sockclose 33) show
0 240 moveto (3384 #define SYS_connect 34) show
0 228 moveto (3385 #define SYS_getpeername 35) show
0 216 moveto (3386 #define SYS_getsockname 36) show
0 204 moveto (3387 ) show
0 192 moveto (3388 ) show
0 180 moveto (3389 ) show
0 168 moveto (3390 ) show
0 156 moveto (3391 ) show
0 144 moveto (3392 ) show
0 132 moveto (3393 ) show
0 120 moveto (3394 ) show
0 108 moveto (3395 ) show
0 96 moveto (3396 ) show
0 84 moveto (3397 ) show
0 72 moveto (3398 ) show
0 60 moveto (3399 ) show
0 24 moveto (Sheet 33) show
grestore
restore
showpage
%%Page: 43 43
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/syscall.c  Page 1) show
0 648 moveto (3400 #include "types.h") show
0 636 moveto (3401 #include "defs.h") show
0 624 moveto (3402 #include "param.h") show
0 612 moveto (3403 #include "mmu.h") show
0 600 moveto (3404 #include "proc.h") show
0 588 moveto (3405 #include "x86.h") show
0 576 moveto (3406 #include "syscall.h") show
0 564 moveto (3407 ) show
0 552 moveto (3408 // User code makes a system call with INT T_SYSCALL.) show
0 540 moveto (3409 // System call number in %eax.) show
0 528 moveto (3410 // Arguments on the stack, from the user call to the C) show
0 516 moveto (3411 // library system call function. The saved user %esp points) show
0 504 moveto (3412 // to a saved program counter, and then the first argument.) show
0 492 moveto (3413 ) show
0 480 moveto (3414 // Fetch the int at addr from process p.) show
0 468 moveto (3415 int) show
0 456 moveto (3416 fetchint\(struct proc *p, uint addr, int *ip\)) show
0 444 moveto (3417 {) show
0 432 moveto (3418   if\(addr >= p->sz || addr+4 > p->sz\)) show
0 420 moveto (3419     return -1;) show
0 408 moveto (3420   *ip = *\(int*\)\(p->mem + addr\);) show
0 396 moveto (3421   return 0;) show
0 384 moveto (3422 }) show
0 372 moveto (3423 ) show
0 360 moveto (3424 // Fetch the nul-terminated string at addr from process p.) show
0 348 moveto (3425 // Doesn't actually copy the string - just sets *pp to point at it.) show
0 336 moveto (3426 // Returns length of string, not including nul.) show
0 324 moveto (3427 int) show
0 312 moveto (3428 fetchstr\(struct proc *p, uint addr, char **pp\)) show
0 300 moveto (3429 {) show
0 288 moveto (3430   char *s, *ep;) show
0 276 moveto (3431 ) show
0 264 moveto (3432   if\(addr >= p->sz\)) show
0 252 moveto (3433     return -1;) show
0 240 moveto (3434   *pp = p->mem + addr;) show
0 228 moveto (3435   ep = p->mem + p->sz;) show
0 216 moveto (3436   for\(s = *pp; s < ep; s++\)) show
0 204 moveto (3437     if\(*s == 0\)) show
0 192 moveto (3438       return s - *pp;) show
0 180 moveto (3439   return -1;) show
0 168 moveto (3440 }) show
0 156 moveto (3441 ) show
0 144 moveto (3442 // Fetch the nth 32-bit system call argument.) show
0 132 moveto (3443 int) show
0 120 moveto (3444 argint\(int n, int *ip\)) show
0 108 moveto (3445 {) show
0 96 moveto (3446   return fetchint\(cp, cp->tf->esp + 4 + 4*n, ip\);) show
0 84 moveto (3447 }) show
0 72 moveto (3448 ) show
0 60 moveto (3449 ) show
0 24 moveto (Sheet 34) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/syscall.c  Page 2) show
0 648 moveto (3450 // Fetch the nth word-sized system call argument as a pointer) show
0 636 moveto (3451 // to a block of memory of size n bytes.  Check that the pointer) show
0 624 moveto (3452 // lies within the process address space.) show
0 612 moveto (3453 int) show
0 600 moveto (3454 argptr\(int n, char **pp, int size\)) show
0 588 moveto (3455 {) show
0 576 moveto (3456   int i;) show
0 564 moveto (3457 ) show
0 552 moveto (3458   if\(argint\(n, &i\) < 0\)) show
0 540 moveto (3459     return -1;) show
0 528 moveto (3460   if\(\(uint\)i >= cp->sz || \(uint\)i+size >= cp->sz\)) show
0 516 moveto (3461     return -1;) show
0 504 moveto (3462   *pp = cp->mem + i;) show
0 492 moveto (3463   return 0;) show
0 480 moveto (3464 }) show
0 468 moveto (3465 ) show
0 456 moveto (3466 // Fetch the nth word-sized system call argument as a string pointer.) show
0 444 moveto (3467 // Check that the pointer is valid and the string is nul-terminated.) show
0 432 moveto (3468 // \(There is no shared writable memory, so the string can't change) show
0 420 moveto (3469 // between this check and being used by the kernel.\)) show
0 408 moveto (3470 int) show
0 396 moveto (3471 argstr\(int n, char **pp\)) show
0 384 moveto (3472 {) show
0 372 moveto (3473   int addr;) show
0 360 moveto (3474   if\(argint\(n, &addr\) < 0\)) show
0 348 moveto (3475     return -1;) show
0 336 moveto (3476   return fetchstr\(cp, addr, pp\);) show
0 324 moveto (3477 }) show
0 312 moveto (3478 ) show
0 300 moveto (3479 extern int sys_chdir\(void\);) show
0 288 moveto (3480 extern int sys_close\(void\);) show
0 276 moveto (3481 extern int sys_dup\(void\);) show
0 264 moveto (3482 extern int sys_exec\(void\);) show
0 252 moveto (3483 extern int sys_exit\(void\);) show
0 240 moveto (3484 extern int sys_fork\(void\);) show
0 228 moveto (3485 extern int sys_fstat\(void\);) show
0 216 moveto (3486 extern int sys_getpid\(void\);) show
0 204 moveto (3487 extern int sys_kill\(void\);) show
0 192 moveto (3488 extern int sys_link\(void\);) show
0 180 moveto (3489 extern int sys_mkdir\(void\);) show
0 168 moveto (3490 extern int sys_mknod\(void\);) show
0 156 moveto (3491 extern int sys_open\(void\);) show
0 144 moveto (3492 extern int sys_pipe\(void\);) show
0 132 moveto (3493 extern int sys_read\(void\);) show
0 120 moveto (3494 extern int sys_sbrk\(void\);) show
0 108 moveto (3495 extern int sys_sleep\(void\);) show
0 96 moveto (3496 extern int sys_unlink\(void\);) show
0 84 moveto (3497 extern int sys_wait\(void\);) show
0 72 moveto (3498 extern int sys_write\(void\);) show
0 60 moveto (3499 extern int sys_upmsec\(void\);) show
0 24 moveto (Sheet 34) show
grestore
restore
showpage
%%Page: 44 44
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/syscall.c  Page 3) show
0 648 moveto (3500 // BSD sockets) show
0 636 moveto (3501 extern int sys_accept\(void\);) show
0 624 moveto (3502 extern int sys_bind\(void\);) show
0 612 moveto (3503 extern int sys_shutdown\(void\);) show
0 600 moveto (3504 extern int sys_getsockopt\(void\);) show
0 588 moveto (3505 extern int sys_setsockopt\(void\);) show
0 576 moveto (3506 extern int sys_sockclose\(void\);) show
0 564 moveto (3507 extern int sys_connect\(void\);) show
0 552 moveto (3508 extern int sys_listen\(void\);) show
0 540 moveto (3509 extern int sys_recv\(void\);) show
0 528 moveto (3510 extern int sys_recvfrom\(void\);) show
0 516 moveto (3511 extern int sys_send\(void\);) show
0 504 moveto (3512 extern int sys_sendto\(void\);) show
0 492 moveto (3513 extern int sys_socket\(void\);) show
0 480 moveto (3514 extern int sys_getpeername \(void\);) show
0 468 moveto (3515 extern int sys_getsockname \(void\);) show
0 456 moveto (3516 //int lwip_read\(int s, void *mem, int len\);) show
0 444 moveto (3517 //int lwip_write\(int s, void *dataptr, int size\);) show
0 432 moveto (3518 //int lwip_select\(int maxfdp1, fd_set *readset, fd_set *writeset, fd_set *exceptset,) show
0 420 moveto (3519 //                struct timeval *timeout\);) show
0 408 moveto (3520 //extern int sys_sockioctl\(void\);) show
0 396 moveto (3521 ) show
0 384 moveto (3522 static int \(*syscalls[]\)\(void\) = {) show
0 372 moveto (3523 [SYS_chdir]   sys_chdir,) show
0 360 moveto (3524 [SYS_close]   sys_close,) show
0 348 moveto (3525 [SYS_dup]     sys_dup,) show
0 336 moveto (3526 [SYS_exec]    sys_exec,) show
0 324 moveto (3527 [SYS_exit]    sys_exit,) show
0 312 moveto (3528 [SYS_fork]    sys_fork,) show
0 300 moveto (3529 [SYS_fstat]   sys_fstat,) show
0 288 moveto (3530 [SYS_getpid]  sys_getpid,) show
0 276 moveto (3531 [SYS_kill]    sys_kill,) show
0 264 moveto (3532 [SYS_link]    sys_link,) show
0 252 moveto (3533 [SYS_mkdir]   sys_mkdir,) show
0 240 moveto (3534 [SYS_mknod]   sys_mknod,) show
0 228 moveto (3535 [SYS_open]    sys_open,) show
0 216 moveto (3536 [SYS_pipe]    sys_pipe,) show
0 204 moveto (3537 [SYS_read]    sys_read,) show
0 192 moveto (3538 [SYS_sbrk]    sys_sbrk,) show
0 180 moveto (3539 [SYS_sleep]   sys_sleep,) show
0 168 moveto (3540 [SYS_unlink]  sys_unlink,) show
0 156 moveto (3541 [SYS_wait]    sys_wait,) show
0 144 moveto (3542 [SYS_write]   sys_write,) show
0 132 moveto (3543 [SYS_upmsec]  sys_upmsec,) show
0 120 moveto (3544 // BSD socket) show
0 108 moveto (3545 [SYS_socket]  sys_socket,) show
0 96 moveto (3546 [SYS_bind]    sys_bind,) show
0 84 moveto (3547 [SYS_listen]  sys_listen,) show
0 72 moveto (3548 [SYS_accept]  sys_accept,) show
0 60 moveto (3549 [SYS_recv]    sys_recv,) show
0 24 moveto (Sheet 35) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/syscall.c  Page 4) show
0 648 moveto (3550 [SYS_recvfrom] sys_recvfrom,) show
0 636 moveto (3551 [SYS_send]    sys_send,) show
0 624 moveto (3552 [SYS_sendto]  sys_sendto,) show
0 612 moveto (3553 [SYS_shutdown] sys_shutdown,) show
0 600 moveto (3554 [SYS_getsockopt] sys_getsockopt,) show
0 588 moveto (3555 [SYS_setsockopt] sys_setsockopt,) show
0 576 moveto (3556 [SYS_sockclose] sys_sockclose,) show
0 564 moveto (3557 [SYS_connect] sys_connect,) show
0 552 moveto (3558 [SYS_getpeername] sys_getpeername,) show
0 540 moveto (3559 [SYS_getsockname] sys_getsockname,) show
0 528 moveto (3560 };) show
0 516 moveto (3561 ) show
0 504 moveto (3562 void) show
0 492 moveto (3563 syscall\(void\)) show
0 480 moveto (3564 {) show
0 468 moveto (3565   int num;) show
0 456 moveto (3566 ) show
0 444 moveto (3567   num = cp->tf->eax;) show
0 432 moveto (3568   if\(num >= 0 && num < NELEM\(syscalls\) && syscalls[num]\)) show
0 420 moveto (3569     cp->tf->eax = syscalls[num]\(\);) show
0 408 moveto (3570   else {) show
0 396 moveto (3571     cprintf\("%d %s: unknown sys call %d\\n",) show
0 384 moveto (3572             cp->pid, cp->name, num\);) show
0 372 moveto (3573     cp->tf->eax = -1;) show
0 360 moveto (3574   }) show
0 348 moveto (3575 }) show
0 336 moveto (3576 ) show
0 324 moveto (3577 ) show
0 312 moveto (3578 ) show
0 300 moveto (3579 ) show
0 288 moveto (3580 ) show
0 276 moveto (3581 ) show
0 264 moveto (3582 ) show
0 252 moveto (3583 ) show
0 240 moveto (3584 ) show
0 228 moveto (3585 ) show
0 216 moveto (3586 ) show
0 204 moveto (3587 ) show
0 192 moveto (3588 ) show
0 180 moveto (3589 ) show
0 168 moveto (3590 ) show
0 156 moveto (3591 ) show
0 144 moveto (3592 ) show
0 132 moveto (3593 ) show
0 120 moveto (3594 ) show
0 108 moveto (3595 ) show
0 96 moveto (3596 ) show
0 84 moveto (3597 ) show
0 72 moveto (3598 ) show
0 60 moveto (3599 ) show
0 24 moveto (Sheet 35) show
grestore
restore
showpage
%%Page: 45 45
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 1) show
0 648 moveto (3600 #include "types.h") show
0 636 moveto (3601 #include "defs.h") show
0 624 moveto (3602 #include "param.h") show
0 612 moveto (3603 #include "mmu.h") show
0 600 moveto (3604 #include "proc.h") show
0 588 moveto (3605 #include "lwip/include/lwip/sockets.h") show
0 576 moveto (3606 ) show
0 564 moveto (3607 int) show
0 552 moveto (3608 sys_fork\(void\)) show
0 540 moveto (3609 {) show
0 528 moveto (3610   struct proc *np;) show
0 516 moveto (3611 ) show
0 504 moveto (3612   if\(\(np = copyproc\(cp\)\) == 0\)) show
0 492 moveto (3613     return -1;) show
0 480 moveto (3614   np->state = RUNNABLE;) show
0 468 moveto (3615   return np->pid;) show
0 456 moveto (3616 }) show
0 444 moveto (3617 ) show
0 432 moveto (3618 int) show
0 420 moveto (3619 sys_exit\(void\)) show
0 408 moveto (3620 {) show
0 396 moveto (3621   exit\(\);) show
0 384 moveto (3622   return 0;  // not reached) show
0 372 moveto (3623 }) show
0 360 moveto (3624 ) show
0 348 moveto (3625 int) show
0 336 moveto (3626 sys_wait\(void\)) show
0 324 moveto (3627 {) show
0 312 moveto (3628   return wait\(\);) show
0 300 moveto (3629 }) show
0 288 moveto (3630 ) show
0 276 moveto (3631 int) show
0 264 moveto (3632 sys_kill\(void\)) show
0 252 moveto (3633 {) show
0 240 moveto (3634   int pid;) show
0 228 moveto (3635 ) show
0 216 moveto (3636   if\(argint\(0, &pid\) < 0\)) show
0 204 moveto (3637     return -1;) show
0 192 moveto (3638   return kill\(pid\);) show
0 180 moveto (3639 }) show
0 168 moveto (3640 ) show
0 156 moveto (3641 int) show
0 144 moveto (3642 sys_getpid\(void\)) show
0 132 moveto (3643 {) show
0 120 moveto (3644   return cp->pid;) show
0 108 moveto (3645 }) show
0 96 moveto (3646 ) show
0 84 moveto (3647 ) show
0 72 moveto (3648 ) show
0 60 moveto (3649 ) show
0 24 moveto (Sheet 36) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 2) show
0 648 moveto (3650 int) show
0 636 moveto (3651 sys_sbrk\(void\)) show
0 624 moveto (3652 {) show
0 612 moveto (3653   int addr;) show
0 600 moveto (3654   int n;) show
0 588 moveto (3655 ) show
0 576 moveto (3656   if\(argint\(0, &n\) < 0\)) show
0 564 moveto (3657     return -1;) show
0 552 moveto (3658   if\(\(addr = growproc\(n\)\) < 0\)) show
0 540 moveto (3659     return -1;) show
0 528 moveto (3660   setupsegs\(cp\);) show
0 516 moveto (3661   return addr;) show
0 504 moveto (3662 }) show
0 492 moveto (3663 ) show
0 480 moveto (3664 int) show
0 468 moveto (3665 sys_sleep\(void\)) show
0 456 moveto (3666 {) show
0 444 moveto (3667   int n, ticks0;) show
0 432 moveto (3668 ) show
0 420 moveto (3669   if\(argint\(0, &n\) < 0\)) show
0 408 moveto (3670     return -1;) show
0 396 moveto (3671   acquire\(&tickslock\);) show
0 384 moveto (3672   ticks0 = ticks;) show
0 372 moveto (3673   while\(ticks - ticks0 < n\){) show
0 360 moveto (3674     if\(cp->killed\){) show
0 348 moveto (3675       release\(&tickslock\);) show
0 336 moveto (3676       return -1;) show
0 324 moveto (3677     }) show
0 312 moveto (3678     sleep\(&ticks, &tickslock\);) show
0 300 moveto (3679   }) show
0 288 moveto (3680   release\(&tickslock\);) show
0 276 moveto (3681   return 0;) show
0 264 moveto (3682 }) show
0 252 moveto (3683 ) show
0 240 moveto (3684 int) show
0 228 moveto (3685 sys_upmsec\(void\)) show
0 216 moveto (3686 {) show
0 204 moveto (3687     return millitime\(\);) show
0 192 moveto (3688 }) show
0 180 moveto (3689 ) show
0 168 moveto (3690 ) show
0 156 moveto (3691 ) show
0 144 moveto (3692 ) show
0 132 moveto (3693 ) show
0 120 moveto (3694 ) show
0 108 moveto (3695 ) show
0 96 moveto (3696 ) show
0 84 moveto (3697 ) show
0 72 moveto (3698 ) show
0 60 moveto (3699 ) show
0 24 moveto (Sheet 36) show
grestore
restore
showpage
%%Page: 46 46
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 3) show
0 648 moveto (3700 int) show
0 636 moveto (3701 sys_accept\(void\)) show
0 624 moveto (3702 {) show
0 612 moveto (3703     int s;) show
0 600 moveto (3704     struct sockaddr *addr;) show
0 588 moveto (3705     socklen_t *addrlen;) show
0 576 moveto (3706     if\(\(argint\(0, &s\)<0\) ||) show
0 564 moveto (3707             \(argptr\(1, &addr, sizeof\(struct sockaddr\)\)<0\) ||) show
0 552 moveto (3708             \(argptr\(2, &addrlen, sizeof\(socklen_t\)\)<0\)\)) show
0 540 moveto (3709         return -1;) show
0 528 moveto (3710     return lwip_accept\(s, addr, addrlen\);) show
0 516 moveto (3711 }) show
0 504 moveto (3712 ) show
0 492 moveto (3713 int) show
0 480 moveto (3714 sys_bind\(void\)) show
0 468 moveto (3715 {) show
0 456 moveto (3716     int s;) show
0 444 moveto (3717     struct sockaddr *name;) show
0 432 moveto (3718     socklen_t *namelen;) show
0 420 moveto (3719     if\(\(argint\(0, &s\)<0\) ||) show
0 408 moveto (3720             \(argptr\(1, &name, sizeof\(struct sockaddr\)\)<0\) ||) show
0 396 moveto (3721             \(argptr\(2, &namelen, sizeof\(socklen_t\)\)<0\)\)) show
0 384 moveto (3722         return -1;) show
0 372 moveto (3723     return lwip_bind\(s, name, namelen\);) show
0 360 moveto (3724 }) show
0 348 moveto (3725 ) show
0 336 moveto (3726 int) show
0 324 moveto (3727 sys_shutdown\(void\)) show
0 312 moveto (3728 {) show
0 300 moveto (3729     int s;) show
0 288 moveto (3730     int how;) show
0 276 moveto (3731     if \(\(argint\(0, &s\)<0\) || \(argint\(1, &how\) < 0\)\)) show
0 264 moveto (3732         return -1;) show
0 252 moveto (3733     return lwip_shutdown\(s, how\);) show
0 240 moveto (3734 }) show
0 228 moveto (3735 ) show
0 216 moveto (3736 ) show
0 204 moveto (3737 ) show
0 192 moveto (3738 ) show
0 180 moveto (3739 ) show
0 168 moveto (3740 ) show
0 156 moveto (3741 ) show
0 144 moveto (3742 ) show
0 132 moveto (3743 ) show
0 120 moveto (3744 ) show
0 108 moveto (3745 ) show
0 96 moveto (3746 ) show
0 84 moveto (3747 ) show
0 72 moveto (3748 ) show
0 60 moveto (3749 ) show
0 24 moveto (Sheet 37) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 4) show
0 648 moveto (3750 int) show
0 636 moveto (3751 sys_getsockopt\(void\)) show
0 624 moveto (3752 {) show
0 612 moveto (3753     int s;) show
0 600 moveto (3754     int level;) show
0 588 moveto (3755     int optname;) show
0 576 moveto (3756     void *optval;) show
0 564 moveto (3757     socklen_t *optlen;) show
0 552 moveto (3758     if \(\(argint\(0, &s\)<0\) ||) show
0 540 moveto (3759         \(argint\(1, &level\)<0\) ||) show
0 528 moveto (3760         \(argint\(2, &optname\)<0\) ||) show
0 516 moveto (3761         \(argptr\(4, &optlen, sizeof\(socklen_t\)\)<0\) ||) show
0 504 moveto (3762         \(argptr\(3, &optval, 0\)<0\)\)) show
0 492 moveto (3763         return -1;) show
0 480 moveto (3764     return lwip_getsockopt\(s, level, optname, optval, optlen\);) show
0 468 moveto (3765 }) show
0 456 moveto (3766 ) show
0 444 moveto (3767 int sys_setsockopt\(void\)) show
0 432 moveto (3768 {) show
0 420 moveto (3769     int s;) show
0 408 moveto (3770     int level;) show
0 396 moveto (3771     int optname;) show
0 384 moveto (3772     void *optval;) show
0 372 moveto (3773     socklen_t *optlen;) show
0 360 moveto (3774     if \(\(argint\(0, &s\)<0\) ||) show
0 348 moveto (3775         \(argint\(1, &level\)<0\) ||) show
0 336 moveto (3776         \(argint\(2, &optname\)<0\) ||) show
0 324 moveto (3777         \(argptr\(4, &optlen, sizeof\(socklen_t\)\)<0\) ||) show
0 312 moveto (3778         \(argptr\(3, &optval, *optlen\)<0\)\)) show
0 300 moveto (3779         return -1;) show
0 288 moveto (3780     return lwip_setsockopt\(s, level, optname, optval, optlen\);) show
0 276 moveto (3781 }) show
0 264 moveto (3782 ) show
0 252 moveto (3783 int sys_sockclose\(void\)) show
0 240 moveto (3784 {) show
0 228 moveto (3785     int s;) show
0 216 moveto (3786     if \(argint\(0, &s\) <0\)) show
0 204 moveto (3787         return -1;) show
0 192 moveto (3788     return lwip_close\(s\);) show
0 180 moveto (3789 }) show
0 168 moveto (3790 ) show
0 156 moveto (3791 ) show
0 144 moveto (3792 ) show
0 132 moveto (3793 ) show
0 120 moveto (3794 ) show
0 108 moveto (3795 ) show
0 96 moveto (3796 ) show
0 84 moveto (3797 ) show
0 72 moveto (3798 ) show
0 60 moveto (3799 ) show
0 24 moveto (Sheet 37) show
grestore
restore
showpage
%%Page: 47 47
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 5) show
0 648 moveto (3800 int sys_connect\(void\)) show
0 636 moveto (3801 {) show
0 624 moveto (3802     int s;) show
0 612 moveto (3803     struct sockaddr *name;) show
0 600 moveto (3804     socklen_t *namelen;) show
0 588 moveto (3805     if\(\(argint\(0, &s\)<0\) ||) show
0 576 moveto (3806             \(argptr\(1, &name, sizeof\(struct sockaddr\)\)<0\) ||) show
0 564 moveto (3807             \(argptr\(2, &namelen, sizeof\(socklen_t\)\)<0\)\)) show
0 552 moveto (3808         return -1;) show
0 540 moveto (3809     return lwip_connect\(s, name, namelen\);) show
0 528 moveto (3810 }) show
0 516 moveto (3811 ) show
0 504 moveto (3812 int sys_listen\(void\)) show
0 492 moveto (3813 {) show
0 480 moveto (3814     int s;) show
0 468 moveto (3815     int backlog;) show
0 456 moveto (3816     if \(\(argint\(0, &s\)<0\) ||) show
0 444 moveto (3817         \(argint\(1, &backlog\)<0\)\)) show
0 432 moveto (3818         return -1;) show
0 420 moveto (3819     return lwip_listen\(s, backlog\);) show
0 408 moveto (3820 }) show
0 396 moveto (3821 ) show
0 384 moveto (3822 int sys_recv\(void\)) show
0 372 moveto (3823 {) show
0 360 moveto (3824     int s;) show
0 348 moveto (3825     void *mem;) show
0 336 moveto (3826     int len;) show
0 324 moveto (3827     unsigned int flags;) show
0 312 moveto (3828     if \(\(argint\(0, &s\)<0\) ||) show
0 300 moveto (3829         \(argint\(2, &len\)<0\) ||) show
0 288 moveto (3830         \(argptr\(1, &mem, len\)<0\) ||) show
0 276 moveto (3831         \(argint\(3, &flags\)<0\)\)) show
0 264 moveto (3832         return -1;) show
0 252 moveto (3833     return lwip_recv\(s, mem, len, flags\);) show
0 240 moveto (3834 }) show
0 228 moveto (3835 ) show
0 216 moveto (3836 ) show
0 204 moveto (3837 ) show
0 192 moveto (3838 ) show
0 180 moveto (3839 ) show
0 168 moveto (3840 ) show
0 156 moveto (3841 ) show
0 144 moveto (3842 ) show
0 132 moveto (3843 ) show
0 120 moveto (3844 ) show
0 108 moveto (3845 ) show
0 96 moveto (3846 ) show
0 84 moveto (3847 ) show
0 72 moveto (3848 ) show
0 60 moveto (3849 ) show
0 24 moveto (Sheet 38) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 6) show
0 648 moveto (3850 int sys_recvfrom\(void\)) show
0 636 moveto (3851 {) show
0 624 moveto (3852     int s;) show
0 612 moveto (3853     void *mem;) show
0 600 moveto (3854     int len;) show
0 588 moveto (3855     unsigned int flags;) show
0 576 moveto (3856     struct sockaddr *from;) show
0 564 moveto (3857     socklen_t *fromlen;) show
0 552 moveto (3858     if \(\(argint\(0, &s\)<0\) ||) show
0 540 moveto (3859         \(argint\(2, &len\)<0\) ||) show
0 528 moveto (3860         \(argptr\(1, &mem, len\)<0\) ||) show
0 516 moveto (3861         \(argint\(3, &flags\)<0\) ||) show
0 504 moveto (3862         \(argptr\(4, &from, 0\)<0\) ||) show
0 492 moveto (3863         \(argptr\(5, &fromlen, sizeof\(socklen_t\)\)<0\)\)) show
0 480 moveto (3864         return -1;) show
0 468 moveto (3865     return lwip_recvfrom\(s, mem, len, flags, from, fromlen\);) show
0 456 moveto (3866 }) show
0 444 moveto (3867 ) show
0 432 moveto (3868 int sys_send\(void\)) show
0 420 moveto (3869 {) show
0 408 moveto (3870     int s;) show
0 396 moveto (3871     void *dataptr;) show
0 384 moveto (3872     int size;) show
0 372 moveto (3873     unsigned int flags;) show
0 360 moveto (3874     if \(\(argint\(0, &s\)<0\) ||) show
0 348 moveto (3875         \(argint\(2, &size\)<0\) ||) show
0 336 moveto (3876         \(argptr\(1, &dataptr, size\)<0\) ||) show
0 324 moveto (3877         \(argint\(3, &flags\)<0\)\)) show
0 312 moveto (3878         return -1;) show
0 300 moveto (3879     return lwip_send\(s, dataptr, size, flags\);) show
0 288 moveto (3880 }) show
0 276 moveto (3881 ) show
0 264 moveto (3882 int sys_sendto\(void\)) show
0 252 moveto (3883 {) show
0 240 moveto (3884     int s;) show
0 228 moveto (3885     void *dataptr;) show
0 216 moveto (3886     int size;) show
0 204 moveto (3887     unsigned int flags;) show
0 192 moveto (3888     struct sockaddr *to;) show
0 180 moveto (3889     socklen_t *tolen;) show
0 168 moveto (3890     if \(\(argint\(0, &s\)<0\) ||) show
0 156 moveto (3891         \(argint\(2, &size\)<0\) ||) show
0 144 moveto (3892         \(argptr\(1, &dataptr, size\)<0\) ||) show
0 132 moveto (3893         \(argint\(3, &flags\)<0\) ||) show
0 120 moveto (3894         \(argptr\(5, &tolen, sizeof\(socklen_t\)\)<0\) ||) show
0 108 moveto (3895         \(argptr\(4, &to, *tolen\)<0\)\)) show
0 96 moveto (3896         return -1;) show
0 84 moveto (3897     return lwip_send\(s, dataptr, size, flags\);) show
0 72 moveto (3898 }) show
0 60 moveto (3899 ) show
0 24 moveto (Sheet 38) show
grestore
restore
showpage
%%Page: 48 48
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysproc.c  Page 7) show
0 648 moveto (3900 int sys_socket\(void\)) show
0 636 moveto (3901 {) show
0 624 moveto (3902     int domain;) show
0 612 moveto (3903     int type;) show
0 600 moveto (3904     int protocol;) show
0 588 moveto (3905     if \(\(argint\(0, &domain\)<0\) ||) show
0 576 moveto (3906         \(argint\(1, &type\)<0\) ||) show
0 564 moveto (3907         \(argint\(2, &protocol\)<0\)\)) show
0 552 moveto (3908         return -1;) show
0 540 moveto (3909     return lwip_socket\(domain, type, protocol\);) show
0 528 moveto (3910 }) show
0 516 moveto (3911 ) show
0 504 moveto (3912 int) show
0 492 moveto (3913 sys_getpeername\(void\)) show
0 480 moveto (3914 {) show
0 468 moveto (3915     int s;) show
0 456 moveto (3916     struct sockaddr *name;) show
0 444 moveto (3917     socklen_t *namelen;) show
0 432 moveto (3918     if\(\(argint\(0, &s\)<0\) ||) show
0 420 moveto (3919             \(argptr\(1, &name, sizeof\(struct sockaddr\)\)<0\) ||) show
0 408 moveto (3920             \(argptr\(2, &namelen, sizeof\(socklen_t\)\)<0\)\)) show
0 396 moveto (3921         return -1;) show
0 384 moveto (3922     return lwip_getpeername\(s, name, namelen\);) show
0 372 moveto (3923 }) show
0 360 moveto (3924 ) show
0 348 moveto (3925 int) show
0 336 moveto (3926 sys_getsockname\(void\)) show
0 324 moveto (3927 {) show
0 312 moveto (3928     int s;) show
0 300 moveto (3929     struct sockaddr *name;) show
0 288 moveto (3930     socklen_t *namelen;) show
0 276 moveto (3931     if\(\(argint\(0, &s\)<0\) ||) show
0 264 moveto (3932             \(argptr\(1, &name, sizeof\(struct sockaddr\)\)<0\) ||) show
0 252 moveto (3933             \(argptr\(2, &namelen, sizeof\(socklen_t\)\)<0\)\)) show
0 240 moveto (3934         return -1;) show
0 228 moveto (3935     return lwip_getsockname\(s, name, namelen\);) show
0 216 moveto (3936 }) show
0 204 moveto (3937 ) show
0 192 moveto (3938 ) show
0 180 moveto (3939 ) show
0 168 moveto (3940 ) show
0 156 moveto (3941 ) show
0 144 moveto (3942 ) show
0 132 moveto (3943 ) show
0 120 moveto (3944 ) show
0 108 moveto (3945 ) show
0 96 moveto (3946 ) show
0 84 moveto (3947 ) show
0 72 moveto (3948 ) show
0 60 moveto (3949 ) show
0 24 moveto (Sheet 39) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/buf.h  Page 1) show
0 648 moveto (3950 struct buf {) show
0 636 moveto (3951   int flags;) show
0 624 moveto (3952   uint dev;) show
0 612 moveto (3953   uint sector;) show
0 600 moveto (3954   struct buf *prev; // LRU cache list) show
0 588 moveto (3955   struct buf *next;) show
0 576 moveto (3956   struct buf *qnext; // disk queue) show
0 564 moveto (3957   uchar data[512];) show
0 552 moveto (3958 };) show
0 540 moveto (3959 #define B_BUSY  0x1  // buffer is locked by some process) show
0 528 moveto (3960 #define B_VALID 0x2  // buffer has been read from disk) show
0 516 moveto (3961 #define B_DIRTY 0x4  // buffer needs to be written to disk) show
0 504 moveto (3962 ) show
0 492 moveto (3963 ) show
0 480 moveto (3964 ) show
0 468 moveto (3965 ) show
0 456 moveto (3966 ) show
0 444 moveto (3967 ) show
0 432 moveto (3968 ) show
0 420 moveto (3969 ) show
0 408 moveto (3970 ) show
0 396 moveto (3971 ) show
0 384 moveto (3972 ) show
0 372 moveto (3973 ) show
0 360 moveto (3974 ) show
0 348 moveto (3975 ) show
0 336 moveto (3976 ) show
0 324 moveto (3977 ) show
0 312 moveto (3978 ) show
0 300 moveto (3979 ) show
0 288 moveto (3980 ) show
0 276 moveto (3981 ) show
0 264 moveto (3982 ) show
0 252 moveto (3983 ) show
0 240 moveto (3984 ) show
0 228 moveto (3985 ) show
0 216 moveto (3986 ) show
0 204 moveto (3987 ) show
0 192 moveto (3988 ) show
0 180 moveto (3989 ) show
0 168 moveto (3990 ) show
0 156 moveto (3991 ) show
0 144 moveto (3992 ) show
0 132 moveto (3993 ) show
0 120 moveto (3994 ) show
0 108 moveto (3995 ) show
0 96 moveto (3996 ) show
0 84 moveto (3997 ) show
0 72 moveto (3998 ) show
0 60 moveto (3999 ) show
0 24 moveto (Sheet 39) show
grestore
restore
showpage
%%Page: 49 49
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/dev.h  Page 1) show
0 648 moveto (4000 struct devsw {) show
0 636 moveto (4001   int \(*read\)\(struct inode*, char*, int\);) show
0 624 moveto (4002   int \(*write\)\(struct inode*, char*, int\);) show
0 612 moveto (4003 };) show
0 600 moveto (4004 ) show
0 588 moveto (4005 extern struct devsw devsw[];) show
0 576 moveto (4006 ) show
0 564 moveto (4007 #define CONSOLE 1) show
0 552 moveto (4008 ) show
0 540 moveto (4009 ) show
0 528 moveto (4010 ) show
0 516 moveto (4011 ) show
0 504 moveto (4012 ) show
0 492 moveto (4013 ) show
0 480 moveto (4014 ) show
0 468 moveto (4015 ) show
0 456 moveto (4016 ) show
0 444 moveto (4017 ) show
0 432 moveto (4018 ) show
0 420 moveto (4019 ) show
0 408 moveto (4020 ) show
0 396 moveto (4021 ) show
0 384 moveto (4022 ) show
0 372 moveto (4023 ) show
0 360 moveto (4024 ) show
0 348 moveto (4025 ) show
0 336 moveto (4026 ) show
0 324 moveto (4027 ) show
0 312 moveto (4028 ) show
0 300 moveto (4029 ) show
0 288 moveto (4030 ) show
0 276 moveto (4031 ) show
0 264 moveto (4032 ) show
0 252 moveto (4033 ) show
0 240 moveto (4034 ) show
0 228 moveto (4035 ) show
0 216 moveto (4036 ) show
0 204 moveto (4037 ) show
0 192 moveto (4038 ) show
0 180 moveto (4039 ) show
0 168 moveto (4040 ) show
0 156 moveto (4041 ) show
0 144 moveto (4042 ) show
0 132 moveto (4043 ) show
0 120 moveto (4044 ) show
0 108 moveto (4045 ) show
0 96 moveto (4046 ) show
0 84 moveto (4047 ) show
0 72 moveto (4048 ) show
0 60 moveto (4049 ) show
0 24 moveto (Sheet 40) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fcntl.h  Page 1) show
0 648 moveto (4050 #define O_RDONLY  0x000) show
0 636 moveto (4051 #define O_WRONLY  0x001) show
0 624 moveto (4052 #define O_RDWR    0x002) show
0 612 moveto (4053 #define O_CREATE  0x200) show
0 600 moveto (4054 ) show
0 588 moveto (4055 ) show
0 576 moveto (4056 ) show
0 564 moveto (4057 ) show
0 552 moveto (4058 ) show
0 540 moveto (4059 ) show
0 528 moveto (4060 ) show
0 516 moveto (4061 ) show
0 504 moveto (4062 ) show
0 492 moveto (4063 ) show
0 480 moveto (4064 ) show
0 468 moveto (4065 ) show
0 456 moveto (4066 ) show
0 444 moveto (4067 ) show
0 432 moveto (4068 ) show
0 420 moveto (4069 ) show
0 408 moveto (4070 ) show
0 396 moveto (4071 ) show
0 384 moveto (4072 ) show
0 372 moveto (4073 ) show
0 360 moveto (4074 ) show
0 348 moveto (4075 ) show
0 336 moveto (4076 ) show
0 324 moveto (4077 ) show
0 312 moveto (4078 ) show
0 300 moveto (4079 ) show
0 288 moveto (4080 ) show
0 276 moveto (4081 ) show
0 264 moveto (4082 ) show
0 252 moveto (4083 ) show
0 240 moveto (4084 ) show
0 228 moveto (4085 ) show
0 216 moveto (4086 ) show
0 204 moveto (4087 ) show
0 192 moveto (4088 ) show
0 180 moveto (4089 ) show
0 168 moveto (4090 ) show
0 156 moveto (4091 ) show
0 144 moveto (4092 ) show
0 132 moveto (4093 ) show
0 120 moveto (4094 ) show
0 108 moveto (4095 ) show
0 96 moveto (4096 ) show
0 84 moveto (4097 ) show
0 72 moveto (4098 ) show
0 60 moveto (4099 ) show
0 24 moveto (Sheet 40) show
grestore
restore
showpage
%%Page: 50 50
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/stat.h  Page 1) show
0 648 moveto (4100 struct stat {) show
0 636 moveto (4101   int dev;     // Device number) show
0 624 moveto (4102   uint ino;    // Inode number on device) show
0 612 moveto (4103   short type;  // Type of file) show
0 600 moveto (4104   short nlink; // Number of links to file) show
0 588 moveto (4105   uint size;   // Size of file in bytes) show
0 576 moveto (4106 };) show
0 564 moveto (4107 ) show
0 552 moveto (4108 ) show
0 540 moveto (4109 ) show
0 528 moveto (4110 ) show
0 516 moveto (4111 ) show
0 504 moveto (4112 ) show
0 492 moveto (4113 ) show
0 480 moveto (4114 ) show
0 468 moveto (4115 ) show
0 456 moveto (4116 ) show
0 444 moveto (4117 ) show
0 432 moveto (4118 ) show
0 420 moveto (4119 ) show
0 408 moveto (4120 ) show
0 396 moveto (4121 ) show
0 384 moveto (4122 ) show
0 372 moveto (4123 ) show
0 360 moveto (4124 ) show
0 348 moveto (4125 ) show
0 336 moveto (4126 ) show
0 324 moveto (4127 ) show
0 312 moveto (4128 ) show
0 300 moveto (4129 ) show
0 288 moveto (4130 ) show
0 276 moveto (4131 ) show
0 264 moveto (4132 ) show
0 252 moveto (4133 ) show
0 240 moveto (4134 ) show
0 228 moveto (4135 ) show
0 216 moveto (4136 ) show
0 204 moveto (4137 ) show
0 192 moveto (4138 ) show
0 180 moveto (4139 ) show
0 168 moveto (4140 ) show
0 156 moveto (4141 ) show
0 144 moveto (4142 ) show
0 132 moveto (4143 ) show
0 120 moveto (4144 ) show
0 108 moveto (4145 ) show
0 96 moveto (4146 ) show
0 84 moveto (4147 ) show
0 72 moveto (4148 ) show
0 60 moveto (4149 ) show
0 24 moveto (Sheet 41) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/file.h  Page 1) show
0 648 moveto (4150 struct file {) show
0 636 moveto (4151   enum { FD_CLOSED, FD_NONE, FD_PIPE, FD_INODE } type;) show
0 624 moveto (4152   int ref; // reference count) show
0 612 moveto (4153   char readable;) show
0 600 moveto (4154   char writable;) show
0 588 moveto (4155   struct pipe *pipe;) show
0 576 moveto (4156   struct inode *ip;) show
0 564 moveto (4157   uint off;) show
0 552 moveto (4158 };) show
0 540 moveto (4159 ) show
0 528 moveto (4160 ) show
0 516 moveto (4161 ) show
0 504 moveto (4162 ) show
0 492 moveto (4163 ) show
0 480 moveto (4164 ) show
0 468 moveto (4165 ) show
0 456 moveto (4166 ) show
0 444 moveto (4167 ) show
0 432 moveto (4168 ) show
0 420 moveto (4169 ) show
0 408 moveto (4170 ) show
0 396 moveto (4171 ) show
0 384 moveto (4172 ) show
0 372 moveto (4173 ) show
0 360 moveto (4174 ) show
0 348 moveto (4175 ) show
0 336 moveto (4176 ) show
0 324 moveto (4177 ) show
0 312 moveto (4178 ) show
0 300 moveto (4179 ) show
0 288 moveto (4180 ) show
0 276 moveto (4181 ) show
0 264 moveto (4182 ) show
0 252 moveto (4183 ) show
0 240 moveto (4184 ) show
0 228 moveto (4185 ) show
0 216 moveto (4186 ) show
0 204 moveto (4187 ) show
0 192 moveto (4188 ) show
0 180 moveto (4189 ) show
0 168 moveto (4190 ) show
0 156 moveto (4191 ) show
0 144 moveto (4192 ) show
0 132 moveto (4193 ) show
0 120 moveto (4194 ) show
0 108 moveto (4195 ) show
0 96 moveto (4196 ) show
0 84 moveto (4197 ) show
0 72 moveto (4198 ) show
0 60 moveto (4199 ) show
0 24 moveto (Sheet 41) show
grestore
restore
showpage
%%Page: 51 51
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.h  Page 1) show
0 648 moveto (4200 // On-disk file system format.) show
0 636 moveto (4201 // Both the kernel and user programs use this header file.) show
0 624 moveto (4202 ) show
0 612 moveto (4203 // Block 0 is unused.) show
0 600 moveto (4204 // Block 1 is super block.) show
0 588 moveto (4205 // Inodes start at block 2.) show
0 576 moveto (4206 ) show
0 564 moveto (4207 #define BSIZE 512  // block size) show
0 552 moveto (4208 ) show
0 540 moveto (4209 // File system super block) show
0 528 moveto (4210 struct superblock {) show
0 516 moveto (4211   uint size;         // Size of file system image \(blocks\)) show
0 504 moveto (4212   uint nblocks;      // Number of data blocks) show
0 492 moveto (4213   uint ninodes;      // Number of inodes.) show
0 480 moveto (4214 };) show
0 468 moveto (4215 ) show
0 456 moveto (4216 #define NADDRS \(NDIRECT+1\)) show
0 444 moveto (4217 #define NDIRECT 12) show
0 432 moveto (4218 #define INDIRECT 12) show
0 420 moveto (4219 #define NINDIRECT \(BSIZE / sizeof\(uint\)\)) show
0 408 moveto (4220 #define MAXFILE \(NDIRECT  + NINDIRECT\)) show
0 396 moveto (4221 ) show
0 384 moveto (4222 // On-disk inode structure) show
0 372 moveto (4223 struct dinode {) show
0 360 moveto (4224   short type;           // File type) show
0 348 moveto (4225   short major;          // Major device number \(T_DEV only\)) show
0 336 moveto (4226   short minor;          // Minor device number \(T_DEV only\)) show
0 324 moveto (4227   short nlink;          // Number of links to inode in file system) show
0 312 moveto (4228   uint size;            // Size of file \(bytes\)) show
0 300 moveto (4229   uint addrs[NADDRS];   // Data block addresses) show
0 288 moveto (4230 };) show
0 276 moveto (4231 ) show
0 264 moveto (4232 #define T_DIR  1   // Directory) show
0 252 moveto (4233 #define T_FILE 2   // File) show
0 240 moveto (4234 #define T_DEV  3   // Special device) show
0 228 moveto (4235 ) show
0 216 moveto (4236 // Inodes per block.) show
0 204 moveto (4237 #define IPB           \(BSIZE / sizeof\(struct dinode\)\)) show
0 192 moveto (4238 ) show
0 180 moveto (4239 // Block containing inode i) show
0 168 moveto (4240 #define IBLOCK\(i\)     \(\(i\) / IPB + 2\)) show
0 156 moveto (4241 ) show
0 144 moveto (4242 // Bitmap bits per block) show
0 132 moveto (4243 #define BPB           \(BSIZE*8\)) show
0 120 moveto (4244 ) show
0 108 moveto (4245 // Block containing bit for block b) show
0 96 moveto (4246 #define BBLOCK\(b, ninodes\) \(b/BPB + \(ninodes\)/IPB + 3\)) show
0 84 moveto (4247 ) show
0 72 moveto (4248 // Directory is a file containing a sequence of dirent structures.) show
0 60 moveto (4249 #define DIRSIZ 14) show
0 24 moveto (Sheet 42) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.h  Page 2) show
0 648 moveto (4250 struct dirent {) show
0 636 moveto (4251   ushort inum;) show
0 624 moveto (4252   char name[DIRSIZ];) show
0 612 moveto (4253 };) show
0 600 moveto (4254 ) show
0 588 moveto (4255 ) show
0 576 moveto (4256 ) show
0 564 moveto (4257 ) show
0 552 moveto (4258 ) show
0 540 moveto (4259 ) show
0 528 moveto (4260 ) show
0 516 moveto (4261 ) show
0 504 moveto (4262 ) show
0 492 moveto (4263 ) show
0 480 moveto (4264 ) show
0 468 moveto (4265 ) show
0 456 moveto (4266 ) show
0 444 moveto (4267 ) show
0 432 moveto (4268 ) show
0 420 moveto (4269 ) show
0 408 moveto (4270 ) show
0 396 moveto (4271 ) show
0 384 moveto (4272 ) show
0 372 moveto (4273 ) show
0 360 moveto (4274 ) show
0 348 moveto (4275 ) show
0 336 moveto (4276 ) show
0 324 moveto (4277 ) show
0 312 moveto (4278 ) show
0 300 moveto (4279 ) show
0 288 moveto (4280 ) show
0 276 moveto (4281 ) show
0 264 moveto (4282 ) show
0 252 moveto (4283 ) show
0 240 moveto (4284 ) show
0 228 moveto (4285 ) show
0 216 moveto (4286 ) show
0 204 moveto (4287 ) show
0 192 moveto (4288 ) show
0 180 moveto (4289 ) show
0 168 moveto (4290 ) show
0 156 moveto (4291 ) show
0 144 moveto (4292 ) show
0 132 moveto (4293 ) show
0 120 moveto (4294 ) show
0 108 moveto (4295 ) show
0 96 moveto (4296 ) show
0 84 moveto (4297 ) show
0 72 moveto (4298 ) show
0 60 moveto (4299 ) show
0 24 moveto (Sheet 42) show
grestore
restore
showpage
%%Page: 52 52
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fsvar.h  Page 1) show
0 648 moveto (4300 // in-core file system types) show
0 636 moveto (4301 ) show
0 624 moveto (4302 struct inode {) show
0 612 moveto (4303   uint dev;           // Device number) show
0 600 moveto (4304   uint inum;          // Inode number) show
0 588 moveto (4305   int ref;            // Reference count) show
0 576 moveto (4306   int flags;          // I_BUSY, I_VALID) show
0 564 moveto (4307 ) show
0 552 moveto (4308   short type;         // copy of disk inode) show
0 540 moveto (4309   short major;) show
0 528 moveto (4310   short minor;) show
0 516 moveto (4311   short nlink;) show
0 504 moveto (4312   uint size;) show
0 492 moveto (4313   uint addrs[NADDRS];) show
0 480 moveto (4314 };) show
0 468 moveto (4315 ) show
0 456 moveto (4316 #define I_BUSY 0x1) show
0 444 moveto (4317 #define I_VALID 0x2) show
0 432 moveto (4318 ) show
0 420 moveto (4319 ) show
0 408 moveto (4320 ) show
0 396 moveto (4321 ) show
0 384 moveto (4322 ) show
0 372 moveto (4323 ) show
0 360 moveto (4324 ) show
0 348 moveto (4325 ) show
0 336 moveto (4326 ) show
0 324 moveto (4327 ) show
0 312 moveto (4328 ) show
0 300 moveto (4329 ) show
0 288 moveto (4330 ) show
0 276 moveto (4331 ) show
0 264 moveto (4332 ) show
0 252 moveto (4333 ) show
0 240 moveto (4334 ) show
0 228 moveto (4335 ) show
0 216 moveto (4336 ) show
0 204 moveto (4337 ) show
0 192 moveto (4338 ) show
0 180 moveto (4339 ) show
0 168 moveto (4340 ) show
0 156 moveto (4341 ) show
0 144 moveto (4342 ) show
0 132 moveto (4343 ) show
0 120 moveto (4344 ) show
0 108 moveto (4345 ) show
0 96 moveto (4346 ) show
0 84 moveto (4347 ) show
0 72 moveto (4348 ) show
0 60 moveto (4349 ) show
0 24 moveto (Sheet 43) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/ide.c  Page 1) show
0 648 moveto (4350 // Simple PIO-based \(non-DMA\) IDE driver code.) show
0 636 moveto (4351 ) show
0 624 moveto (4352 #include "types.h") show
0 612 moveto (4353 #include "defs.h") show
0 600 moveto (4354 #include "param.h") show
0 588 moveto (4355 #include "mmu.h") show
0 576 moveto (4356 #include "proc.h") show
0 564 moveto (4357 #include "x86.h") show
0 552 moveto (4358 #include "traps.h") show
0 540 moveto (4359 #include "spinlock.h") show
0 528 moveto (4360 #include "buf.h") show
0 516 moveto (4361 #include "picirq.h") show
0 504 moveto (4362 ) show
0 492 moveto (4363 #define IDE_BSY       0x80) show
0 480 moveto (4364 #define IDE_DRDY      0x40) show
0 468 moveto (4365 #define IDE_DF        0x20) show
0 456 moveto (4366 #define IDE_ERR       0x01) show
0 444 moveto (4367 ) show
0 432 moveto (4368 #define IDE_CMD_READ  0x20) show
0 420 moveto (4369 #define IDE_CMD_WRITE 0x30) show
0 408 moveto (4370 ) show
0 396 moveto (4371 // ide_queue points to the buf now being read/written to the disk.) show
0 384 moveto (4372 // ide_queue->qnext points to the next buf to be processed.) show
0 372 moveto (4373 // You must hold ide_lock while manipulating queue.) show
0 360 moveto (4374 ) show
0 348 moveto (4375 static struct spinlock ide_lock;) show
0 336 moveto (4376 static struct buf *ide_queue;) show
0 324 moveto (4377 ) show
0 312 moveto (4378 static int disk_1_present;) show
0 300 moveto (4379 static void ide_start_request\(\);) show
0 288 moveto (4380 ) show
0 276 moveto (4381 // Wait for IDE disk to become ready.) show
0 264 moveto (4382 static int) show
0 252 moveto (4383 ide_wait_ready\(int check_error\)) show
0 240 moveto (4384 {) show
0 228 moveto (4385   int r;) show
0 216 moveto (4386 ) show
0 204 moveto (4387   while\(\(\(r = inb\(0x1f7\)\) & IDE_BSY\) || !\(r & IDE_DRDY\)\)) show
0 192 moveto (4388     ;) show
0 180 moveto (4389   if\(check_error && \(r & \(IDE_DF|IDE_ERR\)\) != 0\)) show
0 168 moveto (4390     return -1;) show
0 156 moveto (4391   return 0;) show
0 144 moveto (4392 }) show
0 132 moveto (4393 ) show
0 120 moveto (4394 void) show
0 108 moveto (4395 dummy_ide_intr\(struct trapframe *tf\)) show
0 96 moveto (4396 {) show
0 84 moveto (4397 }) show
0 72 moveto (4398 ) show
0 60 moveto (4399 ) show
0 24 moveto (Sheet 43) show
grestore
restore
showpage
%%Page: 53 53
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/ide.c  Page 2) show
0 648 moveto (4400 void) show
0 636 moveto (4401 ide_init\(void\)) show
0 624 moveto (4402 {) show
0 612 moveto (4403   int i;) show
0 600 moveto (4404 ) show
0 588 moveto (4405   initlock\(&ide_lock, "ide"\);) show
0 576 moveto (4406   pic_enable\(IRQ_IDE\);) show
0 564 moveto (4407   ioapic_enable\(IRQ_IDE, ncpu - 1\);) show
0 552 moveto (4408   ide_wait_ready\(0\);) show
0 540 moveto (4409   reg_irq_handler\(IRQ_IDE_2, dummy_ide_intr\);) show
0 528 moveto (4410 ) show
0 516 moveto (4411   // Check if disk 1 is present) show
0 504 moveto (4412   outb\(0x1f6, 0xe0 | \(1<<4\)\);) show
0 492 moveto (4413   for\(i=0; i<1000; i++\){) show
0 480 moveto (4414     if\(inb\(0x1f7\) != 0\){) show
0 468 moveto (4415       disk_1_present = 1;) show
0 456 moveto (4416       break;) show
0 444 moveto (4417     }) show
0 432 moveto (4418   }) show
0 420 moveto (4419 ) show
0 408 moveto (4420   // Switch back to disk 0.) show
0 396 moveto (4421   outb\(0x1f6, 0xe0 | \(0<<4\)\);) show
0 384 moveto (4422   outb\(0x3f6, 0\);  // generate interrupt) show
0 372 moveto (4423 }) show
0 360 moveto (4424 ) show
0 348 moveto (4425 // Start the request for b.  Caller must hold ide_lock.) show
0 336 moveto (4426 static void) show
0 324 moveto (4427 ide_start_request\(struct buf *b\)) show
0 312 moveto (4428 {) show
0 300 moveto (4429 //    cprintf\("XXX ide_start_request\\n"\);) show
0 288 moveto (4430   if\(b == 0\)) show
0 276 moveto (4431     panic\("ide_start_request"\);) show
0 264 moveto (4432 ) show
0 252 moveto (4433   ide_wait_ready\(0\);) show
0 240 moveto (4434   outb\(0x1f2, 1\);  // number of sectors) show
0 228 moveto (4435   outb\(0x1f3, b->sector & 0xff\);) show
0 216 moveto (4436   outb\(0x1f4, \(b->sector >> 8\) & 0xff\);) show
0 204 moveto (4437   outb\(0x1f5, \(b->sector >> 16\) & 0xff\);) show
0 192 moveto (4438   outb\(0x1f6, 0xe0 | \(\(b->dev&1\)<<4\) | \(\(b->sector>>24\)&0x0f\)\);) show
0 180 moveto (4439   if\(b->flags & B_DIRTY\){) show
0 168 moveto (4440     outb\(0x1f7, IDE_CMD_WRITE\);) show
0 156 moveto (4441     outsl\(0x1f0, b->data, 512/4\);) show
0 144 moveto (4442   } else {) show
0 132 moveto (4443     outb\(0x1f7, IDE_CMD_READ\);) show
0 120 moveto (4444   }) show
0 108 moveto (4445 }) show
0 96 moveto (4446 ) show
0 84 moveto (4447 ) show
0 72 moveto (4448 ) show
0 60 moveto (4449 ) show
0 24 moveto (Sheet 44) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/ide.c  Page 3) show
0 648 moveto (4450 // Interrupt handler.) show
0 636 moveto (4451 void) show
0 624 moveto (4452 ide_intr\(void\)) show
0 612 moveto (4453 {) show
0 600 moveto (4454   struct buf *b;) show
0 588 moveto (4455 ) show
0 576 moveto (4456   acquire\(&ide_lock\);) show
0 564 moveto (4457   if\(\(b = ide_queue\) == 0\){) show
0 552 moveto (4458     release\(&ide_lock\);) show
0 540 moveto (4459     return;) show
0 528 moveto (4460   }) show
0 516 moveto (4461 ) show
0 504 moveto (4462   // Read data if needed.) show
0 492 moveto (4463   if\(!\(b->flags & B_DIRTY\) && ide_wait_ready\(1\) >= 0\)) show
0 480 moveto (4464     insl\(0x1f0, b->data, 512/4\);) show
0 468 moveto (4465 ) show
0 456 moveto (4466   // Wake process waiting for this buf.) show
0 444 moveto (4467   b->flags |= B_VALID;) show
0 432 moveto (4468   b->flags &= ~B_DIRTY;) show
0 420 moveto (4469   wakeup\(b\);) show
0 408 moveto (4470 ) show
0 396 moveto (4471   // Start disk on next buf in queue.) show
0 384 moveto (4472   if\(\(ide_queue = b->qnext\) != 0\)) show
0 372 moveto (4473     ide_start_request\(ide_queue\);) show
0 360 moveto (4474 ) show
0 348 moveto (4475   release\(&ide_lock\);) show
0 336 moveto (4476 }) show
0 324 moveto (4477 ) show
0 312 moveto (4478 // Sync buf with disk.) show
0 300 moveto (4479 // If B_DIRTY is set, write buf to disk, clear B_DIRTY, set B_VALID.) show
0 288 moveto (4480 // Else if B_VALID is not set, read buf from disk, set B_VALID.) show
0 276 moveto (4481 void) show
0 264 moveto (4482 ide_rw\(struct buf *b\)) show
0 252 moveto (4483 {) show
0 240 moveto (4484   struct buf **pp;) show
0 228 moveto (4485 ) show
0 216 moveto (4486   if\(!\(b->flags & B_BUSY\)\)) show
0 204 moveto (4487     panic\("ide_rw: buf not busy"\);) show
0 192 moveto (4488   if\(\(b->flags & \(B_VALID|B_DIRTY\)\) == B_VALID\)) show
0 180 moveto (4489     panic\("ide_rw: nothing to do"\);) show
0 168 moveto (4490   if\(b->dev != 0 && !disk_1_present\)) show
0 156 moveto (4491     panic\("ide disk 1 not present"\);) show
0 144 moveto (4492 ) show
0 132 moveto (4493   acquire\(&ide_lock\);) show
0 120 moveto (4494 ) show
0 108 moveto (4495   // Append b to ide_queue.) show
0 96 moveto (4496   b->qnext = 0;) show
0 84 moveto (4497   for\(pp=&ide_queue; *pp; pp=&\(*pp\)->qnext\)) show
0 72 moveto (4498     ;) show
0 60 moveto (4499   *pp = b;) show
0 24 moveto (Sheet 44) show
grestore
restore
showpage
%%Page: 54 54
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/ide.c  Page 4) show
0 648 moveto (4500   // Start disk if necessary.) show
0 636 moveto (4501   if\(ide_queue == b\)) show
0 624 moveto (4502     ide_start_request\(b\);) show
0 612 moveto (4503 ) show
0 600 moveto (4504   // Wait for request to finish.) show
0 588 moveto (4505   // Assuming will not sleep too long: ignore cp->killed.) show
0 576 moveto (4506   while\(\(b->flags & \(B_VALID|B_DIRTY\)\) != B_VALID\)) show
0 564 moveto (4507   {) show
0 552 moveto (4508     sleep\(b, &ide_lock\);) show
0 540 moveto (4509   }) show
0 528 moveto (4510 //  cprintf\("XXX ide_rw: finished\\n"\);) show
0 516 moveto (4511 ) show
0 504 moveto (4512   release\(&ide_lock\);) show
0 492 moveto (4513 }) show
0 480 moveto (4514 ) show
0 468 moveto (4515 ) show
0 456 moveto (4516 ) show
0 444 moveto (4517 ) show
0 432 moveto (4518 ) show
0 420 moveto (4519 ) show
0 408 moveto (4520 ) show
0 396 moveto (4521 ) show
0 384 moveto (4522 ) show
0 372 moveto (4523 ) show
0 360 moveto (4524 ) show
0 348 moveto (4525 ) show
0 336 moveto (4526 ) show
0 324 moveto (4527 ) show
0 312 moveto (4528 ) show
0 300 moveto (4529 ) show
0 288 moveto (4530 ) show
0 276 moveto (4531 ) show
0 264 moveto (4532 ) show
0 252 moveto (4533 ) show
0 240 moveto (4534 ) show
0 228 moveto (4535 ) show
0 216 moveto (4536 ) show
0 204 moveto (4537 ) show
0 192 moveto (4538 ) show
0 180 moveto (4539 ) show
0 168 moveto (4540 ) show
0 156 moveto (4541 ) show
0 144 moveto (4542 ) show
0 132 moveto (4543 ) show
0 120 moveto (4544 ) show
0 108 moveto (4545 ) show
0 96 moveto (4546 ) show
0 84 moveto (4547 ) show
0 72 moveto (4548 ) show
0 60 moveto (4549 ) show
0 24 moveto (Sheet 45) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bio.c  Page 1) show
0 648 moveto (4550 // Buffer cache.) show
0 636 moveto (4551 //) show
0 624 moveto (4552 // The buffer cache is a linked list of buf structures holding) show
0 612 moveto (4553 // cached copies of disk block contents.  Caching disk blocks) show
0 600 moveto (4554 // in memory reduces the number of disk reads and also provides) show
0 588 moveto (4555 // a synchronization point for disk blocks used by multiple processes.) show
0 576 moveto (4556 //) show
0 564 moveto (4557 // Interface:) show
0 552 moveto (4558 // * To get a buffer for a particular disk block, call bread.) show
0 540 moveto (4559 // * After changing buffer data, call bwrite to flush it to disk.) show
0 528 moveto (4560 // * When done with the buffer, call brelse.) show
0 516 moveto (4561 // * Do not use the buffer after calling brelse.) show
0 504 moveto (4562 // * Only one process at a time can use a buffer,) show
0 492 moveto (4563 //     so do not keep them longer than necessary.) show
0 480 moveto (4564 //) show
0 468 moveto (4565 // The implementation uses three state flags internally:) show
0 456 moveto (4566 // * B_BUSY: the block has been returned from bread) show
0 444 moveto (4567 //     and has not been passed back to brelse.) show
0 432 moveto (4568 // * B_VALID: the buffer data has been initialized) show
0 420 moveto (4569 //     with the associated disk block contents.) show
0 408 moveto (4570 // * B_DIRTY: the buffer data has been modified) show
0 396 moveto (4571 //     and needs to be written to disk.) show
0 384 moveto (4572 ) show
0 372 moveto (4573 #include "types.h") show
0 360 moveto (4574 #include "defs.h") show
0 348 moveto (4575 #include "param.h") show
0 336 moveto (4576 #include "spinlock.h") show
0 324 moveto (4577 #include "buf.h") show
0 312 moveto (4578 ) show
0 300 moveto (4579 struct buf buf[NBUF];) show
0 288 moveto (4580 struct spinlock buf_table_lock;) show
0 276 moveto (4581 ) show
0 264 moveto (4582 // Linked list of all buffers, through prev/next.) show
0 252 moveto (4583 // bufhead->next is most recently used.) show
0 240 moveto (4584 // bufhead->tail is least recently used.) show
0 228 moveto (4585 struct buf bufhead;) show
0 216 moveto (4586 ) show
0 204 moveto (4587 void) show
0 192 moveto (4588 binit\(void\)) show
0 180 moveto (4589 {) show
0 168 moveto (4590   struct buf *b;) show
0 156 moveto (4591 ) show
0 144 moveto (4592   initlock\(&buf_table_lock, "buf_table"\);) show
0 132 moveto (4593 ) show
0 120 moveto (4594   // Create linked list of buffers) show
0 108 moveto (4595   bufhead.prev = &bufhead;) show
0 96 moveto (4596   bufhead.next = &bufhead;) show
0 84 moveto (4597   for\(b = buf; b < buf+NBUF; b++\){) show
0 72 moveto (4598     b->next = bufhead.next;) show
0 60 moveto (4599     b->prev = &bufhead;) show
0 24 moveto (Sheet 45) show
grestore
restore
showpage
%%Page: 55 55
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bio.c  Page 2) show
0 648 moveto (4600     bufhead.next->prev = b;) show
0 636 moveto (4601     bufhead.next = b;) show
0 624 moveto (4602   }) show
0 612 moveto (4603 }) show
0 600 moveto (4604 ) show
0 588 moveto (4605 // Look through buffer cache for sector on device dev.) show
0 576 moveto (4606 // If not found, allocate fresh block.) show
0 564 moveto (4607 // In either case, return locked buffer.) show
0 552 moveto (4608 static struct buf*) show
0 540 moveto (4609 bget\(uint dev, uint sector\)) show
0 528 moveto (4610 {) show
0 516 moveto (4611   struct buf *b;) show
0 504 moveto (4612 ) show
0 492 moveto (4613   acquire\(&buf_table_lock\);) show
0 480 moveto (4614 ) show
0 468 moveto (4615  loop:) show
0 456 moveto (4616   // Try for cached block.) show
0 444 moveto (4617   for\(b = bufhead.next; b != &bufhead; b = b->next\){) show
0 432 moveto (4618     if\(\(b->flags & \(B_BUSY|B_VALID\)\) &&) show
0 420 moveto (4619        b->dev == dev && b->sector == sector\){) show
0 408 moveto (4620       if\(b->flags & B_BUSY\){) show
0 396 moveto (4621         sleep\(buf, &buf_table_lock\);) show
0 384 moveto (4622         goto loop;) show
0 372 moveto (4623       }) show
0 360 moveto (4624       b->flags |= B_BUSY;) show
0 348 moveto (4625       release\(&buf_table_lock\);) show
0 336 moveto (4626       return b;) show
0 324 moveto (4627     }) show
0 312 moveto (4628   }) show
0 300 moveto (4629 ) show
0 288 moveto (4630   // Allocate fresh block.) show
0 276 moveto (4631   for\(b = bufhead.prev; b != &bufhead; b = b->prev\){) show
0 264 moveto (4632     if\(\(b->flags & B_BUSY\) == 0\){) show
0 252 moveto (4633       b->flags = B_BUSY;) show
0 240 moveto (4634       b->dev = dev;) show
0 228 moveto (4635       b->sector = sector;) show
0 216 moveto (4636       release\(&buf_table_lock\);) show
0 204 moveto (4637       return b;) show
0 192 moveto (4638     }) show
0 180 moveto (4639   }) show
0 168 moveto (4640   panic\("bget: no buffers"\);) show
0 156 moveto (4641 }) show
0 144 moveto (4642 ) show
0 132 moveto (4643 ) show
0 120 moveto (4644 ) show
0 108 moveto (4645 ) show
0 96 moveto (4646 ) show
0 84 moveto (4647 ) show
0 72 moveto (4648 ) show
0 60 moveto (4649 ) show
0 24 moveto (Sheet 46) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/bio.c  Page 3) show
0 648 moveto (4650 // Return a B_BUSY buf with the contents of the indicated disk sector.) show
0 636 moveto (4651 struct buf*) show
0 624 moveto (4652 bread\(uint dev, uint sector\)) show
0 612 moveto (4653 {) show
0 600 moveto (4654   struct buf *b;) show
0 588 moveto (4655 ) show
0 576 moveto (4656   b = bget\(dev, sector\);) show
0 564 moveto (4657   if\(!\(b->flags & B_VALID\)\)) show
0 552 moveto (4658     ide_rw\(b\);) show
0 540 moveto (4659   return b;) show
0 528 moveto (4660 }) show
0 516 moveto (4661 ) show
0 504 moveto (4662 // Write buf's contents to disk.  Must be locked.) show
0 492 moveto (4663 void) show
0 480 moveto (4664 bwrite\(struct buf *b\)) show
0 468 moveto (4665 {) show
0 456 moveto (4666   if\(\(b->flags & B_BUSY\) == 0\)) show
0 444 moveto (4667     panic\("bwrite"\);) show
0 432 moveto (4668   b->flags |= B_DIRTY;) show
0 420 moveto (4669   ide_rw\(b\);) show
0 408 moveto (4670 }) show
0 396 moveto (4671 ) show
0 384 moveto (4672 // Release the buffer buf.) show
0 372 moveto (4673 void) show
0 360 moveto (4674 brelse\(struct buf *b\)) show
0 348 moveto (4675 {) show
0 336 moveto (4676   if\(\(b->flags & B_BUSY\) == 0\)) show
0 324 moveto (4677     panic\("brelse"\);) show
0 312 moveto (4678 ) show
0 300 moveto (4679   acquire\(&buf_table_lock\);) show
0 288 moveto (4680 ) show
0 276 moveto (4681   b->next->prev = b->prev;) show
0 264 moveto (4682   b->prev->next = b->next;) show
0 252 moveto (4683   b->next = bufhead.next;) show
0 240 moveto (4684   b->prev = &bufhead;) show
0 228 moveto (4685   bufhead.next->prev = b;) show
0 216 moveto (4686   bufhead.next = b;) show
0 204 moveto (4687 ) show
0 192 moveto (4688   b->flags &= ~B_BUSY;) show
0 180 moveto (4689   wakeup\(buf\);) show
0 168 moveto (4690 ) show
0 156 moveto (4691   release\(&buf_table_lock\);) show
0 144 moveto (4692 }) show
0 132 moveto (4693 ) show
0 120 moveto (4694 ) show
0 108 moveto (4695 ) show
0 96 moveto (4696 ) show
0 84 moveto (4697 ) show
0 72 moveto (4698 ) show
0 60 moveto (4699 ) show
0 24 moveto (Sheet 46) show
grestore
restore
showpage
%%Page: 56 56
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 1) show
0 648 moveto (4700 // File system implementation.  Four layers:) show
0 636 moveto (4701 //   + Blocks: allocator for raw disk blocks.) show
0 624 moveto (4702 //   + Files: inode allocator, reading, writing, metadata.) show
0 612 moveto (4703 //   + Directories: inode with special contents \(list of other inodes!\)) show
0 600 moveto (4704 //   + Names: paths like /usr/rtm/xv6/fs.c for convenient naming.) show
0 588 moveto (4705 //) show
0 576 moveto (4706 // Disk layout is: superblock, inodes, block in-use bitmap, data blocks.) show
0 564 moveto (4707 //) show
0 552 moveto (4708 // This file contains the low-level file system manipulation) show
0 540 moveto (4709 // routines.  The \(higher-level\) system call implementations) show
0 528 moveto (4710 // are in sysfile.c.) show
0 516 moveto (4711 ) show
0 504 moveto (4712 #include "types.h") show
0 492 moveto (4713 #include "defs.h") show
0 480 moveto (4714 #include "param.h") show
0 468 moveto (4715 #include "stat.h") show
0 456 moveto (4716 #include "mmu.h") show
0 444 moveto (4717 #include "proc.h") show
0 432 moveto (4718 #include "spinlock.h") show
0 420 moveto (4719 #include "buf.h") show
0 408 moveto (4720 #include "fs.h") show
0 396 moveto (4721 #include "fsvar.h") show
0 384 moveto (4722 #include "dev.h") show
0 372 moveto (4723 ) show
0 360 moveto (4724 #define min\(a, b\) \(\(a\) < \(b\) ? \(a\) : \(b\)\)) show
0 348 moveto (4725 static void itrunc\(struct inode*\);) show
0 336 moveto (4726 ) show
0 324 moveto (4727 // Read the super block.) show
0 312 moveto (4728 static void) show
0 300 moveto (4729 readsb\(int dev, struct superblock *sb\)) show
0 288 moveto (4730 {) show
0 276 moveto (4731   struct buf *bp;) show
0 264 moveto (4732 ) show
0 252 moveto (4733 //  cprintf\("XXX %s\\n",__func__\);) show
0 240 moveto (4734   bp = bread\(dev, 1\);) show
0 228 moveto (4735   memmove\(sb, bp->data, sizeof\(*sb\)\);) show
0 216 moveto (4736   brelse\(bp\);) show
0 204 moveto (4737 }) show
0 192 moveto (4738 ) show
0 180 moveto (4739 ) show
0 168 moveto (4740 ) show
0 156 moveto (4741 ) show
0 144 moveto (4742 ) show
0 132 moveto (4743 ) show
0 120 moveto (4744 ) show
0 108 moveto (4745 ) show
0 96 moveto (4746 ) show
0 84 moveto (4747 ) show
0 72 moveto (4748 ) show
0 60 moveto (4749 ) show
0 24 moveto (Sheet 47) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 2) show
0 648 moveto (4750 // Zero a block.) show
0 636 moveto (4751 static void) show
0 624 moveto (4752 bzero\(int dev, int bno\)) show
0 612 moveto (4753 {) show
0 600 moveto (4754   struct buf *bp;) show
0 588 moveto (4755 ) show
0 576 moveto (4756 //  cprintf\("XXX %s\\n",__func__\);) show
0 564 moveto (4757   bp = bread\(dev, bno\);) show
0 552 moveto (4758   memset\(bp->data, 0, BSIZE\);) show
0 540 moveto (4759   bwrite\(bp\);) show
0 528 moveto (4760   brelse\(bp\);) show
0 516 moveto (4761 }) show
0 504 moveto (4762 ) show
0 492 moveto (4763 // Blocks.) show
0 480 moveto (4764 ) show
0 468 moveto (4765 // Allocate a disk block.) show
0 456 moveto (4766 static uint) show
0 444 moveto (4767 balloc\(uint dev\)) show
0 432 moveto (4768 {) show
0 420 moveto (4769   int b, bi, m;) show
0 408 moveto (4770   struct buf *bp;) show
0 396 moveto (4771   struct superblock sb;) show
0 384 moveto (4772 ) show
0 372 moveto (4773 //  cprintf\("XXX %s\\n",__func__\);) show
0 360 moveto (4774   bp = 0;) show
0 348 moveto (4775   readsb\(dev, &sb\);) show
0 336 moveto (4776   for\(b = 0; b < sb.size; b += BPB\){) show
0 324 moveto (4777     bp = bread\(dev, BBLOCK\(b, sb.ninodes\)\);) show
0 312 moveto (4778     for\(bi = 0; bi < BPB; bi++\){) show
0 300 moveto (4779       m = 1 << \(bi % 8\);) show
0 288 moveto (4780       if\(\(bp->data[bi/8] & m\) == 0\){  // Is block free?) show
0 276 moveto (4781         bp->data[bi/8] |= m;  // Mark block in use on disk.) show
0 264 moveto (4782         bwrite\(bp\);) show
0 252 moveto (4783         brelse\(bp\);) show
0 240 moveto (4784         return b + bi;) show
0 228 moveto (4785       }) show
0 216 moveto (4786     }) show
0 204 moveto (4787     brelse\(bp\);) show
0 192 moveto (4788   }) show
0 180 moveto (4789   panic\("balloc: out of blocks"\);) show
0 168 moveto (4790 }) show
0 156 moveto (4791 ) show
0 144 moveto (4792 ) show
0 132 moveto (4793 ) show
0 120 moveto (4794 ) show
0 108 moveto (4795 ) show
0 96 moveto (4796 ) show
0 84 moveto (4797 ) show
0 72 moveto (4798 ) show
0 60 moveto (4799 ) show
0 24 moveto (Sheet 47) show
grestore
restore
showpage
%%Page: 57 57
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 3) show
0 648 moveto (4800 // Free a disk block.) show
0 636 moveto (4801 static void) show
0 624 moveto (4802 bfree\(int dev, uint b\)) show
0 612 moveto (4803 {) show
0 600 moveto (4804   struct buf *bp;) show
0 588 moveto (4805   struct superblock sb;) show
0 576 moveto (4806   int bi, m;) show
0 564 moveto (4807 ) show
0 552 moveto (4808   bzero\(dev, b\);) show
0 540 moveto (4809 ) show
0 528 moveto (4810 //  cprintf\("XXX %s\\n",__func__\);) show
0 516 moveto (4811   readsb\(dev, &sb\);) show
0 504 moveto (4812   bp = bread\(dev, BBLOCK\(b, sb.ninodes\)\);) show
0 492 moveto (4813   bi = b % BPB;) show
0 480 moveto (4814   m = 1 << \(bi % 8\);) show
0 468 moveto (4815   if\(\(bp->data[bi/8] & m\) == 0\)) show
0 456 moveto (4816     panic\("freeing free block"\);) show
0 444 moveto (4817   bp->data[bi/8] &= ~m;  // Mark block free on disk.) show
0 432 moveto (4818   bwrite\(bp\);) show
0 420 moveto (4819   brelse\(bp\);) show
0 408 moveto (4820 }) show
0 396 moveto (4821 ) show
0 384 moveto (4822 // Inodes.) show
0 372 moveto (4823 //) show
0 360 moveto (4824 // An inode is a single, unnamed file in the file system.) show
0 348 moveto (4825 // The inode disk structure holds metadata \(the type, device numbers,) show
0 336 moveto (4826 // and data size\) along with a list of blocks where the associated) show
0 324 moveto (4827 // data can be found.) show
0 312 moveto (4828 //) show
0 300 moveto (4829 // The inodes are laid out sequentially on disk immediately after) show
0 288 moveto (4830 // the superblock.  The kernel keeps a cache of the in-use) show
0 276 moveto (4831 // on-disk structures to provide a place for synchronizing access) show
0 264 moveto (4832 // to inodes shared between multiple processes.) show
0 252 moveto (4833 //) show
0 240 moveto (4834 // ip->ref counts the number of pointer references to this cached) show
0 228 moveto (4835 // inode; references are typically kept in struct file and in cp->cwd.) show
0 216 moveto (4836 // When ip->ref falls to zero, the inode is no longer cached.) show
0 204 moveto (4837 // It is an error to use an inode without holding a reference to it.) show
0 192 moveto (4838 //) show
0 180 moveto (4839 // Processes are only allowed to read and write inode) show
0 168 moveto (4840 // metadata and contents when holding the inode's lock,) show
0 156 moveto (4841 // represented by the I_BUSY flag in the in-memory copy.) show
0 144 moveto (4842 // Because inode locks are held during disk accesses,) show
0 132 moveto (4843 // they are implemented using a flag rather than with) show
0 120 moveto (4844 // spin locks.  Callers are responsible for locking) show
0 108 moveto (4845 // inodes before passing them to routines in this file; leaving) show
0 96 moveto (4846 // this responsibility with the caller makes it possible for them) show
0 84 moveto (4847 // to create arbitrarily-sized atomic operations.) show
0 72 moveto (4848 //) show
0 60 moveto (4849 // To give maximum control over locking to the callers,) show
0 24 moveto (Sheet 48) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 4) show
0 648 moveto (4850 // the routines in this file that return inode pointers) show
0 636 moveto (4851 // return pointers to *unlocked* inodes.  It is the callers') show
0 624 moveto (4852 // responsibility to lock them before using them.  A non-zero) show
0 612 moveto (4853 // ip->ref keeps these unlocked inodes in the cache.) show
0 600 moveto (4854 ) show
0 588 moveto (4855 struct {) show
0 576 moveto (4856   struct spinlock lock;) show
0 564 moveto (4857   struct inode inode[NINODE];) show
0 552 moveto (4858 } icache;) show
0 540 moveto (4859 ) show
0 528 moveto (4860 void) show
0 516 moveto (4861 iinit\(void\)) show
0 504 moveto (4862 {) show
0 492 moveto (4863   initlock\(&icache.lock, "icache.lock"\);) show
0 480 moveto (4864 }) show
0 468 moveto (4865 ) show
0 456 moveto (4866 // Find the inode with number inum on device dev) show
0 444 moveto (4867 // and return the in-memory copy.) show
0 432 moveto (4868 static struct inode*) show
0 420 moveto (4869 iget\(uint dev, uint inum\)) show
0 408 moveto (4870 {) show
0 396 moveto (4871   struct inode *ip, *empty;) show
0 384 moveto (4872 ) show
0 372 moveto (4873   acquire\(&icache.lock\);) show
0 360 moveto (4874 ) show
0 348 moveto (4875   // Try for cached inode.) show
0 336 moveto (4876   empty = 0;) show
0 324 moveto (4877   for\(ip = &icache.inode[0]; ip < &icache.inode[NINODE]; ip++\){) show
0 312 moveto (4878     if\(ip->ref > 0 && ip->dev == dev && ip->inum == inum\){) show
0 300 moveto (4879       ip->ref++;) show
0 288 moveto (4880       release\(&icache.lock\);) show
0 276 moveto (4881 //      cprintf\("XXX iget: found in cache\\n"\);) show
0 264 moveto (4882       return ip;) show
0 252 moveto (4883     }) show
0 240 moveto (4884     if\(empty == 0 && ip->ref == 0\)    // Remember empty slot.) show
0 228 moveto (4885       empty = ip;) show
0 216 moveto (4886   }) show
0 204 moveto (4887 ) show
0 192 moveto (4888   // Allocate fresh inode.) show
0 180 moveto (4889   if\(empty == 0\)) show
0 168 moveto (4890     panic\("iget: no inodes"\);) show
0 156 moveto (4891 ) show
0 144 moveto (4892 //  cprintf\("XXX iget: allocating new\\n"\);) show
0 132 moveto (4893   ip = empty;) show
0 120 moveto (4894   ip->dev = dev;) show
0 108 moveto (4895   ip->inum = inum;) show
0 96 moveto (4896   ip->ref = 1;) show
0 84 moveto (4897   ip->flags = 0;) show
0 72 moveto (4898   release\(&icache.lock\);) show
0 60 moveto (4899 ) show
0 24 moveto (Sheet 48) show
grestore
restore
showpage
%%Page: 58 58
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 5) show
0 648 moveto (4900   return ip;) show
0 636 moveto (4901 }) show
0 624 moveto (4902 ) show
0 612 moveto (4903 // Increment reference count for ip.) show
0 600 moveto (4904 // Returns ip to enable ip = idup\(ip1\) idiom.) show
0 588 moveto (4905 struct inode*) show
0 576 moveto (4906 idup\(struct inode *ip\)) show
0 564 moveto (4907 {) show
0 552 moveto (4908   acquire\(&icache.lock\);) show
0 540 moveto (4909   ip->ref++;) show
0 528 moveto (4910   release\(&icache.lock\);) show
0 516 moveto (4911   return ip;) show
0 504 moveto (4912 }) show
0 492 moveto (4913 ) show
0 480 moveto (4914 // Lock the given inode.) show
0 468 moveto (4915 void) show
0 456 moveto (4916 ilock\(struct inode *ip\)) show
0 444 moveto (4917 {) show
0 432 moveto (4918   struct buf *bp;) show
0 420 moveto (4919   struct dinode *dip;) show
0 408 moveto (4920 ) show
0 396 moveto (4921   if\(ip == 0 || ip->ref < 1\)) show
0 384 moveto (4922     panic\("ilock"\);) show
0 372 moveto (4923 ) show
0 360 moveto (4924   acquire\(&icache.lock\);) show
0 348 moveto (4925   while\(ip->flags & I_BUSY\)) show
0 336 moveto (4926     sleep\(ip, &icache.lock\);) show
0 324 moveto (4927   ip->flags |= I_BUSY;) show
0 312 moveto (4928   release\(&icache.lock\);) show
0 300 moveto (4929 ) show
0 288 moveto (4930   if\(!\(ip->flags & I_VALID\)\){) show
0 276 moveto (4931     bp = bread\(ip->dev, IBLOCK\(ip->inum\)\);) show
0 264 moveto (4932 //  cprintf\("XXX %s:after bread \\n",__func__\);) show
0 252 moveto (4933     dip = \(struct dinode*\)bp->data + ip->inum%IPB;) show
0 240 moveto (4934     ip->type = dip->type;) show
0 228 moveto (4935     ip->major = dip->major;) show
0 216 moveto (4936     ip->minor = dip->minor;) show
0 204 moveto (4937     ip->nlink = dip->nlink;) show
0 192 moveto (4938     ip->size = dip->size;) show
0 180 moveto (4939     memmove\(ip->addrs, dip->addrs, sizeof\(ip->addrs\)\);) show
0 168 moveto (4940     brelse\(bp\);) show
0 156 moveto (4941     ip->flags |= I_VALID;) show
0 144 moveto (4942     if\(ip->type == 0\)) show
0 132 moveto (4943       panic\("ilock: no type"\);) show
0 120 moveto (4944   }) show
0 108 moveto (4945 }) show
0 96 moveto (4946 ) show
0 84 moveto (4947 ) show
0 72 moveto (4948 ) show
0 60 moveto (4949 ) show
0 24 moveto (Sheet 49) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 6) show
0 648 moveto (4950 // Unlock the given inode.) show
0 636 moveto (4951 void) show
0 624 moveto (4952 iunlock\(struct inode *ip\)) show
0 612 moveto (4953 {) show
0 600 moveto (4954   if\(ip == 0 || !\(ip->flags & I_BUSY\) || ip->ref < 1\)) show
0 588 moveto (4955     panic\("iunlock"\);) show
0 576 moveto (4956 ) show
0 564 moveto (4957   acquire\(&icache.lock\);) show
0 552 moveto (4958   ip->flags &= ~I_BUSY;) show
0 540 moveto (4959   wakeup\(ip\);) show
0 528 moveto (4960   release\(&icache.lock\);) show
0 516 moveto (4961 }) show
0 504 moveto (4962 ) show
0 492 moveto (4963 // Caller holds reference to unlocked ip.  Drop reference.) show
0 480 moveto (4964 void) show
0 468 moveto (4965 iput\(struct inode *ip\)) show
0 456 moveto (4966 {) show
0 444 moveto (4967   acquire\(&icache.lock\);) show
0 432 moveto (4968   if\(ip->ref == 1 && \(ip->flags & I_VALID\) && ip->nlink == 0\){) show
0 420 moveto (4969     // inode is no longer used: truncate and free inode.) show
0 408 moveto (4970     if\(ip->flags & I_BUSY\)) show
0 396 moveto (4971       panic\("iput busy"\);) show
0 384 moveto (4972     ip->flags |= I_BUSY;) show
0 372 moveto (4973     release\(&icache.lock\);) show
0 360 moveto (4974     itrunc\(ip\);) show
0 348 moveto (4975     ip->type = 0;) show
0 336 moveto (4976     iupdate\(ip\);) show
0 324 moveto (4977     acquire\(&icache.lock\);) show
0 312 moveto (4978     ip->flags &= ~I_BUSY;) show
0 300 moveto (4979     wakeup\(ip\);) show
0 288 moveto (4980   }) show
0 276 moveto (4981   ip->ref--;) show
0 264 moveto (4982   release\(&icache.lock\);) show
0 252 moveto (4983 }) show
0 240 moveto (4984 ) show
0 228 moveto (4985 // Common idiom: unlock, then put.) show
0 216 moveto (4986 void) show
0 204 moveto (4987 iunlockput\(struct inode *ip\)) show
0 192 moveto (4988 {) show
0 180 moveto (4989   iunlock\(ip\);) show
0 168 moveto (4990   iput\(ip\);) show
0 156 moveto (4991 }) show
0 144 moveto (4992 ) show
0 132 moveto (4993 ) show
0 120 moveto (4994 ) show
0 108 moveto (4995 ) show
0 96 moveto (4996 ) show
0 84 moveto (4997 ) show
0 72 moveto (4998 ) show
0 60 moveto (4999 ) show
0 24 moveto (Sheet 49) show
grestore
restore
showpage
%%Page: 59 59
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 7) show
0 648 moveto (5000 // Allocate a new inode with the given type on device dev.) show
0 636 moveto (5001 struct inode*) show
0 624 moveto (5002 ialloc\(uint dev, short type\)) show
0 612 moveto (5003 {) show
0 600 moveto (5004   int inum;) show
0 588 moveto (5005   struct buf *bp;) show
0 576 moveto (5006   struct dinode *dip;) show
0 564 moveto (5007   struct superblock sb;) show
0 552 moveto (5008 ) show
0 540 moveto (5009 //  cprintf\("XXX %s\\n",__func__\);) show
0 528 moveto (5010   readsb\(dev, &sb\);) show
0 516 moveto (5011   for\(inum = 1; inum < sb.ninodes; inum++\){  // loop over inode blocks) show
0 504 moveto (5012     bp = bread\(dev, IBLOCK\(inum\)\);) show
0 492 moveto (5013     dip = \(struct dinode*\)bp->data + inum%IPB;) show
0 480 moveto (5014     if\(dip->type == 0\){  // a free inode) show
0 468 moveto (5015       memset\(dip, 0, sizeof\(*dip\)\);) show
0 456 moveto (5016       dip->type = type;) show
0 444 moveto (5017       bwrite\(bp\);   // mark it allocated on the disk) show
0 432 moveto (5018       brelse\(bp\);) show
0 420 moveto (5019       return iget\(dev, inum\);) show
0 408 moveto (5020     }) show
0 396 moveto (5021     brelse\(bp\);) show
0 384 moveto (5022   }) show
0 372 moveto (5023   panic\("ialloc: no inodes"\);) show
0 360 moveto (5024 }) show
0 348 moveto (5025 ) show
0 336 moveto (5026 // Copy inode, which has changed, from memory to disk.) show
0 324 moveto (5027 void) show
0 312 moveto (5028 iupdate\(struct inode *ip\)) show
0 300 moveto (5029 {) show
0 288 moveto (5030   struct buf *bp;) show
0 276 moveto (5031   struct dinode *dip;) show
0 264 moveto (5032 ) show
0 252 moveto (5033   bp = bread\(ip->dev, IBLOCK\(ip->inum\)\);) show
0 240 moveto (5034   dip = \(struct dinode*\)bp->data + ip->inum%IPB;) show
0 228 moveto (5035   dip->type = ip->type;) show
0 216 moveto (5036   dip->major = ip->major;) show
0 204 moveto (5037   dip->minor = ip->minor;) show
0 192 moveto (5038   dip->nlink = ip->nlink;) show
0 180 moveto (5039   dip->size = ip->size;) show
0 168 moveto (5040   memmove\(dip->addrs, ip->addrs, sizeof\(ip->addrs\)\);) show
0 156 moveto (5041   bwrite\(bp\);) show
0 144 moveto (5042   brelse\(bp\);) show
0 132 moveto (5043 }) show
0 120 moveto (5044 ) show
0 108 moveto (5045 ) show
0 96 moveto (5046 ) show
0 84 moveto (5047 ) show
0 72 moveto (5048 ) show
0 60 moveto (5049 ) show
0 24 moveto (Sheet 50) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 8) show
0 648 moveto (5050 // Inode contents) show
0 636 moveto (5051 //) show
0 624 moveto (5052 // The contents \(data\) associated with each inode is stored) show
0 612 moveto (5053 // in a sequence of blocks on the disk.  The first NDIRECT blocks) show
0 600 moveto (5054 // are listed in ip->addrs[].  The next NINDIRECT blocks are) show
0 588 moveto (5055 // listed in the block ip->addrs[INDIRECT].) show
0 576 moveto (5056 ) show
0 564 moveto (5057 // Return the disk block address of the nth block in inode ip.) show
0 552 moveto (5058 // If there is no such block, alloc controls whether one is allocated.) show
0 540 moveto (5059 static uint) show
0 528 moveto (5060 bmap\(struct inode *ip, uint bn, int alloc\)) show
0 516 moveto (5061 {) show
0 504 moveto (5062   uint addr, *a;) show
0 492 moveto (5063   struct buf *bp;) show
0 480 moveto (5064 ) show
0 468 moveto (5065   if\(bn < NDIRECT\){) show
0 456 moveto (5066     if\(\(addr = ip->addrs[bn]\) == 0\){) show
0 444 moveto (5067       if\(!alloc\)) show
0 432 moveto (5068         return -1;) show
0 420 moveto (5069       ip->addrs[bn] = addr = balloc\(ip->dev\);) show
0 408 moveto (5070     }) show
0 396 moveto (5071     return addr;) show
0 384 moveto (5072   }) show
0 372 moveto (5073   bn -= NDIRECT;) show
0 360 moveto (5074 ) show
0 348 moveto (5075   if\(bn < NINDIRECT\){) show
0 336 moveto (5076     // Load indirect block, allocating if necessary.) show
0 324 moveto (5077     if\(\(addr = ip->addrs[INDIRECT]\) == 0\){) show
0 312 moveto (5078       if\(!alloc\)) show
0 300 moveto (5079         return -1;) show
0 288 moveto (5080       ip->addrs[INDIRECT] = addr = balloc\(ip->dev\);) show
0 276 moveto (5081     }) show
0 264 moveto (5082     bp = bread\(ip->dev, addr\);) show
0 252 moveto (5083     a = \(uint*\)bp->data;) show
0 240 moveto (5084 ) show
0 228 moveto (5085     if\(\(addr = a[bn]\) == 0\){) show
0 216 moveto (5086       if\(!alloc\){) show
0 204 moveto (5087         brelse\(bp\);) show
0 192 moveto (5088         return -1;) show
0 180 moveto (5089       }) show
0 168 moveto (5090       a[bn] = addr = balloc\(ip->dev\);) show
0 156 moveto (5091       bwrite\(bp\);) show
0 144 moveto (5092     }) show
0 132 moveto (5093     brelse\(bp\);) show
0 120 moveto (5094     return addr;) show
0 108 moveto (5095   }) show
0 96 moveto (5096 ) show
0 84 moveto (5097   panic\("bmap: out of range"\);) show
0 72 moveto (5098 }) show
0 60 moveto (5099 ) show
0 24 moveto (Sheet 50) show
grestore
restore
showpage
%%Page: 60 60
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 9) show
0 648 moveto (5100 // Truncate inode \(discard contents\).) show
0 636 moveto (5101 static void) show
0 624 moveto (5102 itrunc\(struct inode *ip\)) show
0 612 moveto (5103 {) show
0 600 moveto (5104   int i, j;) show
0 588 moveto (5105   struct buf *bp;) show
0 576 moveto (5106   uint *a;) show
0 564 moveto (5107 ) show
0 552 moveto (5108   for\(i = 0; i < NDIRECT; i++\){) show
0 540 moveto (5109     if\(ip->addrs[i]\){) show
0 528 moveto (5110       bfree\(ip->dev, ip->addrs[i]\);) show
0 516 moveto (5111       ip->addrs[i] = 0;) show
0 504 moveto (5112     }) show
0 492 moveto (5113   }) show
0 480 moveto (5114 ) show
0 468 moveto (5115   if\(ip->addrs[INDIRECT]\){) show
0 456 moveto (5116     bp = bread\(ip->dev, ip->addrs[INDIRECT]\);) show
0 444 moveto (5117     a = \(uint*\)bp->data;) show
0 432 moveto (5118     for\(j = 0; j < NINDIRECT; j++\){) show
0 420 moveto (5119       if\(a[j]\)) show
0 408 moveto (5120         bfree\(ip->dev, a[j]\);) show
0 396 moveto (5121     }) show
0 384 moveto (5122     brelse\(bp\);) show
0 372 moveto (5123     ip->addrs[INDIRECT] = 0;) show
0 360 moveto (5124   }) show
0 348 moveto (5125 ) show
0 336 moveto (5126   ip->size = 0;) show
0 324 moveto (5127   iupdate\(ip\);) show
0 312 moveto (5128 }) show
0 300 moveto (5129 ) show
0 288 moveto (5130 // Copy stat information from inode.) show
0 276 moveto (5131 void) show
0 264 moveto (5132 stati\(struct inode *ip, struct stat *st\)) show
0 252 moveto (5133 {) show
0 240 moveto (5134   st->dev = ip->dev;) show
0 228 moveto (5135   st->ino = ip->inum;) show
0 216 moveto (5136   st->type = ip->type;) show
0 204 moveto (5137   st->nlink = ip->nlink;) show
0 192 moveto (5138   st->size = ip->size;) show
0 180 moveto (5139 }) show
0 168 moveto (5140 ) show
0 156 moveto (5141 ) show
0 144 moveto (5142 ) show
0 132 moveto (5143 ) show
0 120 moveto (5144 ) show
0 108 moveto (5145 ) show
0 96 moveto (5146 ) show
0 84 moveto (5147 ) show
0 72 moveto (5148 ) show
0 60 moveto (5149 ) show
0 24 moveto (Sheet 51) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 10) show
0 648 moveto (5150 // Read data from inode.) show
0 636 moveto (5151 int) show
0 624 moveto (5152 readi\(struct inode *ip, char *dst, uint off, uint n\)) show
0 612 moveto (5153 {) show
0 600 moveto (5154   uint tot, m;) show
0 588 moveto (5155   struct buf *bp;) show
0 576 moveto (5156 ) show
0 564 moveto (5157 //  cprintf\("XXX readi %d.%d\\n", ip->dev, ip->inum\);) show
0 552 moveto (5158   if\(ip->type == T_DEV\){) show
0 540 moveto (5159     if\(ip->major < 0 || ip->major >= NDEV || !devsw[ip->major].read\)) show
0 528 moveto (5160       return -1;) show
0 516 moveto (5161     return devsw[ip->major].read\(ip, dst, n\);) show
0 504 moveto (5162   }) show
0 492 moveto (5163 ) show
0 480 moveto (5164   if\(off > ip->size || off + n < off\)) show
0 468 moveto (5165     return -1;) show
0 456 moveto (5166   if\(off + n > ip->size\)) show
0 444 moveto (5167     n = ip->size - off;) show
0 432 moveto (5168 ) show
0 420 moveto (5169   for\(tot=0; tot<n; tot+=m, off+=m, dst+=m\){) show
0 408 moveto (5170     bp = bread\(ip->dev, bmap\(ip, off/BSIZE, 0\)\);) show
0 396 moveto (5171     m = min\(n - tot, BSIZE - off%BSIZE\);) show
0 384 moveto (5172     memmove\(dst, bp->data + off%BSIZE, m\);) show
0 372 moveto (5173     brelse\(bp\);) show
0 360 moveto (5174   }) show
0 348 moveto (5175   return n;) show
0 336 moveto (5176 }) show
0 324 moveto (5177 ) show
0 312 moveto (5178 // Write data to inode.) show
0 300 moveto (5179 int) show
0 288 moveto (5180 writei\(struct inode *ip, char *src, uint off, uint n\)) show
0 276 moveto (5181 {) show
0 264 moveto (5182   uint tot, m;) show
0 252 moveto (5183   struct buf *bp;) show
0 240 moveto (5184 ) show
0 228 moveto (5185   if\(ip->type == T_DEV\){) show
0 216 moveto (5186     if\(ip->major < 0 || ip->major >= NDEV || !devsw[ip->major].write\)) show
0 204 moveto (5187       return -1;) show
0 192 moveto (5188     return devsw[ip->major].write\(ip, src, n\);) show
0 180 moveto (5189   }) show
0 168 moveto (5190 ) show
0 156 moveto (5191   if\(off + n < off\)) show
0 144 moveto (5192     return -1;) show
0 132 moveto (5193   if\(off + n > MAXFILE*BSIZE\)) show
0 120 moveto (5194     n = MAXFILE*BSIZE - off;) show
0 108 moveto (5195 ) show
0 96 moveto (5196 ) show
0 84 moveto (5197 ) show
0 72 moveto (5198 ) show
0 60 moveto (5199 ) show
0 24 moveto (Sheet 51) show
grestore
restore
showpage
%%Page: 61 61
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 11) show
0 648 moveto (5200   for\(tot=0; tot<n; tot+=m, off+=m, src+=m\){) show
0 636 moveto (5201     bp = bread\(ip->dev, bmap\(ip, off/BSIZE, 1\)\);) show
0 624 moveto (5202     m = min\(n - tot, BSIZE - off%BSIZE\);) show
0 612 moveto (5203     memmove\(bp->data + off%BSIZE, src, m\);) show
0 600 moveto (5204     bwrite\(bp\);) show
0 588 moveto (5205     brelse\(bp\);) show
0 576 moveto (5206   }) show
0 564 moveto (5207 ) show
0 552 moveto (5208   if\(n > 0 && off > ip->size\){) show
0 540 moveto (5209     ip->size = off;) show
0 528 moveto (5210     iupdate\(ip\);) show
0 516 moveto (5211   }) show
0 504 moveto (5212   return n;) show
0 492 moveto (5213 }) show
0 480 moveto (5214 ) show
0 468 moveto (5215 // Directories) show
0 456 moveto (5216 ) show
0 444 moveto (5217 int) show
0 432 moveto (5218 namecmp\(const char *s, const char *t\)) show
0 420 moveto (5219 {) show
0 408 moveto (5220   return strncmp\(s, t, DIRSIZ\);) show
0 396 moveto (5221 }) show
0 384 moveto (5222 ) show
0 372 moveto (5223 // Look for a directory entry in a directory.) show
0 360 moveto (5224 // If found, set *poff to byte offset of entry.) show
0 348 moveto (5225 // Caller must have already locked dp.) show
0 336 moveto (5226 struct inode*) show
0 324 moveto (5227 dirlookup\(struct inode *dp, char *name, uint *poff\)) show
0 312 moveto (5228 {) show
0 300 moveto (5229   uint off, inum;) show
0 288 moveto (5230   struct buf *bp;) show
0 276 moveto (5231   struct dirent *de;) show
0 264 moveto (5232 ) show
0 252 moveto (5233   if\(dp->type != T_DIR\)) show
0 240 moveto (5234     panic\("dirlookup not DIR"\);) show
0 228 moveto (5235 ) show
0 216 moveto (5236   for\(off = 0; off < dp->size; off += BSIZE\){) show
0 204 moveto (5237     bp = bread\(dp->dev, bmap\(dp, off / BSIZE, 0\)\);) show
0 192 moveto (5238     for\(de = \(struct dirent*\)bp->data;) show
0 180 moveto (5239         de < \(struct dirent*\)\(bp->data + BSIZE\);) show
0 168 moveto (5240         de++\){) show
0 156 moveto (5241       if\(de->inum == 0\)) show
0 144 moveto (5242         continue;) show
0 132 moveto (5243       if\(namecmp\(name, de->name\) == 0\){) show
0 120 moveto (5244         // entry matches path element) show
0 108 moveto (5245         if\(poff\)) show
0 96 moveto (5246           *poff = off + \(uchar*\)de - bp->data;) show
0 84 moveto (5247         inum = de->inum;) show
0 72 moveto (5248         brelse\(bp\);) show
0 60 moveto (5249         return iget\(dp->dev, inum\);) show
0 24 moveto (Sheet 52) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 12) show
0 648 moveto (5250       }) show
0 636 moveto (5251     }) show
0 624 moveto (5252     brelse\(bp\);) show
0 612 moveto (5253   }) show
0 600 moveto (5254   return 0;) show
0 588 moveto (5255 }) show
0 576 moveto (5256 ) show
0 564 moveto (5257 // Write a new directory entry \(name, ino\) into the directory dp.) show
0 552 moveto (5258 int) show
0 540 moveto (5259 dirlink\(struct inode *dp, char *name, uint ino\)) show
0 528 moveto (5260 {) show
0 516 moveto (5261   int off;) show
0 504 moveto (5262   struct dirent de;) show
0 492 moveto (5263   struct inode *ip;) show
0 480 moveto (5264 ) show
0 468 moveto (5265   // Check that name is not present.) show
0 456 moveto (5266   if\(\(ip = dirlookup\(dp, name, 0\)\) != 0\){) show
0 444 moveto (5267     iput\(ip\);) show
0 432 moveto (5268     return -1;) show
0 420 moveto (5269   }) show
0 408 moveto (5270 ) show
0 396 moveto (5271   // Look for an empty dirent.) show
0 384 moveto (5272   for\(off = 0; off < dp->size; off += sizeof\(de\)\){) show
0 372 moveto (5273     if\(readi\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 360 moveto (5274       panic\("dirlink read"\);) show
0 348 moveto (5275     if\(de.inum == 0\)) show
0 336 moveto (5276       break;) show
0 324 moveto (5277   }) show
0 312 moveto (5278 ) show
0 300 moveto (5279   strncpy\(de.name, name, DIRSIZ\);) show
0 288 moveto (5280   de.inum = ino;) show
0 276 moveto (5281   if\(writei\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 264 moveto (5282     panic\("dirlink"\);) show
0 252 moveto (5283 ) show
0 240 moveto (5284   return 0;) show
0 228 moveto (5285 }) show
0 216 moveto (5286 ) show
0 204 moveto (5287 ) show
0 192 moveto (5288 ) show
0 180 moveto (5289 ) show
0 168 moveto (5290 ) show
0 156 moveto (5291 ) show
0 144 moveto (5292 ) show
0 132 moveto (5293 ) show
0 120 moveto (5294 ) show
0 108 moveto (5295 ) show
0 96 moveto (5296 ) show
0 84 moveto (5297 ) show
0 72 moveto (5298 ) show
0 60 moveto (5299 ) show
0 24 moveto (Sheet 52) show
grestore
restore
showpage
%%Page: 62 62
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 13) show
0 648 moveto (5300 // Paths) show
0 636 moveto (5301 ) show
0 624 moveto (5302 // Copy the next path element from path into name.) show
0 612 moveto (5303 // Return a pointer to the element following the copied one.) show
0 600 moveto (5304 // The returned path has no leading slashes,) show
0 588 moveto (5305 // so the caller can check *path=='\\0' to see if the name is the last one.) show
0 576 moveto (5306 // If no name to remove, return 0.) show
0 564 moveto (5307 //) show
0 552 moveto (5308 // Examples:) show
0 540 moveto (5309 //   skipelem\("a/bb/c", name\) = "bb/c", setting name = "a") show
0 528 moveto (5310 //   skipelem\("///a//bb", name\) = "bb", setting name = "a") show
0 516 moveto (5311 //   skipelem\("", name\) = skipelem\("////", name\) = 0) show
0 504 moveto (5312 //) show
0 492 moveto (5313 static char*) show
0 480 moveto (5314 skipelem\(char *path, char *name\)) show
0 468 moveto (5315 {) show
0 456 moveto (5316   char *s;) show
0 444 moveto (5317   int len;) show
0 432 moveto (5318 ) show
0 420 moveto (5319   while\(*path == '/'\)) show
0 408 moveto (5320     path++;) show
0 396 moveto (5321   if\(*path == 0\)) show
0 384 moveto (5322     return 0;) show
0 372 moveto (5323   s = path;) show
0 360 moveto (5324   while\(*path != '/' && *path != 0\)) show
0 348 moveto (5325     path++;) show
0 336 moveto (5326   len = path - s;) show
0 324 moveto (5327   if\(len >= DIRSIZ\)) show
0 312 moveto (5328     memmove\(name, s, DIRSIZ\);) show
0 300 moveto (5329   else {) show
0 288 moveto (5330     memmove\(name, s, len\);) show
0 276 moveto (5331     name[len] = 0;) show
0 264 moveto (5332   }) show
0 252 moveto (5333   while\(*path == '/'\)) show
0 240 moveto (5334     path++;) show
0 228 moveto (5335   return path;) show
0 216 moveto (5336 }) show
0 204 moveto (5337 ) show
0 192 moveto (5338 ) show
0 180 moveto (5339 ) show
0 168 moveto (5340 ) show
0 156 moveto (5341 ) show
0 144 moveto (5342 ) show
0 132 moveto (5343 ) show
0 120 moveto (5344 ) show
0 108 moveto (5345 ) show
0 96 moveto (5346 ) show
0 84 moveto (5347 ) show
0 72 moveto (5348 ) show
0 60 moveto (5349 ) show
0 24 moveto (Sheet 53) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 14) show
0 648 moveto (5350 // Look up and return the inode for a path name.) show
0 636 moveto (5351 // If parent != 0, return the inode for the parent and copy the final) show
0 624 moveto (5352 // path element into name, which must have room for DIRSIZ bytes.) show
0 612 moveto (5353 static struct inode*) show
0 600 moveto (5354 _namei\(char *path, int parent, char *name\)) show
0 588 moveto (5355 {) show
0 576 moveto (5356   struct inode *ip, *next;) show
0 564 moveto (5357 ) show
0 552 moveto (5358 //  cprintf\("XXX _namei %s\\n", path\);) show
0 540 moveto (5359   if\(*path == '/'\)) show
0 528 moveto (5360     ip = iget\(ROOTDEV, 1\);) show
0 516 moveto (5361   else) show
0 504 moveto (5362     ip = idup\(cp->cwd\);) show
0 492 moveto (5363 ) show
0 480 moveto (5364   while\(\(path = skipelem\(path, name\)\) != 0\){) show
0 468 moveto (5365 //    cprintf\("XXX ready to ilock\\n"\);) show
0 456 moveto (5366     ilock\(ip\);) show
0 444 moveto (5367 //    cprintf\("XXX here %d\\n", ip->type\);) show
0 432 moveto (5368     if\(ip->type != T_DIR\){) show
0 420 moveto (5369       iunlockput\(ip\);) show
0 408 moveto (5370       return 0;) show
0 396 moveto (5371     }) show
0 384 moveto (5372     if\(parent && *path == '\\0'\){) show
0 372 moveto (5373       // Stop one level early.) show
0 360 moveto (5374       iunlock\(ip\);) show
0 348 moveto (5375       return ip;) show
0 336 moveto (5376     }) show
0 324 moveto (5377     if\(\(next = dirlookup\(ip, name, 0\)\) == 0\){) show
0 312 moveto (5378       iunlockput\(ip\);) show
0 300 moveto (5379       return 0;) show
0 288 moveto (5380     }) show
0 276 moveto (5381     iunlockput\(ip\);) show
0 264 moveto (5382     ip = next;) show
0 252 moveto (5383   }) show
0 240 moveto (5384   if\(parent\){) show
0 228 moveto (5385     iput\(ip\);) show
0 216 moveto (5386     return 0;) show
0 204 moveto (5387   }) show
0 192 moveto (5388   return ip;) show
0 180 moveto (5389 }) show
0 168 moveto (5390 ) show
0 156 moveto (5391 struct inode*) show
0 144 moveto (5392 namei\(char *path\)) show
0 132 moveto (5393 {) show
0 120 moveto (5394   char name[DIRSIZ];) show
0 108 moveto (5395   return _namei\(path, 0, name\);) show
0 96 moveto (5396 }) show
0 84 moveto (5397 ) show
0 72 moveto (5398 ) show
0 60 moveto (5399 ) show
0 24 moveto (Sheet 53) show
grestore
restore
showpage
%%Page: 63 63
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/fs.c  Page 15) show
0 648 moveto (5400 struct inode*) show
0 636 moveto (5401 nameiparent\(char *path, char *name\)) show
0 624 moveto (5402 {) show
0 612 moveto (5403   return _namei\(path, 1, name\);) show
0 600 moveto (5404 }) show
0 588 moveto (5405 ) show
0 576 moveto (5406 ) show
0 564 moveto (5407 ) show
0 552 moveto (5408 ) show
0 540 moveto (5409 ) show
0 528 moveto (5410 ) show
0 516 moveto (5411 ) show
0 504 moveto (5412 ) show
0 492 moveto (5413 ) show
0 480 moveto (5414 ) show
0 468 moveto (5415 ) show
0 456 moveto (5416 ) show
0 444 moveto (5417 ) show
0 432 moveto (5418 ) show
0 420 moveto (5419 ) show
0 408 moveto (5420 ) show
0 396 moveto (5421 ) show
0 384 moveto (5422 ) show
0 372 moveto (5423 ) show
0 360 moveto (5424 ) show
0 348 moveto (5425 ) show
0 336 moveto (5426 ) show
0 324 moveto (5427 ) show
0 312 moveto (5428 ) show
0 300 moveto (5429 ) show
0 288 moveto (5430 ) show
0 276 moveto (5431 ) show
0 264 moveto (5432 ) show
0 252 moveto (5433 ) show
0 240 moveto (5434 ) show
0 228 moveto (5435 ) show
0 216 moveto (5436 ) show
0 204 moveto (5437 ) show
0 192 moveto (5438 ) show
0 180 moveto (5439 ) show
0 168 moveto (5440 ) show
0 156 moveto (5441 ) show
0 144 moveto (5442 ) show
0 132 moveto (5443 ) show
0 120 moveto (5444 ) show
0 108 moveto (5445 ) show
0 96 moveto (5446 ) show
0 84 moveto (5447 ) show
0 72 moveto (5448 ) show
0 60 moveto (5449 ) show
0 24 moveto (Sheet 54) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/file.c  Page 1) show
0 648 moveto (5450 #include "types.h") show
0 636 moveto (5451 #include "defs.h") show
0 624 moveto (5452 #include "param.h") show
0 612 moveto (5453 #include "file.h") show
0 600 moveto (5454 #include "spinlock.h") show
0 588 moveto (5455 #include "dev.h") show
0 576 moveto (5456 ) show
0 564 moveto (5457 struct devsw devsw[NDEV];) show
0 552 moveto (5458 struct spinlock file_table_lock;) show
0 540 moveto (5459 struct file file[NFILE];) show
0 528 moveto (5460 ) show
0 516 moveto (5461 void) show
0 504 moveto (5462 fileinit\(void\)) show
0 492 moveto (5463 {) show
0 480 moveto (5464   initlock\(&file_table_lock, "file_table"\);) show
0 468 moveto (5465 }) show
0 456 moveto (5466 ) show
0 444 moveto (5467 // Allocate a file structure.) show
0 432 moveto (5468 struct file*) show
0 420 moveto (5469 filealloc\(void\)) show
0 408 moveto (5470 {) show
0 396 moveto (5471   int i;) show
0 384 moveto (5472 ) show
0 372 moveto (5473   acquire\(&file_table_lock\);) show
0 360 moveto (5474   for\(i = 0; i < NFILE; i++\){) show
0 348 moveto (5475     if\(file[i].type == FD_CLOSED\){) show
0 336 moveto (5476       file[i].type = FD_NONE;) show
0 324 moveto (5477       file[i].ref = 1;) show
0 312 moveto (5478       release\(&file_table_lock\);) show
0 300 moveto (5479       return file + i;) show
0 288 moveto (5480     }) show
0 276 moveto (5481   }) show
0 264 moveto (5482   release\(&file_table_lock\);) show
0 252 moveto (5483   return 0;) show
0 240 moveto (5484 }) show
0 228 moveto (5485 ) show
0 216 moveto (5486 // Increment ref count for file f.) show
0 204 moveto (5487 struct file*) show
0 192 moveto (5488 filedup\(struct file *f\)) show
0 180 moveto (5489 {) show
0 168 moveto (5490   acquire\(&file_table_lock\);) show
0 156 moveto (5491   if\(f->ref < 1 || f->type == FD_CLOSED\)) show
0 144 moveto (5492     panic\("filedup"\);) show
0 132 moveto (5493   f->ref++;) show
0 120 moveto (5494   release\(&file_table_lock\);) show
0 108 moveto (5495   return f;) show
0 96 moveto (5496 }) show
0 84 moveto (5497 ) show
0 72 moveto (5498 ) show
0 60 moveto (5499 ) show
0 24 moveto (Sheet 54) show
grestore
restore
showpage
%%Page: 64 64
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/file.c  Page 2) show
0 648 moveto (5500 // Close file f.  \(Decrement ref count, close when reaches 0.\)) show
0 636 moveto (5501 void) show
0 624 moveto (5502 fileclose\(struct file *f\)) show
0 612 moveto (5503 {) show
0 600 moveto (5504   struct file ff;) show
0 588 moveto (5505 ) show
0 576 moveto (5506   acquire\(&file_table_lock\);) show
0 564 moveto (5507   if\(f->ref < 1 || f->type == FD_CLOSED\)) show
0 552 moveto (5508   {) show
0 540 moveto (5509       cprintf\("ref: %d type: %d\\n", f->ref, f->type\);) show
0 528 moveto (5510       panic\("fileclose: file closed"\);) show
0 516 moveto (5511   }) show
0 504 moveto (5512   if\(--f->ref > 0\){) show
0 492 moveto (5513     release\(&file_table_lock\);) show
0 480 moveto (5514     return;) show
0 468 moveto (5515   }) show
0 456 moveto (5516   ff = *f;) show
0 444 moveto (5517   f->ref = 0;) show
0 432 moveto (5518   f->type = FD_CLOSED;) show
0 420 moveto (5519   release\(&file_table_lock\);) show
0 408 moveto (5520 ) show
0 396 moveto (5521   if\(ff.type == FD_PIPE\)) show
0 384 moveto (5522     pipeclose\(ff.pipe, ff.writable\);) show
0 372 moveto (5523   else if\(ff.type == FD_INODE\)) show
0 360 moveto (5524     iput\(ff.ip\);) show
0 348 moveto (5525   else) show
0 336 moveto (5526   {) show
0 324 moveto (5527       cprintf\("type: %d\\n"\);) show
0 312 moveto (5528       panic\("fileclose: file type error"\);) show
0 300 moveto (5529   }) show
0 288 moveto (5530 }) show
0 276 moveto (5531 ) show
0 264 moveto (5532 // Get metadata about file f.) show
0 252 moveto (5533 int) show
0 240 moveto (5534 filestat\(struct file *f, struct stat *st\)) show
0 228 moveto (5535 {) show
0 216 moveto (5536   if\(f->type == FD_INODE\){) show
0 204 moveto (5537     ilock\(f->ip\);) show
0 192 moveto (5538     stati\(f->ip, st\);) show
0 180 moveto (5539     iunlock\(f->ip\);) show
0 168 moveto (5540     return 0;) show
0 156 moveto (5541   }) show
0 144 moveto (5542   return -1;) show
0 132 moveto (5543 }) show
0 120 moveto (5544 ) show
0 108 moveto (5545 ) show
0 96 moveto (5546 ) show
0 84 moveto (5547 ) show
0 72 moveto (5548 ) show
0 60 moveto (5549 ) show
0 24 moveto (Sheet 55) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/file.c  Page 3) show
0 648 moveto (5550 // Read from file f.  Addr is kernel address.) show
0 636 moveto (5551 int) show
0 624 moveto (5552 fileread\(struct file *f, char *addr, int n\)) show
0 612 moveto (5553 {) show
0 600 moveto (5554   int r;) show
0 588 moveto (5555 ) show
0 576 moveto (5556   if\(f->readable == 0\)) show
0 564 moveto (5557     return -1;) show
0 552 moveto (5558   if\(f->type == FD_PIPE\)) show
0 540 moveto (5559     return piperead\(f->pipe, addr, n\);) show
0 528 moveto (5560   if\(f->type == FD_INODE\){) show
0 516 moveto (5561     ilock\(f->ip\);) show
0 504 moveto (5562     if\(\(r = readi\(f->ip, addr, f->off, n\)\) > 0\)) show
0 492 moveto (5563       f->off += r;) show
0 480 moveto (5564     iunlock\(f->ip\);) show
0 468 moveto (5565     return r;) show
0 456 moveto (5566   }) show
0 444 moveto (5567   panic\("fileread"\);) show
0 432 moveto (5568 }) show
0 420 moveto (5569 ) show
0 408 moveto (5570 // Write to file f.  Addr is kernel address.) show
0 396 moveto (5571 int) show
0 384 moveto (5572 filewrite\(struct file *f, char *addr, int n\)) show
0 372 moveto (5573 {) show
0 360 moveto (5574   int r;) show
0 348 moveto (5575 ) show
0 336 moveto (5576   if\(f->writable == 0\)) show
0 324 moveto (5577     return -1;) show
0 312 moveto (5578   if\(f->type == FD_PIPE\)) show
0 300 moveto (5579     return pipewrite\(f->pipe, addr, n\);) show
0 288 moveto (5580   if\(f->type == FD_INODE\){) show
0 276 moveto (5581     ilock\(f->ip\);) show
0 264 moveto (5582     if\(\(r = writei\(f->ip, addr, f->off, n\)\) > 0\)) show
0 252 moveto (5583       f->off += r;) show
0 240 moveto (5584     iunlock\(f->ip\);) show
0 228 moveto (5585     return r;) show
0 216 moveto (5586   }) show
0 204 moveto (5587   panic\("filewrite"\);) show
0 192 moveto (5588 }) show
0 180 moveto (5589 ) show
0 168 moveto (5590 ) show
0 156 moveto (5591 ) show
0 144 moveto (5592 ) show
0 132 moveto (5593 ) show
0 120 moveto (5594 ) show
0 108 moveto (5595 ) show
0 96 moveto (5596 ) show
0 84 moveto (5597 ) show
0 72 moveto (5598 ) show
0 60 moveto (5599 ) show
0 24 moveto (Sheet 55) show
grestore
restore
showpage
%%Page: 65 65
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 1) show
0 648 moveto (5600 #include "types.h") show
0 636 moveto (5601 #include "defs.h") show
0 624 moveto (5602 #include "param.h") show
0 612 moveto (5603 #include "stat.h") show
0 600 moveto (5604 #include "mmu.h") show
0 588 moveto (5605 #include "proc.h") show
0 576 moveto (5606 #include "fs.h") show
0 564 moveto (5607 #include "fsvar.h") show
0 552 moveto (5608 #include "file.h") show
0 540 moveto (5609 #include "fcntl.h") show
0 528 moveto (5610 ) show
0 516 moveto (5611 // Fetch the nth word-sized system call argument as a file descriptor) show
0 504 moveto (5612 // and return both the descriptor and the corresponding struct file.) show
0 492 moveto (5613 static int) show
0 480 moveto (5614 argfd\(int n, int *pfd, struct file **pf\)) show
0 468 moveto (5615 {) show
0 456 moveto (5616   int fd;) show
0 444 moveto (5617   struct file *f;) show
0 432 moveto (5618 ) show
0 420 moveto (5619   if\(argint\(n, &fd\) < 0\)) show
0 408 moveto (5620     return -1;) show
0 396 moveto (5621   if\(fd < 0 || fd >= NOFILE || \(f=cp->ofile[fd]\) == 0\)) show
0 384 moveto (5622     return -1;) show
0 372 moveto (5623   if\(pfd\)) show
0 360 moveto (5624     *pfd = fd;) show
0 348 moveto (5625   if\(pf\)) show
0 336 moveto (5626     *pf = f;) show
0 324 moveto (5627   return 0;) show
0 312 moveto (5628 }) show
0 300 moveto (5629 ) show
0 288 moveto (5630 // Allocate a file descriptor for the given file.) show
0 276 moveto (5631 // Takes over file reference from caller on success.) show
0 264 moveto (5632 static int) show
0 252 moveto (5633 fdalloc\(struct file *f\)) show
0 240 moveto (5634 {) show
0 228 moveto (5635   int fd;) show
0 216 moveto (5636 ) show
0 204 moveto (5637   for\(fd = 0; fd < NOFILE; fd++\){) show
0 192 moveto (5638     if\(cp->ofile[fd] == 0\){) show
0 180 moveto (5639       cp->ofile[fd] = f;) show
0 168 moveto (5640       return fd;) show
0 156 moveto (5641     }) show
0 144 moveto (5642   }) show
0 132 moveto (5643   return -1;) show
0 120 moveto (5644 }) show
0 108 moveto (5645 ) show
0 96 moveto (5646 ) show
0 84 moveto (5647 ) show
0 72 moveto (5648 ) show
0 60 moveto (5649 ) show
0 24 moveto (Sheet 56) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 2) show
0 648 moveto (5650 int) show
0 636 moveto (5651 sys_read\(void\)) show
0 624 moveto (5652 {) show
0 612 moveto (5653   struct file *f;) show
0 600 moveto (5654   int n;) show
0 588 moveto (5655   char *cp;) show
0 576 moveto (5656 ) show
0 564 moveto (5657   if\(argfd\(0, 0, &f\) < 0 || argint\(2, &n\) < 0 || argptr\(1, &cp, n\) < 0\)) show
0 552 moveto (5658     return -1;) show
0 540 moveto (5659   return fileread\(f, cp, n\);) show
0 528 moveto (5660 }) show
0 516 moveto (5661 ) show
0 504 moveto (5662 int) show
0 492 moveto (5663 sys_write\(void\)) show
0 480 moveto (5664 {) show
0 468 moveto (5665   struct file *f;) show
0 456 moveto (5666   int n;) show
0 444 moveto (5667   char *cp;) show
0 432 moveto (5668 ) show
0 420 moveto (5669   if\(argfd\(0, 0, &f\) < 0 || argint\(2, &n\) < 0 || argptr\(1, &cp, n\) < 0\)) show
0 408 moveto (5670     return -1;) show
0 396 moveto (5671   return filewrite\(f, cp, n\);) show
0 384 moveto (5672 }) show
0 372 moveto (5673 ) show
0 360 moveto (5674 int) show
0 348 moveto (5675 sys_dup\(void\)) show
0 336 moveto (5676 {) show
0 324 moveto (5677   struct file *f;) show
0 312 moveto (5678   int fd;) show
0 300 moveto (5679 ) show
0 288 moveto (5680   if\(argfd\(0, 0, &f\) < 0\)) show
0 276 moveto (5681     return -1;) show
0 264 moveto (5682   if\(\(fd=fdalloc\(f\)\) < 0\)) show
0 252 moveto (5683     return -1;) show
0 240 moveto (5684   filedup\(f\);) show
0 228 moveto (5685   return fd;) show
0 216 moveto (5686 }) show
0 204 moveto (5687 ) show
0 192 moveto (5688 int) show
0 180 moveto (5689 sys_close\(void\)) show
0 168 moveto (5690 {) show
0 156 moveto (5691   int fd;) show
0 144 moveto (5692   struct file *f;) show
0 132 moveto (5693 ) show
0 120 moveto (5694   if\(argfd\(0, &fd, &f\) < 0\)) show
0 108 moveto (5695     return -1;) show
0 96 moveto (5696   cp->ofile[fd] = 0;) show
0 84 moveto (5697   fileclose\(f\);) show
0 72 moveto (5698   return 0;) show
0 60 moveto (5699 }) show
0 24 moveto (Sheet 56) show
grestore
restore
showpage
%%Page: 66 66
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 3) show
0 648 moveto (5700 int) show
0 636 moveto (5701 sys_fstat\(void\)) show
0 624 moveto (5702 {) show
0 612 moveto (5703   struct file *f;) show
0 600 moveto (5704   struct stat *st;) show
0 588 moveto (5705 ) show
0 576 moveto (5706   if\(argfd\(0, 0, &f\) < 0 || argptr\(1, \(void*\)&st, sizeof\(*st\)\) < 0\)) show
0 564 moveto (5707     return -1;) show
0 552 moveto (5708   return filestat\(f, st\);) show
0 540 moveto (5709 }) show
0 528 moveto (5710 ) show
0 516 moveto (5711 // Create the path new as a link to the same inode as old.) show
0 504 moveto (5712 int) show
0 492 moveto (5713 sys_link\(void\)) show
0 480 moveto (5714 {) show
0 468 moveto (5715   char name[DIRSIZ], *new, *old;) show
0 456 moveto (5716   struct inode *dp, *ip;) show
0 444 moveto (5717 ) show
0 432 moveto (5718   if\(argstr\(0, &old\) < 0 || argstr\(1, &new\) < 0\)) show
0 420 moveto (5719     return -1;) show
0 408 moveto (5720   if\(\(ip = namei\(old\)\) == 0\)) show
0 396 moveto (5721     return -1;) show
0 384 moveto (5722   ilock\(ip\);) show
0 372 moveto (5723   if\(ip->type == T_DIR\){) show
0 360 moveto (5724     iunlockput\(ip\);) show
0 348 moveto (5725     return -1;) show
0 336 moveto (5726   }) show
0 324 moveto (5727   ip->nlink++;) show
0 312 moveto (5728   iupdate\(ip\);) show
0 300 moveto (5729   iunlock\(ip\);) show
0 288 moveto (5730 ) show
0 276 moveto (5731   if\(\(dp = nameiparent\(new, name\)\) == 0\)) show
0 264 moveto (5732     goto  bad;) show
0 252 moveto (5733   ilock\(dp\);) show
0 240 moveto (5734   if\(dp->dev != ip->dev || dirlink\(dp, name, ip->inum\) < 0\)) show
0 228 moveto (5735     goto bad;) show
0 216 moveto (5736   iunlockput\(dp\);) show
0 204 moveto (5737   iput\(ip\);) show
0 192 moveto (5738   return 0;) show
0 180 moveto (5739 ) show
0 168 moveto (5740 bad:) show
0 156 moveto (5741   if\(dp\)) show
0 144 moveto (5742     iunlockput\(dp\);) show
0 132 moveto (5743   ilock\(ip\);) show
0 120 moveto (5744   ip->nlink--;) show
0 108 moveto (5745   iupdate\(ip\);) show
0 96 moveto (5746   iunlockput\(ip\);) show
0 84 moveto (5747   return -1;) show
0 72 moveto (5748 }) show
0 60 moveto (5749 ) show
0 24 moveto (Sheet 57) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 4) show
0 648 moveto (5750 // Is the directory dp empty except for "." and ".." ?) show
0 636 moveto (5751 static int) show
0 624 moveto (5752 isdirempty\(struct inode *dp\)) show
0 612 moveto (5753 {) show
0 600 moveto (5754   int off;) show
0 588 moveto (5755   struct dirent de;) show
0 576 moveto (5756 ) show
0 564 moveto (5757   for\(off=2*sizeof\(de\); off<dp->size; off+=sizeof\(de\)\){) show
0 552 moveto (5758     if\(readi\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 540 moveto (5759       panic\("isdirempty: readi"\);) show
0 528 moveto (5760     if\(de.inum != 0\)) show
0 516 moveto (5761       return 0;) show
0 504 moveto (5762   }) show
0 492 moveto (5763   return 1;) show
0 480 moveto (5764 }) show
0 468 moveto (5765 ) show
0 456 moveto (5766 int) show
0 444 moveto (5767 sys_unlink\(void\)) show
0 432 moveto (5768 {) show
0 420 moveto (5769   struct inode *ip, *dp;) show
0 408 moveto (5770   struct dirent de;) show
0 396 moveto (5771   char name[DIRSIZ], *path;) show
0 384 moveto (5772   uint off;) show
0 372 moveto (5773 ) show
0 360 moveto (5774   if\(argstr\(0, &path\) < 0\)) show
0 348 moveto (5775     return -1;) show
0 336 moveto (5776   if\(\(dp = nameiparent\(path, name\)\) == 0\)) show
0 324 moveto (5777     return -1;) show
0 312 moveto (5778   ilock\(dp\);) show
0 300 moveto (5779 ) show
0 288 moveto (5780   // Cannot unlink "." or "..".) show
0 276 moveto (5781   if\(namecmp\(name, "."\) == 0 || namecmp\(name, ".."\) == 0\){) show
0 264 moveto (5782     iunlockput\(dp\);) show
0 252 moveto (5783     return -1;) show
0 240 moveto (5784   }) show
0 228 moveto (5785 ) show
0 216 moveto (5786   if\(\(ip = dirlookup\(dp, name, &off\)\) == 0\){) show
0 204 moveto (5787     iunlockput\(dp\);) show
0 192 moveto (5788     return -1;) show
0 180 moveto (5789   }) show
0 168 moveto (5790   ilock\(ip\);) show
0 156 moveto (5791 ) show
0 144 moveto (5792   if\(ip->nlink < 1\)) show
0 132 moveto (5793     panic\("unlink: nlink < 1"\);) show
0 120 moveto (5794   if\(ip->type == T_DIR && !isdirempty\(ip\)\){) show
0 108 moveto (5795     iunlockput\(ip\);) show
0 96 moveto (5796     iunlockput\(dp\);) show
0 84 moveto (5797     return -1;) show
0 72 moveto (5798   }) show
0 60 moveto (5799 ) show
0 24 moveto (Sheet 57) show
grestore
restore
showpage
%%Page: 67 67
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 5) show
0 648 moveto (5800   memset\(&de, 0, sizeof\(de\)\);) show
0 636 moveto (5801   if\(writei\(dp, \(char*\)&de, off, sizeof\(de\)\) != sizeof\(de\)\)) show
0 624 moveto (5802     panic\("unlink: writei"\);) show
0 612 moveto (5803   iunlockput\(dp\);) show
0 600 moveto (5804 ) show
0 588 moveto (5805   ip->nlink--;) show
0 576 moveto (5806   iupdate\(ip\);) show
0 564 moveto (5807   iunlockput\(ip\);) show
0 552 moveto (5808   return 0;) show
0 540 moveto (5809 }) show
0 528 moveto (5810 ) show
0 516 moveto (5811 static struct inode*) show
0 504 moveto (5812 create\(char *path, int canexist, short type, short major, short minor\)) show
0 492 moveto (5813 {) show
0 480 moveto (5814   uint off;) show
0 468 moveto (5815   struct inode *ip, *dp;) show
0 456 moveto (5816   char name[DIRSIZ];) show
0 444 moveto (5817 ) show
0 432 moveto (5818   if\(\(dp = nameiparent\(path, name\)\) == 0\)) show
0 420 moveto (5819     return 0;) show
0 408 moveto (5820   ilock\(dp\);) show
0 396 moveto (5821 ) show
0 384 moveto (5822   if\(canexist && \(ip = dirlookup\(dp, name, &off\)\) != 0\){) show
0 372 moveto (5823     iunlockput\(dp\);) show
0 360 moveto (5824     ilock\(ip\);) show
0 348 moveto (5825     if\(ip->type != type || ip->major != major || ip->minor != minor\){) show
0 336 moveto (5826       iunlockput\(ip\);) show
0 324 moveto (5827       return 0;) show
0 312 moveto (5828     }) show
0 300 moveto (5829     return ip;) show
0 288 moveto (5830   }) show
0 276 moveto (5831 ) show
0 264 moveto (5832   if\(\(ip = ialloc\(dp->dev, type\)\) == 0\){) show
0 252 moveto (5833     iunlockput\(dp\);) show
0 240 moveto (5834     return 0;) show
0 228 moveto (5835   }) show
0 216 moveto (5836   ilock\(ip\);) show
0 204 moveto (5837   ip->major = major;) show
0 192 moveto (5838   ip->minor = minor;) show
0 180 moveto (5839   ip->nlink = 1;) show
0 168 moveto (5840   iupdate\(ip\);) show
0 156 moveto (5841 ) show
0 144 moveto (5842   if\(dirlink\(dp, name, ip->inum\) < 0\){) show
0 132 moveto (5843     ip->nlink = 0;) show
0 120 moveto (5844     iunlockput\(ip\);) show
0 108 moveto (5845     iunlockput\(dp\);) show
0 96 moveto (5846     return 0;) show
0 84 moveto (5847   }) show
0 72 moveto (5848 ) show
0 60 moveto (5849 ) show
0 24 moveto (Sheet 58) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 6) show
0 648 moveto (5850   if\(type == T_DIR\){  // Create . and .. entries.) show
0 636 moveto (5851     dp->nlink++;  // for "..") show
0 624 moveto (5852     iupdate\(dp\);) show
0 612 moveto (5853     // No ip->nlink++ for ".": avoid cyclic ref count.) show
0 600 moveto (5854     if\(dirlink\(ip, ".", ip->inum\) < 0 || dirlink\(ip, "..", dp->inum\) < 0\)) show
0 588 moveto (5855       panic\("create dots"\);) show
0 576 moveto (5856   }) show
0 564 moveto (5857   iunlockput\(dp\);) show
0 552 moveto (5858   return ip;) show
0 540 moveto (5859 }) show
0 528 moveto (5860 ) show
0 516 moveto (5861 int) show
0 504 moveto (5862 sys_open\(void\)) show
0 492 moveto (5863 {) show
0 480 moveto (5864   char *path;) show
0 468 moveto (5865   int fd, omode;) show
0 456 moveto (5866   struct file *f;) show
0 444 moveto (5867   struct inode *ip;) show
0 432 moveto (5868 ) show
0 420 moveto (5869   if\(argstr\(0, &path\) < 0 || argint\(1, &omode\) < 0\)) show
0 408 moveto (5870     return -1;) show
0 396 moveto (5871 ) show
0 384 moveto (5872   if\(omode & O_CREATE\){) show
0 372 moveto (5873     if\(\(ip = create\(path, 1, T_FILE, 0, 0\)\) == 0\)) show
0 360 moveto (5874       return -1;) show
0 348 moveto (5875   } else {) show
0 336 moveto (5876     if\(\(ip = namei\(path\)\) == 0\)) show
0 324 moveto (5877       return -1;) show
0 312 moveto (5878     ilock\(ip\);) show
0 300 moveto (5879     if\(ip->type == T_DIR && \(omode & \(O_RDWR|O_WRONLY\)\)\){) show
0 288 moveto (5880       iunlockput\(ip\);) show
0 276 moveto (5881       return -1;) show
0 264 moveto (5882     }) show
0 252 moveto (5883   }) show
0 240 moveto (5884 ) show
0 228 moveto (5885   if\(\(f = filealloc\(\)\) == 0 || \(fd = fdalloc\(f\)\) < 0\){) show
0 216 moveto (5886     if\(f\)) show
0 204 moveto (5887       fileclose\(f\);) show
0 192 moveto (5888     iunlockput\(ip\);) show
0 180 moveto (5889     return -1;) show
0 168 moveto (5890   }) show
0 156 moveto (5891   iunlock\(ip\);) show
0 144 moveto (5892 ) show
0 132 moveto (5893   f->type = FD_INODE;) show
0 120 moveto (5894   f->ip = ip;) show
0 108 moveto (5895   f->off = 0;) show
0 96 moveto (5896   f->readable = !\(omode & O_WRONLY\);) show
0 84 moveto (5897   f->writable = \(omode & O_WRONLY\) || \(omode & O_RDWR\);) show
0 72 moveto (5898 ) show
0 60 moveto (5899 ) show
0 24 moveto (Sheet 58) show
grestore
restore
showpage
%%Page: 68 68
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 7) show
0 648 moveto (5900   return fd;) show
0 636 moveto (5901 }) show
0 624 moveto (5902 ) show
0 612 moveto (5903 int) show
0 600 moveto (5904 sys_mknod\(void\)) show
0 588 moveto (5905 {) show
0 576 moveto (5906   struct inode *ip;) show
0 564 moveto (5907   char *path;) show
0 552 moveto (5908   int len;) show
0 540 moveto (5909   int major, minor;) show
0 528 moveto (5910 ) show
0 516 moveto (5911   if\(\(len=argstr\(0, &path\)\) < 0 ||) show
0 504 moveto (5912      argint\(1, &major\) < 0 ||) show
0 492 moveto (5913      argint\(2, &minor\) < 0 ||) show
0 480 moveto (5914      \(ip = create\(path, 0, T_DEV, major, minor\)\) == 0\)) show
0 468 moveto (5915     return -1;) show
0 456 moveto (5916   iunlockput\(ip\);) show
0 444 moveto (5917   return 0;) show
0 432 moveto (5918 }) show
0 420 moveto (5919 ) show
0 408 moveto (5920 int) show
0 396 moveto (5921 sys_mkdir\(void\)) show
0 384 moveto (5922 {) show
0 372 moveto (5923   char *path;) show
0 360 moveto (5924   struct inode *ip;) show
0 348 moveto (5925 ) show
0 336 moveto (5926   if\(argstr\(0, &path\) < 0 || \(ip = create\(path, 0, T_DIR, 0, 0\)\) == 0\)) show
0 324 moveto (5927     return -1;) show
0 312 moveto (5928   iunlockput\(ip\);) show
0 300 moveto (5929   return 0;) show
0 288 moveto (5930 }) show
0 276 moveto (5931 ) show
0 264 moveto (5932 int) show
0 252 moveto (5933 sys_chdir\(void\)) show
0 240 moveto (5934 {) show
0 228 moveto (5935   char *path;) show
0 216 moveto (5936   struct inode *ip;) show
0 204 moveto (5937 ) show
0 192 moveto (5938   if\(argstr\(0, &path\) < 0 || \(ip = namei\(path\)\) == 0\)) show
0 180 moveto (5939     return -1;) show
0 168 moveto (5940   ilock\(ip\);) show
0 156 moveto (5941   if\(ip->type != T_DIR\){) show
0 144 moveto (5942     iunlockput\(ip\);) show
0 132 moveto (5943     return -1;) show
0 120 moveto (5944   }) show
0 108 moveto (5945   iunlock\(ip\);) show
0 96 moveto (5946   iput\(cp->cwd\);) show
0 84 moveto (5947   cp->cwd = ip;) show
0 72 moveto (5948   return 0;) show
0 60 moveto (5949 }) show
0 24 moveto (Sheet 59) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sysfile.c  Page 8) show
0 648 moveto (5950 int) show
0 636 moveto (5951 sys_exec\(void\)) show
0 624 moveto (5952 {) show
0 612 moveto (5953   char *path, *argv[20];) show
0 600 moveto (5954   int i;) show
0 588 moveto (5955   uint uargv, uarg;) show
0 576 moveto (5956 ) show
0 564 moveto (5957   if\(argstr\(0, &path\) < 0 || argint\(1, \(int*\)&uargv\) < 0\)) show
0 552 moveto (5958     return -1;) show
0 540 moveto (5959   memset\(argv, 0, sizeof\(argv\)\);) show
0 528 moveto (5960   for\(i=0;; i++\){) show
0 516 moveto (5961     if\(i >= NELEM\(argv\)\)) show
0 504 moveto (5962       return -1;) show
0 492 moveto (5963     if\(fetchint\(cp, uargv+4*i, \(int*\)&uarg\) < 0\)) show
0 480 moveto (5964       return -1;) show
0 468 moveto (5965     if\(uarg == 0\){) show
0 456 moveto (5966       argv[i] = 0;) show
0 444 moveto (5967       break;) show
0 432 moveto (5968     }) show
0 420 moveto (5969     if\(fetchstr\(cp, uarg, &argv[i]\) < 0\)) show
0 408 moveto (5970       return -1;) show
0 396 moveto (5971   }) show
0 384 moveto (5972   return exec\(path, argv\);) show
0 372 moveto (5973 }) show
0 360 moveto (5974 ) show
0 348 moveto (5975 int) show
0 336 moveto (5976 sys_pipe\(void\)) show
0 324 moveto (5977 {) show
0 312 moveto (5978   int *fd;) show
0 300 moveto (5979   struct file *rf, *wf;) show
0 288 moveto (5980   int fd0, fd1;) show
0 276 moveto (5981 ) show
0 264 moveto (5982   if\(argptr\(0, \(void*\)&fd, 2*sizeof\(fd[0]\)\) < 0\)) show
0 252 moveto (5983     return -1;) show
0 240 moveto (5984   if\(pipealloc\(&rf, &wf\) < 0\)) show
0 228 moveto (5985     return -1;) show
0 216 moveto (5986   fd0 = -1;) show
0 204 moveto (5987   if\(\(fd0 = fdalloc\(rf\)\) < 0 || \(fd1 = fdalloc\(wf\)\) < 0\){) show
0 192 moveto (5988     if\(fd0 >= 0\)) show
0 180 moveto (5989       cp->ofile[fd0] = 0;) show
0 168 moveto (5990     fileclose\(rf\);) show
0 156 moveto (5991     fileclose\(wf\);) show
0 144 moveto (5992     return -1;) show
0 132 moveto (5993   }) show
0 120 moveto (5994   fd[0] = fd0;) show
0 108 moveto (5995   fd[1] = fd1;) show
0 96 moveto (5996   return 0;) show
0 84 moveto (5997 }) show
0 72 moveto (5998 ) show
0 60 moveto (5999 ) show
0 24 moveto (Sheet 59) show
grestore
restore
showpage
%%Page: 69 69
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/exec.c  Page 1) show
0 648 moveto (6000 #include "types.h") show
0 636 moveto (6001 #include "param.h") show
0 624 moveto (6002 #include "mmu.h") show
0 612 moveto (6003 #include "proc.h") show
0 600 moveto (6004 #include "defs.h") show
0 588 moveto (6005 #include "x86.h") show
0 576 moveto (6006 #include "elf.h") show
0 564 moveto (6007 ) show
0 552 moveto (6008 int) show
0 540 moveto (6009 exec\(char *path, char **argv\)) show
0 528 moveto (6010 {) show
0 516 moveto (6011   char *mem, *s, *last;) show
0 504 moveto (6012   int i, argc, arglen, len, off;) show
0 492 moveto (6013   uint sz, sp, argp;) show
0 480 moveto (6014   struct elfhdr elf;) show
0 468 moveto (6015   struct inode *ip;) show
0 456 moveto (6016   struct proghdr ph;) show
0 444 moveto (6017 ) show
0 432 moveto (6018   if\(\(ip = namei\(path\)\) == 0\)) show
0 420 moveto (6019     return -1;) show
0 408 moveto (6020 //  cprintf\("XXX exec\\n"\);) show
0 396 moveto (6021   ilock\(ip\);) show
0 384 moveto (6022 ) show
0 372 moveto (6023   // Compute memory size of new process.) show
0 360 moveto (6024   mem = 0;) show
0 348 moveto (6025   sz = 0;) show
0 336 moveto (6026 ) show
0 324 moveto (6027   // Program segments.) show
0 312 moveto (6028   if\(readi\(ip, \(char*\)&elf, 0, sizeof\(elf\)\) < sizeof\(elf\)\)) show
0 300 moveto (6029     goto bad;) show
0 288 moveto (6030   if\(elf.magic != ELF_MAGIC\)) show
0 276 moveto (6031     goto bad;) show
0 264 moveto (6032   for\(i=0, off=elf.phoff; i<elf.phnum; i++, off+=sizeof\(ph\)\){) show
0 252 moveto (6033     if\(readi\(ip, \(char*\)&ph, off, sizeof\(ph\)\) != sizeof\(ph\)\)) show
0 240 moveto (6034       goto bad;) show
0 228 moveto (6035     if\(ph.type != ELF_PROG_LOAD\)) show
0 216 moveto (6036       continue;) show
0 204 moveto (6037     if\(ph.memsz < ph.filesz\)) show
0 192 moveto (6038       goto bad;) show
0 180 moveto (6039     sz += ph.memsz;) show
0 168 moveto (6040   }) show
0 156 moveto (6041 ) show
0 144 moveto (6042   // Arguments.) show
0 132 moveto (6043   arglen = 0;) show
0 120 moveto (6044   for\(argc=0; argv[argc]; argc++\)) show
0 108 moveto (6045     arglen += strlen\(argv[argc]\) + 1;) show
0 96 moveto (6046   arglen = \(arglen+3\) & ~3;) show
0 84 moveto (6047   sz += arglen + 4*\(argc+1\);) show
0 72 moveto (6048 ) show
0 60 moveto (6049 ) show
0 24 moveto (Sheet 60) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/exec.c  Page 2) show
0 648 moveto (6050   // Stack.) show
0 636 moveto (6051   sz += PAGE;) show
0 624 moveto (6052 ) show
0 612 moveto (6053   // Allocate program memory.) show
0 600 moveto (6054   sz = \(sz+PAGE-1\) & ~\(PAGE-1\);) show
0 588 moveto (6055   mem = kalloc\(sz\);) show
0 576 moveto (6056   if\(mem == 0\)) show
0 564 moveto (6057     goto bad;) show
0 552 moveto (6058   memset\(mem, 0, sz\);) show
0 540 moveto (6059 ) show
0 528 moveto (6060   // Load program into memory.) show
0 516 moveto (6061   for\(i=0, off=elf.phoff; i<elf.phnum; i++, off+=sizeof\(ph\)\){) show
0 504 moveto (6062     if\(readi\(ip, \(char*\)&ph, off, sizeof\(ph\)\) != sizeof\(ph\)\)) show
0 492 moveto (6063       goto bad;) show
0 480 moveto (6064     if\(ph.type != ELF_PROG_LOAD\)) show
0 468 moveto (6065       continue;) show
0 456 moveto (6066     if\(ph.va + ph.memsz > sz\)) show
0 444 moveto (6067       goto bad;) show
0 432 moveto (6068     if\(readi\(ip, mem + ph.va, ph.offset, ph.filesz\) != ph.filesz\)) show
0 420 moveto (6069       goto bad;) show
0 408 moveto (6070     memset\(mem + ph.va + ph.filesz, 0, ph.memsz - ph.filesz\);) show
0 396 moveto (6071   }) show
0 384 moveto (6072   iunlockput\(ip\);) show
0 372 moveto (6073 ) show
0 360 moveto (6074   // Initialize stack.) show
0 348 moveto (6075   sp = sz;) show
0 336 moveto (6076   argp = sz - arglen - 4*\(argc+1\);) show
0 324 moveto (6077 ) show
0 312 moveto (6078   // Copy argv strings and pointers to stack.) show
0 300 moveto (6079   *\(uint*\)\(mem+argp + 4*argc\) = 0;  // argv[argc]) show
0 288 moveto (6080   for\(i=argc-1; i>=0; i--\){) show
0 276 moveto (6081     len = strlen\(argv[i]\) + 1;) show
0 264 moveto (6082     sp -= len;) show
0 252 moveto (6083     memmove\(mem+sp, argv[i], len\);) show
0 240 moveto (6084     *\(uint*\)\(mem+argp + 4*i\) = sp;  // argv[i]) show
0 228 moveto (6085   }) show
0 216 moveto (6086 ) show
0 204 moveto (6087   // Stack frame for main\(argc, argv\), below arguments.) show
0 192 moveto (6088   sp = argp;) show
0 180 moveto (6089   sp -= 4;) show
0 168 moveto (6090   *\(uint*\)\(mem+sp\) = argp;) show
0 156 moveto (6091   sp -= 4;) show
0 144 moveto (6092   *\(uint*\)\(mem+sp\) = argc;) show
0 132 moveto (6093   sp -= 4;) show
0 120 moveto (6094   *\(uint*\)\(mem+sp\) = 0xffffffff;   // fake return pc) show
0 108 moveto (6095 ) show
0 96 moveto (6096 ) show
0 84 moveto (6097 ) show
0 72 moveto (6098 ) show
0 60 moveto (6099 ) show
0 24 moveto (Sheet 60) show
grestore
restore
showpage
%%Page: 70 70
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/exec.c  Page 3) show
0 648 moveto (6100   // Save program name for debugging.) show
0 636 moveto (6101   for\(last=s=path; *s; s++\)) show
0 624 moveto (6102     if\(*s == '/'\)) show
0 612 moveto (6103       last = s+1;) show
0 600 moveto (6104   safestrcpy\(cp->name, last, sizeof\(cp->name\)\);) show
0 588 moveto (6105 ) show
0 576 moveto (6106   // Commit to the new image.) show
0 564 moveto (6107   kfree\(cp->mem, cp->sz\);) show
0 552 moveto (6108   cp->mem = mem;) show
0 540 moveto (6109   cp->sz = sz;) show
0 528 moveto (6110   cp->tf->eip = elf.entry;  // main) show
0 516 moveto (6111   cp->tf->esp = sp;) show
0 504 moveto (6112   setupsegs\(cp\);) show
0 492 moveto (6113   return 0;) show
0 480 moveto (6114 ) show
0 468 moveto (6115  bad:) show
0 456 moveto (6116   if\(mem\)) show
0 444 moveto (6117     kfree\(mem, sz\);) show
0 432 moveto (6118   iunlockput\(ip\);) show
0 420 moveto (6119   return -1;) show
0 408 moveto (6120 }) show
0 396 moveto (6121 ) show
0 384 moveto (6122 ) show
0 372 moveto (6123 ) show
0 360 moveto (6124 ) show
0 348 moveto (6125 ) show
0 336 moveto (6126 ) show
0 324 moveto (6127 ) show
0 312 moveto (6128 ) show
0 300 moveto (6129 ) show
0 288 moveto (6130 ) show
0 276 moveto (6131 ) show
0 264 moveto (6132 ) show
0 252 moveto (6133 ) show
0 240 moveto (6134 ) show
0 228 moveto (6135 ) show
0 216 moveto (6136 ) show
0 204 moveto (6137 ) show
0 192 moveto (6138 ) show
0 180 moveto (6139 ) show
0 168 moveto (6140 ) show
0 156 moveto (6141 ) show
0 144 moveto (6142 ) show
0 132 moveto (6143 ) show
0 120 moveto (6144 ) show
0 108 moveto (6145 ) show
0 96 moveto (6146 ) show
0 84 moveto (6147 ) show
0 72 moveto (6148 ) show
0 60 moveto (6149 ) show
0 24 moveto (Sheet 61) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pipe.c  Page 1) show
0 648 moveto (6150 #include "types.h") show
0 636 moveto (6151 #include "defs.h") show
0 624 moveto (6152 #include "param.h") show
0 612 moveto (6153 #include "mmu.h") show
0 600 moveto (6154 #include "proc.h") show
0 588 moveto (6155 #include "file.h") show
0 576 moveto (6156 #include "spinlock.h") show
0 564 moveto (6157 ) show
0 552 moveto (6158 #define PIPESIZE 512) show
0 540 moveto (6159 ) show
0 528 moveto (6160 struct pipe {) show
0 516 moveto (6161   int readopen;   // read fd is still open) show
0 504 moveto (6162   int writeopen;  // write fd is still open) show
0 492 moveto (6163   int writep;     // next index to write) show
0 480 moveto (6164   int readp;      // next index to read) show
0 468 moveto (6165   struct spinlock lock;) show
0 456 moveto (6166   char data[PIPESIZE];) show
0 444 moveto (6167 };) show
0 432 moveto (6168 ) show
0 420 moveto (6169 int) show
0 408 moveto (6170 pipealloc\(struct file **f0, struct file **f1\)) show
0 396 moveto (6171 {) show
0 384 moveto (6172   struct pipe *p;) show
0 372 moveto (6173 ) show
0 360 moveto (6174   p = 0;) show
0 348 moveto (6175   *f0 = *f1 = 0;) show
0 336 moveto (6176   if\(\(*f0 = filealloc\(\)\) == 0 || \(*f1 = filealloc\(\)\) == 0\)) show
0 324 moveto (6177     goto bad;) show
0 312 moveto (6178   if\(\(p = \(struct pipe*\)kalloc\(PAGE\)\) == 0\)) show
0 300 moveto (6179     goto bad;) show
0 288 moveto (6180   p->readopen = 1;) show
0 276 moveto (6181   p->writeopen = 1;) show
0 264 moveto (6182   p->writep = 0;) show
0 252 moveto (6183   p->readp = 0;) show
0 240 moveto (6184   initlock\(&p->lock, "pipe"\);) show
0 228 moveto (6185   \(*f0\)->type = FD_PIPE;) show
0 216 moveto (6186   \(*f0\)->readable = 1;) show
0 204 moveto (6187   \(*f0\)->writable = 0;) show
0 192 moveto (6188   \(*f0\)->pipe = p;) show
0 180 moveto (6189   \(*f1\)->type = FD_PIPE;) show
0 168 moveto (6190   \(*f1\)->readable = 0;) show
0 156 moveto (6191   \(*f1\)->writable = 1;) show
0 144 moveto (6192   \(*f1\)->pipe = p;) show
0 132 moveto (6193   return 0;) show
0 120 moveto (6194 ) show
0 108 moveto (6195  bad:) show
0 96 moveto (6196   if\(p\)) show
0 84 moveto (6197     kfree\(\(char*\)p, PAGE\);) show
0 72 moveto (6198   if\(*f0\){) show
0 60 moveto (6199     \(*f0\)->type = FD_NONE;) show
0 24 moveto (Sheet 61) show
grestore
restore
showpage
%%Page: 71 71
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pipe.c  Page 2) show
0 648 moveto (6200     fileclose\(*f0\);) show
0 636 moveto (6201   }) show
0 624 moveto (6202   if\(*f1\){) show
0 612 moveto (6203     \(*f1\)->type = FD_NONE;) show
0 600 moveto (6204     fileclose\(*f1\);) show
0 588 moveto (6205   }) show
0 576 moveto (6206   return -1;) show
0 564 moveto (6207 }) show
0 552 moveto (6208 ) show
0 540 moveto (6209 void) show
0 528 moveto (6210 pipeclose\(struct pipe *p, int writable\)) show
0 516 moveto (6211 {) show
0 504 moveto (6212   acquire\(&p->lock\);) show
0 492 moveto (6213   if\(writable\){) show
0 480 moveto (6214     p->writeopen = 0;) show
0 468 moveto (6215     wakeup\(&p->readp\);) show
0 456 moveto (6216   } else {) show
0 444 moveto (6217     p->readopen = 0;) show
0 432 moveto (6218     wakeup\(&p->writep\);) show
0 420 moveto (6219   }) show
0 408 moveto (6220   release\(&p->lock\);) show
0 396 moveto (6221 ) show
0 384 moveto (6222   if\(p->readopen == 0 && p->writeopen == 0\)) show
0 372 moveto (6223     kfree\(\(char*\)p, PAGE\);) show
0 360 moveto (6224 }) show
0 348 moveto (6225 ) show
0 336 moveto (6226 int) show
0 324 moveto (6227 pipewrite\(struct pipe *p, char *addr, int n\)) show
0 312 moveto (6228 {) show
0 300 moveto (6229   int i;) show
0 288 moveto (6230 ) show
0 276 moveto (6231   acquire\(&p->lock\);) show
0 264 moveto (6232   for\(i = 0; i < n; i++\){) show
0 252 moveto (6233     while\(\(\(p->writep + 1\) % PIPESIZE\) == p->readp\){) show
0 240 moveto (6234       if\(p->readopen == 0 || cp->killed\){) show
0 228 moveto (6235         release\(&p->lock\);) show
0 216 moveto (6236         return -1;) show
0 204 moveto (6237       }) show
0 192 moveto (6238       wakeup\(&p->readp\);) show
0 180 moveto (6239       sleep\(&p->writep, &p->lock\);) show
0 168 moveto (6240     }) show
0 156 moveto (6241     p->data[p->writep] = addr[i];) show
0 144 moveto (6242     p->writep = \(p->writep + 1\) % PIPESIZE;) show
0 132 moveto (6243   }) show
0 120 moveto (6244   wakeup\(&p->readp\);) show
0 108 moveto (6245   release\(&p->lock\);) show
0 96 moveto (6246   return i;) show
0 84 moveto (6247 }) show
0 72 moveto (6248 ) show
0 60 moveto (6249 ) show
0 24 moveto (Sheet 62) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pipe.c  Page 3) show
0 648 moveto (6250 int) show
0 636 moveto (6251 piperead\(struct pipe *p, char *addr, int n\)) show
0 624 moveto (6252 {) show
0 612 moveto (6253   int i;) show
0 600 moveto (6254 ) show
0 588 moveto (6255   acquire\(&p->lock\);) show
0 576 moveto (6256   while\(p->readp == p->writep && p->writeopen\){) show
0 564 moveto (6257     if\(cp->killed\){) show
0 552 moveto (6258       release\(&p->lock\);) show
0 540 moveto (6259       return -1;) show
0 528 moveto (6260     }) show
0 516 moveto (6261     sleep\(&p->readp, &p->lock\);) show
0 504 moveto (6262   }) show
0 492 moveto (6263   for\(i = 0; i < n; i++\){) show
0 480 moveto (6264     if\(p->readp == p->writep\)) show
0 468 moveto (6265       break;) show
0 456 moveto (6266     addr[i] = p->data[p->readp];) show
0 444 moveto (6267     p->readp = \(p->readp + 1\) % PIPESIZE;) show
0 432 moveto (6268   }) show
0 420 moveto (6269   wakeup\(&p->writep\);) show
0 408 moveto (6270   release\(&p->lock\);) show
0 396 moveto (6271   return i;) show
0 384 moveto (6272 }) show
0 372 moveto (6273 ) show
0 360 moveto (6274 ) show
0 348 moveto (6275 ) show
0 336 moveto (6276 ) show
0 324 moveto (6277 ) show
0 312 moveto (6278 ) show
0 300 moveto (6279 ) show
0 288 moveto (6280 ) show
0 276 moveto (6281 ) show
0 264 moveto (6282 ) show
0 252 moveto (6283 ) show
0 240 moveto (6284 ) show
0 228 moveto (6285 ) show
0 216 moveto (6286 ) show
0 204 moveto (6287 ) show
0 192 moveto (6288 ) show
0 180 moveto (6289 ) show
0 168 moveto (6290 ) show
0 156 moveto (6291 ) show
0 144 moveto (6292 ) show
0 132 moveto (6293 ) show
0 120 moveto (6294 ) show
0 108 moveto (6295 ) show
0 96 moveto (6296 ) show
0 84 moveto (6297 ) show
0 72 moveto (6298 ) show
0 60 moveto (6299 ) show
0 24 moveto (Sheet 62) show
grestore
restore
showpage
%%Page: 72 72
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/string.c  Page 1) show
0 648 moveto (6300 #include "types.h") show
0 636 moveto (6301 ) show
0 624 moveto (6302 void*) show
0 612 moveto (6303 memcpy\(void *dst, const void *src, uint n\)) show
0 600 moveto (6304 {) show
0 588 moveto (6305     const uchar *s1;) show
0 576 moveto (6306     uchar *s2;) show
0 564 moveto (6307 ) show
0 552 moveto (6308     s1 = src;) show
0 540 moveto (6309     s2 = dst;) show
0 528 moveto (6310     while\(n-- > 0\){) show
0 516 moveto (6311         *s2 = *s1;) show
0 504 moveto (6312         s1++;) show
0 492 moveto (6313         s2++;) show
0 480 moveto (6314     }) show
0 468 moveto (6315 ) show
0 456 moveto (6316     return 0;) show
0 444 moveto (6317 }) show
0 432 moveto (6318 ) show
0 420 moveto (6319 void*) show
0 408 moveto (6320 memset\(void *dst, int c, uint n\)) show
0 396 moveto (6321 {) show
0 384 moveto (6322   char *d;) show
0 372 moveto (6323 ) show
0 360 moveto (6324   d = \(char*\)dst;) show
0 348 moveto (6325   while\(n-- > 0\)) show
0 336 moveto (6326     *d++ = c;) show
0 324 moveto (6327 ) show
0 312 moveto (6328   return dst;) show
0 300 moveto (6329 }) show
0 288 moveto (6330 ) show
0 276 moveto (6331 int) show
0 264 moveto (6332 memcmp\(const void *v1, const void *v2, uint n\)) show
0 252 moveto (6333 {) show
0 240 moveto (6334   const uchar *s1, *s2;) show
0 228 moveto (6335 ) show
0 216 moveto (6336   s1 = v1;) show
0 204 moveto (6337   s2 = v2;) show
0 192 moveto (6338   while\(n-- > 0\){) show
0 180 moveto (6339     if\(*s1 != *s2\)) show
0 168 moveto (6340       return *s1 - *s2;) show
0 156 moveto (6341     s1++, s2++;) show
0 144 moveto (6342   }) show
0 132 moveto (6343 ) show
0 120 moveto (6344   return 0;) show
0 108 moveto (6345 }) show
0 96 moveto (6346 ) show
0 84 moveto (6347 ) show
0 72 moveto (6348 ) show
0 60 moveto (6349 ) show
0 24 moveto (Sheet 63) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/string.c  Page 2) show
0 648 moveto (6350 void*) show
0 636 moveto (6351 memmove\(void *dst, const void *src, uint n\)) show
0 624 moveto (6352 {) show
0 612 moveto (6353   const char *s;) show
0 600 moveto (6354   char *d;) show
0 588 moveto (6355 ) show
0 576 moveto (6356   s = src;) show
0 564 moveto (6357   d = dst;) show
0 552 moveto (6358   if\(s < d && s + n > d\){) show
0 540 moveto (6359     s += n;) show
0 528 moveto (6360     d += n;) show
0 516 moveto (6361     while\(n-- > 0\)) show
0 504 moveto (6362       *--d = *--s;) show
0 492 moveto (6363   } else) show
0 480 moveto (6364     while\(n-- > 0\)) show
0 468 moveto (6365       *d++ = *s++;) show
0 456 moveto (6366 ) show
0 444 moveto (6367   return dst;) show
0 432 moveto (6368 }) show
0 420 moveto (6369 ) show
0 408 moveto (6370 int) show
0 396 moveto (6371 strncmp\(const char *p, const char *q, uint n\)) show
0 384 moveto (6372 {) show
0 372 moveto (6373   while\(n > 0 && *p && *p == *q\)) show
0 360 moveto (6374     n--, p++, q++;) show
0 348 moveto (6375   if\(n == 0\)) show
0 336 moveto (6376     return 0;) show
0 324 moveto (6377   return \(uchar\)*p - \(uchar\)*q;) show
0 312 moveto (6378 }) show
0 300 moveto (6379 ) show
0 288 moveto (6380 char*) show
0 276 moveto (6381 strncpy\(char *s, const char *t, int n\)) show
0 264 moveto (6382 {) show
0 252 moveto (6383   char *os;) show
0 240 moveto (6384 ) show
0 228 moveto (6385   os = s;) show
0 216 moveto (6386   while\(n-- > 0 && \(*s++ = *t++\) != 0\)) show
0 204 moveto (6387     ;) show
0 192 moveto (6388   while\(n-- > 0\)) show
0 180 moveto (6389     *s++ = 0;) show
0 168 moveto (6390   return os;) show
0 156 moveto (6391 }) show
0 144 moveto (6392 ) show
0 132 moveto (6393 ) show
0 120 moveto (6394 ) show
0 108 moveto (6395 ) show
0 96 moveto (6396 ) show
0 84 moveto (6397 ) show
0 72 moveto (6398 ) show
0 60 moveto (6399 ) show
0 24 moveto (Sheet 63) show
grestore
restore
showpage
%%Page: 73 73
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/string.c  Page 3) show
0 648 moveto (6400 // Like strncpy but guaranteed to NUL-terminate.) show
0 636 moveto (6401 char*) show
0 624 moveto (6402 safestrcpy\(char *s, const char *t, int n\)) show
0 612 moveto (6403 {) show
0 600 moveto (6404   char *os;) show
0 588 moveto (6405 ) show
0 576 moveto (6406   os = s;) show
0 564 moveto (6407   if\(n <= 0\)) show
0 552 moveto (6408     return os;) show
0 540 moveto (6409   while\(--n > 0 && \(*s++ = *t++\) != 0\)) show
0 528 moveto (6410     ;) show
0 516 moveto (6411   *s = 0;) show
0 504 moveto (6412   return os;) show
0 492 moveto (6413 }) show
0 480 moveto (6414 ) show
0 468 moveto (6415 int) show
0 456 moveto (6416 strlen\(const char *s\)) show
0 444 moveto (6417 {) show
0 432 moveto (6418   int n;) show
0 420 moveto (6419 ) show
0 408 moveto (6420   for\(n = 0; s[n]; n++\)) show
0 396 moveto (6421     ;) show
0 384 moveto (6422   return n;) show
0 372 moveto (6423 }) show
0 360 moveto (6424 ) show
0 348 moveto (6425 ) show
0 336 moveto (6426 ) show
0 324 moveto (6427 ) show
0 312 moveto (6428 ) show
0 300 moveto (6429 ) show
0 288 moveto (6430 ) show
0 276 moveto (6431 ) show
0 264 moveto (6432 ) show
0 252 moveto (6433 ) show
0 240 moveto (6434 ) show
0 228 moveto (6435 ) show
0 216 moveto (6436 ) show
0 204 moveto (6437 ) show
0 192 moveto (6438 ) show
0 180 moveto (6439 ) show
0 168 moveto (6440 ) show
0 156 moveto (6441 ) show
0 144 moveto (6442 ) show
0 132 moveto (6443 ) show
0 120 moveto (6444 ) show
0 108 moveto (6445 ) show
0 96 moveto (6446 ) show
0 84 moveto (6447 ) show
0 72 moveto (6448 ) show
0 60 moveto (6449 ) show
0 24 moveto (Sheet 64) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mp.h  Page 1) show
0 648 moveto (6450 // See MultiProcessor Specification Version 1.[14]) show
0 636 moveto (6451 ) show
0 624 moveto (6452 struct mp {             // floating pointer) show
0 612 moveto (6453   uchar signature[4];           // "_MP_") show
0 600 moveto (6454   void *physaddr;               // phys addr of MP config table) show
0 588 moveto (6455   uchar length;                 // 1) show
0 576 moveto (6456   uchar specrev;                // [14]) show
0 564 moveto (6457   uchar checksum;               // all bytes must add up to 0) show
0 552 moveto (6458   uchar type;                   // MP system config type) show
0 540 moveto (6459   uchar imcrp;) show
0 528 moveto (6460   uchar reserved[3];) show
0 516 moveto (6461 };) show
0 504 moveto (6462 ) show
0 492 moveto (6463 struct mpconf {         // configuration table header) show
0 480 moveto (6464   uchar signature[4];           // "PCMP") show
0 468 moveto (6465   ushort length;                // total table length) show
0 456 moveto (6466   uchar version;                // [14]) show
0 444 moveto (6467   uchar checksum;               // all bytes must add up to 0) show
0 432 moveto (6468   uchar product[20];            // product id) show
0 420 moveto (6469   uint *oemtable;               // OEM table pointer) show
0 408 moveto (6470   ushort oemlength;             // OEM table length) show
0 396 moveto (6471   ushort entry;                 // entry count) show
0 384 moveto (6472   uint *lapicaddr;              // address of local APIC) show
0 372 moveto (6473   ushort xlength;               // extended table length) show
0 360 moveto (6474   uchar xchecksum;              // extended table checksum) show
0 348 moveto (6475   uchar reserved;) show
0 336 moveto (6476 };) show
0 324 moveto (6477 ) show
0 312 moveto (6478 struct mpproc {         // processor table entry) show
0 300 moveto (6479   uchar type;                   // entry type \(0\)) show
0 288 moveto (6480   uchar apicid;                 // local APIC id) show
0 276 moveto (6481   uchar version;                // local APIC verison) show
0 264 moveto (6482   uchar flags;                  // CPU flags) show
0 252 moveto (6483     #define MPBOOT 0x02           // This proc is the bootstrap processor.) show
0 240 moveto (6484   uchar signature[4];           // CPU signature) show
0 228 moveto (6485   uint feature;                 // feature flags from CPUID instruction) show
0 216 moveto (6486   uchar reserved[8];) show
0 204 moveto (6487 };) show
0 192 moveto (6488 ) show
0 180 moveto (6489 struct mpioapic {       // I/O APIC table entry) show
0 168 moveto (6490   uchar type;                   // entry type \(2\)) show
0 156 moveto (6491   uchar apicno;                 // I/O APIC id) show
0 144 moveto (6492   uchar version;                // I/O APIC version) show
0 132 moveto (6493   uchar flags;                  // I/O APIC flags) show
0 120 moveto (6494   uint *addr;                  // I/O APIC address) show
0 108 moveto (6495 };) show
0 96 moveto (6496 ) show
0 84 moveto (6497 ) show
0 72 moveto (6498 ) show
0 60 moveto (6499 ) show
0 24 moveto (Sheet 64) show
grestore
restore
showpage
%%Page: 74 74
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mp.h  Page 2) show
0 648 moveto (6500 // Table entry types) show
0 636 moveto (6501 #define MPPROC    0x00  // One per processor) show
0 624 moveto (6502 #define MPBUS     0x01  // One per bus) show
0 612 moveto (6503 #define MPIOAPIC  0x02  // One per I/O APIC) show
0 600 moveto (6504 #define MPIOINTR  0x03  // One per bus interrupt source) show
0 588 moveto (6505 #define MPLINTR   0x04  // One per system interrupt source) show
0 576 moveto (6506 ) show
0 564 moveto (6507 ) show
0 552 moveto (6508 ) show
0 540 moveto (6509 ) show
0 528 moveto (6510 ) show
0 516 moveto (6511 ) show
0 504 moveto (6512 ) show
0 492 moveto (6513 ) show
0 480 moveto (6514 ) show
0 468 moveto (6515 ) show
0 456 moveto (6516 ) show
0 444 moveto (6517 ) show
0 432 moveto (6518 ) show
0 420 moveto (6519 ) show
0 408 moveto (6520 ) show
0 396 moveto (6521 ) show
0 384 moveto (6522 ) show
0 372 moveto (6523 ) show
0 360 moveto (6524 ) show
0 348 moveto (6525 ) show
0 336 moveto (6526 ) show
0 324 moveto (6527 ) show
0 312 moveto (6528 ) show
0 300 moveto (6529 ) show
0 288 moveto (6530 ) show
0 276 moveto (6531 ) show
0 264 moveto (6532 ) show
0 252 moveto (6533 ) show
0 240 moveto (6534 ) show
0 228 moveto (6535 ) show
0 216 moveto (6536 ) show
0 204 moveto (6537 ) show
0 192 moveto (6538 ) show
0 180 moveto (6539 ) show
0 168 moveto (6540 ) show
0 156 moveto (6541 ) show
0 144 moveto (6542 ) show
0 132 moveto (6543 ) show
0 120 moveto (6544 ) show
0 108 moveto (6545 ) show
0 96 moveto (6546 ) show
0 84 moveto (6547 ) show
0 72 moveto (6548 ) show
0 60 moveto (6549 ) show
0 24 moveto (Sheet 65) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mp.c  Page 1) show
0 648 moveto (6550 // Multiprocessor bootstrap.) show
0 636 moveto (6551 // Search memory for MP description structures.) show
0 624 moveto (6552 // http://developer.intel.com/design/pentium/datashts/24201606.pdf) show
0 612 moveto (6553 ) show
0 600 moveto (6554 #include "types.h") show
0 588 moveto (6555 #include "defs.h") show
0 576 moveto (6556 #include "param.h") show
0 564 moveto (6557 #include "mp.h") show
0 552 moveto (6558 #include "x86.h") show
0 540 moveto (6559 #include "mmu.h") show
0 528 moveto (6560 #include "proc.h") show
0 516 moveto (6561 ) show
0 504 moveto (6562 struct cpu cpus[NCPU];) show
0 492 moveto (6563 static struct cpu *bcpu;) show
0 480 moveto (6564 int ismp;) show
0 468 moveto (6565 int ncpu;) show
0 456 moveto (6566 uchar ioapic_id;) show
0 444 moveto (6567 ) show
0 432 moveto (6568 int) show
0 420 moveto (6569 mp_bcpu\(void\)) show
0 408 moveto (6570 {) show
0 396 moveto (6571   return bcpu-cpus;) show
0 384 moveto (6572 }) show
0 372 moveto (6573 ) show
0 360 moveto (6574 static uchar) show
0 348 moveto (6575 sum\(uchar *addr, int len\)) show
0 336 moveto (6576 {) show
0 324 moveto (6577   int i, sum;) show
0 312 moveto (6578 ) show
0 300 moveto (6579   sum = 0;) show
0 288 moveto (6580   for\(i=0; i<len; i++\)) show
0 276 moveto (6581     sum += addr[i];) show
0 264 moveto (6582   return sum;) show
0 252 moveto (6583 }) show
0 240 moveto (6584 ) show
0 228 moveto (6585 // Look for an MP structure in the len bytes at addr.) show
0 216 moveto (6586 static struct mp*) show
0 204 moveto (6587 mp_search1\(uchar *addr, int len\)) show
0 192 moveto (6588 {) show
0 180 moveto (6589   uchar *e, *p;) show
0 168 moveto (6590 ) show
0 156 moveto (6591   e = addr+len;) show
0 144 moveto (6592   for\(p = addr; p < e; p += sizeof\(struct mp\)\)) show
0 132 moveto (6593     if\(memcmp\(p, "_MP_", 4\) == 0 && sum\(p, sizeof\(struct mp\)\) == 0\)) show
0 120 moveto (6594       return \(struct mp*\)p;) show
0 108 moveto (6595   return 0;) show
0 96 moveto (6596 }) show
0 84 moveto (6597 ) show
0 72 moveto (6598 ) show
0 60 moveto (6599 ) show
0 24 moveto (Sheet 65) show
grestore
restore
showpage
%%Page: 75 75
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mp.c  Page 2) show
0 648 moveto (6600 // Search for the MP Floating Pointer Structure, which according to the) show
0 636 moveto (6601 // spec is in one of the following three locations:) show
0 624 moveto (6602 // 1\) in the first KB of the EBDA;) show
0 612 moveto (6603 // 2\) in the last KB of system base memory;) show
0 600 moveto (6604 // 3\) in the BIOS ROM between 0xE0000 and 0xFFFFF.) show
0 588 moveto (6605 static struct mp*) show
0 576 moveto (6606 mp_search\(void\)) show
0 564 moveto (6607 {) show
0 552 moveto (6608   uchar *bda;) show
0 540 moveto (6609   uint p;) show
0 528 moveto (6610   struct mp *mp;) show
0 516 moveto (6611 ) show
0 504 moveto (6612   bda = \(uchar*\)0x400;) show
0 492 moveto (6613   if\(\(p = \(bda[0x0F]<<8\)|bda[0x0E]\)\){) show
0 480 moveto (6614     if\(\(mp = mp_search1\(\(uchar*\)p, 1024\)\)\)) show
0 468 moveto (6615       return mp;) show
0 456 moveto (6616   } else {) show
0 444 moveto (6617     p = \(\(bda[0x14]<<8\)|bda[0x13]\)*1024;) show
0 432 moveto (6618     if\(\(mp = mp_search1\(\(uchar*\)p-1024, 1024\)\)\)) show
0 420 moveto (6619       return mp;) show
0 408 moveto (6620   }) show
0 396 moveto (6621   return mp_search1\(\(uchar*\)0xF0000, 0x10000\);) show
0 384 moveto (6622 }) show
0 372 moveto (6623 ) show
0 360 moveto (6624 // Search for an MP configuration table.  For now,) show
0 348 moveto (6625 // don't accept the default configurations \(physaddr == 0\).) show
0 336 moveto (6626 // Check for correct signature, calculate the checksum and,) show
0 324 moveto (6627 // if correct, check the version.) show
0 312 moveto (6628 // To do: check extended table checksum.) show
0 300 moveto (6629 static struct mpconf*) show
0 288 moveto (6630 mp_config\(struct mp **pmp\)) show
0 276 moveto (6631 {) show
0 264 moveto (6632   struct mpconf *conf;) show
0 252 moveto (6633   struct mp *mp;) show
0 240 moveto (6634 ) show
0 228 moveto (6635   if\(\(mp = mp_search\(\)\) == 0 || mp->physaddr == 0\)) show
0 216 moveto (6636     return 0;) show
0 204 moveto (6637   conf = \(struct mpconf*\)mp->physaddr;) show
0 192 moveto (6638   if\(memcmp\(conf, "PCMP", 4\) != 0\)) show
0 180 moveto (6639     return 0;) show
0 168 moveto (6640   if\(conf->version != 1 && conf->version != 4\)) show
0 156 moveto (6641     return 0;) show
0 144 moveto (6642   if\(sum\(\(uchar*\)conf, conf->length\) != 0\)) show
0 132 moveto (6643     return 0;) show
0 120 moveto (6644   *pmp = mp;) show
0 108 moveto (6645   return conf;) show
0 96 moveto (6646 }) show
0 84 moveto (6647 ) show
0 72 moveto (6648 ) show
0 60 moveto (6649 ) show
0 24 moveto (Sheet 66) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/mp.c  Page 3) show
0 648 moveto (6650 void) show
0 636 moveto (6651 mp_init\(void\)) show
0 624 moveto (6652 {) show
0 612 moveto (6653   uchar *p, *e;) show
0 600 moveto (6654   struct mp *mp;) show
0 588 moveto (6655   struct mpconf *conf;) show
0 576 moveto (6656   struct mpproc *proc;) show
0 564 moveto (6657   struct mpioapic *ioapic;) show
0 552 moveto (6658 ) show
0 540 moveto (6659   bcpu = &cpus[ncpu];) show
0 528 moveto (6660   if\(\(conf = mp_config\(&mp\)\) == 0\)) show
0 516 moveto (6661     return;) show
0 504 moveto (6662 ) show
0 492 moveto (6663   ismp = 1;) show
0 480 moveto (6664   lapic = \(uint*\)conf->lapicaddr;) show
0 468 moveto (6665 ) show
0 456 moveto (6666   for\(p=\(uchar*\)\(conf+1\), e=\(uchar*\)conf+conf->length; p<e; \){) show
0 444 moveto (6667     switch\(*p\){) show
0 432 moveto (6668     case MPPROC:) show
0 420 moveto (6669       proc = \(struct mpproc*\)p;) show
0 408 moveto (6670       cpus[ncpu].apicid = proc->apicid;) show
0 396 moveto (6671       if\(proc->flags & MPBOOT\)) show
0 384 moveto (6672         bcpu = &cpus[ncpu];) show
0 372 moveto (6673       ncpu++;) show
0 360 moveto (6674       p += sizeof\(struct mpproc\);) show
0 348 moveto (6675       continue;) show
0 336 moveto (6676     case MPIOAPIC:) show
0 324 moveto (6677       ioapic = \(struct mpioapic*\)p;) show
0 312 moveto (6678       ioapic_id = ioapic->apicno;) show
0 300 moveto (6679       p += sizeof\(struct mpioapic\);) show
0 288 moveto (6680       continue;) show
0 276 moveto (6681     case MPBUS:) show
0 264 moveto (6682     case MPIOINTR:) show
0 252 moveto (6683     case MPLINTR:) show
0 240 moveto (6684       p += 8;) show
0 228 moveto (6685       continue;) show
0 216 moveto (6686     default:) show
0 204 moveto (6687       cprintf\("mp_init: unknown config type %x\\n", *p\);) show
0 192 moveto (6688       panic\("mp_init"\);) show
0 180 moveto (6689     }) show
0 168 moveto (6690   }) show
0 156 moveto (6691 ) show
0 144 moveto (6692   if\(mp->imcrp\){) show
0 132 moveto (6693     // Bochs doesn't support IMCR, so this doesn't run on Bochs.) show
0 120 moveto (6694     // But it would on real hardware.) show
0 108 moveto (6695     outb\(0x22, 0x70\);   // Select IMCR) show
0 96 moveto (6696     outb\(0x23, inb\(0x23\) | 1\);  // Mask external interrupts.) show
0 84 moveto (6697   }) show
0 72 moveto (6698 }) show
0 60 moveto (6699 ) show
0 24 moveto (Sheet 66) show
grestore
restore
showpage
%%Page: 76 76
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/lapic.c  Page 1) show
0 648 moveto (6700 // The local APIC manages internal \(non-I/O\) interrupts.) show
0 636 moveto (6701 // See Chapter 8 & Appendix C of Intel processor manual volume 3.) show
0 624 moveto (6702 ) show
0 612 moveto (6703 #include "types.h") show
0 600 moveto (6704 #include "traps.h") show
0 588 moveto (6705 ) show
0 576 moveto (6706 // Local APIC registers, divided by 4 for use as uint[] indices.) show
0 564 moveto (6707 #define ID      \(0x0020/4\)   // ID) show
0 552 moveto (6708 #define VER     \(0x0030/4\)   // Version) show
0 540 moveto (6709 #define TPR     \(0x0080/4\)   // Task Priority) show
0 528 moveto (6710 #define EOI     \(0x00B0/4\)   // EOI) show
0 516 moveto (6711 #define SVR     \(0x00F0/4\)   // Spurious Interrupt Vector) show
0 504 moveto (6712   #define ENABLE     0x00000100   // Unit Enable) show
0 492 moveto (6713 #define ESR     \(0x0280/4\)   // Error Status) show
0 480 moveto (6714 #define ICRLO   \(0x0300/4\)   // Interrupt Command) show
0 468 moveto (6715   #define INIT       0x00000500   // INIT/RESET) show
0 456 moveto (6716   #define STARTUP    0x00000600   // Startup IPI) show
0 444 moveto (6717   #define DELIVS     0x00001000   // Delivery status) show
0 432 moveto (6718   #define ASSERT     0x00004000   // Assert interrupt \(vs deassert\)) show
0 420 moveto (6719   #define LEVEL      0x00008000   // Level triggered) show
0 408 moveto (6720   #define BCAST      0x00080000   // Send to all APICs, including self.) show
0 396 moveto (6721 #define ICRHI   \(0x0310/4\)   // Interrupt Command [63:32]) show
0 384 moveto (6722 #define TIMER   \(0x0320/4\)   // Local Vector Table 0 \(TIMER\)) show
0 372 moveto (6723   #define X1         0x0000000B   // divide counts by 1) show
0 360 moveto (6724   #define PERIODIC   0x00020000   // Periodic) show
0 348 moveto (6725 #define PCINT   \(0x0340/4\)   // Performance Counter LVT) show
0 336 moveto (6726 #define LINT0   \(0x0350/4\)   // Local Vector Table 1 \(LINT0\)) show
0 324 moveto (6727 #define LINT1   \(0x0360/4\)   // Local Vector Table 2 \(LINT1\)) show
0 312 moveto (6728 #define ERROR   \(0x0370/4\)   // Local Vector Table 3 \(ERROR\)) show
0 300 moveto (6729   #define MASKED     0x00010000   // Interrupt masked) show
0 288 moveto (6730 #define TICR    \(0x0380/4\)   // Timer Initial Count) show
0 276 moveto (6731 #define TCCR    \(0x0390/4\)   // Timer Current Count) show
0 264 moveto (6732 #define TDCR    \(0x03E0/4\)   // Timer Divide Configuration) show
0 252 moveto (6733 ) show
0 240 moveto (6734 volatile uint *lapic;  // Initialized in mp.c) show
0 228 moveto (6735 ) show
0 216 moveto (6736 void) show
0 204 moveto (6737 lapic_init\(int c\)) show
0 192 moveto (6738 {) show
0 180 moveto (6739   if\(!lapic\)) show
0 168 moveto (6740     return;) show
0 156 moveto (6741 ) show
0 144 moveto (6742   // Enable local APIC; set spurious interrupt vector.) show
0 132 moveto (6743   lapic[SVR] = ENABLE | \(IRQ_OFFSET+IRQ_SPURIOUS\);) show
0 120 moveto (6744 ) show
0 108 moveto (6745   // The timer repeatedly counts down at bus frequency) show
0 96 moveto (6746   // from lapic[TICR] and then issues an interrupt.) show
0 84 moveto (6747   // Lapic[TCCR] is the current counter value.) show
0 72 moveto (6748   // If xv6 cared more about precise timekeeping, the) show
0 60 moveto (6749   // values of TICR and TCCR would be calibrated using) show
0 24 moveto (Sheet 67) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/lapic.c  Page 2) show
0 648 moveto (6750   // an external time source.) show
0 636 moveto (6751   lapic[TDCR] = X1;) show
0 624 moveto (6752   lapic[TICR] = 10000000;) show
0 612 moveto (6753   lapic[TCCR] = 10000000;) show
0 600 moveto (6754   lapic[TIMER] = PERIODIC | \(IRQ_OFFSET + IRQ_TIMER\);) show
0 588 moveto (6755 ) show
0 576 moveto (6756   // Disable logical interrupt lines.) show
0 564 moveto (6757   lapic[LINT0] = MASKED;) show
0 552 moveto (6758   lapic[LINT1] = MASKED;) show
0 540 moveto (6759 ) show
0 528 moveto (6760   // Disable performance counter overflow interrupts) show
0 516 moveto (6761   // on machines that provide that interrupt entry.) show
0 504 moveto (6762   if\(\(\(lapic[VER]>>16\) & 0xFF\) >= 4\)) show
0 492 moveto (6763     lapic[PCINT] = MASKED;) show
0 480 moveto (6764 ) show
0 468 moveto (6765   // Map error interrupt to IRQ_ERROR.) show
0 456 moveto (6766   lapic[ERROR] = IRQ_OFFSET+IRQ_ERROR;) show
0 444 moveto (6767 ) show
0 432 moveto (6768   // Clear error status register \(requires back-to-back writes\).) show
0 420 moveto (6769   lapic[ESR] = 0;) show
0 408 moveto (6770   lapic[ESR] = 0;) show
0 396 moveto (6771 ) show
0 384 moveto (6772   // Ack any outstanding interrupts.) show
0 372 moveto (6773   lapic[EOI] = 0;) show
0 360 moveto (6774 ) show
0 348 moveto (6775   // Send an Init Level De-Assert to synchronise arbitration ID's.) show
0 336 moveto (6776   lapic[ICRHI] = 0;) show
0 324 moveto (6777   lapic[ICRLO] = BCAST | INIT | LEVEL;) show
0 312 moveto (6778   while\(lapic[ICRLO] & DELIVS\)) show
0 300 moveto (6779     ;) show
0 288 moveto (6780 ) show
0 276 moveto (6781   // Enable interrupts on the APIC \(but not on the processor\).) show
0 264 moveto (6782   lapic[TPR] = 0;) show
0 252 moveto (6783 }) show
0 240 moveto (6784 ) show
0 228 moveto (6785 int) show
0 216 moveto (6786 cpu\(void\)) show
0 204 moveto (6787 {) show
0 192 moveto (6788   if\(lapic\)) show
0 180 moveto (6789     return lapic[ID]>>24;) show
0 168 moveto (6790   return 0;) show
0 156 moveto (6791 }) show
0 144 moveto (6792 ) show
0 132 moveto (6793 // Acknowledge interrupt.) show
0 120 moveto (6794 void) show
0 108 moveto (6795 lapic_eoi\(void\)) show
0 96 moveto (6796 {) show
0 84 moveto (6797   if\(lapic\)) show
0 72 moveto (6798     lapic[EOI] = 0;) show
0 60 moveto (6799 }) show
0 24 moveto (Sheet 67) show
grestore
restore
showpage
%%Page: 77 77
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/lapic.c  Page 3) show
0 648 moveto (6800 // Spin for a given number of microseconds.) show
0 636 moveto (6801 // On real hardware would want to tune this dynamically.) show
0 624 moveto (6802 static void) show
0 612 moveto (6803 microdelay\(int us\)) show
0 600 moveto (6804 {) show
0 588 moveto (6805   volatile int j = 0;) show
0 576 moveto (6806 ) show
0 564 moveto (6807   while\(us-- > 0\)) show
0 552 moveto (6808     for\(j=0; j<10000; j++\);) show
0 540 moveto (6809 }) show
0 528 moveto (6810 ) show
0 516 moveto (6811 // Start additional processor running bootstrap code at addr.) show
0 504 moveto (6812 // See Appendix B of MultiProcessor Specification.) show
0 492 moveto (6813 void) show
0 480 moveto (6814 lapic_startap\(uchar apicid, uint addr\)) show
0 468 moveto (6815 {) show
0 456 moveto (6816   int i;) show
0 444 moveto (6817   volatile int j = 0;) show
0 432 moveto (6818 ) show
0 420 moveto (6819   // Send INIT interrupt to reset other CPU.) show
0 408 moveto (6820   lapic[ICRHI] = apicid<<24;) show
0 396 moveto (6821   lapic[ICRLO] = INIT | LEVEL;) show
0 384 moveto (6822   microdelay\(10\);) show
0 372 moveto (6823 ) show
0 360 moveto (6824   // Send startup IPI \(twice!\) to enter bootstrap code.) show
0 348 moveto (6825   for\(i = 0; i < 2; i++\){) show
0 336 moveto (6826     lapic[ICRHI] = apicid<<24;) show
0 324 moveto (6827     lapic[ICRLO] = STARTUP | \(addr>>12\);) show
0 312 moveto (6828     for\(j=0; j<10000; j++\);  // 200us) show
0 300 moveto (6829   }) show
0 288 moveto (6830 }) show
0 276 moveto (6831 ) show
0 264 moveto (6832 ) show
0 252 moveto (6833 ) show
0 240 moveto (6834 ) show
0 228 moveto (6835 ) show
0 216 moveto (6836 ) show
0 204 moveto (6837 ) show
0 192 moveto (6838 ) show
0 180 moveto (6839 ) show
0 168 moveto (6840 ) show
0 156 moveto (6841 ) show
0 144 moveto (6842 ) show
0 132 moveto (6843 ) show
0 120 moveto (6844 ) show
0 108 moveto (6845 ) show
0 96 moveto (6846 ) show
0 84 moveto (6847 ) show
0 72 moveto (6848 ) show
0 60 moveto (6849 ) show
0 24 moveto (Sheet 68) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/ioapic.c  Page 1) show
0 648 moveto (6850 // The I/O APIC manages hardware interrupts for an SMP system.) show
0 636 moveto (6851 // http://www.intel.com/design/chipsets/datashts/29056601.pdf) show
0 624 moveto (6852 // See also picirq.c.) show
0 612 moveto (6853 ) show
0 600 moveto (6854 #include "types.h") show
0 588 moveto (6855 #include "defs.h") show
0 576 moveto (6856 #include "traps.h") show
0 564 moveto (6857 ) show
0 552 moveto (6858 #define IOAPIC  0xFEC00000   // Default physical address of IO APIC) show
0 540 moveto (6859 ) show
0 528 moveto (6860 #define REG_ID     0x00  // Register index: ID) show
0 516 moveto (6861 #define REG_VER    0x01  // Register index: version) show
0 504 moveto (6862 #define REG_TABLE  0x10  // Redirection table base) show
0 492 moveto (6863 ) show
0 480 moveto (6864 // The redirection table starts at REG_TABLE and uses) show
0 468 moveto (6865 // two registers to configure each interrupt.) show
0 456 moveto (6866 // The first \(low\) register in a pair contains configuration bits.) show
0 444 moveto (6867 // The second \(high\) register contains a bitmask telling which) show
0 432 moveto (6868 // CPUs can serve that interrupt.) show
0 420 moveto (6869 #define INT_DISABLED   0x00100000  // Interrupt disabled) show
0 408 moveto (6870 #define INT_LEVEL      0x00008000  // Level-triggered \(vs edge-\)) show
0 396 moveto (6871 #define INT_ACTIVELOW  0x00002000  // Active low \(vs high\)) show
0 384 moveto (6872 #define INT_LOGICAL    0x00000800  // Destination is CPU id \(vs APIC ID\)) show
0 372 moveto (6873 ) show
0 360 moveto (6874 volatile struct ioapic *ioapic;) show
0 348 moveto (6875 ) show
0 336 moveto (6876 // IO APIC MMIO structure: write reg, then read or write data.) show
0 324 moveto (6877 struct ioapic {) show
0 312 moveto (6878   uint reg;) show
0 300 moveto (6879   uint pad[3];) show
0 288 moveto (6880   uint data;) show
0 276 moveto (6881 };) show
0 264 moveto (6882 ) show
0 252 moveto (6883 static uint) show
0 240 moveto (6884 ioapic_read\(int reg\)) show
0 228 moveto (6885 {) show
0 216 moveto (6886   ioapic->reg = reg;) show
0 204 moveto (6887   return ioapic->data;) show
0 192 moveto (6888 }) show
0 180 moveto (6889 ) show
0 168 moveto (6890 static void) show
0 156 moveto (6891 ioapic_write\(int reg, uint data\)) show
0 144 moveto (6892 {) show
0 132 moveto (6893   ioapic->reg = reg;) show
0 120 moveto (6894   ioapic->data = data;) show
0 108 moveto (6895 }) show
0 96 moveto (6896 ) show
0 84 moveto (6897 ) show
0 72 moveto (6898 ) show
0 60 moveto (6899 ) show
0 24 moveto (Sheet 68) show
grestore
restore
showpage
%%Page: 78 78
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/ioapic.c  Page 2) show
0 648 moveto (6900 void) show
0 636 moveto (6901 ioapic_init\(void\)) show
0 624 moveto (6902 {) show
0 612 moveto (6903   int i, id, maxintr;) show
0 600 moveto (6904 ) show
0 588 moveto (6905   if\(!ismp\)) show
0 576 moveto (6906     return;) show
0 564 moveto (6907 ) show
0 552 moveto (6908   ioapic = \(volatile struct ioapic*\)IOAPIC;) show
0 540 moveto (6909   maxintr = \(ioapic_read\(REG_VER\) >> 16\) & 0xFF;) show
0 528 moveto (6910   id = ioapic_read\(REG_ID\) >> 24;) show
0 516 moveto (6911   if\(id != ioapic_id\)) show
0 504 moveto (6912     cprintf\("ioapic_init: id isn't equal to ioapic_id; not a MP\\n"\);) show
0 492 moveto (6913 ) show
0 480 moveto (6914   // Mark all interrupts edge-triggered, active high, disabled,) show
0 468 moveto (6915   // and not routed to any CPUs.) show
0 456 moveto (6916   for\(i = 0; i <= maxintr; i++\){) show
0 444 moveto (6917     ioapic_write\(REG_TABLE+2*i, INT_DISABLED | \(IRQ_OFFSET + i\)\);) show
0 432 moveto (6918     ioapic_write\(REG_TABLE+2*i+1, 0\);) show
0 420 moveto (6919   }) show
0 408 moveto (6920 }) show
0 396 moveto (6921 ) show
0 384 moveto (6922 void) show
0 372 moveto (6923 ioapic_enable\(int irq, int cpunum\)) show
0 360 moveto (6924 {) show
0 348 moveto (6925   if\(!ismp\)) show
0 336 moveto (6926     return;) show
0 324 moveto (6927 ) show
0 312 moveto (6928   // Mark interrupt edge-triggered, active high,) show
0 300 moveto (6929   // enabled, and routed to the given cpunum,) show
0 288 moveto (6930   // which happens to be that cpu's APIC ID.) show
0 276 moveto (6931   ioapic_write\(REG_TABLE+2*irq, IRQ_OFFSET + irq\);) show
0 264 moveto (6932   ioapic_write\(REG_TABLE+2*irq+1, cpunum << 24\);) show
0 252 moveto (6933 }) show
0 240 moveto (6934 ) show
0 228 moveto (6935 ) show
0 216 moveto (6936 ) show
0 204 moveto (6937 ) show
0 192 moveto (6938 ) show
0 180 moveto (6939 ) show
0 168 moveto (6940 ) show
0 156 moveto (6941 ) show
0 144 moveto (6942 ) show
0 132 moveto (6943 ) show
0 120 moveto (6944 ) show
0 108 moveto (6945 ) show
0 96 moveto (6946 ) show
0 84 moveto (6947 ) show
0 72 moveto (6948 ) show
0 60 moveto (6949 ) show
0 24 moveto (Sheet 69) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/picirq.h  Page 1) show
0 648 moveto (6950 #ifndef XV6_PICIRQ_H_) show
0 636 moveto (6951 #define XV6_PICIRQ_H_) show
0 624 moveto (6952 #include "x86.h") show
0 612 moveto (6953 ) show
0 600 moveto (6954 typedef void \(*irq_handler_t\)\(struct trapframe *\);) show
0 588 moveto (6955 extern irq_handler_t irq_handler[];) show
0 576 moveto (6956 void reg_irq_handler\(int irq_num, irq_handler_t handler\);) show
0 564 moveto (6957 #define IRQ_MAX         256) show
0 552 moveto (6958 ) show
0 540 moveto (6959 #endif // XV6_PICIRQ_H_) show
0 528 moveto (6960 ) show
0 516 moveto (6961 ) show
0 504 moveto (6962 ) show
0 492 moveto (6963 ) show
0 480 moveto (6964 ) show
0 468 moveto (6965 ) show
0 456 moveto (6966 ) show
0 444 moveto (6967 ) show
0 432 moveto (6968 ) show
0 420 moveto (6969 ) show
0 408 moveto (6970 ) show
0 396 moveto (6971 ) show
0 384 moveto (6972 ) show
0 372 moveto (6973 ) show
0 360 moveto (6974 ) show
0 348 moveto (6975 ) show
0 336 moveto (6976 ) show
0 324 moveto (6977 ) show
0 312 moveto (6978 ) show
0 300 moveto (6979 ) show
0 288 moveto (6980 ) show
0 276 moveto (6981 ) show
0 264 moveto (6982 ) show
0 252 moveto (6983 ) show
0 240 moveto (6984 ) show
0 228 moveto (6985 ) show
0 216 moveto (6986 ) show
0 204 moveto (6987 ) show
0 192 moveto (6988 ) show
0 180 moveto (6989 ) show
0 168 moveto (6990 ) show
0 156 moveto (6991 ) show
0 144 moveto (6992 ) show
0 132 moveto (6993 ) show
0 120 moveto (6994 ) show
0 108 moveto (6995 ) show
0 96 moveto (6996 ) show
0 84 moveto (6997 ) show
0 72 moveto (6998 ) show
0 60 moveto (6999 ) show
0 24 moveto (Sheet 69) show
grestore
restore
showpage
%%Page: 79 79
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/picirq.c  Page 1) show
0 648 moveto (7000 // Intel 8259A programmable interrupt controllers.) show
0 636 moveto (7001 ) show
0 624 moveto (7002 #include "types.h") show
0 612 moveto (7003 #include "x86.h") show
0 600 moveto (7004 #include "picirq.h") show
0 588 moveto (7005 #include "traps.h") show
0 576 moveto (7006 #include "defs.h") show
0 564 moveto (7007 ) show
0 552 moveto (7008 irq_handler_t irq_handler[IRQ_MAX];) show
0 540 moveto (7009 // I/O Addresses of the two programmable interrupt controllers) show
0 528 moveto (7010 #define IO_PIC1         0x20    // Master \(IRQs 0-7\)) show
0 516 moveto (7011 #define IO_PIC2         0xA0    // Slave \(IRQs 8-15\)) show
0 504 moveto (7012 ) show
0 492 moveto (7013 #define IRQ_SLAVE       2       // IRQ at which slave connects to master) show
0 480 moveto (7014 ) show
0 468 moveto (7015 // Current IRQ mask.) show
0 456 moveto (7016 // Initial IRQ mask has interrupt 2 enabled \(for slave 8259A\).) show
0 444 moveto (7017 static ushort irqmask = 0xFFFF & ~\(1<<IRQ_SLAVE\);) show
0 432 moveto (7018 ) show
0 420 moveto (7019 void) show
0 408 moveto (7020 reg_irq_handler\(int irq_num, irq_handler_t handler\)) show
0 396 moveto (7021 {) show
0 384 moveto (7022     irq_handler[irq_num] = handler;) show
0 372 moveto (7023 }) show
0 360 moveto (7024 ) show
0 348 moveto (7025 static void) show
0 336 moveto (7026 pic_setmask\(ushort mask\)) show
0 324 moveto (7027 {) show
0 312 moveto (7028   irqmask = mask;) show
0 300 moveto (7029   outb\(IO_PIC1+1, mask\);) show
0 288 moveto (7030   outb\(IO_PIC2+1, mask >> 8\);) show
0 276 moveto (7031 }) show
0 264 moveto (7032 ) show
0 252 moveto (7033 void) show
0 240 moveto (7034 pic_enable\(int irq\)) show
0 228 moveto (7035 {) show
0 216 moveto (7036   pic_setmask\(irqmask & ~\(1<<irq\)\);) show
0 204 moveto (7037 }) show
0 192 moveto (7038 ) show
0 180 moveto (7039 ) show
0 168 moveto (7040 ) show
0 156 moveto (7041 ) show
0 144 moveto (7042 ) show
0 132 moveto (7043 ) show
0 120 moveto (7044 ) show
0 108 moveto (7045 ) show
0 96 moveto (7046 ) show
0 84 moveto (7047 ) show
0 72 moveto (7048 ) show
0 60 moveto (7049 ) show
0 24 moveto (Sheet 70) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/picirq.c  Page 2) show
0 648 moveto (7050 // Initialize the 8259A interrupt controllers.) show
0 636 moveto (7051 void) show
0 624 moveto (7052 pic_init\(void\)) show
0 612 moveto (7053 {) show
0 600 moveto (7054   // mask all interrupts) show
0 588 moveto (7055   outb\(IO_PIC1+1, 0xFF\);) show
0 576 moveto (7056   outb\(IO_PIC2+1, 0xFF\);) show
0 564 moveto (7057 ) show
0 552 moveto (7058   // Set up master \(8259A-1\)) show
0 540 moveto (7059 ) show
0 528 moveto (7060   // ICW1:  0001g0hi) show
0 516 moveto (7061   //    g:  0 = edge triggering, 1 = level triggering) show
0 504 moveto (7062   //    h:  0 = cascaded PICs, 1 = master only) show
0 492 moveto (7063   //    i:  0 = no ICW4, 1 = ICW4 required) show
0 480 moveto (7064   outb\(IO_PIC1, 0x11\);) show
0 468 moveto (7065 ) show
0 456 moveto (7066   // ICW2:  Vector offset) show
0 444 moveto (7067   outb\(IO_PIC1+1, IRQ_OFFSET\);) show
0 432 moveto (7068 ) show
0 420 moveto (7069   // ICW3:  \(master PIC\) bit mask of IR lines connected to slaves) show
0 408 moveto (7070   //        \(slave PIC\) 3-bit # of slave's connection to master) show
0 396 moveto (7071   outb\(IO_PIC1+1, 1<<IRQ_SLAVE\);) show
0 384 moveto (7072 ) show
0 372 moveto (7073   // ICW4:  000nbmap) show
0 360 moveto (7074   //    n:  1 = special fully nested mode) show
0 348 moveto (7075   //    b:  1 = buffered mode) show
0 336 moveto (7076   //    m:  0 = slave PIC, 1 = master PIC) show
0 324 moveto (7077   //      \(ignored when b is 0, as the master/slave role) show
0 312 moveto (7078   //      can be hardwired\).) show
0 300 moveto (7079   //    a:  1 = Automatic EOI mode) show
0 288 moveto (7080   //    p:  0 = MCS-80/85 mode, 1 = intel x86 mode) show
0 276 moveto (7081   outb\(IO_PIC1+1, 0x3\);) show
0 264 moveto (7082 ) show
0 252 moveto (7083   // Set up slave \(8259A-2\)) show
0 240 moveto (7084   outb\(IO_PIC2, 0x11\);                  // ICW1) show
0 228 moveto (7085   outb\(IO_PIC2+1, IRQ_OFFSET + 8\);      // ICW2) show
0 216 moveto (7086   outb\(IO_PIC2+1, IRQ_SLAVE\);           // ICW3) show
0 204 moveto (7087   // NB Automatic EOI mode doesn't tend to work on the slave.) show
0 192 moveto (7088   // Linux source code says it's "to be investigated".) show
0 180 moveto (7089   outb\(IO_PIC2+1, 0x3\);                 // ICW4) show
0 168 moveto (7090 ) show
0 156 moveto (7091   // OCW3:  0ef01prs) show
0 144 moveto (7092   //   ef:  0x = NOP, 10 = clear specific mask, 11 = set specific mask) show
0 132 moveto (7093   //    p:  0 = no polling, 1 = polling mode) show
0 120 moveto (7094   //   rs:  0x = NOP, 10 = read IRR, 11 = read ISR) show
0 108 moveto (7095   outb\(IO_PIC1, 0x68\);             // clear specific mask) show
0 96 moveto (7096   outb\(IO_PIC1, 0x0a\);             // read IRR by default) show
0 84 moveto (7097 ) show
0 72 moveto (7098   outb\(IO_PIC2, 0x68\);             // OCW3) show
0 60 moveto (7099   outb\(IO_PIC2, 0x0a\);             // OCW3) show
0 24 moveto (Sheet 70) show
grestore
restore
showpage
%%Page: 80 80
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/picirq.c  Page 3) show
0 648 moveto (7100   if\(irqmask != 0xFFFF\)) show
0 636 moveto (7101     pic_setmask\(irqmask\);) show
0 624 moveto (7102   memset\(irq_handler, 0, sizeof\(irq_handler\)\);) show
0 612 moveto (7103 }) show
0 600 moveto (7104 ) show
0 588 moveto (7105 ) show
0 576 moveto (7106 ) show
0 564 moveto (7107 ) show
0 552 moveto (7108 ) show
0 540 moveto (7109 ) show
0 528 moveto (7110 ) show
0 516 moveto (7111 ) show
0 504 moveto (7112 ) show
0 492 moveto (7113 ) show
0 480 moveto (7114 ) show
0 468 moveto (7115 ) show
0 456 moveto (7116 ) show
0 444 moveto (7117 ) show
0 432 moveto (7118 ) show
0 420 moveto (7119 ) show
0 408 moveto (7120 ) show
0 396 moveto (7121 ) show
0 384 moveto (7122 ) show
0 372 moveto (7123 ) show
0 360 moveto (7124 ) show
0 348 moveto (7125 ) show
0 336 moveto (7126 ) show
0 324 moveto (7127 ) show
0 312 moveto (7128 ) show
0 300 moveto (7129 ) show
0 288 moveto (7130 ) show
0 276 moveto (7131 ) show
0 264 moveto (7132 ) show
0 252 moveto (7133 ) show
0 240 moveto (7134 ) show
0 228 moveto (7135 ) show
0 216 moveto (7136 ) show
0 204 moveto (7137 ) show
0 192 moveto (7138 ) show
0 180 moveto (7139 ) show
0 168 moveto (7140 ) show
0 156 moveto (7141 ) show
0 144 moveto (7142 ) show
0 132 moveto (7143 ) show
0 120 moveto (7144 ) show
0 108 moveto (7145 ) show
0 96 moveto (7146 ) show
0 84 moveto (7147 ) show
0 72 moveto (7148 ) show
0 60 moveto (7149 ) show
0 24 moveto (Sheet 71) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kbd.h  Page 1) show
0 648 moveto (7150 // PC keyboard interface constants) show
0 636 moveto (7151 ) show
0 624 moveto (7152 #define KBSTATP         0x64    // kbd controller status port\(I\)) show
0 612 moveto (7153 #define KBS_DIB         0x01    // kbd data in buffer) show
0 600 moveto (7154 #define KBDATAP         0x60    // kbd data port\(I\)) show
0 588 moveto (7155 ) show
0 576 moveto (7156 #define NO              0) show
0 564 moveto (7157 ) show
0 552 moveto (7158 #define SHIFT           \(1<<0\)) show
0 540 moveto (7159 #define CTL             \(1<<1\)) show
0 528 moveto (7160 #define ALT             \(1<<2\)) show
0 516 moveto (7161 ) show
0 504 moveto (7162 #define CAPSLOCK        \(1<<3\)) show
0 492 moveto (7163 #define NUMLOCK         \(1<<4\)) show
0 480 moveto (7164 #define SCROLLLOCK      \(1<<5\)) show
0 468 moveto (7165 ) show
0 456 moveto (7166 #define E0ESC           \(1<<6\)) show
0 444 moveto (7167 ) show
0 432 moveto (7168 // Special keycodes) show
0 420 moveto (7169 #define KEY_HOME        0xE0) show
0 408 moveto (7170 #define KEY_END         0xE1) show
0 396 moveto (7171 #define KEY_UP          0xE2) show
0 384 moveto (7172 #define KEY_DN          0xE3) show
0 372 moveto (7173 #define KEY_LF          0xE4) show
0 360 moveto (7174 #define KEY_RT          0xE5) show
0 348 moveto (7175 #define KEY_PGUP        0xE6) show
0 336 moveto (7176 #define KEY_PGDN        0xE7) show
0 324 moveto (7177 #define KEY_INS         0xE8) show
0 312 moveto (7178 #define KEY_DEL         0xE9) show
0 300 moveto (7179 ) show
0 288 moveto (7180 // C\('A'\) == Control-A) show
0 276 moveto (7181 #define C\(x\) \(x - '@'\)) show
0 264 moveto (7182 ) show
0 252 moveto (7183 static uchar shiftcode[256] =) show
0 240 moveto (7184 {) show
0 228 moveto (7185   [0x1D] CTL,) show
0 216 moveto (7186   [0x2A] SHIFT,) show
0 204 moveto (7187   [0x36] SHIFT,) show
0 192 moveto (7188   [0x38] ALT,) show
0 180 moveto (7189   [0x9D] CTL,) show
0 168 moveto (7190   [0xB8] ALT) show
0 156 moveto (7191 };) show
0 144 moveto (7192 ) show
0 132 moveto (7193 static uchar togglecode[256] =) show
0 120 moveto (7194 {) show
0 108 moveto (7195   [0x3A] CAPSLOCK,) show
0 96 moveto (7196   [0x45] NUMLOCK,) show
0 84 moveto (7197   [0x46] SCROLLLOCK) show
0 72 moveto (7198 };) show
0 60 moveto (7199 ) show
0 24 moveto (Sheet 71) show
grestore
restore
showpage
%%Page: 81 81
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kbd.h  Page 2) show
0 648 moveto (7200 static uchar normalmap[256] =) show
0 636 moveto (7201 {) show
0 624 moveto (7202   NO,   0x1B, '1',  '2',  '3',  '4',  '5',  '6',  // 0x00) show
0 612 moveto (7203   '7',  '8',  '9',  '0',  '-',  '=',  '\\b', '\\t',) show
0 600 moveto (7204   'q',  'w',  'e',  'r',  't',  'y',  'u',  'i',  // 0x10) show
0 588 moveto (7205   'o',  'p',  '[',  ']',  '\\n', NO,   'a',  's',) show
0 576 moveto (7206   'd',  'f',  'g',  'h',  'j',  'k',  'l',  ';',  // 0x20) show
0 564 moveto (7207   '\\'', '`',  NO,   '\\\\', 'z',  'x',  'c',  'v',) show
0 552 moveto (7208   'b',  'n',  'm',  ',',  '.',  '/',  NO,   '*',  // 0x30) show
0 540 moveto (7209   NO,   ' ',  NO,   NO,   NO,   NO,   NO,   NO,) show
0 528 moveto (7210   NO,   NO,   NO,   NO,   NO,   NO,   NO,   '7',  // 0x40) show
0 516 moveto (7211   '8',  '9',  '-',  '4',  '5',  '6',  '+',  '1',) show
0 504 moveto (7212   '2',  '3',  '0',  '.',  NO,   NO,   NO,   NO,   // 0x50) show
0 492 moveto (7213   [0x9C] '\\n',      // KP_Enter) show
0 480 moveto (7214   [0xB5] '/',       // KP_Div) show
0 468 moveto (7215   [0xC8] KEY_UP,    [0xD0] KEY_DN,) show
0 456 moveto (7216   [0xC9] KEY_PGUP,  [0xD1] KEY_PGDN,) show
0 444 moveto (7217   [0xCB] KEY_LF,    [0xCD] KEY_RT,) show
0 432 moveto (7218   [0x97] KEY_HOME,  [0xCF] KEY_END,) show
0 420 moveto (7219   [0xD2] KEY_INS,   [0xD3] KEY_DEL) show
0 408 moveto (7220 };) show
0 396 moveto (7221 ) show
0 384 moveto (7222 static uchar shiftmap[256] =) show
0 372 moveto (7223 {) show
0 360 moveto (7224   NO,   033,  '!',  '@',  '#',  '$',  '%',  '^',  // 0x00) show
0 348 moveto (7225   '&',  '*',  '\(',  '\)',  '_',  '+',  '\\b', '\\t',) show
0 336 moveto (7226   'Q',  'W',  'E',  'R',  'T',  'Y',  'U',  'I',  // 0x10) show
0 324 moveto (7227   'O',  'P',  '{',  '}',  '\\n', NO,   'A',  'S',) show
0 312 moveto (7228   'D',  'F',  'G',  'H',  'J',  'K',  'L',  ':',  // 0x20) show
0 300 moveto (7229   '"',  '~',  NO,   '|',  'Z',  'X',  'C',  'V',) show
0 288 moveto (7230   'B',  'N',  'M',  '<',  '>',  '?',  NO,   '*',  // 0x30) show
0 276 moveto (7231   NO,   ' ',  NO,   NO,   NO,   NO,   NO,   NO,) show
0 264 moveto (7232   NO,   NO,   NO,   NO,   NO,   NO,   NO,   '7',  // 0x40) show
0 252 moveto (7233   '8',  '9',  '-',  '4',  '5',  '6',  '+',  '1',) show
0 240 moveto (7234   '2',  '3',  '0',  '.',  NO,   NO,   NO,   NO,   // 0x50) show
0 228 moveto (7235   [0x9C] '\\n',      // KP_Enter) show
0 216 moveto (7236   [0xB5] '/',       // KP_Div) show
0 204 moveto (7237   [0xC8] KEY_UP,    [0xD0] KEY_DN,) show
0 192 moveto (7238   [0xC9] KEY_PGUP,  [0xD1] KEY_PGDN,) show
0 180 moveto (7239   [0xCB] KEY_LF,    [0xCD] KEY_RT,) show
0 168 moveto (7240   [0x97] KEY_HOME,  [0xCF] KEY_END,) show
0 156 moveto (7241   [0xD2] KEY_INS,   [0xD3] KEY_DEL) show
0 144 moveto (7242 };) show
0 132 moveto (7243 ) show
0 120 moveto (7244 ) show
0 108 moveto (7245 ) show
0 96 moveto (7246 ) show
0 84 moveto (7247 ) show
0 72 moveto (7248 ) show
0 60 moveto (7249 ) show
0 24 moveto (Sheet 72) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kbd.h  Page 3) show
0 648 moveto (7250 static uchar ctlmap[256] =) show
0 636 moveto (7251 {) show
0 624 moveto (7252   NO,      NO,      NO,      NO,      NO,      NO,      NO,      NO,) show
0 612 moveto (7253   NO,      NO,      NO,      NO,      NO,      NO,      NO,      NO,) show
0 600 moveto (7254   C\('Q'\),  C\('W'\),  C\('E'\),  C\('R'\),  C\('T'\),  C\('Y'\),  C\('U'\),  C\('I'\),) show
0 588 moveto (7255   C\('O'\),  C\('P'\),  NO,      NO,      '\\r',    NO,      C\('A'\),  C\('S'\),) show
0 576 moveto (7256   C\('D'\),  C\('F'\),  C\('G'\),  C\('H'\),  C\('J'\),  C\('K'\),  C\('L'\),  NO,) show
0 564 moveto (7257   NO,      NO,      NO,      C\('\\\\'\), C\('Z'\),  C\('X'\),  C\('C'\),  C\('V'\),) show
0 552 moveto (7258   C\('B'\),  C\('N'\),  C\('M'\),  NO,      NO,      C\('/'\),  NO,      NO,) show
0 540 moveto (7259   [0x9C] '\\r',      // KP_Enter) show
0 528 moveto (7260   [0xB5] C\('/'\),    // KP_Div) show
0 516 moveto (7261   [0xC8] KEY_UP,    [0xD0] KEY_DN,) show
0 504 moveto (7262   [0xC9] KEY_PGUP,  [0xD1] KEY_PGDN,) show
0 492 moveto (7263   [0xCB] KEY_LF,    [0xCD] KEY_RT,) show
0 480 moveto (7264   [0x97] KEY_HOME,  [0xCF] KEY_END,) show
0 468 moveto (7265   [0xD2] KEY_INS,   [0xD3] KEY_DEL) show
0 456 moveto (7266 };) show
0 444 moveto (7267 ) show
0 432 moveto (7268 ) show
0 420 moveto (7269 ) show
0 408 moveto (7270 ) show
0 396 moveto (7271 ) show
0 384 moveto (7272 ) show
0 372 moveto (7273 ) show
0 360 moveto (7274 ) show
0 348 moveto (7275 ) show
0 336 moveto (7276 ) show
0 324 moveto (7277 ) show
0 312 moveto (7278 ) show
0 300 moveto (7279 ) show
0 288 moveto (7280 ) show
0 276 moveto (7281 ) show
0 264 moveto (7282 ) show
0 252 moveto (7283 ) show
0 240 moveto (7284 ) show
0 228 moveto (7285 ) show
0 216 moveto (7286 ) show
0 204 moveto (7287 ) show
0 192 moveto (7288 ) show
0 180 moveto (7289 ) show
0 168 moveto (7290 ) show
0 156 moveto (7291 ) show
0 144 moveto (7292 ) show
0 132 moveto (7293 ) show
0 120 moveto (7294 ) show
0 108 moveto (7295 ) show
0 96 moveto (7296 ) show
0 84 moveto (7297 ) show
0 72 moveto (7298 ) show
0 60 moveto (7299 ) show
0 24 moveto (Sheet 72) show
grestore
restore
showpage
%%Page: 82 82
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/kbd.c  Page 1) show
0 648 moveto (7300 #include "types.h") show
0 636 moveto (7301 #include "x86.h") show
0 624 moveto (7302 #include "defs.h") show
0 612 moveto (7303 #include "kbd.h") show
0 600 moveto (7304 ) show
0 588 moveto (7305 int) show
0 576 moveto (7306 kbd_getc\(void\)) show
0 564 moveto (7307 {) show
0 552 moveto (7308   static uint shift;) show
0 540 moveto (7309   static uchar *charcode[4] = {) show
0 528 moveto (7310     normalmap, shiftmap, ctlmap, ctlmap) show
0 516 moveto (7311   };) show
0 504 moveto (7312   uint st, data, c;) show
0 492 moveto (7313 ) show
0 480 moveto (7314   st = inb\(KBSTATP\);) show
0 468 moveto (7315   if\(\(st & KBS_DIB\) == 0\)) show
0 456 moveto (7316     return -1;) show
0 444 moveto (7317   data = inb\(KBDATAP\);) show
0 432 moveto (7318 ) show
0 420 moveto (7319   if\(data == 0xE0\){) show
0 408 moveto (7320     shift |= E0ESC;) show
0 396 moveto (7321     return 0;) show
0 384 moveto (7322   } else if\(data & 0x80\){) show
0 372 moveto (7323     // Key released) show
0 360 moveto (7324     data = \(shift & E0ESC ? data : data & 0x7F\);) show
0 348 moveto (7325     shift &= ~\(shiftcode[data] | E0ESC\);) show
0 336 moveto (7326     return 0;) show
0 324 moveto (7327   } else if\(shift & E0ESC\){) show
0 312 moveto (7328     // Last character was an E0 escape; or with 0x80) show
0 300 moveto (7329     data |= 0x80;) show
0 288 moveto (7330     shift &= ~E0ESC;) show
0 276 moveto (7331   }) show
0 264 moveto (7332 ) show
0 252 moveto (7333   shift |= shiftcode[data];) show
0 240 moveto (7334   shift ^= togglecode[data];) show
0 228 moveto (7335   c = charcode[shift & \(CTL | SHIFT\)][data];) show
0 216 moveto (7336   if\(shift & CAPSLOCK\){) show
0 204 moveto (7337     if\('a' <= c && c <= 'z'\)) show
0 192 moveto (7338       c += 'A' - 'a';) show
0 180 moveto (7339     else if\('A' <= c && c <= 'Z'\)) show
0 168 moveto (7340       c += 'a' - 'A';) show
0 156 moveto (7341   }) show
0 144 moveto (7342   return c;) show
0 132 moveto (7343 }) show
0 120 moveto (7344 ) show
0 108 moveto (7345 void) show
0 96 moveto (7346 kbd_intr\(void\)) show
0 84 moveto (7347 {) show
0 72 moveto (7348   console_intr\(kbd_getc\);) show
0 60 moveto (7349 }) show
0 24 moveto (Sheet 73) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 1) show
0 648 moveto (7350 // Console input and output.) show
0 636 moveto (7351 // Input is from the keyboard only.) show
0 624 moveto (7352 // Output is written to the screen and the printer port.) show
0 612 moveto (7353 ) show
0 600 moveto (7354 #include "types.h") show
0 588 moveto (7355 #include "defs.h") show
0 576 moveto (7356 #include "param.h") show
0 564 moveto (7357 #include "traps.h") show
0 552 moveto (7358 #include "spinlock.h") show
0 540 moveto (7359 #include "dev.h") show
0 528 moveto (7360 #include "mmu.h") show
0 516 moveto (7361 #include "proc.h") show
0 504 moveto (7362 #include "x86.h") show
0 492 moveto (7363 #include "thread.h") show
0 480 moveto (7364 #include "lwip/sockets.h") show
0 468 moveto (7365 ) show
0 456 moveto (7366 #define CRTPORT 0x3d4) show
0 444 moveto (7367 #define LPTPORT 0x378) show
0 432 moveto (7368 #define BACKSPACE 0x100) show
0 420 moveto (7369 ) show
0 408 moveto (7370 static ushort *crt = \(ushort*\)0xb8000;  // CGA memory) show
0 396 moveto (7371 ) show
0 384 moveto (7372 static struct spinlock console_lock;) show
0 372 moveto (7373 int panicked = 0;) show
0 360 moveto (7374 int use_console_lock = 0;) show
0 348 moveto (7375 ) show
0 336 moveto (7376 // Copy console output to parallel port, which you can tell) show
0 324 moveto (7377 // .bochsrc to copy to the stdout:) show
0 312 moveto (7378 //   parport1: enabled=1, file="/dev/stdout") show
0 300 moveto (7379 static void) show
0 288 moveto (7380 lpt_putc\(int c\)) show
0 276 moveto (7381 {) show
0 264 moveto (7382   int i;) show
0 252 moveto (7383 ) show
0 240 moveto (7384   for\(i = 0; !\(inb\(LPTPORT+1\) & 0x80\) && i < 12800; i++\)) show
0 228 moveto (7385     ;) show
0 216 moveto (7386   if\(c == BACKSPACE\)) show
0 204 moveto (7387     c = '\\b';) show
0 192 moveto (7388   outb\(LPTPORT+0, c\);) show
0 180 moveto (7389   outb\(LPTPORT+2, 0x08|0x04|0x01\);) show
0 168 moveto (7390   outb\(LPTPORT+2, 0x08\);) show
0 156 moveto (7391 }) show
0 144 moveto (7392 ) show
0 132 moveto (7393 ) show
0 120 moveto (7394 ) show
0 108 moveto (7395 ) show
0 96 moveto (7396 ) show
0 84 moveto (7397 ) show
0 72 moveto (7398 ) show
0 60 moveto (7399 ) show
0 24 moveto (Sheet 73) show
grestore
restore
showpage
%%Page: 83 83
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 2) show
0 648 moveto (7400 static void) show
0 636 moveto (7401 cga_putc\(int c\)) show
0 624 moveto (7402 {) show
0 612 moveto (7403   int pos;) show
0 600 moveto (7404 ) show
0 588 moveto (7405   // Cursor position: col + 80*row.) show
0 576 moveto (7406   outb\(CRTPORT, 14\);) show
0 564 moveto (7407   pos = inb\(CRTPORT+1\) << 8;) show
0 552 moveto (7408   outb\(CRTPORT, 15\);) show
0 540 moveto (7409   pos |= inb\(CRTPORT+1\);) show
0 528 moveto (7410 ) show
0 516 moveto (7411   if\(c == '\\n'\)) show
0 504 moveto (7412     pos += 80 - pos%80;) show
0 492 moveto (7413   else if\(c == BACKSPACE\){) show
0 480 moveto (7414     if\(pos > 0\)) show
0 468 moveto (7415       crt[--pos] = ' ' | 0x0700;) show
0 456 moveto (7416   } else) show
0 444 moveto (7417     crt[pos++] = \(c&0xff\) | 0x0700;  // black on white) show
0 432 moveto (7418 ) show
0 420 moveto (7419   if\(\(pos/80\) >= 24\){  // Scroll up.) show
0 408 moveto (7420     memmove\(crt, crt+80, sizeof\(crt[0]\)*23*80\);) show
0 396 moveto (7421     pos -= 80;) show
0 384 moveto (7422     memset\(crt + pos, 0, sizeof\(crt[0]\)*80\);) show
0 372 moveto (7423   }) show
0 360 moveto (7424 ) show
0 348 moveto (7425   outb\(CRTPORT, 14\);) show
0 336 moveto (7426   outb\(CRTPORT+1, pos>>8\);) show
0 324 moveto (7427   outb\(CRTPORT, 15\);) show
0 312 moveto (7428   outb\(CRTPORT+1, pos\);) show
0 300 moveto (7429   crt[pos] = ' ' | 0x0700;) show
0 288 moveto (7430 }) show
0 276 moveto (7431 ) show
0 264 moveto (7432 void) show
0 252 moveto (7433 cons_putc\(int c\)) show
0 240 moveto (7434 {) show
0 228 moveto (7435   if\(panicked\){) show
0 216 moveto (7436     cli\(\);) show
0 204 moveto (7437     for\(;;\)) show
0 192 moveto (7438       ;) show
0 180 moveto (7439   }) show
0 168 moveto (7440 ) show
0 156 moveto (7441   lpt_putc\(c\);) show
0 144 moveto (7442   cga_putc\(c\);) show
0 132 moveto (7443 }) show
0 120 moveto (7444 ) show
0 108 moveto (7445 ) show
0 96 moveto (7446 ) show
0 84 moveto (7447 ) show
0 72 moveto (7448 ) show
0 60 moveto (7449 ) show
0 24 moveto (Sheet 74) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 3) show
0 648 moveto (7450 void) show
0 636 moveto (7451 printintlen\(int xx, int base, int sgn, int len, char fill\)) show
0 624 moveto (7452 {) show
0 612 moveto (7453   static char digits[] = "0123456789ABCDEF";) show
0 600 moveto (7454   char buf[16];) show
0 588 moveto (7455   int i = 0, neg = 0, j = 0;) show
0 576 moveto (7456   uint x;) show
0 564 moveto (7457 ) show
0 552 moveto (7458   if\(sgn && xx < 0\){) show
0 540 moveto (7459     neg = 1;) show
0 528 moveto (7460     x = 0 - xx;) show
0 516 moveto (7461   } else {) show
0 504 moveto (7462     x = xx;) show
0 492 moveto (7463   }) show
0 480 moveto (7464 ) show
0 468 moveto (7465   do{) show
0 456 moveto (7466     buf[i++] = digits[x % base];) show
0 444 moveto (7467   }while\(\(x /= base\) != 0\);) show
0 432 moveto (7468   if\(neg\)) show
0 420 moveto (7469     buf[i++] = '-';) show
0 408 moveto (7470 ) show
0 396 moveto (7471   if \(i < len\)) show
0 384 moveto (7472   {) show
0 372 moveto (7473       if \(neg\)) show
0 360 moveto (7474       {) show
0 348 moveto (7475           cons_putc\('-'\);) show
0 336 moveto (7476           i--;) show
0 324 moveto (7477       }) show
0 312 moveto (7478       j = len - i;) show
0 300 moveto (7479       while \(j-- > 0\)) show
0 288 moveto (7480           cons_putc\(fill\);) show
0 276 moveto (7481   }) show
0 264 moveto (7482   while\(--i >= 0\)) show
0 252 moveto (7483     cons_putc\(buf[i]\);) show
0 240 moveto (7484 }) show
0 228 moveto (7485 ) show
0 216 moveto (7486 ) show
0 204 moveto (7487 ) show
0 192 moveto (7488 ) show
0 180 moveto (7489 ) show
0 168 moveto (7490 ) show
0 156 moveto (7491 ) show
0 144 moveto (7492 ) show
0 132 moveto (7493 ) show
0 120 moveto (7494 ) show
0 108 moveto (7495 ) show
0 96 moveto (7496 ) show
0 84 moveto (7497 ) show
0 72 moveto (7498 ) show
0 60 moveto (7499 ) show
0 24 moveto (Sheet 74) show
grestore
restore
showpage
%%Page: 84 84
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 4) show
0 648 moveto (7500 void) show
0 636 moveto (7501 printint\(int xx, int base, int sgn\)) show
0 624 moveto (7502 {) show
0 612 moveto (7503   static char digits[] = "0123456789ABCDEF";) show
0 600 moveto (7504   char buf[16];) show
0 588 moveto (7505   int i = 0, neg = 0;) show
0 576 moveto (7506   uint x;) show
0 564 moveto (7507 ) show
0 552 moveto (7508   if\(sgn && xx < 0\){) show
0 540 moveto (7509     neg = 1;) show
0 528 moveto (7510     x = 0 - xx;) show
0 516 moveto (7511   } else {) show
0 504 moveto (7512     x = xx;) show
0 492 moveto (7513   }) show
0 480 moveto (7514 ) show
0 468 moveto (7515   do{) show
0 456 moveto (7516     buf[i++] = digits[x % base];) show
0 444 moveto (7517   }while\(\(x /= base\) != 0\);) show
0 432 moveto (7518   if\(neg\)) show
0 420 moveto (7519     buf[i++] = '-';) show
0 408 moveto (7520 ) show
0 396 moveto (7521   while\(--i >= 0\)) show
0 384 moveto (7522     cons_putc\(buf[i]\);) show
0 372 moveto (7523 }) show
0 360 moveto (7524 ) show
0 348 moveto (7525 enum fmt_types {) show
0 336 moveto (7526     CHAR,) show
0 324 moveto (7527     SHORT,) show
0 312 moveto (7528     LONG,) show
0 300 moveto (7529     LONGLONG,) show
0 288 moveto (7530 };) show
0 276 moveto (7531 ) show
0 264 moveto (7532 // Print to the console. only understands %d, %x, %p, %s.) show
0 252 moveto (7533 void) show
0 240 moveto (7534 cprintf\(char *fmt, ...\)) show
0 228 moveto (7535 {) show
0 216 moveto (7536   int i, c, state, locking, len = 0;) show
0 204 moveto (7537   uint *argp;) show
0 192 moveto (7538   char *s, last, fill;) show
0 180 moveto (7539   enum fmt_types type;) show
0 168 moveto (7540 ) show
0 156 moveto (7541   locking = use_console_lock;) show
0 144 moveto (7542   if\(locking\)) show
0 132 moveto (7543     acquire\(&console_lock\);) show
0 120 moveto (7544 ) show
0 108 moveto (7545   argp = \(uint*\)\(void*\)&fmt + 1;) show
0 96 moveto (7546   state = 0;) show
0 84 moveto (7547   c = 0;) show
0 72 moveto (7548   fill = ' ';) show
0 60 moveto (7549   len = -1;) show
0 24 moveto (Sheet 75) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 5) show
0 648 moveto (7550   for\(i = 0; fmt[i]; i++\){) show
0 636 moveto (7551     last = c;) show
0 624 moveto (7552     c = fmt[i] & 0xff;) show
0 612 moveto (7553     switch\(state\){) show
0 600 moveto (7554     case 0:) show
0 588 moveto (7555       if\(c == '%'\)) show
0 576 moveto (7556         state = '%';) show
0 564 moveto (7557       else) show
0 552 moveto (7558         cons_putc\(c\);) show
0 540 moveto (7559       break;) show
0 528 moveto (7560 ) show
0 516 moveto (7561     case '%':) show
0 504 moveto (7562       switch\(c\){) show
0 492 moveto (7563       case 'l':) show
0 480 moveto (7564         if \(last == 'l'\)) show
0 468 moveto (7565         {) show
0 456 moveto (7566             // ll: long long) show
0 444 moveto (7567             type = LONGLONG;) show
0 432 moveto (7568         } else {) show
0 420 moveto (7569             type = LONG;) show
0 408 moveto (7570         }) show
0 396 moveto (7571         break;) show
0 384 moveto (7572       case 'h':) show
0 372 moveto (7573         if \(last == 'h'\)) show
0 360 moveto (7574         {) show
0 348 moveto (7575             // hh: char) show
0 336 moveto (7576             type = CHAR;) show
0 324 moveto (7577         } else {) show
0 312 moveto (7578             type = SHORT;) show
0 300 moveto (7579         }) show
0 288 moveto (7580         break;) show
0 276 moveto (7581       case 'c':) show
0 264 moveto (7582         cons_putc\(*argp++\);) show
0 252 moveto (7583         len = -1;) show
0 240 moveto (7584         state = 0;) show
0 228 moveto (7585         break;) show
0 216 moveto (7586       case 'd':) show
0 204 moveto (7587       case 'i':) show
0 192 moveto (7588         if \(len != -1\)) show
0 180 moveto (7589             printintlen\(*argp++, 10, 1, len, fill\);) show
0 168 moveto (7590         else) show
0 156 moveto (7591             printint\(*argp++, 10, 1\);) show
0 144 moveto (7592         fill = ' ';) show
0 132 moveto (7593         len = -1;) show
0 120 moveto (7594         state = 0;) show
0 108 moveto (7595         break;) show
0 96 moveto (7596       case 'u':) show
0 84 moveto (7597         if \(len != -1\)) show
0 72 moveto (7598             printintlen\(*argp++, 10, 0, len, fill\);) show
0 60 moveto (7599         else) show
0 24 moveto (Sheet 75) show
grestore
restore
showpage
%%Page: 85 85
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 6) show
0 648 moveto (7600             printint\(*argp++, 10, 0\);) show
0 636 moveto (7601         fill = ' ';) show
0 624 moveto (7602         len = -1;) show
0 612 moveto (7603         state = 0;) show
0 600 moveto (7604         break;) show
0 588 moveto (7605       case 'x':) show
0 576 moveto (7606       case 'p':) show
0 564 moveto (7607         if \(len != -1\)) show
0 552 moveto (7608             printintlen\(*argp++, 16, 0, len, fill\);) show
0 540 moveto (7609         else) show
0 528 moveto (7610             printint\(*argp++, 16, 0\);) show
0 516 moveto (7611         fill = ' ';) show
0 504 moveto (7612         len = -1;) show
0 492 moveto (7613         state = 0;) show
0 480 moveto (7614         break;) show
0 468 moveto (7615       case 's':) show
0 456 moveto (7616         s = \(char*\)*argp++;) show
0 444 moveto (7617         if\(s == 0\)) show
0 432 moveto (7618           s = "\(null\)";) show
0 420 moveto (7619         for\(; *s; s++\)) show
0 408 moveto (7620           cons_putc\(*s\);) show
0 396 moveto (7621         len = -1;) show
0 384 moveto (7622         state = 0;) show
0 372 moveto (7623         break;) show
0 360 moveto (7624       case '%':) show
0 348 moveto (7625         cons_putc\('%'\);) show
0 336 moveto (7626         state = 0;) show
0 324 moveto (7627         break;) show
0 312 moveto (7628       case '0':) show
0 300 moveto (7629         if \(len == -1\)) show
0 288 moveto (7630         {) show
0 276 moveto (7631             len = 0;) show
0 264 moveto (7632             fill = '0';) show
0 252 moveto (7633         } else {) show
0 240 moveto (7634             len = len * 10;) show
0 228 moveto (7635         }) show
0 216 moveto (7636         break;) show
0 204 moveto (7637       case '1':) show
0 192 moveto (7638       case '2':) show
0 180 moveto (7639       case '3':) show
0 168 moveto (7640       case '4':) show
0 156 moveto (7641       case '5':) show
0 144 moveto (7642       case '6':) show
0 132 moveto (7643       case '7':) show
0 120 moveto (7644       case '8':) show
0 108 moveto (7645       case '9':) show
0 96 moveto (7646         if \(len == -1\)) show
0 84 moveto (7647             len = c - '0';) show
0 72 moveto (7648         else) show
0 60 moveto (7649             len = len * 10 + c - '0';) show
0 24 moveto (Sheet 76) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 7) show
0 648 moveto (7650         break;) show
0 636 moveto (7651       default:) show
0 624 moveto (7652         // Print unknown % sequence to draw attention.) show
0 612 moveto (7653         cons_putc\('%'\);) show
0 600 moveto (7654         cons_putc\(c\);) show
0 588 moveto (7655         break;) show
0 576 moveto (7656       }) show
0 564 moveto (7657       break;) show
0 552 moveto (7658     }) show
0 540 moveto (7659   }) show
0 528 moveto (7660 ) show
0 516 moveto (7661   if\(locking\)) show
0 504 moveto (7662     release\(&console_lock\);) show
0 492 moveto (7663 }) show
0 480 moveto (7664 ) show
0 468 moveto (7665 int) show
0 456 moveto (7666 console_write\(struct inode *ip, char *buf, int n\)) show
0 444 moveto (7667 {) show
0 432 moveto (7668   int i;) show
0 420 moveto (7669 ) show
0 408 moveto (7670   iunlock\(ip\);) show
0 396 moveto (7671   acquire\(&console_lock\);) show
0 384 moveto (7672   for\(i = 0; i < n; i++\)) show
0 372 moveto (7673     cons_putc\(buf[i] & 0xff\);) show
0 360 moveto (7674   release\(&console_lock\);) show
0 348 moveto (7675   ilock\(ip\);) show
0 336 moveto (7676 ) show
0 324 moveto (7677   return n;) show
0 312 moveto (7678 }) show
0 300 moveto (7679 ) show
0 288 moveto (7680 #define INPUT_BUF 128) show
0 276 moveto (7681 struct {) show
0 264 moveto (7682   struct spinlock lock;) show
0 252 moveto (7683   char buf[INPUT_BUF];) show
0 240 moveto (7684   int r;  // Read index) show
0 228 moveto (7685   int w;  // Write index) show
0 216 moveto (7686   int e;  // Edit index) show
0 204 moveto (7687 } input;) show
0 192 moveto (7688 ) show
0 180 moveto (7689 #define C\(x\)  \(\(x\)-'@'\)  // Control-x) show
0 168 moveto (7690 ) show
0 156 moveto (7691 void) show
0 144 moveto (7692 console_intr\(int \(*getc\)\(void\)\)) show
0 132 moveto (7693 {) show
0 120 moveto (7694   int c;) show
0 108 moveto (7695 ) show
0 96 moveto (7696   acquire\(&input.lock\);) show
0 84 moveto (7697   while\(\(c = getc\(\)\) >= 0\){) show
0 72 moveto (7698     switch\(c\){) show
0 60 moveto (7699     case C\('P'\):  // Process listing.) show
0 24 moveto (Sheet 76) show
grestore
restore
showpage
%%Page: 86 86
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 8) show
0 648 moveto (7700       procdump\(\);) show
0 636 moveto (7701       break;) show
0 624 moveto (7702     case C\('U'\):  // Kill line.) show
0 612 moveto (7703       while\(input.e > input.w &&) show
0 600 moveto (7704             input.buf[\(input.e-1\) % INPUT_BUF] != '\\n'\){) show
0 588 moveto (7705         input.e--;) show
0 576 moveto (7706         cons_putc\(BACKSPACE\);) show
0 564 moveto (7707       }) show
0 552 moveto (7708       break;) show
0 540 moveto (7709     case C\('H'\):  // Backspace) show
0 528 moveto (7710       if\(input.e > input.w\){) show
0 516 moveto (7711         input.e--;) show
0 504 moveto (7712         cons_putc\(BACKSPACE\);) show
0 492 moveto (7713       }) show
0 480 moveto (7714       break;) show
0 468 moveto (7715     default:) show
0 456 moveto (7716       if\(c != 0 && input.e < input.r+INPUT_BUF\){) show
0 444 moveto (7717         input.buf[input.e++ % INPUT_BUF] = c;) show
0 432 moveto (7718         cons_putc\(c\);) show
0 420 moveto (7719         if\(c == '\\n' || c == C\('D'\) || input.e == input.r+INPUT_BUF\){) show
0 408 moveto (7720           input.w = input.e;) show
0 396 moveto (7721           wakeup\(&input.r\);) show
0 384 moveto (7722         }) show
0 372 moveto (7723       }) show
0 360 moveto (7724       break;) show
0 348 moveto (7725     }) show
0 336 moveto (7726   }) show
0 324 moveto (7727   release\(&input.lock\);) show
0 312 moveto (7728 }) show
0 300 moveto (7729 ) show
0 288 moveto (7730 void) show
0 276 moveto (7731 thread_stub\(void * arg\)) show
0 264 moveto (7732 {) show
0 252 moveto (7733 /*    static int id = 0;) show
0 240 moveto (7734     id++;) show
0 228 moveto (7735 //    int myid = id;) show
0 216 moveto (7736     cprintf\("thread_stub started! arg: %d\\n", arg\);) show
0 204 moveto (7737     int i;) show
0 192 moveto (7738     for \(i=0; i<100000000; i++\)) show
0 180 moveto (7739     {) show
0 168 moveto (7740         if \(i % 100000 == 0\)) show
0 156 moveto (7741         cprintf\("%d:", myid\);) show
0 144 moveto (7742     }*/) show
0 132 moveto (7743   static int in = 0;) show
0 120 moveto (7744   if \(in\)) show
0 108 moveto (7745       return;) show
0 96 moveto (7746   in = 1;) show
0 84 moveto (7747   unsigned char data[512];) show
0 72 moveto (7748   int s;) show
0 60 moveto (7749   int len;) show
0 24 moveto (Sheet 77) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 9) show
0 648 moveto (7750   s = lwip_socket\(PF_INET, SOCK_STREAM, 0\);) show
0 636 moveto (7751   struct sockaddr_in sa;) show
0 624 moveto (7752   sa.sin_family = AF_INET;) show
0 612 moveto (7753   sa.sin_port = htons\(80\);) show
0 600 moveto (7754   sa.sin_addr.s_addr = inet_addr\("192.168.1.1"\);) show
0 588 moveto (7755   len = 1;) show
0 576 moveto (7756   lwip_setsockopt\(s, SOL_SOCKET, SO_REUSEPORT, &len, sizeof\(int\)\);) show
0 564 moveto (7757   lwip_bind\(s, &sa, sizeof\(sa\)\);) show
0 552 moveto (7758   int addrlen = sizeof\(sa\);) show
0 540 moveto (7759 //  len = lwip_recvfrom\(s, data, sizeof\(data\), 0, &sa, &addrlen\);) show
0 528 moveto (7760 //  lwip_sendto\(s, data, len, 0, &sa, addrlen\);) show
0 516 moveto (7761   int client;) show
0 504 moveto (7762   lwip_listen\(s, 1\);) show
0 492 moveto (7763   while \(\(client = lwip_accept\(s, &sa, &addrlen\)\) > 0\)) show
0 480 moveto (7764   {) show
0 468 moveto (7765       do {) show
0 456 moveto (7766         len = lwip_read\(client, data, sizeof\(data\)\);) show
0 444 moveto (7767 //        cprintf\("received %d bytes\\n", len\);) show
0 432 moveto (7768         lwip_send\(client, data, len, 0\);) show
0 420 moveto (7769         if \(data[0] == '!'\)) show
0 408 moveto (7770             len = -1;) show
0 396 moveto (7771       } while \(len > 0\);) show
0 384 moveto (7772       lwip_close\(client\);) show
0 372 moveto (7773   }) show
0 360 moveto (7774   lwip_close\(s\);) show
0 348 moveto (7775   in = 0;) show
0 336 moveto (7776 }) show
0 324 moveto (7777 ) show
0 312 moveto (7778 ) show
0 300 moveto (7779 int) show
0 288 moveto (7780 console_read\(struct inode *ip, char *dst, int n\)) show
0 276 moveto (7781 {) show
0 264 moveto (7782   uint target;) show
0 252 moveto (7783   int c;) show
0 240 moveto (7784   int ret;) show
0 228 moveto (7785 //  unsigned char data[100];) show
0 216 moveto (7786   int mark;) show
0 204 moveto (7787 ) show
0 192 moveto (7788 //  kproc_start\(thread_stub, 0, 0, 0, "[stub thread]"\);) show
0 180 moveto (7789 //  for \(c=0; c<10; c++\)) show
0 168 moveto (7790 //      data[c] = 0xda;) show
0 156 moveto (7791   iunlock\(ip\);) show
0 144 moveto (7792   target = n;) show
0 132 moveto (7793   acquire\(&input.lock\);) show
0 120 moveto (7794   while\(n > 0\){) show
0 108 moveto (7795     while\(input.r == input.w\){) show
0 96 moveto (7796       if\(cp->killed\){) show
0 84 moveto (7797         release\(&input.lock\);) show
0 72 moveto (7798         ilock\(ip\);) show
0 60 moveto (7799         return -1;) show
0 24 moveto (Sheet 77) show
grestore
restore
showpage
%%Page: 87 87
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 10) show
0 648 moveto (7800       }) show
0 636 moveto (7801       mark = 0;) show
0 624 moveto (7802       sleep\(&input.r, &input.lock\);) show
0 612 moveto (7803 /*      do {) show
0 600 moveto (7804         ret = msleep_spin\(&input.r, &input.lock, 1000\);) show
0 588 moveto (7805        if \(ret\)) show
0 576 moveto (7806         {*/) show
0 564 moveto (7807 //            if \(\(mark = lwip_recv\(s, data,) show
0 552 moveto (7808 //            sizeof\(data\), MSG_DONTWAIT\)\) > 0\)) show
0 540 moveto (7809 //                cprintf\("received from 192.168.1.1:80: %d\\n", mark\);) show
0 528 moveto (7810 /*            if \(mark == 0\)) show
0 516 moveto (7811             {) show
0 504 moveto (7812                 for \( ; mark < 64; mark ++\)) show
0 492 moveto (7813                     e100_send\(data, sizeof\(data\)\);) show
0 480 moveto (7814             }) show
0 468 moveto (7815             int len = e100_receive\(data, sizeof\(data\)\);) show
0 456 moveto (7816             cprintf\("received: %d bytes\\n", len\);) show
0 444 moveto (7817             int i;) show
0 432 moveto (7818             for \(i=0; i<len; i++\)) show
0 420 moveto (7819             {) show
0 408 moveto (7820                 cprintf\("%02x ", data[i]\);) show
0 396 moveto (7821                 if \(\(i+1\) % 10 == 0\)) show
0 384 moveto (7822                     cprintf\("\\n"\);) show
0 372 moveto (7823             }) show
0 360 moveto (7824             cprintf\("\\n"\);*/) show
0 348 moveto (7825 //            kproc_start\(thread_stub, \(void *\)100, 0, 0\);) show
0 336 moveto (7826 //            cprintf\("XXX faster!!\\n"\);) show
0 324 moveto (7827 /*        }) show
0 312 moveto (7828       } while \(ret\);*/) show
0 300 moveto (7829     }) show
0 288 moveto (7830     c = input.buf[input.r++ % INPUT_BUF];) show
0 276 moveto (7831     if\(c == C\('D'\)\){  // EOF) show
0 264 moveto (7832       if\(n < target\){) show
0 252 moveto (7833         // Save ^D for next time, to make sure) show
0 240 moveto (7834         // caller gets a 0-byte result.) show
0 228 moveto (7835         input.r--;) show
0 216 moveto (7836       }) show
0 204 moveto (7837       break;) show
0 192 moveto (7838     }) show
0 180 moveto (7839     *dst++ = c;) show
0 168 moveto (7840     --n;) show
0 156 moveto (7841     if\(c == '\\n'\)) show
0 144 moveto (7842       break;) show
0 132 moveto (7843   }) show
0 120 moveto (7844   release\(&input.lock\);) show
0 108 moveto (7845   ilock\(ip\);) show
0 96 moveto (7846 ) show
0 84 moveto (7847   return target - n;) show
0 72 moveto (7848 }) show
0 60 moveto (7849 ) show
0 24 moveto (Sheet 78) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/console.c  Page 11) show
0 648 moveto (7850 void) show
0 636 moveto (7851 console_init\(void\)) show
0 624 moveto (7852 {) show
0 612 moveto (7853   initlock\(&console_lock, "console"\);) show
0 600 moveto (7854   initlock\(&input.lock, "console input"\);) show
0 588 moveto (7855 ) show
0 576 moveto (7856   devsw[CONSOLE].write = console_write;) show
0 564 moveto (7857   devsw[CONSOLE].read = console_read;) show
0 552 moveto (7858   //use_console_lock = 1;) show
0 540 moveto (7859 ) show
0 528 moveto (7860   pic_enable\(IRQ_KBD\);) show
0 516 moveto (7861   ioapic_enable\(IRQ_KBD, 0\);) show
0 504 moveto (7862 }) show
0 492 moveto (7863 ) show
0 480 moveto (7864 void) show
0 468 moveto (7865 printstack\(\)) show
0 456 moveto (7866 {) show
0 444 moveto (7867   int i;) show
0 432 moveto (7868   uint ebp;) show
0 420 moveto (7869   uint pcs[10];) show
0 408 moveto (7870   cprintf\("Stack trace:\\n"\);) show
0 396 moveto (7871   asm\("movl %%ebp, %0" : "=r"\(ebp\) : \);) show
0 384 moveto (7872   getcallerpcs\(\(void*\)\(ebp+8\), pcs\);) show
0 372 moveto (7873   for\(i=0; i<10; i++\)) show
0 360 moveto (7874     cprintf\("0x%08x ", pcs[i]\);) show
0 348 moveto (7875   cprintf\("\\n"\);) show
0 336 moveto (7876 }) show
0 324 moveto (7877 ) show
0 312 moveto (7878 ) show
0 300 moveto (7879 void) show
0 288 moveto (7880 panic\(char *s\)) show
0 276 moveto (7881 {) show
0 264 moveto (7882   int i;) show
0 252 moveto (7883   uint pcs[10];) show
0 240 moveto (7884 ) show
0 228 moveto (7885   __asm __volatile\("cli"\);) show
0 216 moveto (7886   use_console_lock = 0;) show
0 204 moveto (7887   cprintf\("panic \(%d\): ", cpu\(\)\);) show
0 192 moveto (7888   cprintf\(s, 0\);) show
0 180 moveto (7889   cprintf\("\\n", 0\);) show
0 168 moveto (7890   getcallerpcs\(&s, pcs\);) show
0 156 moveto (7891   for\(i=0; i<10; i++\)) show
0 144 moveto (7892     cprintf\(" %p", pcs[i]\);) show
0 132 moveto (7893   panicked = 1; // freeze other CPU) show
0 120 moveto (7894   for\(;;\)) show
0 108 moveto (7895     ;) show
0 96 moveto (7896 }) show
0 84 moveto (7897 ) show
0 72 moveto (7898 ) show
0 60 moveto (7899 ) show
0 24 moveto (Sheet 78) show
grestore
restore
showpage
%%Page: 88 88
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/timer.c  Page 1) show
0 648 moveto (7900 // Intel 8253/8254/82C54 Programmable Interval Timer \(PIT\).) show
0 636 moveto (7901 // Only used on uniprocessors;) show
0 624 moveto (7902 // SMP machines use the local APIC timer.) show
0 612 moveto (7903 ) show
0 600 moveto (7904 #include "types.h") show
0 588 moveto (7905 #include "defs.h") show
0 576 moveto (7906 #include "traps.h") show
0 564 moveto (7907 #include "x86.h") show
0 552 moveto (7908 ) show
0 540 moveto (7909 #define IO_TIMER1       0x040           // 8253 Timer #1) show
0 528 moveto (7910 ) show
0 516 moveto (7911 // Frequency of all three count-down timers;) show
0 504 moveto (7912 // \(TIMER_FREQ/freq\) is the appropriate count) show
0 492 moveto (7913 // to generate a frequency of freq Hz.) show
0 480 moveto (7914 ) show
0 468 moveto (7915 #define TIMER_FREQ      1193182) show
0 456 moveto (7916 #define TIMER_DIV\(x\)    \(\(TIMER_FREQ+\(x\)/2\)/\(x\)\)) show
0 444 moveto (7917 ) show
0 432 moveto (7918 #define TIMER_MODE      \(IO_TIMER1 + 3\) // timer mode port) show
0 420 moveto (7919 #define TIMER_SEL0      0x00    // select counter 0) show
0 408 moveto (7920 #define TIMER_RATEGEN   0x04    // mode 2, rate generator) show
0 396 moveto (7921 #define TIMER_16BIT     0x30    // r/w counter 16 bits, LSB first) show
0 384 moveto (7922 ) show
0 372 moveto (7923 void) show
0 360 moveto (7924 timer_init\(void\)) show
0 348 moveto (7925 {) show
0 336 moveto (7926   // Interrupt 100 times/sec.) show
0 324 moveto (7927   outb\(TIMER_MODE, TIMER_SEL0 | TIMER_RATEGEN | TIMER_16BIT\);) show
0 312 moveto (7928   outb\(IO_TIMER1, TIMER_DIV\(100\) % 256\);) show
0 300 moveto (7929   outb\(IO_TIMER1, TIMER_DIV\(100\) / 256\);) show
0 288 moveto (7930   pic_enable\(IRQ_TIMER\);) show
0 276 moveto (7931 }) show
0 264 moveto (7932 ) show
0 252 moveto (7933 int) show
0 240 moveto (7934 millitime\(void\)) show
0 228 moveto (7935 {) show
0 216 moveto (7936     return ticks * 10;) show
0 204 moveto (7937 }) show
0 192 moveto (7938 ) show
0 180 moveto (7939 ) show
0 168 moveto (7940 ) show
0 156 moveto (7941 ) show
0 144 moveto (7942 ) show
0 132 moveto (7943 ) show
0 120 moveto (7944 ) show
0 108 moveto (7945 ) show
0 96 moveto (7946 ) show
0 84 moveto (7947 ) show
0 72 moveto (7948 ) show
0 60 moveto (7949 ) show
0 24 moveto (Sheet 79) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.h  Page 1) show
0 648 moveto (7950 #ifndef XV6_PCI_H_) show
0 636 moveto (7951 #define XV6_PCI_H_) show
0 624 moveto (7952 ) show
0 612 moveto (7953 #include "types.h") show
0 600 moveto (7954 ) show
0 588 moveto (7955 // PCI subsystem interface) show
0 576 moveto (7956 enum { pci_res_bus, pci_res_mem, pci_res_io, pci_res_max };) show
0 564 moveto (7957 ) show
0 552 moveto (7958 struct pci_bus;) show
0 540 moveto (7959 ) show
0 528 moveto (7960 struct pci_func {) show
0 516 moveto (7961     struct pci_bus *bus;) show
32 mp_a_x mul 516 moveto (// Primary bus for bridges) show
0 504 moveto (7962 ) show
0 492 moveto (7963     uint32_t dev;) show
0 480 moveto (7964     uint32_t func;) show
0 468 moveto (7965 ) show
0 456 moveto (7966     uint32_t dev_id;) show
0 444 moveto (7967     uint32_t dev_class;) show
0 432 moveto (7968 ) show
0 420 moveto (7969     uint32_t reg_base[6];) show
0 408 moveto (7970     uint32_t reg_size[6];) show
0 396 moveto (7971     uint8_t irq_line;) show
0 384 moveto (7972 };) show
0 372 moveto (7973 ) show
0 360 moveto (7974 struct pci_bus {) show
0 348 moveto (7975     struct pci_func *parent_bridge;) show
0 336 moveto (7976     uint32_t busno;) show
0 324 moveto (7977 };) show
0 312 moveto (7978 ) show
0 300 moveto (7979 int pci_init\(void\);) show
0 288 moveto (7980 void pci_func_enable\(struct pci_func *f\);) show
0 276 moveto (7981 ) show
0 264 moveto (7982 int ether_send\(void *buffer, int len\);) show
0 252 moveto (7983 int ether_receive\(void *buffer, int len\);) show
0 240 moveto (7984 ) show
0 228 moveto (7985 #endif) show
0 216 moveto (7986 ) show
0 204 moveto (7987 ) show
0 192 moveto (7988 ) show
0 180 moveto (7989 ) show
0 168 moveto (7990 ) show
0 156 moveto (7991 ) show
0 144 moveto (7992 ) show
0 132 moveto (7993 ) show
0 120 moveto (7994 ) show
0 108 moveto (7995 ) show
0 96 moveto (7996 ) show
0 84 moveto (7997 ) show
0 72 moveto (7998 ) show
0 60 moveto (7999 ) show
0 24 moveto (Sheet 79) show
grestore
restore
showpage
%%Page: 89 89
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 1) show
0 648 moveto (8000 /*) show
8 mp_a_x mul 648 moveto ($NetBSD: pcireg.h,v 1.45 2004/02/04 06:58:24 soren Exp $) show
72 mp_a_x mul 648 moveto (*/) show
0 636 moveto (8001 ) show
0 624 moveto (8002 /*) show
0 612 moveto (8003  * Copyright \(c\) 1995, 1996, 1999, 2000) show
0 600 moveto (8004  *     Christopher G. Demetriou.  All rights reserved.) show
0 588 moveto (8005  * Copyright \(c\) 1994, 1996 Charles M. Hannum.  All rights reserved.) show
0 576 moveto (8006  *) show
0 564 moveto (8007  * Redistribution and use in source and binary forms, with or without) show
0 552 moveto (8008  * modification, are permitted provided that the following conditions) show
0 540 moveto (8009  * are met:) show
0 528 moveto (8010  * 1. Redistributions of source code must retain the above copyright) show
0 516 moveto (8011  *    notice, this list of conditions and the following disclaimer.) show
0 504 moveto (8012  * 2. Redistributions in binary form must reproduce the above copyright) show
0 492 moveto (8013  *    notice, this list of conditions and the following disclaimer in the) show
0 480 moveto (8014  *    documentation and/or other materials provided with the distribution.) show
0 468 moveto (8015  * 3. All advertising materials mentioning features or use of this software) show
0 456 moveto (8016  *    must display the following acknowledgement:) show
0 444 moveto (8017  *) show
8 mp_a_x mul 444 moveto (This product includes software developed by Charles M. Hannum.) show
0 432 moveto (8018  * 4. The name of the author may not be used to endorse or promote products) show
0 420 moveto (8019  *    derived from this software without specific prior written permission.) show
0 408 moveto (8020  *) show
0 396 moveto (8021  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR) show
0 384 moveto (8022  * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES) show
0 372 moveto (8023  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.) show
0 360 moveto (8024  * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,) show
0 348 moveto (8025  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES \(INCLUDING, BUT) show
0 336 moveto (8026  * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,) show
0 324 moveto (8027  * DATA, OR PROFITS; OR BUSINESS INTERRUPTION\) HOWEVER CAUSED AND ON ANY) show
0 312 moveto (8028  * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT) show
0 300 moveto (8029  * \(INCLUDING NEGLIGENCE OR OTHERWISE\) ARISING IN ANY WAY OUT OF THE USE OF) show
0 288 moveto (8030  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.) show
0 276 moveto (8031  */) show
0 264 moveto (8032 ) show
0 252 moveto (8033 #ifndef _DEV_PCI_PCIREG_H_) show
0 240 moveto (8034 #define) show
16 mp_a_x mul 240 moveto (_DEV_PCI_PCIREG_H_) show
0 228 moveto (8035 ) show
0 216 moveto (8036 /*) show
0 204 moveto (8037  * Standardized PCI configuration information) show
0 192 moveto (8038  *) show
0 180 moveto (8039  * XXX This is not complete.) show
0 168 moveto (8040  */) show
0 156 moveto (8041 ) show
0 144 moveto (8042 #include "types.h") show
0 132 moveto (8043 ) show
0 120 moveto (8044 /*) show
0 108 moveto (8045  * Device identification register; contains a vendor ID and a device ID.) show
0 96 moveto (8046  */) show
0 84 moveto (8047 #define) show
16 mp_a_x mul 84 moveto (PCI_ID_REG) show
48 mp_a_x mul 84 moveto (0x00) show
0 72 moveto (8048 ) show
0 60 moveto (8049 ) show
0 24 moveto (Sheet 80) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 2) show
0 648 moveto (8050 typedef uint16_t pci_vendor_id_t;) show
0 636 moveto (8051 typedef uint16_t pci_product_id_t;) show
0 624 moveto (8052 ) show
0 612 moveto (8053 #define) show
16 mp_a_x mul 612 moveto (PCI_VENDOR_SHIFT) show
56 mp_a_x mul 612 moveto (0) show
0 600 moveto (8054 #define) show
16 mp_a_x mul 600 moveto (PCI_VENDOR_MASK) show
56 mp_a_x mul 600 moveto (0xffff) show
0 588 moveto (8055 #define) show
16 mp_a_x mul 588 moveto (PCI_VENDOR\(id\) \\) show
0 576 moveto (8056 ) show
12 mp_a_x mul 576 moveto (\(\(\(id\) >> PCI_VENDOR_SHIFT\) & PCI_VENDOR_MASK\)) show
0 564 moveto (8057 ) show
0 552 moveto (8058 #define) show
16 mp_a_x mul 552 moveto (PCI_PRODUCT_SHIFT) show
56 mp_a_x mul 552 moveto (16) show
0 540 moveto (8059 #define) show
16 mp_a_x mul 540 moveto (PCI_PRODUCT_MASK) show
56 mp_a_x mul 540 moveto (0xffff) show
0 528 moveto (8060 #define) show
16 mp_a_x mul 528 moveto (PCI_PRODUCT\(id\) \\) show
0 516 moveto (8061 ) show
12 mp_a_x mul 516 moveto (\(\(\(id\) >> PCI_PRODUCT_SHIFT\) & PCI_PRODUCT_MASK\)) show
0 504 moveto (8062 ) show
0 492 moveto (8063 #define PCI_ID_CODE\(vid,pid\)) show
72 mp_a_x mul 492 moveto (\\) show
0 480 moveto (8064 ) show
8 mp_a_x mul 480 moveto (\(\(\(\(vid\) & PCI_VENDOR_MASK\) << PCI_VENDOR_SHIFT\) |) show
64 mp_a_x mul 480 moveto (\\) show
0 468 moveto (8065 ) show
9 mp_a_x mul 468 moveto (\(\(\(pid\) & PCI_PRODUCT_MASK\) << PCI_PRODUCT_SHIFT\)\)) show
64 mp_a_x mul 468 moveto (\\) show
0 456 moveto (8066 ) show
0 444 moveto (8067 /*) show
0 432 moveto (8068  * Command and status register.) show
0 420 moveto (8069  */) show
0 408 moveto (8070 #define) show
16 mp_a_x mul 408 moveto (PCI_COMMAND_STATUS_REG) show
56 mp_a_x mul 408 moveto (0x04) show
0 396 moveto (8071 #define) show
16 mp_a_x mul 396 moveto (PCI_COMMAND_SHIFT) show
56 mp_a_x mul 396 moveto (0) show
0 384 moveto (8072 #define) show
16 mp_a_x mul 384 moveto (PCI_COMMAND_MASK) show
56 mp_a_x mul 384 moveto (0xffff) show
0 372 moveto (8073 #define) show
16 mp_a_x mul 372 moveto (PCI_STATUS_SHIFT) show
56 mp_a_x mul 372 moveto (16) show
0 360 moveto (8074 #define) show
16 mp_a_x mul 360 moveto (PCI_STATUS_MASK) show
56 mp_a_x mul 360 moveto (0xffff) show
0 348 moveto (8075 ) show
0 336 moveto (8076 #define PCI_COMMAND_STATUS_CODE\(cmd,stat\)) show
64 mp_a_x mul 336 moveto (\\) show
0 324 moveto (8077 ) show
8 mp_a_x mul 324 moveto (\(\(\(\(cmd\) & PCI_COMMAND_MASK\) >> PCI_COMMAND_SHIFT\) |) show
64 mp_a_x mul 324 moveto (\\) show
0 312 moveto (8078 ) show
9 mp_a_x mul 312 moveto (\(\(\(stat\) & PCI_STATUS_MASK\) >> PCI_STATUS_SHIFT\)\)) show
64 mp_a_x mul 312 moveto (\\) show
0 300 moveto (8079 ) show
0 288 moveto (8080 #define) show
16 mp_a_x mul 288 moveto (PCI_COMMAND_IO_ENABLE) show
56 mp_a_x mul 288 moveto (0x00000001) show
0 276 moveto (8081 #define) show
16 mp_a_x mul 276 moveto (PCI_COMMAND_MEM_ENABLE) show
56 mp_a_x mul 276 moveto (0x00000002) show
0 264 moveto (8082 #define) show
16 mp_a_x mul 264 moveto (PCI_COMMAND_MASTER_ENABLE) show
56 mp_a_x mul 264 moveto (0x00000004) show
0 252 moveto (8083 #define) show
16 mp_a_x mul 252 moveto (PCI_COMMAND_SPECIAL_ENABLE) show
56 mp_a_x mul 252 moveto (0x00000008) show
0 240 moveto (8084 #define) show
16 mp_a_x mul 240 moveto (PCI_COMMAND_INVALIDATE_ENABLE) show
56 mp_a_x mul 240 moveto (0x00000010) show
0 228 moveto (8085 #define) show
16 mp_a_x mul 228 moveto (PCI_COMMAND_PALETTE_ENABLE) show
56 mp_a_x mul 228 moveto (0x00000020) show
0 216 moveto (8086 #define) show
16 mp_a_x mul 216 moveto (PCI_COMMAND_PARITY_ENABLE) show
56 mp_a_x mul 216 moveto (0x00000040) show
0 204 moveto (8087 #define) show
16 mp_a_x mul 204 moveto (PCI_COMMAND_STEPPING_ENABLE) show
56 mp_a_x mul 204 moveto (0x00000080) show
0 192 moveto (8088 #define) show
16 mp_a_x mul 192 moveto (PCI_COMMAND_SERR_ENABLE) show
56 mp_a_x mul 192 moveto (0x00000100) show
0 180 moveto (8089 #define) show
16 mp_a_x mul 180 moveto (PCI_COMMAND_BACKTOBACK_ENABLE) show
56 mp_a_x mul 180 moveto (0x00000200) show
0 168 moveto (8090 ) show
0 156 moveto (8091 #define) show
16 mp_a_x mul 156 moveto (PCI_STATUS_CAPLIST_SUPPORT) show
56 mp_a_x mul 156 moveto (0x00100000) show
0 144 moveto (8092 #define) show
16 mp_a_x mul 144 moveto (PCI_STATUS_66MHZ_SUPPORT) show
56 mp_a_x mul 144 moveto (0x00200000) show
0 132 moveto (8093 #define) show
16 mp_a_x mul 132 moveto (PCI_STATUS_UDF_SUPPORT) show
56 mp_a_x mul 132 moveto (0x00400000) show
0 120 moveto (8094 #define) show
16 mp_a_x mul 120 moveto (PCI_STATUS_BACKTOBACK_SUPPORT) show
56 mp_a_x mul 120 moveto (0x00800000) show
0 108 moveto (8095 #define) show
16 mp_a_x mul 108 moveto (PCI_STATUS_PARITY_ERROR) show
56 mp_a_x mul 108 moveto (0x01000000) show
0 96 moveto (8096 #define) show
16 mp_a_x mul 96 moveto (PCI_STATUS_DEVSEL_FAST) show
56 mp_a_x mul 96 moveto (0x00000000) show
0 84 moveto (8097 #define) show
16 mp_a_x mul 84 moveto (PCI_STATUS_DEVSEL_MEDIUM) show
56 mp_a_x mul 84 moveto (0x02000000) show
0 72 moveto (8098 #define) show
16 mp_a_x mul 72 moveto (PCI_STATUS_DEVSEL_SLOW) show
56 mp_a_x mul 72 moveto (0x04000000) show
0 60 moveto (8099 #define) show
16 mp_a_x mul 60 moveto (PCI_STATUS_DEVSEL_MASK) show
56 mp_a_x mul 60 moveto (0x06000000) show
0 24 moveto (Sheet 80) show
grestore
restore
showpage
%%Page: 90 90
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 3) show
0 648 moveto (8100 #define) show
16 mp_a_x mul 648 moveto (PCI_STATUS_TARGET_TARGET_ABORT) show
56 mp_a_x mul 648 moveto (0x08000000) show
0 636 moveto (8101 #define) show
16 mp_a_x mul 636 moveto (PCI_STATUS_MASTER_TARGET_ABORT) show
56 mp_a_x mul 636 moveto (0x10000000) show
0 624 moveto (8102 #define) show
16 mp_a_x mul 624 moveto (PCI_STATUS_MASTER_ABORT) show
56 mp_a_x mul 624 moveto (0x20000000) show
0 612 moveto (8103 #define) show
16 mp_a_x mul 612 moveto (PCI_STATUS_SPECIAL_ERROR) show
56 mp_a_x mul 612 moveto (0x40000000) show
0 600 moveto (8104 #define) show
16 mp_a_x mul 600 moveto (PCI_STATUS_PARITY_DETECT) show
56 mp_a_x mul 600 moveto (0x80000000) show
0 588 moveto (8105 ) show
0 576 moveto (8106 /*) show
0 564 moveto (8107  * PCI Class and Revision Register; defines type and revision of device.) show
0 552 moveto (8108  */) show
0 540 moveto (8109 #define) show
16 mp_a_x mul 540 moveto (PCI_CLASS_REG) show
48 mp_a_x mul 540 moveto (0x08) show
0 528 moveto (8110 ) show
0 516 moveto (8111 typedef uint8_t pci_class_t;) show
0 504 moveto (8112 typedef uint8_t pci_subclass_t;) show
0 492 moveto (8113 typedef uint8_t pci_interface_t;) show
0 480 moveto (8114 typedef uint8_t pci_revision_t;) show
0 468 moveto (8115 ) show
0 456 moveto (8116 #define) show
16 mp_a_x mul 456 moveto (PCI_CLASS_SHIFT) show
56 mp_a_x mul 456 moveto (24) show
0 444 moveto (8117 #define) show
16 mp_a_x mul 444 moveto (PCI_CLASS_MASK) show
56 mp_a_x mul 444 moveto (0xff) show
0 432 moveto (8118 #define) show
16 mp_a_x mul 432 moveto (PCI_CLASS\(cr\) \\) show
0 420 moveto (8119 ) show
12 mp_a_x mul 420 moveto (\(\(\(cr\) >> PCI_CLASS_SHIFT\) & PCI_CLASS_MASK\)) show
0 408 moveto (8120 ) show
0 396 moveto (8121 #define) show
16 mp_a_x mul 396 moveto (PCI_SUBCLASS_SHIFT) show
56 mp_a_x mul 396 moveto (16) show
0 384 moveto (8122 #define) show
16 mp_a_x mul 384 moveto (PCI_SUBCLASS_MASK) show
56 mp_a_x mul 384 moveto (0xff) show
0 372 moveto (8123 #define) show
16 mp_a_x mul 372 moveto (PCI_SUBCLASS\(cr\) \\) show
0 360 moveto (8124 ) show
12 mp_a_x mul 360 moveto (\(\(\(cr\) >> PCI_SUBCLASS_SHIFT\) & PCI_SUBCLASS_MASK\)) show
0 348 moveto (8125 ) show
0 336 moveto (8126 #define) show
16 mp_a_x mul 336 moveto (PCI_INTERFACE_SHIFT) show
56 mp_a_x mul 336 moveto (8) show
0 324 moveto (8127 #define) show
16 mp_a_x mul 324 moveto (PCI_INTERFACE_MASK) show
56 mp_a_x mul 324 moveto (0xff) show
0 312 moveto (8128 #define) show
16 mp_a_x mul 312 moveto (PCI_INTERFACE\(cr\) \\) show
0 300 moveto (8129 ) show
12 mp_a_x mul 300 moveto (\(\(\(cr\) >> PCI_INTERFACE_SHIFT\) & PCI_INTERFACE_MASK\)) show
0 288 moveto (8130 ) show
0 276 moveto (8131 #define) show
16 mp_a_x mul 276 moveto (PCI_REVISION_SHIFT) show
56 mp_a_x mul 276 moveto (0) show
0 264 moveto (8132 #define) show
16 mp_a_x mul 264 moveto (PCI_REVISION_MASK) show
56 mp_a_x mul 264 moveto (0xff) show
0 252 moveto (8133 #define) show
16 mp_a_x mul 252 moveto (PCI_REVISION\(cr\) \\) show
0 240 moveto (8134 ) show
12 mp_a_x mul 240 moveto (\(\(\(cr\) >> PCI_REVISION_SHIFT\) & PCI_REVISION_MASK\)) show
0 228 moveto (8135 ) show
0 216 moveto (8136 #define) show
16 mp_a_x mul 216 moveto (PCI_CLASS_CODE\(mainclass, subclass, interface\) \\) show
0 204 moveto (8137 ) show
12 mp_a_x mul 204 moveto (\(\(\(\(mainclass\) & PCI_CLASS_MASK\) << PCI_CLASS_SHIFT\) | \\) show
0 192 moveto (8138 ) show
13 mp_a_x mul 192 moveto (\(\(\(subclass\) & PCI_SUBCLASS_MASK\) << PCI_SUBCLASS_SHIFT\) | \\) show
0 180 moveto (8139 ) show
13 mp_a_x mul 180 moveto (\(\(\(interface\) & PCI_INTERFACE_MASK\) << PCI_INTERFACE_SHIFT\)\)) show
0 168 moveto (8140 ) show
0 156 moveto (8141 /* base classes */) show
0 144 moveto (8142 #define) show
16 mp_a_x mul 144 moveto (PCI_CLASS_PREHISTORIC) show
56 mp_a_x mul 144 moveto (0x00) show
0 132 moveto (8143 #define) show
16 mp_a_x mul 132 moveto (PCI_CLASS_MASS_STORAGE) show
56 mp_a_x mul 132 moveto (0x01) show
0 120 moveto (8144 #define) show
16 mp_a_x mul 120 moveto (PCI_CLASS_NETWORK) show
56 mp_a_x mul 120 moveto (0x02) show
0 108 moveto (8145 #define) show
16 mp_a_x mul 108 moveto (PCI_CLASS_DISPLAY) show
56 mp_a_x mul 108 moveto (0x03) show
0 96 moveto (8146 #define) show
16 mp_a_x mul 96 moveto (PCI_CLASS_MULTIMEDIA) show
56 mp_a_x mul 96 moveto (0x04) show
0 84 moveto (8147 #define) show
16 mp_a_x mul 84 moveto (PCI_CLASS_MEMORY) show
56 mp_a_x mul 84 moveto (0x05) show
0 72 moveto (8148 #define) show
16 mp_a_x mul 72 moveto (PCI_CLASS_BRIDGE) show
56 mp_a_x mul 72 moveto (0x06) show
0 60 moveto (8149 #define) show
16 mp_a_x mul 60 moveto (PCI_CLASS_COMMUNICATIONS) show
56 mp_a_x mul 60 moveto (0x07) show
0 24 moveto (Sheet 81) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 4) show
0 648 moveto (8150 #define) show
16 mp_a_x mul 648 moveto (PCI_CLASS_SYSTEM) show
56 mp_a_x mul 648 moveto (0x08) show
0 636 moveto (8151 #define) show
16 mp_a_x mul 636 moveto (PCI_CLASS_INPUT) show
56 mp_a_x mul 636 moveto (0x09) show
0 624 moveto (8152 #define) show
16 mp_a_x mul 624 moveto (PCI_CLASS_DOCK) show
56 mp_a_x mul 624 moveto (0x0a) show
0 612 moveto (8153 #define) show
16 mp_a_x mul 612 moveto (PCI_CLASS_PROCESSOR) show
56 mp_a_x mul 612 moveto (0x0b) show
0 600 moveto (8154 #define) show
16 mp_a_x mul 600 moveto (PCI_CLASS_SERIALBUS) show
56 mp_a_x mul 600 moveto (0x0c) show
0 588 moveto (8155 #define) show
16 mp_a_x mul 588 moveto (PCI_CLASS_WIRELESS) show
56 mp_a_x mul 588 moveto (0x0d) show
0 576 moveto (8156 #define) show
16 mp_a_x mul 576 moveto (PCI_CLASS_I2O) show
56 mp_a_x mul 576 moveto (0x0e) show
0 564 moveto (8157 #define) show
16 mp_a_x mul 564 moveto (PCI_CLASS_SATCOM) show
56 mp_a_x mul 564 moveto (0x0f) show
0 552 moveto (8158 #define) show
16 mp_a_x mul 552 moveto (PCI_CLASS_CRYPTO) show
56 mp_a_x mul 552 moveto (0x10) show
0 540 moveto (8159 #define) show
16 mp_a_x mul 540 moveto (PCI_CLASS_DASP) show
56 mp_a_x mul 540 moveto (0x11) show
0 528 moveto (8160 #define) show
16 mp_a_x mul 528 moveto (PCI_CLASS_UNDEFINED) show
56 mp_a_x mul 528 moveto (0xff) show
0 516 moveto (8161 ) show
0 504 moveto (8162 /* 0x00 prehistoric subclasses */) show
0 492 moveto (8163 #define) show
16 mp_a_x mul 492 moveto (PCI_SUBCLASS_PREHISTORIC_MISC) show
56 mp_a_x mul 492 moveto (0x00) show
0 480 moveto (8164 #define) show
16 mp_a_x mul 480 moveto (PCI_SUBCLASS_PREHISTORIC_VGA) show
56 mp_a_x mul 480 moveto (0x01) show
0 468 moveto (8165 ) show
0 456 moveto (8166 /* 0x01 mass storage subclasses */) show
0 444 moveto (8167 #define) show
16 mp_a_x mul 444 moveto (PCI_SUBCLASS_MASS_STORAGE_SCSI) show
56 mp_a_x mul 444 moveto (0x00) show
0 432 moveto (8168 #define) show
16 mp_a_x mul 432 moveto (PCI_SUBCLASS_MASS_STORAGE_IDE) show
56 mp_a_x mul 432 moveto (0x01) show
0 420 moveto (8169 #define) show
16 mp_a_x mul 420 moveto (PCI_SUBCLASS_MASS_STORAGE_FLOPPY) show
56 mp_a_x mul 420 moveto (0x02) show
0 408 moveto (8170 #define) show
16 mp_a_x mul 408 moveto (PCI_SUBCLASS_MASS_STORAGE_IPI) show
56 mp_a_x mul 408 moveto (0x03) show
0 396 moveto (8171 #define) show
16 mp_a_x mul 396 moveto (PCI_SUBCLASS_MASS_STORAGE_RAID) show
56 mp_a_x mul 396 moveto (0x04) show
0 384 moveto (8172 #define) show
16 mp_a_x mul 384 moveto (PCI_SUBCLASS_MASS_STORAGE_ATA) show
56 mp_a_x mul 384 moveto (0x05) show
0 372 moveto (8173 #define) show
16 mp_a_x mul 372 moveto (PCI_SUBCLASS_MASS_STORAGE_SATA) show
56 mp_a_x mul 372 moveto (0x06) show
0 360 moveto (8174 #define) show
16 mp_a_x mul 360 moveto (PCI_SUBCLASS_MASS_STORAGE_MISC) show
56 mp_a_x mul 360 moveto (0x80) show
0 348 moveto (8175 ) show
0 336 moveto (8176 /* 0x02 network subclasses */) show
0 324 moveto (8177 #define) show
16 mp_a_x mul 324 moveto (PCI_SUBCLASS_NETWORK_ETHERNET) show
56 mp_a_x mul 324 moveto (0x00) show
0 312 moveto (8178 #define) show
16 mp_a_x mul 312 moveto (PCI_SUBCLASS_NETWORK_TOKENRING) show
56 mp_a_x mul 312 moveto (0x01) show
0 300 moveto (8179 #define) show
16 mp_a_x mul 300 moveto (PCI_SUBCLASS_NETWORK_FDDI) show
56 mp_a_x mul 300 moveto (0x02) show
0 288 moveto (8180 #define) show
16 mp_a_x mul 288 moveto (PCI_SUBCLASS_NETWORK_ATM) show
56 mp_a_x mul 288 moveto (0x03) show
0 276 moveto (8181 #define) show
16 mp_a_x mul 276 moveto (PCI_SUBCLASS_NETWORK_ISDN) show
56 mp_a_x mul 276 moveto (0x04) show
0 264 moveto (8182 #define) show
16 mp_a_x mul 264 moveto (PCI_SUBCLASS_NETWORK_WORLDFIP) show
56 mp_a_x mul 264 moveto (0x05) show
0 252 moveto (8183 #define) show
16 mp_a_x mul 252 moveto (PCI_SUBCLASS_NETWORK_PCIMGMULTICOMP) show
56 mp_a_x mul 252 moveto (0x06) show
0 240 moveto (8184 #define) show
16 mp_a_x mul 240 moveto (PCI_SUBCLASS_NETWORK_MISC) show
56 mp_a_x mul 240 moveto (0x80) show
0 228 moveto (8185 ) show
0 216 moveto (8186 /* 0x03 display subclasses */) show
0 204 moveto (8187 #define) show
16 mp_a_x mul 204 moveto (PCI_SUBCLASS_DISPLAY_VGA) show
56 mp_a_x mul 204 moveto (0x00) show
0 192 moveto (8188 #define) show
16 mp_a_x mul 192 moveto (PCI_SUBCLASS_DISPLAY_XGA) show
56 mp_a_x mul 192 moveto (0x01) show
0 180 moveto (8189 #define) show
16 mp_a_x mul 180 moveto (PCI_SUBCLASS_DISPLAY_3D) show
56 mp_a_x mul 180 moveto (0x02) show
0 168 moveto (8190 #define) show
16 mp_a_x mul 168 moveto (PCI_SUBCLASS_DISPLAY_MISC) show
56 mp_a_x mul 168 moveto (0x80) show
0 156 moveto (8191 ) show
0 144 moveto (8192 /* 0x04 multimedia subclasses */) show
0 132 moveto (8193 #define) show
16 mp_a_x mul 132 moveto (PCI_SUBCLASS_MULTIMEDIA_VIDEO) show
56 mp_a_x mul 132 moveto (0x00) show
0 120 moveto (8194 #define) show
16 mp_a_x mul 120 moveto (PCI_SUBCLASS_MULTIMEDIA_AUDIO) show
56 mp_a_x mul 120 moveto (0x01) show
0 108 moveto (8195 #define) show
16 mp_a_x mul 108 moveto (PCI_SUBCLASS_MULTIMEDIA_TELEPHONY) show
56 mp_a_x mul 108 moveto (0x02) show
0 96 moveto (8196 #define) show
16 mp_a_x mul 96 moveto (PCI_SUBCLASS_MULTIMEDIA_MISC) show
56 mp_a_x mul 96 moveto (0x80) show
0 84 moveto (8197 ) show
0 72 moveto (8198 ) show
0 60 moveto (8199 ) show
0 24 moveto (Sheet 81) show
grestore
restore
showpage
%%Page: 91 91
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 5) show
0 648 moveto (8200 /* 0x05 memory subclasses */) show
0 636 moveto (8201 #define) show
16 mp_a_x mul 636 moveto (PCI_SUBCLASS_MEMORY_RAM) show
56 mp_a_x mul 636 moveto (0x00) show
0 624 moveto (8202 #define) show
16 mp_a_x mul 624 moveto (PCI_SUBCLASS_MEMORY_FLASH) show
56 mp_a_x mul 624 moveto (0x01) show
0 612 moveto (8203 #define) show
16 mp_a_x mul 612 moveto (PCI_SUBCLASS_MEMORY_MISC) show
56 mp_a_x mul 612 moveto (0x80) show
0 600 moveto (8204 ) show
0 588 moveto (8205 /* 0x06 bridge subclasses */) show
0 576 moveto (8206 #define) show
16 mp_a_x mul 576 moveto (PCI_SUBCLASS_BRIDGE_HOST) show
56 mp_a_x mul 576 moveto (0x00) show
0 564 moveto (8207 #define) show
16 mp_a_x mul 564 moveto (PCI_SUBCLASS_BRIDGE_ISA) show
56 mp_a_x mul 564 moveto (0x01) show
0 552 moveto (8208 #define) show
16 mp_a_x mul 552 moveto (PCI_SUBCLASS_BRIDGE_EISA) show
56 mp_a_x mul 552 moveto (0x02) show
0 540 moveto (8209 #define) show
16 mp_a_x mul 540 moveto (PCI_SUBCLASS_BRIDGE_MC) show
56 mp_a_x mul 540 moveto (0x03) show
64 mp_a_x mul 540 moveto (/* XXX _MCA? */) show
0 528 moveto (8210 #define) show
16 mp_a_x mul 528 moveto (PCI_SUBCLASS_BRIDGE_PCI) show
56 mp_a_x mul 528 moveto (0x04) show
0 516 moveto (8211 #define) show
16 mp_a_x mul 516 moveto (PCI_SUBCLASS_BRIDGE_PCMCIA) show
56 mp_a_x mul 516 moveto (0x05) show
0 504 moveto (8212 #define) show
16 mp_a_x mul 504 moveto (PCI_SUBCLASS_BRIDGE_NUBUS) show
56 mp_a_x mul 504 moveto (0x06) show
0 492 moveto (8213 #define) show
16 mp_a_x mul 492 moveto (PCI_SUBCLASS_BRIDGE_CARDBUS) show
56 mp_a_x mul 492 moveto (0x07) show
0 480 moveto (8214 #define) show
16 mp_a_x mul 480 moveto (PCI_SUBCLASS_BRIDGE_RACEWAY) show
56 mp_a_x mul 480 moveto (0x08) show
0 468 moveto (8215 #define) show
16 mp_a_x mul 468 moveto (PCI_SUBCLASS_BRIDGE_STPCI) show
56 mp_a_x mul 468 moveto (0x09) show
0 456 moveto (8216 #define) show
16 mp_a_x mul 456 moveto (PCI_SUBCLASS_BRIDGE_INFINIBAND) show
56 mp_a_x mul 456 moveto (0x0a) show
0 444 moveto (8217 #define) show
16 mp_a_x mul 444 moveto (PCI_SUBCLASS_BRIDGE_MISC) show
56 mp_a_x mul 444 moveto (0x80) show
0 432 moveto (8218 ) show
0 420 moveto (8219 /* 0x07 communications subclasses */) show
0 408 moveto (8220 #define) show
16 mp_a_x mul 408 moveto (PCI_SUBCLASS_COMMUNICATIONS_SERIAL) show
56 mp_a_x mul 408 moveto (0x00) show
0 396 moveto (8221 #define) show
16 mp_a_x mul 396 moveto (PCI_SUBCLASS_COMMUNICATIONS_PARALLEL) show
56 mp_a_x mul 396 moveto (0x01) show
0 384 moveto (8222 #define) show
16 mp_a_x mul 384 moveto (PCI_SUBCLASS_COMMUNICATIONS_MPSERIAL) show
56 mp_a_x mul 384 moveto (0x02) show
0 372 moveto (8223 #define) show
16 mp_a_x mul 372 moveto (PCI_SUBCLASS_COMMUNICATIONS_MODEM) show
56 mp_a_x mul 372 moveto (0x03) show
0 360 moveto (8224 #define) show
16 mp_a_x mul 360 moveto (PCI_SUBCLASS_COMMUNICATIONS_GPIB) show
56 mp_a_x mul 360 moveto (0x04) show
0 348 moveto (8225 #define) show
16 mp_a_x mul 348 moveto (PCI_SUBCLASS_COMMUNICATIONS_SMARTCARD) show
56 mp_a_x mul 348 moveto (0x05) show
0 336 moveto (8226 #define) show
16 mp_a_x mul 336 moveto (PCI_SUBCLASS_COMMUNICATIONS_MISC) show
56 mp_a_x mul 336 moveto (0x80) show
0 324 moveto (8227 ) show
0 312 moveto (8228 /* 0x08 system subclasses */) show
0 300 moveto (8229 #define) show
16 mp_a_x mul 300 moveto (PCI_SUBCLASS_SYSTEM_PIC) show
56 mp_a_x mul 300 moveto (0x00) show
0 288 moveto (8230 #define) show
16 mp_a_x mul 288 moveto (PCI_SUBCLASS_SYSTEM_DMA) show
56 mp_a_x mul 288 moveto (0x01) show
0 276 moveto (8231 #define) show
16 mp_a_x mul 276 moveto (PCI_SUBCLASS_SYSTEM_TIMER) show
56 mp_a_x mul 276 moveto (0x02) show
0 264 moveto (8232 #define) show
16 mp_a_x mul 264 moveto (PCI_SUBCLASS_SYSTEM_RTC) show
56 mp_a_x mul 264 moveto (0x03) show
0 252 moveto (8233 #define) show
16 mp_a_x mul 252 moveto (PCI_SUBCLASS_SYSTEM_PCIHOTPLUG) show
56 mp_a_x mul 252 moveto (0x04) show
0 240 moveto (8234 #define) show
16 mp_a_x mul 240 moveto (PCI_SUBCLASS_SYSTEM_MISC) show
56 mp_a_x mul 240 moveto (0x80) show
0 228 moveto (8235 ) show
0 216 moveto (8236 /* 0x09 input subclasses */) show
0 204 moveto (8237 #define) show
16 mp_a_x mul 204 moveto (PCI_SUBCLASS_INPUT_KEYBOARD) show
56 mp_a_x mul 204 moveto (0x00) show
0 192 moveto (8238 #define) show
16 mp_a_x mul 192 moveto (PCI_SUBCLASS_INPUT_DIGITIZER) show
56 mp_a_x mul 192 moveto (0x01) show
0 180 moveto (8239 #define) show
16 mp_a_x mul 180 moveto (PCI_SUBCLASS_INPUT_MOUSE) show
56 mp_a_x mul 180 moveto (0x02) show
0 168 moveto (8240 #define) show
16 mp_a_x mul 168 moveto (PCI_SUBCLASS_INPUT_SCANNER) show
56 mp_a_x mul 168 moveto (0x03) show
0 156 moveto (8241 #define) show
16 mp_a_x mul 156 moveto (PCI_SUBCLASS_INPUT_GAMEPORT) show
56 mp_a_x mul 156 moveto (0x04) show
0 144 moveto (8242 #define) show
16 mp_a_x mul 144 moveto (PCI_SUBCLASS_INPUT_MISC) show
56 mp_a_x mul 144 moveto (0x80) show
0 132 moveto (8243 ) show
0 120 moveto (8244 /* 0x0a dock subclasses */) show
0 108 moveto (8245 #define) show
16 mp_a_x mul 108 moveto (PCI_SUBCLASS_DOCK_GENERIC) show
56 mp_a_x mul 108 moveto (0x00) show
0 96 moveto (8246 #define) show
16 mp_a_x mul 96 moveto (PCI_SUBCLASS_DOCK_MISC) show
56 mp_a_x mul 96 moveto (0x80) show
0 84 moveto (8247 ) show
0 72 moveto (8248 ) show
0 60 moveto (8249 ) show
0 24 moveto (Sheet 82) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 6) show
0 648 moveto (8250 /* 0x0b processor subclasses */) show
0 636 moveto (8251 #define) show
16 mp_a_x mul 636 moveto (PCI_SUBCLASS_PROCESSOR_386) show
56 mp_a_x mul 636 moveto (0x00) show
0 624 moveto (8252 #define) show
16 mp_a_x mul 624 moveto (PCI_SUBCLASS_PROCESSOR_486) show
56 mp_a_x mul 624 moveto (0x01) show
0 612 moveto (8253 #define) show
16 mp_a_x mul 612 moveto (PCI_SUBCLASS_PROCESSOR_PENTIUM) show
56 mp_a_x mul 612 moveto (0x02) show
0 600 moveto (8254 #define) show
16 mp_a_x mul 600 moveto (PCI_SUBCLASS_PROCESSOR_ALPHA) show
56 mp_a_x mul 600 moveto (0x10) show
0 588 moveto (8255 #define) show
16 mp_a_x mul 588 moveto (PCI_SUBCLASS_PROCESSOR_POWERPC) show
56 mp_a_x mul 588 moveto (0x20) show
0 576 moveto (8256 #define) show
16 mp_a_x mul 576 moveto (PCI_SUBCLASS_PROCESSOR_MIPS) show
56 mp_a_x mul 576 moveto (0x30) show
0 564 moveto (8257 #define) show
16 mp_a_x mul 564 moveto (PCI_SUBCLASS_PROCESSOR_COPROC) show
56 mp_a_x mul 564 moveto (0x40) show
0 552 moveto (8258 ) show
0 540 moveto (8259 /* 0x0c serial bus subclasses */) show
0 528 moveto (8260 #define) show
16 mp_a_x mul 528 moveto (PCI_SUBCLASS_SERIALBUS_FIREWIRE) show
56 mp_a_x mul 528 moveto (0x00) show
0 516 moveto (8261 #define) show
16 mp_a_x mul 516 moveto (PCI_SUBCLASS_SERIALBUS_ACCESS) show
56 mp_a_x mul 516 moveto (0x01) show
0 504 moveto (8262 #define) show
16 mp_a_x mul 504 moveto (PCI_SUBCLASS_SERIALBUS_SSA) show
56 mp_a_x mul 504 moveto (0x02) show
0 492 moveto (8263 #define) show
16 mp_a_x mul 492 moveto (PCI_SUBCLASS_SERIALBUS_USB) show
56 mp_a_x mul 492 moveto (0x03) show
0 480 moveto (8264 #define) show
16 mp_a_x mul 480 moveto (PCI_SUBCLASS_SERIALBUS_FIBER) show
56 mp_a_x mul 480 moveto (0x04) show
64 mp_a_x mul 480 moveto (/* XXX _FIBRECHANNEL */) show
0 468 moveto (8265 #define) show
16 mp_a_x mul 468 moveto (PCI_SUBCLASS_SERIALBUS_SMBUS) show
56 mp_a_x mul 468 moveto (0x05) show
0 456 moveto (8266 #define) show
16 mp_a_x mul 456 moveto (PCI_SUBCLASS_SERIALBUS_INFINIBAND) show
56 mp_a_x mul 456 moveto (0x06) show
0 444 moveto (8267 #define) show
16 mp_a_x mul 444 moveto (PCI_SUBCLASS_SERIALBUS_IPMI) show
56 mp_a_x mul 444 moveto (0x07) show
0 432 moveto (8268 #define) show
16 mp_a_x mul 432 moveto (PCI_SUBCLASS_SERIALBUS_SERCOS) show
56 mp_a_x mul 432 moveto (0x08) show
0 420 moveto (8269 #define) show
16 mp_a_x mul 420 moveto (PCI_SUBCLASS_SERIALBUS_CANBUS) show
56 mp_a_x mul 420 moveto (0x09) show
0 408 moveto (8270 ) show
0 396 moveto (8271 /* 0x0d wireless subclasses */) show
0 384 moveto (8272 #define) show
16 mp_a_x mul 384 moveto (PCI_SUBCLASS_WIRELESS_IRDA) show
56 mp_a_x mul 384 moveto (0x00) show
0 372 moveto (8273 #define) show
16 mp_a_x mul 372 moveto (PCI_SUBCLASS_WIRELESS_CONSUMERIR) show
56 mp_a_x mul 372 moveto (0x01) show
0 360 moveto (8274 #define) show
16 mp_a_x mul 360 moveto (PCI_SUBCLASS_WIRELESS_RF) show
56 mp_a_x mul 360 moveto (0x10) show
0 348 moveto (8275 #define) show
16 mp_a_x mul 348 moveto (PCI_SUBCLASS_WIRELESS_BLUETOOTH) show
56 mp_a_x mul 348 moveto (0x11) show
0 336 moveto (8276 #define) show
16 mp_a_x mul 336 moveto (PCI_SUBCLASS_WIRELESS_BROADBAND) show
56 mp_a_x mul 336 moveto (0x12) show
0 324 moveto (8277 #define) show
16 mp_a_x mul 324 moveto (PCI_SUBCLASS_WIRELESS_802_11A) show
56 mp_a_x mul 324 moveto (0x20) show
0 312 moveto (8278 #define) show
16 mp_a_x mul 312 moveto (PCI_SUBCLASS_WIRELESS_802_11B) show
56 mp_a_x mul 312 moveto (0x21) show
0 300 moveto (8279 #define) show
16 mp_a_x mul 300 moveto (PCI_SUBCLASS_WIRELESS_MISC) show
56 mp_a_x mul 300 moveto (0x80) show
0 288 moveto (8280 ) show
0 276 moveto (8281 /* 0x0e I2O \(Intelligent I/O\) subclasses */) show
0 264 moveto (8282 #define) show
16 mp_a_x mul 264 moveto (PCI_SUBCLASS_I2O_STANDARD) show
56 mp_a_x mul 264 moveto (0x00) show
0 252 moveto (8283 ) show
0 240 moveto (8284 /* 0x0f satellite communication subclasses */) show
0 228 moveto (8285 /*) show
8 mp_a_x mul 228 moveto (PCI_SUBCLASS_SATCOM_???) show
48 mp_a_x mul 228 moveto (0x00) show
56 mp_a_x mul 228 moveto (/ * XXX ??? */) show
0 216 moveto (8286 #define) show
16 mp_a_x mul 216 moveto (PCI_SUBCLASS_SATCOM_TV) show
56 mp_a_x mul 216 moveto (0x01) show
0 204 moveto (8287 #define) show
16 mp_a_x mul 204 moveto (PCI_SUBCLASS_SATCOM_AUDIO) show
56 mp_a_x mul 204 moveto (0x02) show
0 192 moveto (8288 #define) show
16 mp_a_x mul 192 moveto (PCI_SUBCLASS_SATCOM_VOICE) show
56 mp_a_x mul 192 moveto (0x03) show
0 180 moveto (8289 #define) show
16 mp_a_x mul 180 moveto (PCI_SUBCLASS_SATCOM_DATA) show
56 mp_a_x mul 180 moveto (0x04) show
0 168 moveto (8290 ) show
0 156 moveto (8291 /* 0x10 encryption/decryption subclasses */) show
0 144 moveto (8292 #define) show
16 mp_a_x mul 144 moveto (PCI_SUBCLASS_CRYPTO_NETCOMP) show
56 mp_a_x mul 144 moveto (0x00) show
0 132 moveto (8293 #define) show
16 mp_a_x mul 132 moveto (PCI_SUBCLASS_CRYPTO_ENTERTAINMENT) show
56 mp_a_x mul 132 moveto (0x10) show
0 120 moveto (8294 #define) show
16 mp_a_x mul 120 moveto (PCI_SUBCLASS_CRYPTO_MISC) show
56 mp_a_x mul 120 moveto (0x80) show
0 108 moveto (8295 ) show
0 96 moveto (8296 ) show
0 84 moveto (8297 ) show
0 72 moveto (8298 ) show
0 60 moveto (8299 ) show
0 24 moveto (Sheet 82) show
grestore
restore
showpage
%%Page: 92 92
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 7) show
0 648 moveto (8300 /* 0x11 data acquisition and signal processing subclasses */) show
0 636 moveto (8301 #define) show
16 mp_a_x mul 636 moveto (PCI_SUBCLASS_DASP_DPIO) show
56 mp_a_x mul 636 moveto (0x00) show
0 624 moveto (8302 #define) show
16 mp_a_x mul 624 moveto (PCI_SUBCLASS_DASP_TIMEFREQ) show
56 mp_a_x mul 624 moveto (0x01) show
0 612 moveto (8303 #define) show
16 mp_a_x mul 612 moveto (PCI_SUBCLASS_DASP_SYNC) show
56 mp_a_x mul 612 moveto (0x10) show
0 600 moveto (8304 #define) show
16 mp_a_x mul 600 moveto (PCI_SUBCLASS_DASP_MGMT) show
56 mp_a_x mul 600 moveto (0x20) show
0 588 moveto (8305 #define) show
16 mp_a_x mul 588 moveto (PCI_SUBCLASS_DASP_MISC) show
56 mp_a_x mul 588 moveto (0x80) show
0 576 moveto (8306 ) show
0 564 moveto (8307 /*) show
0 552 moveto (8308  * PCI BIST/Header Type/Latency Timer/Cache Line Size Register.) show
0 540 moveto (8309  */) show
0 528 moveto (8310 #define) show
16 mp_a_x mul 528 moveto (PCI_BHLC_REG) show
48 mp_a_x mul 528 moveto (0x0c) show
0 516 moveto (8311 ) show
0 504 moveto (8312 #define) show
16 mp_a_x mul 504 moveto (PCI_BIST_SHIFT) show
56 mp_a_x mul 504 moveto (24) show
0 492 moveto (8313 #define) show
16 mp_a_x mul 492 moveto (PCI_BIST_MASK) show
56 mp_a_x mul 492 moveto (0xff) show
0 480 moveto (8314 #define) show
16 mp_a_x mul 480 moveto (PCI_BIST\(bhlcr\) \\) show
0 468 moveto (8315 ) show
12 mp_a_x mul 468 moveto (\(\(\(bhlcr\) >> PCI_BIST_SHIFT\) & PCI_BIST_MASK\)) show
0 456 moveto (8316 ) show
0 444 moveto (8317 #define) show
16 mp_a_x mul 444 moveto (PCI_HDRTYPE_SHIFT) show
56 mp_a_x mul 444 moveto (16) show
0 432 moveto (8318 #define) show
16 mp_a_x mul 432 moveto (PCI_HDRTYPE_MASK) show
56 mp_a_x mul 432 moveto (0xff) show
0 420 moveto (8319 #define) show
16 mp_a_x mul 420 moveto (PCI_HDRTYPE\(bhlcr\) \\) show
0 408 moveto (8320 ) show
12 mp_a_x mul 408 moveto (\(\(\(bhlcr\) >> PCI_HDRTYPE_SHIFT\) & PCI_HDRTYPE_MASK\)) show
0 396 moveto (8321 ) show
0 384 moveto (8322 #define) show
16 mp_a_x mul 384 moveto (PCI_HDRTYPE_TYPE\(bhlcr\) \\) show
0 372 moveto (8323 ) show
12 mp_a_x mul 372 moveto (\(PCI_HDRTYPE\(bhlcr\) & 0x7f\)) show
0 360 moveto (8324 #define) show
16 mp_a_x mul 360 moveto (PCI_HDRTYPE_MULTIFN\(bhlcr\) \\) show
0 348 moveto (8325 ) show
12 mp_a_x mul 348 moveto (\(\(PCI_HDRTYPE\(bhlcr\) & 0x80\) != 0\)) show
0 336 moveto (8326 ) show
0 324 moveto (8327 #define) show
16 mp_a_x mul 324 moveto (PCI_LATTIMER_SHIFT) show
56 mp_a_x mul 324 moveto (8) show
0 312 moveto (8328 #define) show
16 mp_a_x mul 312 moveto (PCI_LATTIMER_MASK) show
56 mp_a_x mul 312 moveto (0xff) show
0 300 moveto (8329 #define) show
16 mp_a_x mul 300 moveto (PCI_LATTIMER\(bhlcr\) \\) show
0 288 moveto (8330 ) show
12 mp_a_x mul 288 moveto (\(\(\(bhlcr\) >> PCI_LATTIMER_SHIFT\) & PCI_LATTIMER_MASK\)) show
0 276 moveto (8331 ) show
0 264 moveto (8332 #define) show
16 mp_a_x mul 264 moveto (PCI_CACHELINE_SHIFT) show
56 mp_a_x mul 264 moveto (0) show
0 252 moveto (8333 #define) show
16 mp_a_x mul 252 moveto (PCI_CACHELINE_MASK) show
56 mp_a_x mul 252 moveto (0xff) show
0 240 moveto (8334 #define) show
16 mp_a_x mul 240 moveto (PCI_CACHELINE\(bhlcr\) \\) show
0 228 moveto (8335 ) show
12 mp_a_x mul 228 moveto (\(\(\(bhlcr\) >> PCI_CACHELINE_SHIFT\) & PCI_CACHELINE_MASK\)) show
0 216 moveto (8336 ) show
0 204 moveto (8337 #define PCI_BHLC_CODE\(bist,type,multi,latency,cacheline\)) show
72 mp_a_x mul 204 moveto (\\) show
0 192 moveto (8338 ) show
12 mp_a_x mul 192 moveto (\(\(\(\(bist\) & PCI_BIST_MASK\) << PCI_BIST_SHIFT\) |) show
72 mp_a_x mul 192 moveto (\\) show
0 180 moveto (8339 ) show
13 mp_a_x mul 180 moveto (\(\(\(type\) & PCI_HDRTYPE_MASK\) << PCI_HDRTYPE_SHIFT\) |) show
72 mp_a_x mul 180 moveto (\\) show
0 168 moveto (8340 ) show
13 mp_a_x mul 168 moveto (\(\(\(multi\)?0x80:0\) << PCI_HDRTYPE_SHIFT\) |) show
72 mp_a_x mul 168 moveto (\\) show
0 156 moveto (8341 ) show
13 mp_a_x mul 156 moveto (\(\(\(latency\) & PCI_LATTIMER_MASK\) << PCI_LATTIMER_SHIFT\) |) show
72 mp_a_x mul 156 moveto (\\) show
0 144 moveto (8342 ) show
13 mp_a_x mul 144 moveto (\(\(\(cacheline\) & PCI_CACHELINE_MASK\) << PCI_CACHELINE_SHIFT\)\)) show
0 132 moveto (8343 ) show
0 120 moveto (8344 /*) show
0 108 moveto (8345  * PCI header type) show
0 96 moveto (8346  */) show
0 84 moveto (8347 #define PCI_HDRTYPE_DEVICE) show
32 mp_a_x mul 84 moveto (0) show
0 72 moveto (8348 #define PCI_HDRTYPE_PPB) show
40 mp_a_x mul 72 moveto (1) show
0 60 moveto (8349 #define PCI_HDRTYPE_PCB) show
40 mp_a_x mul 60 moveto (2) show
0 24 moveto (Sheet 83) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 8) show
0 648 moveto (8350 /*) show
0 636 moveto (8351  * Mapping registers) show
0 624 moveto (8352  */) show
0 612 moveto (8353 #define) show
16 mp_a_x mul 612 moveto (PCI_MAPREG_START) show
48 mp_a_x mul 612 moveto (0x10) show
0 600 moveto (8354 #define) show
16 mp_a_x mul 600 moveto (PCI_MAPREG_END) show
48 mp_a_x mul 600 moveto (0x28) show
0 588 moveto (8355 #define) show
16 mp_a_x mul 588 moveto (PCI_MAPREG_ROM) show
48 mp_a_x mul 588 moveto (0x30) show
0 576 moveto (8356 #define) show
16 mp_a_x mul 576 moveto (PCI_MAPREG_PPB_END) show
48 mp_a_x mul 576 moveto (0x18) show
0 564 moveto (8357 #define) show
16 mp_a_x mul 564 moveto (PCI_MAPREG_PCB_END) show
48 mp_a_x mul 564 moveto (0x14) show
0 552 moveto (8358 ) show
0 540 moveto (8359 #define) show
16 mp_a_x mul 540 moveto (PCI_MAPREG_TYPE\(mr\)) show
80 mp_a_x mul 540 moveto (\\) show
0 528 moveto (8360 ) show
12 mp_a_x mul 528 moveto (\(\(mr\) & PCI_MAPREG_TYPE_MASK\)) show
0 516 moveto (8361 #define) show
16 mp_a_x mul 516 moveto (PCI_MAPREG_TYPE_MASK) show
56 mp_a_x mul 516 moveto (0x00000001) show
0 504 moveto (8362 ) show
0 492 moveto (8363 #define) show
16 mp_a_x mul 492 moveto (PCI_MAPREG_TYPE_MEM) show
56 mp_a_x mul 492 moveto (0x00000000) show
0 480 moveto (8364 #define) show
16 mp_a_x mul 480 moveto (PCI_MAPREG_TYPE_IO) show
56 mp_a_x mul 480 moveto (0x00000001) show
0 468 moveto (8365 #define) show
16 mp_a_x mul 468 moveto (PCI_MAPREG_ROM_ENABLE) show
56 mp_a_x mul 468 moveto (0x00000001) show
0 456 moveto (8366 ) show
0 444 moveto (8367 #define) show
16 mp_a_x mul 444 moveto (PCI_MAPREG_MEM_TYPE\(mr\)) show
80 mp_a_x mul 444 moveto (\\) show
0 432 moveto (8368 ) show
12 mp_a_x mul 432 moveto (\(\(mr\) & PCI_MAPREG_MEM_TYPE_MASK\)) show
0 420 moveto (8369 #define) show
16 mp_a_x mul 420 moveto (PCI_MAPREG_MEM_TYPE_MASK) show
56 mp_a_x mul 420 moveto (0x00000006) show
0 408 moveto (8370 ) show
0 396 moveto (8371 #define) show
16 mp_a_x mul 396 moveto (PCI_MAPREG_MEM_TYPE_32BIT) show
56 mp_a_x mul 396 moveto (0x00000000) show
0 384 moveto (8372 #define) show
16 mp_a_x mul 384 moveto (PCI_MAPREG_MEM_TYPE_32BIT_1M) show
56 mp_a_x mul 384 moveto (0x00000002) show
0 372 moveto (8373 #define) show
16 mp_a_x mul 372 moveto (PCI_MAPREG_MEM_TYPE_64BIT) show
56 mp_a_x mul 372 moveto (0x00000004) show
0 360 moveto (8374 ) show
0 348 moveto (8375 #define) show
16 mp_a_x mul 348 moveto (PCI_MAPREG_MEM_PREFETCHABLE\(mr\)) show
72 mp_a_x mul 348 moveto (\\) show
0 336 moveto (8376 ) show
12 mp_a_x mul 336 moveto (\(\(\(mr\) & PCI_MAPREG_MEM_PREFETCHABLE_MASK\) != 0\)) show
0 324 moveto (8377 #define) show
16 mp_a_x mul 324 moveto (PCI_MAPREG_MEM_PREFETCHABLE_MASK) show
56 mp_a_x mul 324 moveto (0x00000008) show
0 312 moveto (8378 ) show
0 300 moveto (8379 #define) show
16 mp_a_x mul 300 moveto (PCI_MAPREG_MEM_ADDR\(mr\)) show
80 mp_a_x mul 300 moveto (\\) show
0 288 moveto (8380 ) show
12 mp_a_x mul 288 moveto (\(\(mr\) & PCI_MAPREG_MEM_ADDR_MASK\)) show
0 276 moveto (8381 #define) show
16 mp_a_x mul 276 moveto (PCI_MAPREG_MEM_SIZE\(mr\)) show
80 mp_a_x mul 276 moveto (\\) show
0 264 moveto (8382 ) show
12 mp_a_x mul 264 moveto (\(PCI_MAPREG_MEM_ADDR\(mr\) & -PCI_MAPREG_MEM_ADDR\(mr\)\)) show
0 252 moveto (8383 #define) show
16 mp_a_x mul 252 moveto (PCI_MAPREG_MEM_ADDR_MASK) show
56 mp_a_x mul 252 moveto (0xfffffff0) show
0 240 moveto (8384 ) show
0 228 moveto (8385 #define) show
16 mp_a_x mul 228 moveto (PCI_MAPREG_MEM64_ADDR\(mr\)) show
80 mp_a_x mul 228 moveto (\\) show
0 216 moveto (8386 ) show
12 mp_a_x mul 216 moveto (\(\(mr\) & PCI_MAPREG_MEM64_ADDR_MASK\)) show
0 204 moveto (8387 #define) show
16 mp_a_x mul 204 moveto (PCI_MAPREG_MEM64_SIZE\(mr\)) show
80 mp_a_x mul 204 moveto (\\) show
0 192 moveto (8388 ) show
12 mp_a_x mul 192 moveto (\(PCI_MAPREG_MEM64_ADDR\(mr\) & -PCI_MAPREG_MEM64_ADDR\(mr\)\)) show
0 180 moveto (8389 #define) show
16 mp_a_x mul 180 moveto (PCI_MAPREG_MEM64_ADDR_MASK) show
56 mp_a_x mul 180 moveto (0xfffffffffffffff0ULL) show
0 168 moveto (8390 ) show
0 156 moveto (8391 #define) show
16 mp_a_x mul 156 moveto (PCI_MAPREG_IO_ADDR\(mr\)) show
80 mp_a_x mul 156 moveto (\\) show
0 144 moveto (8392 ) show
12 mp_a_x mul 144 moveto (\(\(mr\) & PCI_MAPREG_IO_ADDR_MASK\)) show
0 132 moveto (8393 #define) show
16 mp_a_x mul 132 moveto (PCI_MAPREG_IO_SIZE\(mr\)) show
80 mp_a_x mul 132 moveto (\\) show
0 120 moveto (8394 ) show
12 mp_a_x mul 120 moveto (\(PCI_MAPREG_IO_ADDR\(mr\) & -PCI_MAPREG_IO_ADDR\(mr\)\)) show
0 108 moveto (8395 #define) show
16 mp_a_x mul 108 moveto (PCI_MAPREG_IO_ADDR_MASK) show
56 mp_a_x mul 108 moveto (0xfffffffc) show
0 96 moveto (8396 ) show
0 84 moveto (8397 #define PCI_MAPREG_SIZE_TO_MASK\(size\)) show
80 mp_a_x mul 84 moveto (\\) show
0 72 moveto (8398 ) show
12 mp_a_x mul 72 moveto (\(-\(size\)\)) show
0 60 moveto (8399 ) show
0 24 moveto (Sheet 83) show
grestore
restore
showpage
%%Page: 93 93
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 9) show
0 648 moveto (8400 #define PCI_MAPREG_NUM\(offset\)) show
80 mp_a_x mul 648 moveto (\\) show
0 636 moveto (8401 ) show
12 mp_a_x mul 636 moveto (\(\(\(unsigned\)\(offset\)-PCI_MAPREG_START\)/4\)) show
0 624 moveto (8402 ) show
0 612 moveto (8403 ) show
0 600 moveto (8404 /*) show
0 588 moveto (8405  * Cardbus CIS pointer \(PCI rev. 2.1\)) show
0 576 moveto (8406  */) show
0 564 moveto (8407 #define PCI_CARDBUS_CIS_REG 0x28) show
0 552 moveto (8408 ) show
0 540 moveto (8409 /*) show
0 528 moveto (8410  * Subsystem identification register; contains a vendor ID and a device ID.) show
0 516 moveto (8411  * Types/macros for PCI_ID_REG apply.) show
0 504 moveto (8412  * \(PCI rev. 2.1\)) show
0 492 moveto (8413  */) show
0 480 moveto (8414 #define PCI_SUBSYS_ID_REG 0x2c) show
0 468 moveto (8415 ) show
0 456 moveto (8416 /*) show
0 444 moveto (8417  * Capabilities link list \(PCI rev. 2.2\)) show
0 432 moveto (8418  */) show
0 420 moveto (8419 #define) show
16 mp_a_x mul 420 moveto (PCI_CAPLISTPTR_REG) show
48 mp_a_x mul 420 moveto (0x34) show
56 mp_a_x mul 420 moveto (/* header type 0 */) show
0 408 moveto (8420 #define) show
16 mp_a_x mul 408 moveto (PCI_CARDBUS_CAPLISTPTR_REG) show
48 mp_a_x mul 408 moveto (0x14) show
56 mp_a_x mul 408 moveto (/* header type 2 */) show
0 396 moveto (8421 #define) show
16 mp_a_x mul 396 moveto (PCI_CAPLIST_PTR\(cpr\)) show
40 mp_a_x mul 396 moveto (\(\(cpr\) & 0xff\)) show
0 384 moveto (8422 #define) show
16 mp_a_x mul 384 moveto (PCI_CAPLIST_NEXT\(cr\)) show
40 mp_a_x mul 384 moveto (\(\(\(cr\) >> 8\) & 0xff\)) show
0 372 moveto (8423 #define) show
16 mp_a_x mul 372 moveto (PCI_CAPLIST_CAP\(cr\)) show
40 mp_a_x mul 372 moveto (\(\(cr\) & 0xff\)) show
0 360 moveto (8424 ) show
0 348 moveto (8425 #define) show
16 mp_a_x mul 348 moveto (PCI_CAP_RESERVED0) show
40 mp_a_x mul 348 moveto (0x00) show
0 336 moveto (8426 #define) show
16 mp_a_x mul 336 moveto (PCI_CAP_PWRMGMT) show
40 mp_a_x mul 336 moveto (0x01) show
0 324 moveto (8427 #define) show
16 mp_a_x mul 324 moveto (PCI_CAP_AGP) show
40 mp_a_x mul 324 moveto (0x02) show
0 312 moveto (8428 #define PCI_CAP_AGP_MAJOR\(cr\)) show
40 mp_a_x mul 312 moveto (\(\(\(cr\) >> 20\) & 0xf\)) show
0 300 moveto (8429 #define PCI_CAP_AGP_MINOR\(cr\)) show
40 mp_a_x mul 300 moveto (\(\(\(cr\) >> 16\) & 0xf\)) show
0 288 moveto (8430 #define) show
16 mp_a_x mul 288 moveto (PCI_CAP_VPD) show
40 mp_a_x mul 288 moveto (0x03) show
0 276 moveto (8431 #define) show
16 mp_a_x mul 276 moveto (PCI_CAP_SLOTID) show
40 mp_a_x mul 276 moveto (0x04) show
0 264 moveto (8432 #define) show
16 mp_a_x mul 264 moveto (PCI_CAP_MSI) show
40 mp_a_x mul 264 moveto (0x05) show
0 252 moveto (8433 #define) show
16 mp_a_x mul 252 moveto (PCI_CAP_CPCI_HOTSWAP) show
40 mp_a_x mul 252 moveto (0x06) show
0 240 moveto (8434 #define) show
16 mp_a_x mul 240 moveto (PCI_CAP_PCIX) show
40 mp_a_x mul 240 moveto (0x07) show
0 228 moveto (8435 #define) show
16 mp_a_x mul 228 moveto (PCI_CAP_LDT) show
40 mp_a_x mul 228 moveto (0x08) show
0 216 moveto (8436 #define) show
16 mp_a_x mul 216 moveto (PCI_CAP_VENDSPEC) show
40 mp_a_x mul 216 moveto (0x09) show
0 204 moveto (8437 #define) show
16 mp_a_x mul 204 moveto (PCI_CAP_DEBUGPORT) show
40 mp_a_x mul 204 moveto (0x0a) show
0 192 moveto (8438 #define) show
16 mp_a_x mul 192 moveto (PCI_CAP_CPCI_RSRCCTL) show
40 mp_a_x mul 192 moveto (0x0b) show
0 180 moveto (8439 #define) show
16 mp_a_x mul 180 moveto (PCI_CAP_HOTPLUG) show
40 mp_a_x mul 180 moveto (0x0c) show
0 168 moveto (8440 #define) show
16 mp_a_x mul 168 moveto (PCI_CAP_AGP8) show
40 mp_a_x mul 168 moveto (0x0e) show
0 156 moveto (8441 #define) show
16 mp_a_x mul 156 moveto (PCI_CAP_SECURE) show
40 mp_a_x mul 156 moveto (0x0f) show
0 144 moveto (8442 #define) show
16 mp_a_x mul 144 moveto (PCI_CAP_PCIEXPRESS     ) show
40 mp_a_x mul 144 moveto (0x10) show
0 132 moveto (8443 #define) show
16 mp_a_x mul 132 moveto (PCI_CAP_MSIX) show
40 mp_a_x mul 132 moveto (0x11) show
0 120 moveto (8444 ) show
0 108 moveto (8445 /*) show
0 96 moveto (8446  * Vital Product Data; access via capability pointer \(PCI rev 2.2\).) show
0 84 moveto (8447  */) show
0 72 moveto (8448 #define) show
16 mp_a_x mul 72 moveto (PCI_VPD_ADDRESS_MASK) show
40 mp_a_x mul 72 moveto (0x7fff) show
0 60 moveto (8449 #define) show
16 mp_a_x mul 60 moveto (PCI_VPD_ADDRESS_SHIFT) show
40 mp_a_x mul 60 moveto (16) show
0 24 moveto (Sheet 84) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 10) show
0 648 moveto (8450 #define) show
16 mp_a_x mul 648 moveto (PCI_VPD_ADDRESS\(ofs\)) show
40 mp_a_x mul 648 moveto (\\) show
0 636 moveto (8451 ) show
8 mp_a_x mul 636 moveto (\(\(\(ofs\) & PCI_VPD_ADDRESS_MASK\) << PCI_VPD_ADDRESS_SHIFT\)) show
0 624 moveto (8452 #define) show
16 mp_a_x mul 624 moveto (PCI_VPD_DATAREG\(ofs\)) show
40 mp_a_x mul 624 moveto (\(\(ofs\) + 4\)) show
0 612 moveto (8453 #define) show
16 mp_a_x mul 612 moveto (PCI_VPD_OPFLAG) show
40 mp_a_x mul 612 moveto (0x80000000) show
0 600 moveto (8454 ) show
0 588 moveto (8455 /*) show
0 576 moveto (8456  * Power Management Capability; access via capability pointer.) show
0 564 moveto (8457  */) show
0 552 moveto (8458 ) show
0 540 moveto (8459 /* Power Management Capability Register */) show
0 528 moveto (8460 #define PCI_PMCR) show
32 mp_a_x mul 528 moveto (0x02) show
0 516 moveto (8461 #define PCI_PMCR_D1SUPP) show
40 mp_a_x mul 516 moveto (0x0200) show
0 504 moveto (8462 #define PCI_PMCR_D2SUPP) show
40 mp_a_x mul 504 moveto (0x0400) show
0 492 moveto (8463 /* Power Management Control Status Register */) show
0 480 moveto (8464 #define PCI_PMCSR) show
32 mp_a_x mul 480 moveto (0x04) show
0 468 moveto (8465 #define PCI_PMCSR_STATE_MASK) show
40 mp_a_x mul 468 moveto (0x03) show
0 456 moveto (8466 #define PCI_PMCSR_STATE_D0      0x00) show
0 444 moveto (8467 #define PCI_PMCSR_STATE_D1      0x01) show
0 432 moveto (8468 #define PCI_PMCSR_STATE_D2      0x02) show
0 420 moveto (8469 #define PCI_PMCSR_STATE_D3      0x03) show
0 408 moveto (8470 ) show
0 396 moveto (8471 /*) show
0 384 moveto (8472  * PCI-X capability.) show
0 372 moveto (8473  */) show
0 360 moveto (8474 ) show
0 348 moveto (8475 /*) show
0 336 moveto (8476  * Command. 16 bits at offset 2 \(e.g. upper 16 bits of the first 32-bit) show
0 324 moveto (8477  * word at the capability; the lower 16 bits are the capability ID and) show
0 312 moveto (8478  * next capability pointer\).) show
0 300 moveto (8479  *) show
0 288 moveto (8480  * Since we always read PCI config space in 32-bit words, we define these) show
0 276 moveto (8481  * as 32-bit values, offset and shifted appropriately.  Make sure you perform) show
0 264 moveto (8482  * the appropriate R/M/W cycles!) show
0 252 moveto (8483  */) show
0 240 moveto (8484 #define PCI_PCIX_CMD) show
48 mp_a_x mul 240 moveto (0x00) show
0 228 moveto (8485 #define PCI_PCIX_CMD_PERR_RECOVER) show
40 mp_a_x mul 228 moveto (0x00010000) show
0 216 moveto (8486 #define PCI_PCIX_CMD_RELAXED_ORDER) show
40 mp_a_x mul 216 moveto (0x00020000) show
0 204 moveto (8487 #define PCI_PCIX_CMD_BYTECNT_MASK) show
40 mp_a_x mul 204 moveto (0x000c0000) show
0 192 moveto (8488 #define) show
16 mp_a_x mul 192 moveto (PCI_PCIX_CMD_BYTECNT_SHIFT) show
48 mp_a_x mul 192 moveto (18) show
0 180 moveto (8489 #define) show
24 mp_a_x mul 180 moveto (PCI_PCIX_CMD_BCNT_512) show
56 mp_a_x mul 180 moveto (0x00000000) show
0 168 moveto (8490 #define) show
24 mp_a_x mul 168 moveto (PCI_PCIX_CMD_BCNT_1024) show
56 mp_a_x mul 168 moveto (0x00040000) show
0 156 moveto (8491 #define) show
24 mp_a_x mul 156 moveto (PCI_PCIX_CMD_BCNT_2048) show
56 mp_a_x mul 156 moveto (0x00080000) show
0 144 moveto (8492 #define) show
24 mp_a_x mul 144 moveto (PCI_PCIX_CMD_BCNT_4096) show
56 mp_a_x mul 144 moveto (0x000c0000) show
0 132 moveto (8493 #define PCI_PCIX_CMD_SPLTRANS_MASK) show
40 mp_a_x mul 132 moveto (0x00700000) show
0 120 moveto (8494 #define) show
24 mp_a_x mul 120 moveto (PCI_PCIX_CMD_SPLTRANS_1) show
56 mp_a_x mul 120 moveto (0x00000000) show
0 108 moveto (8495 #define) show
24 mp_a_x mul 108 moveto (PCI_PCIX_CMD_SPLTRANS_2) show
56 mp_a_x mul 108 moveto (0x00100000) show
0 96 moveto (8496 #define) show
24 mp_a_x mul 96 moveto (PCI_PCIX_CMD_SPLTRANS_3) show
56 mp_a_x mul 96 moveto (0x00200000) show
0 84 moveto (8497 #define) show
24 mp_a_x mul 84 moveto (PCI_PCIX_CMD_SPLTRANS_4) show
56 mp_a_x mul 84 moveto (0x00300000) show
0 72 moveto (8498 #define) show
24 mp_a_x mul 72 moveto (PCI_PCIX_CMD_SPLTRANS_8) show
56 mp_a_x mul 72 moveto (0x00400000) show
0 60 moveto (8499 #define) show
24 mp_a_x mul 60 moveto (PCI_PCIX_CMD_SPLTRANS_12) show
56 mp_a_x mul 60 moveto (0x00500000) show
0 24 moveto (Sheet 84) show
grestore
restore
showpage
%%Page: 94 94
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 11) show
0 648 moveto (8500 #define) show
24 mp_a_x mul 648 moveto (PCI_PCIX_CMD_SPLTRANS_16) show
56 mp_a_x mul 648 moveto (0x00600000) show
0 636 moveto (8501 #define) show
24 mp_a_x mul 636 moveto (PCI_PCIX_CMD_SPLTRANS_32) show
56 mp_a_x mul 636 moveto (0x00700000) show
0 624 moveto (8502 ) show
0 612 moveto (8503 /*) show
0 600 moveto (8504  * Status. 32 bits at offset 4.) show
0 588 moveto (8505  */) show
0 576 moveto (8506 #define PCI_PCIX_STATUS) show
48 mp_a_x mul 576 moveto (0x04) show
0 564 moveto (8507 #define PCI_PCIX_STATUS_FN_MASK) show
48 mp_a_x mul 564 moveto (0x00000007) show
0 552 moveto (8508 #define PCI_PCIX_STATUS_DEV_MASK) show
40 mp_a_x mul 552 moveto (0x000000f8) show
0 540 moveto (8509 #define PCI_PCIX_STATUS_BUS_MASK) show
40 mp_a_x mul 540 moveto (0x0000ff00) show
0 528 moveto (8510 #define PCI_PCIX_STATUS_64BIT) show
48 mp_a_x mul 528 moveto (0x00010000) show
0 516 moveto (8511 #define PCI_PCIX_STATUS_133) show
48 mp_a_x mul 516 moveto (0x00020000) show
0 504 moveto (8512 #define PCI_PCIX_STATUS_SPLDISC) show
48 mp_a_x mul 504 moveto (0x00040000) show
0 492 moveto (8513 #define PCI_PCIX_STATUS_SPLUNEX) show
48 mp_a_x mul 492 moveto (0x00080000) show
0 480 moveto (8514 #define PCI_PCIX_STATUS_DEVCPLX) show
48 mp_a_x mul 480 moveto (0x00100000) show
0 468 moveto (8515 #define PCI_PCIX_STATUS_MAXB_MASK) show
40 mp_a_x mul 468 moveto (0x00600000) show
0 456 moveto (8516 #define) show
16 mp_a_x mul 456 moveto (PCI_PCIX_STATUS_MAXB_SHIFT) show
48 mp_a_x mul 456 moveto (21) show
0 444 moveto (8517 #define) show
24 mp_a_x mul 444 moveto (PCI_PCIX_STATUS_MAXB_512) show
56 mp_a_x mul 444 moveto (0x00000000) show
0 432 moveto (8518 #define) show
24 mp_a_x mul 432 moveto (PCI_PCIX_STATUS_MAXB_1024) show
56 mp_a_x mul 432 moveto (0x00200000) show
0 420 moveto (8519 #define) show
24 mp_a_x mul 420 moveto (PCI_PCIX_STATUS_MAXB_2048) show
56 mp_a_x mul 420 moveto (0x00400000) show
0 408 moveto (8520 #define) show
24 mp_a_x mul 408 moveto (PCI_PCIX_STATUS_MAXB_4096) show
56 mp_a_x mul 408 moveto (0x00600000) show
0 396 moveto (8521 #define PCI_PCIX_STATUS_MAXST_MASK) show
40 mp_a_x mul 396 moveto (0x03800000) show
0 384 moveto (8522 #define) show
24 mp_a_x mul 384 moveto (PCI_PCIX_STATUS_MAXST_1) show
56 mp_a_x mul 384 moveto (0x00000000) show
0 372 moveto (8523 #define) show
24 mp_a_x mul 372 moveto (PCI_PCIX_STATUS_MAXST_2) show
56 mp_a_x mul 372 moveto (0x00800000) show
0 360 moveto (8524 #define) show
24 mp_a_x mul 360 moveto (PCI_PCIX_STATUS_MAXST_3) show
56 mp_a_x mul 360 moveto (0x01000000) show
0 348 moveto (8525 #define) show
24 mp_a_x mul 348 moveto (PCI_PCIX_STATUS_MAXST_4) show
56 mp_a_x mul 348 moveto (0x01800000) show
0 336 moveto (8526 #define) show
24 mp_a_x mul 336 moveto (PCI_PCIX_STATUS_MAXST_8) show
56 mp_a_x mul 336 moveto (0x02000000) show
0 324 moveto (8527 #define) show
24 mp_a_x mul 324 moveto (PCI_PCIX_STATUS_MAXST_12) show
56 mp_a_x mul 324 moveto (0x02800000) show
0 312 moveto (8528 #define) show
24 mp_a_x mul 312 moveto (PCI_PCIX_STATUS_MAXST_16) show
56 mp_a_x mul 312 moveto (0x03000000) show
0 300 moveto (8529 #define) show
24 mp_a_x mul 300 moveto (PCI_PCIX_STATUS_MAXST_32) show
56 mp_a_x mul 300 moveto (0x03800000) show
0 288 moveto (8530 #define PCI_PCIX_STATUS_MAXRS_MASK) show
40 mp_a_x mul 288 moveto (0x1c000000) show
0 276 moveto (8531 #define) show
24 mp_a_x mul 276 moveto (PCI_PCIX_STATUS_MAXRS_1K) show
56 mp_a_x mul 276 moveto (0x00000000) show
0 264 moveto (8532 #define) show
24 mp_a_x mul 264 moveto (PCI_PCIX_STATUS_MAXRS_2K) show
56 mp_a_x mul 264 moveto (0x04000000) show
0 252 moveto (8533 #define) show
24 mp_a_x mul 252 moveto (PCI_PCIX_STATUS_MAXRS_4K) show
56 mp_a_x mul 252 moveto (0x08000000) show
0 240 moveto (8534 #define) show
24 mp_a_x mul 240 moveto (PCI_PCIX_STATUS_MAXRS_8K) show
56 mp_a_x mul 240 moveto (0x0c000000) show
0 228 moveto (8535 #define) show
24 mp_a_x mul 228 moveto (PCI_PCIX_STATUS_MAXRS_16K) show
56 mp_a_x mul 228 moveto (0x10000000) show
0 216 moveto (8536 #define) show
24 mp_a_x mul 216 moveto (PCI_PCIX_STATUS_MAXRS_32K) show
56 mp_a_x mul 216 moveto (0x14000000) show
0 204 moveto (8537 #define) show
24 mp_a_x mul 204 moveto (PCI_PCIX_STATUS_MAXRS_64K) show
56 mp_a_x mul 204 moveto (0x18000000) show
0 192 moveto (8538 #define) show
24 mp_a_x mul 192 moveto (PCI_PCIX_STATUS_MAXRS_128K) show
56 mp_a_x mul 192 moveto (0x1c000000) show
0 180 moveto (8539 #define PCI_PCIX_STATUS_SCERR) show
56 mp_a_x mul 180 moveto (0x20000000) show
0 168 moveto (8540 ) show
0 156 moveto (8541 ) show
0 144 moveto (8542 /*) show
0 132 moveto (8543  * Interrupt Configuration Register; contains interrupt pin and line.) show
0 120 moveto (8544  */) show
0 108 moveto (8545 #define) show
16 mp_a_x mul 108 moveto (PCI_INTERRUPT_REG) show
48 mp_a_x mul 108 moveto (0x3c) show
0 96 moveto (8546 ) show
0 84 moveto (8547 ) show
0 72 moveto (8548 ) show
0 60 moveto (8549 ) show
0 24 moveto (Sheet 85) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 12) show
0 648 moveto (8550 typedef uint8_t pci_intr_latency_t;) show
0 636 moveto (8551 typedef uint8_t pci_intr_grant_t;) show
0 624 moveto (8552 typedef uint8_t pci_intr_pin_t;) show
0 612 moveto (8553 typedef uint8_t pci_intr_line_t;) show
0 600 moveto (8554 ) show
0 588 moveto (8555 #define PCI_MAX_LAT_SHIFT) show
48 mp_a_x mul 588 moveto (24) show
0 576 moveto (8556 #define) show
16 mp_a_x mul 576 moveto (PCI_MAX_LAT_MASK) show
56 mp_a_x mul 576 moveto (0xff) show
0 564 moveto (8557 #define) show
16 mp_a_x mul 564 moveto (PCI_MAX_LAT\(icr\) \\) show
0 552 moveto (8558 ) show
12 mp_a_x mul 552 moveto (\(\(\(icr\) >> PCI_MAX_LAT_SHIFT\) & PCI_MAX_LAT_MASK\)) show
0 540 moveto (8559 ) show
0 528 moveto (8560 #define PCI_MIN_GNT_SHIFT) show
48 mp_a_x mul 528 moveto (16) show
0 516 moveto (8561 #define) show
16 mp_a_x mul 516 moveto (PCI_MIN_GNT_MASK) show
56 mp_a_x mul 516 moveto (0xff) show
0 504 moveto (8562 #define) show
16 mp_a_x mul 504 moveto (PCI_MIN_GNT\(icr\) \\) show
0 492 moveto (8563 ) show
12 mp_a_x mul 492 moveto (\(\(\(icr\) >> PCI_MIN_GNT_SHIFT\) & PCI_MIN_GNT_MASK\)) show
0 480 moveto (8564 ) show
0 468 moveto (8565 #define) show
16 mp_a_x mul 468 moveto (PCI_INTERRUPT_GRANT_SHIFT) show
56 mp_a_x mul 468 moveto (24) show
0 456 moveto (8566 #define) show
16 mp_a_x mul 456 moveto (PCI_INTERRUPT_GRANT_MASK) show
56 mp_a_x mul 456 moveto (0xff) show
0 444 moveto (8567 #define) show
16 mp_a_x mul 444 moveto (PCI_INTERRUPT_GRANT\(icr\) \\) show
0 432 moveto (8568 ) show
12 mp_a_x mul 432 moveto (\(\(\(icr\) >> PCI_INTERRUPT_GRANT_SHIFT\) & PCI_INTERRUPT_GRANT_MASK\)) show
0 420 moveto (8569 ) show
0 408 moveto (8570 #define) show
16 mp_a_x mul 408 moveto (PCI_INTERRUPT_LATENCY_SHIFT) show
56 mp_a_x mul 408 moveto (16) show
0 396 moveto (8571 #define) show
16 mp_a_x mul 396 moveto (PCI_INTERRUPT_LATENCY_MASK) show
56 mp_a_x mul 396 moveto (0xff) show
0 384 moveto (8572 #define) show
16 mp_a_x mul 384 moveto (PCI_INTERRUPT_LATENCY\(icr\) \\) show
0 372 moveto (8573 ) show
12 mp_a_x mul 372 moveto (\(\(\(icr\) >> PCI_INTERRUPT_LATENCY_SHIFT\) & PCI_INTERRUPT_LATENCY_MASK\)) show
0 360 moveto (8574 ) show
0 348 moveto (8575 #define) show
16 mp_a_x mul 348 moveto (PCI_INTERRUPT_PIN_SHIFT) show
56 mp_a_x mul 348 moveto (8) show
0 336 moveto (8576 #define) show
16 mp_a_x mul 336 moveto (PCI_INTERRUPT_PIN_MASK) show
56 mp_a_x mul 336 moveto (0xff) show
0 324 moveto (8577 #define) show
16 mp_a_x mul 324 moveto (PCI_INTERRUPT_PIN\(icr\) \\) show
0 312 moveto (8578 ) show
12 mp_a_x mul 312 moveto (\(\(\(icr\) >> PCI_INTERRUPT_PIN_SHIFT\) & PCI_INTERRUPT_PIN_MASK\)) show
0 300 moveto (8579 ) show
0 288 moveto (8580 #define) show
16 mp_a_x mul 288 moveto (PCI_INTERRUPT_LINE_SHIFT) show
56 mp_a_x mul 288 moveto (0) show
0 276 moveto (8581 #define) show
16 mp_a_x mul 276 moveto (PCI_INTERRUPT_LINE_MASK) show
56 mp_a_x mul 276 moveto (0xff) show
0 264 moveto (8582 #define) show
16 mp_a_x mul 264 moveto (PCI_INTERRUPT_LINE\(icr\) \\) show
0 252 moveto (8583 ) show
12 mp_a_x mul 252 moveto (\(\(\(icr\) >> PCI_INTERRUPT_LINE_SHIFT\) & PCI_INTERRUPT_LINE_MASK\)) show
0 240 moveto (8584 ) show
0 228 moveto (8585 #define PCI_INTERRUPT_CODE\(lat,gnt,pin,line\)) show
64 mp_a_x mul 228 moveto (\\) show
0 216 moveto (8586 ) show
10 mp_a_x mul 216 moveto (\(\(\(\(lat\)&PCI_INTERRUPT_LATENCY_MASK\)<<PCI_INTERRUPT_LATENCY_SHIFT\)| \\) show
0 204 moveto (8587 ) show
11 mp_a_x mul 204 moveto (\(\(\(gnt\)&PCI_INTERRUPT_GRANT_MASK\)  <<PCI_INTERRUPT_GRANT_SHIFT\)  | \\) show
0 192 moveto (8588 ) show
11 mp_a_x mul 192 moveto (\(\(\(pin\)&PCI_INTERRUPT_PIN_MASK\)    <<PCI_INTERRUPT_PIN_SHIFT\)    | \\) show
0 180 moveto (8589 ) show
11 mp_a_x mul 180 moveto (\(\(\(line\)&PCI_INTERRUPT_LINE_MASK\)  <<PCI_INTERRUPT_LINE_SHIFT\)\)) show
0 168 moveto (8590 ) show
0 156 moveto (8591 #define) show
16 mp_a_x mul 156 moveto (PCI_INTERRUPT_PIN_NONE) show
56 mp_a_x mul 156 moveto (0x00) show
0 144 moveto (8592 #define) show
16 mp_a_x mul 144 moveto (PCI_INTERRUPT_PIN_A) show
56 mp_a_x mul 144 moveto (0x01) show
0 132 moveto (8593 #define) show
16 mp_a_x mul 132 moveto (PCI_INTERRUPT_PIN_B) show
56 mp_a_x mul 132 moveto (0x02) show
0 120 moveto (8594 #define) show
16 mp_a_x mul 120 moveto (PCI_INTERRUPT_PIN_C) show
56 mp_a_x mul 120 moveto (0x03) show
0 108 moveto (8595 #define) show
16 mp_a_x mul 108 moveto (PCI_INTERRUPT_PIN_D) show
56 mp_a_x mul 108 moveto (0x04) show
0 96 moveto (8596 #define) show
16 mp_a_x mul 96 moveto (PCI_INTERRUPT_PIN_MAX) show
56 mp_a_x mul 96 moveto (0x04) show
0 84 moveto (8597 ) show
0 72 moveto (8598 ) show
0 60 moveto (8599 ) show
0 24 moveto (Sheet 85) show
grestore
restore
showpage
%%Page: 95 95
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 13) show
0 648 moveto (8600 /* Header Type 1 \(Bridge\) configuration registers */) show
0 636 moveto (8601 #define PCI_BRIDGE_BUS_REG) show
40 mp_a_x mul 636 moveto (0x18) show
0 624 moveto (8602 #define   PCI_BRIDGE_BUS_PRIMARY_SHIFT) show
56 mp_a_x mul 624 moveto (0) show
0 612 moveto (8603 #define   PCI_BRIDGE_BUS_SECONDARY_SHIFT) show
48 mp_a_x mul 612 moveto (8) show
0 600 moveto (8604 #define   PCI_BRIDGE_BUS_SUBORDINATE_SHIFT) show
48 mp_a_x mul 600 moveto (16) show
0 588 moveto (8605 ) show
0 576 moveto (8606 #define PCI_BRIDGE_STATIO_REG) show
48 mp_a_x mul 576 moveto (0x1C) show
0 564 moveto (8607 #define) show
18 mp_a_x mul 564 moveto (PCI_BRIDGE_STATIO_IOBASE_SHIFT) show
56 mp_a_x mul 564 moveto (0) show
0 552 moveto (8608 #define) show
18 mp_a_x mul 552 moveto (PCI_BRIDGE_STATIO_IOLIMIT_SHIFT) show
56 mp_a_x mul 552 moveto (8) show
0 540 moveto (8609 #define) show
18 mp_a_x mul 540 moveto (PCI_BRIDGE_STATIO_STATUS_SHIFT) show
56 mp_a_x mul 540 moveto (16) show
0 528 moveto (8610 #define) show
18 mp_a_x mul 528 moveto (PCI_BRIDGE_STATIO_IOBASE_MASK) show
56 mp_a_x mul 528 moveto (0xf0) show
0 516 moveto (8611 #define) show
18 mp_a_x mul 516 moveto (PCI_BRIDGE_STATIO_IOLIMIT_MASK) show
56 mp_a_x mul 516 moveto (0xf0) show
0 504 moveto (8612 #define) show
18 mp_a_x mul 504 moveto (PCI_BRIDGE_STATIO_STATUS_MASK) show
56 mp_a_x mul 504 moveto (0xffff) show
0 492 moveto (8613 #define) show
18 mp_a_x mul 492 moveto (PCI_BRIDGE_IO_32BITS\(reg\)) show
56 mp_a_x mul 492 moveto (\(\(\(reg\) & 0xf\) == 1\)) show
0 480 moveto (8614 ) show
0 468 moveto (8615 #define PCI_BRIDGE_MEMORY_REG) show
48 mp_a_x mul 468 moveto (0x20) show
0 456 moveto (8616 #define) show
18 mp_a_x mul 456 moveto (PCI_BRIDGE_MEMORY_BASE_SHIFT) show
56 mp_a_x mul 456 moveto (4) show
0 444 moveto (8617 #define) show
18 mp_a_x mul 444 moveto (PCI_BRIDGE_MEMORY_LIMIT_SHIFT) show
56 mp_a_x mul 444 moveto (20) show
0 432 moveto (8618 #define) show
18 mp_a_x mul 432 moveto (PCI_BRIDGE_MEMORY_BASE_MASK) show
56 mp_a_x mul 432 moveto (0xffff) show
0 420 moveto (8619 #define) show
18 mp_a_x mul 420 moveto (PCI_BRIDGE_MEMORY_LIMIT_MASK) show
56 mp_a_x mul 420 moveto (0xffff) show
0 408 moveto (8620 ) show
0 396 moveto (8621 #define PCI_BRIDGE_PREFETCHMEM_REG) show
40 mp_a_x mul 396 moveto (0x24) show
0 384 moveto (8622 #define) show
18 mp_a_x mul 384 moveto (PCI_BRIDGE_PREFETCHMEM_BASE_SHIFT) show
56 mp_a_x mul 384 moveto (4) show
0 372 moveto (8623 #define) show
18 mp_a_x mul 372 moveto (PCI_BRIDGE_PREFETCHMEM_LIMIT_SHIFT) show
56 mp_a_x mul 372 moveto (20) show
0 360 moveto (8624 #define) show
18 mp_a_x mul 360 moveto (PCI_BRIDGE_PREFETCHMEM_BASE_MASK) show
56 mp_a_x mul 360 moveto (0xffff) show
0 348 moveto (8625 #define) show
18 mp_a_x mul 348 moveto (PCI_BRIDGE_PREFETCHMEM_LIMIT_MASK) show
56 mp_a_x mul 348 moveto (0xffff) show
0 336 moveto (8626 #define) show
18 mp_a_x mul 336 moveto (PCI_BRIDGE_PREFETCHMEM_64BITS\(reg\)) show
56 mp_a_x mul 336 moveto (\(\(reg\) & 0xf\)) show
0 324 moveto (8627 ) show
0 312 moveto (8628 #define PCI_BRIDGE_PREFETCHBASE32_REG) show
48 mp_a_x mul 312 moveto (0x28) show
0 300 moveto (8629 #define PCI_BRIDGE_PREFETCHLIMIT32_REG) show
48 mp_a_x mul 300 moveto (0x2C) show
0 288 moveto (8630 ) show
0 276 moveto (8631 #define PCI_BRIDGE_IOHIGH_REG) show
48 mp_a_x mul 276 moveto (0x30) show
0 264 moveto (8632 #define) show
18 mp_a_x mul 264 moveto (PCI_BRIDGE_IOHIGH_BASE_SHIFT) show
56 mp_a_x mul 264 moveto (0) show
0 252 moveto (8633 #define) show
18 mp_a_x mul 252 moveto (PCI_BRIDGE_IOHIGH_LIMIT_SHIFT) show
56 mp_a_x mul 252 moveto (16) show
0 240 moveto (8634 #define) show
18 mp_a_x mul 240 moveto (PCI_BRIDGE_IOHIGH_BASE_MASK) show
56 mp_a_x mul 240 moveto (0xffff) show
0 228 moveto (8635 #define) show
18 mp_a_x mul 228 moveto (PCI_BRIDGE_IOHIGH_LIMIT_MASK) show
56 mp_a_x mul 228 moveto (0xffff) show
0 216 moveto (8636 ) show
0 204 moveto (8637 #define PCI_BRIDGE_CONTROL_REG) show
48 mp_a_x mul 204 moveto (0x3C) show
0 192 moveto (8638 #define) show
18 mp_a_x mul 192 moveto (PCI_BRIDGE_CONTROL_SHIFT) show
56 mp_a_x mul 192 moveto (16) show
0 180 moveto (8639 #define) show
18 mp_a_x mul 180 moveto (PCI_BRIDGE_CONTROL_MASK) show
56 mp_a_x mul 180 moveto (0xffff) show
0 168 moveto (8640 #define   PCI_BRIDGE_CONTROL_PERE) show
48 mp_a_x mul 168 moveto (\(1 <<  0\)) show
0 156 moveto (8641 #define   PCI_BRIDGE_CONTROL_SERR) show
48 mp_a_x mul 156 moveto (\(1 <<  1\)) show
0 144 moveto (8642 #define   PCI_BRIDGE_CONTROL_ISA) show
48 mp_a_x mul 144 moveto (\(1 <<  2\)) show
0 132 moveto (8643 #define   PCI_BRIDGE_CONTROL_VGA) show
48 mp_a_x mul 132 moveto (\(1 <<  3\)) show
0 120 moveto (8644 /* Reserved) show
56 mp_a_x mul 120 moveto (\(1 <<  4\) */) show
0 108 moveto (8645 #define   PCI_BRIDGE_CONTROL_MABRT) show
48 mp_a_x mul 108 moveto (\(1 <<  5\)) show
0 96 moveto (8646 #define   PCI_BRIDGE_CONTROL_SECBR) show
48 mp_a_x mul 96 moveto (\(1 <<  6\)) show
0 84 moveto (8647 #define   PCI_BRIDGE_CONTROL_SECFASTB2B) show
56 mp_a_x mul 84 moveto (\(1 <<  7\)) show
0 72 moveto (8648 #define   PCI_BRIDGE_CONTROL_PRI_DISC_TIMER) show
56 mp_a_x mul 72 moveto (\(1 <<  8\)) show
0 60 moveto (8649 #define   PCI_BRIDGE_CONTROL_SEC_DISC_TIMER) show
56 mp_a_x mul 60 moveto (\(1 <<  9\)) show
0 24 moveto (Sheet 86) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 14) show
0 648 moveto (8650 #define   PCI_BRIDGE_CONTROL_DISC_TIMER_STAT) show
56 mp_a_x mul 648 moveto (\(1 << 10\)) show
0 636 moveto (8651 #define   PCI_BRIDGE_CONTROL_DISC_TIMER_SERR) show
56 mp_a_x mul 636 moveto (\(1 << 11\)) show
0 624 moveto (8652 /* Reserved) show
56 mp_a_x mul 624 moveto (\(1 << 12\) - \(1 << 15\) */) show
0 612 moveto (8653 ) show
0 600 moveto (8654 /*) show
0 588 moveto (8655  * Vital Product Data resource tags.) show
0 576 moveto (8656  */) show
0 564 moveto (8657 struct pci_vpd_smallres {) show
0 552 moveto (8658 ) show
8 mp_a_x mul 552 moveto (uint8_t) show
24 mp_a_x mul 552 moveto (vpdres_byte0;) show
48 mp_a_x mul 552 moveto (/* length of data + tag */) show
0 540 moveto (8659 ) show
8 mp_a_x mul 540 moveto (/* Actual data. */) show
0 528 moveto (8660 } __attribute__\(\(__packed__\)\);) show
0 516 moveto (8661 ) show
0 504 moveto (8662 struct pci_vpd_largeres {) show
0 492 moveto (8663 ) show
8 mp_a_x mul 492 moveto (uint8_t) show
24 mp_a_x mul 492 moveto (vpdres_byte0;) show
0 480 moveto (8664 ) show
8 mp_a_x mul 480 moveto (uint8_t) show
24 mp_a_x mul 480 moveto (vpdres_len_lsb;) show
48 mp_a_x mul 480 moveto (/* length of data only */) show
0 468 moveto (8665 ) show
8 mp_a_x mul 468 moveto (uint8_t) show
24 mp_a_x mul 468 moveto (vpdres_len_msb;) show
0 456 moveto (8666 ) show
8 mp_a_x mul 456 moveto (/* Actual data. */) show
0 444 moveto (8667 } __attribute__\(\(__packed__\)\);) show
0 432 moveto (8668 ) show
0 420 moveto (8669 #define) show
16 mp_a_x mul 420 moveto (PCI_VPDRES_ISLARGE\(x\)) show
56 mp_a_x mul 420 moveto (\(\(x\) & 0x80\)) show
0 408 moveto (8670 ) show
0 396 moveto (8671 #define) show
16 mp_a_x mul 396 moveto (PCI_VPDRES_SMALL_LENGTH\(x\)) show
56 mp_a_x mul 396 moveto (\(\(x\) & 0x7\)) show
0 384 moveto (8672 #define) show
16 mp_a_x mul 384 moveto (PCI_VPDRES_SMALL_NAME\(x\)) show
56 mp_a_x mul 384 moveto (\(\(\(x\) >> 3\) & 0xf\)) show
0 372 moveto (8673 ) show
0 360 moveto (8674 #define) show
16 mp_a_x mul 360 moveto (PCI_VPDRES_LARGE_NAME\(x\)) show
56 mp_a_x mul 360 moveto (\(\(x\) & 0x7f\)) show
0 348 moveto (8675 ) show
0 336 moveto (8676 #define) show
16 mp_a_x mul 336 moveto (PCI_VPDRES_TYPE_COMPATIBLE_DEVICE_ID) show
56 mp_a_x mul 336 moveto (0x3) show
64 mp_a_x mul 336 moveto (/* small */) show
0 324 moveto (8677 #define) show
16 mp_a_x mul 324 moveto (PCI_VPDRES_TYPE_VENDOR_DEFINED) show
56 mp_a_x mul 324 moveto (0xe) show
64 mp_a_x mul 324 moveto (/* small */) show
0 312 moveto (8678 #define) show
16 mp_a_x mul 312 moveto (PCI_VPDRES_TYPE_END_TAG) show
56 mp_a_x mul 312 moveto (0xf) show
64 mp_a_x mul 312 moveto (/* small */) show
0 300 moveto (8679 ) show
0 288 moveto (8680 #define) show
16 mp_a_x mul 288 moveto (PCI_VPDRES_TYPE_IDENTIFIER_STRING) show
56 mp_a_x mul 288 moveto (0x02) show
64 mp_a_x mul 288 moveto (/* large */) show
0 276 moveto (8681 #define) show
16 mp_a_x mul 276 moveto (PCI_VPDRES_TYPE_VPD) show
56 mp_a_x mul 276 moveto (0x10) show
64 mp_a_x mul 276 moveto (/* large */) show
0 264 moveto (8682 ) show
0 252 moveto (8683 struct pci_vpd {) show
0 240 moveto (8684 ) show
8 mp_a_x mul 240 moveto (uint8_t) show
24 mp_a_x mul 240 moveto (vpd_key0;) show
0 228 moveto (8685 ) show
8 mp_a_x mul 228 moveto (uint8_t) show
24 mp_a_x mul 228 moveto (vpd_key1;) show
0 216 moveto (8686 ) show
8 mp_a_x mul 216 moveto (uint8_t) show
24 mp_a_x mul 216 moveto (vpd_len;) show
48 mp_a_x mul 216 moveto (/* length of data only */) show
0 204 moveto (8687 ) show
8 mp_a_x mul 204 moveto (/* Actual data. */) show
0 192 moveto (8688 } __attribute__\(\(__packed__\)\);) show
0 180 moveto (8689 ) show
0 168 moveto (8690 /*) show
0 156 moveto (8691  * Recommended VPD fields:) show
0 144 moveto (8692  *) show
0 132 moveto (8693  *) show
8 mp_a_x mul 132 moveto (PN) show
24 mp_a_x mul 132 moveto (Part number of assembly) show
0 120 moveto (8694  *) show
8 mp_a_x mul 120 moveto (FN) show
24 mp_a_x mul 120 moveto (FRU part number) show
0 108 moveto (8695  *) show
8 mp_a_x mul 108 moveto (EC) show
24 mp_a_x mul 108 moveto (EC level of assembly) show
0 96 moveto (8696  *) show
8 mp_a_x mul 96 moveto (MN) show
24 mp_a_x mul 96 moveto (Manufacture ID) show
0 84 moveto (8697  *) show
8 mp_a_x mul 84 moveto (SN) show
24 mp_a_x mul 84 moveto (Serial Number) show
0 72 moveto (8698  *) show
0 60 moveto (8699  * Conditionally recommended VPD fields:) show
0 24 moveto (Sheet 86) show
grestore
restore
showpage
%%Page: 96 96
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pcireg.h  Page 15) show
0 648 moveto (8700  *) show
0 636 moveto (8701  *) show
8 mp_a_x mul 636 moveto (LI) show
24 mp_a_x mul 636 moveto (Load ID) show
0 624 moveto (8702  *) show
8 mp_a_x mul 624 moveto (RL) show
24 mp_a_x mul 624 moveto (ROM Level) show
0 612 moveto (8703  *) show
8 mp_a_x mul 612 moveto (RM) show
24 mp_a_x mul 612 moveto (Alterable ROM Level) show
0 600 moveto (8704  *) show
8 mp_a_x mul 600 moveto (NA) show
24 mp_a_x mul 600 moveto (Network Address) show
0 588 moveto (8705  *) show
8 mp_a_x mul 588 moveto (DD) show
24 mp_a_x mul 588 moveto (Device Driver Level) show
0 576 moveto (8706  *) show
8 mp_a_x mul 576 moveto (DG) show
24 mp_a_x mul 576 moveto (Diagnostic Level) show
0 564 moveto (8707  *) show
8 mp_a_x mul 564 moveto (LL) show
24 mp_a_x mul 564 moveto (Loadable Microcode Level) show
0 552 moveto (8708  *) show
8 mp_a_x mul 552 moveto (VI) show
24 mp_a_x mul 552 moveto (Vendor ID/Device ID) show
0 540 moveto (8709  *) show
8 mp_a_x mul 540 moveto (FU) show
24 mp_a_x mul 540 moveto (Function Number) show
0 528 moveto (8710  *) show
8 mp_a_x mul 528 moveto (SI) show
24 mp_a_x mul 528 moveto (Subsystem Vendor ID/Subsystem ID) show
0 516 moveto (8711  *) show
0 504 moveto (8712  * Additional VPD fields:) show
0 492 moveto (8713  *) show
0 480 moveto (8714  *) show
8 mp_a_x mul 480 moveto (Z0-ZZ) show
24 mp_a_x mul 480 moveto (User/Product Specific) show
0 468 moveto (8715  */) show
0 456 moveto (8716 ) show
0 444 moveto (8717 /*) show
0 432 moveto (8718  * Threshold below which 32bit PCI DMA needs bouncing.) show
0 420 moveto (8719  */) show
0 408 moveto (8720 #define PCI32_DMA_BOUNCE_THRESHOLD) show
40 mp_a_x mul 408 moveto (0x100000000ULL) show
0 396 moveto (8721 ) show
0 384 moveto (8722 #endif /* _DEV_PCI_PCIREG_H_ */) show
0 372 moveto (8723 ) show
0 360 moveto (8724 ) show
0 348 moveto (8725 ) show
0 336 moveto (8726 ) show
0 324 moveto (8727 ) show
0 312 moveto (8728 ) show
0 300 moveto (8729 ) show
0 288 moveto (8730 ) show
0 276 moveto (8731 ) show
0 264 moveto (8732 ) show
0 252 moveto (8733 ) show
0 240 moveto (8734 ) show
0 228 moveto (8735 ) show
0 216 moveto (8736 ) show
0 204 moveto (8737 ) show
0 192 moveto (8738 ) show
0 180 moveto (8739 ) show
0 168 moveto (8740 ) show
0 156 moveto (8741 ) show
0 144 moveto (8742 ) show
0 132 moveto (8743 ) show
0 120 moveto (8744 ) show
0 108 moveto (8745 ) show
0 96 moveto (8746 ) show
0 84 moveto (8747 ) show
0 72 moveto (8748 ) show
0 60 moveto (8749 ) show
0 24 moveto (Sheet 87) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 1) show
0 648 moveto (8750 #include "types.h") show
0 636 moveto (8751 #include "x86.h") show
0 624 moveto (8752 #include "defs.h") show
0 612 moveto (8753 #include "pci.h") show
0 600 moveto (8754 #include "pcireg.h") show
0 588 moveto (8755 #include "assert.h") show
0 576 moveto (8756 #include "e100.h") show
0 564 moveto (8757 ) show
0 552 moveto (8758 // Flag to do "lspci" at bootup) show
0 540 moveto (8759 static int pci_show_devs = 1;) show
0 528 moveto (8760 static int pci_show_addrs = 1;) show
0 516 moveto (8761 ) show
0 504 moveto (8762 // PCI "configuration mechanism one") show
0 492 moveto (8763 static uint32_t pci_conf1_addr_ioport = 0x0cf8;) show
0 480 moveto (8764 static uint32_t pci_conf1_data_ioport = 0x0cfc;) show
0 468 moveto (8765 ) show
0 456 moveto (8766 // Forward declarations) show
0 444 moveto (8767 static int pci_bridge_attach\(struct pci_func *pcif\);) show
0 432 moveto (8768 static int pci_bridge_pci_attach\(struct pci_func *pcif\);) show
0 420 moveto (8769 static int pci_display_attach\(struct pci_func *pcif\);) show
0 408 moveto (8770 static int pci_net_ether_attach\(struct pci_func *pcif\);) show
0 396 moveto (8771 ) show
0 384 moveto (8772 // PCI driver table) show
0 372 moveto (8773 struct pci_driver {) show
0 360 moveto (8774     uint32_t key1, key2;) show
0 348 moveto (8775     int \(*attachfn\) \(struct pci_func *pcif\);) show
0 336 moveto (8776 };) show
0 324 moveto (8777 ) show
0 312 moveto (8778 #define PCI_SUBCLASS_ANY 0xffff) show
0 300 moveto (8779 ) show
0 288 moveto (8780 struct pci_driver pci_attach_class[] = {) show
0 276 moveto (8781     { PCI_CLASS_BRIDGE, PCI_SUBCLASS_ANY, &pci_bridge_attach },) show
0 264 moveto (8782     { PCI_CLASS_BRIDGE, PCI_SUBCLASS_BRIDGE_PCI, &pci_bridge_pci_attach },) show
0 252 moveto (8783     { PCI_CLASS_DISPLAY, PCI_SUBCLASS_ANY, &pci_display_attach },) show
0 240 moveto (8784     { PCI_CLASS_NETWORK, PCI_SUBCLASS_NETWORK_ETHERNET,) show
0 228 moveto (8785         &pci_net_ether_attach },) show
0 216 moveto (8786     { 0, 0, 0 },) show
0 204 moveto (8787 };) show
0 192 moveto (8788 ) show
0 180 moveto (8789 struct pci_driver pci_attach_vendor[] = {) show
0 168 moveto (8790     { PCI_VENDOR_INTEL, PCI_PRODUCT_E100, &ether_e100_attach },) show
0 156 moveto (8791     { 0, 0, 0 },) show
0 144 moveto (8792 };) show
0 132 moveto (8793 ) show
0 120 moveto (8794 ) show
0 108 moveto (8795 ) show
0 96 moveto (8796 ) show
0 84 moveto (8797 ) show
0 72 moveto (8798 ) show
0 60 moveto (8799 ) show
0 24 moveto (Sheet 87) show
grestore
restore
showpage
%%Page: 97 97
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 2) show
0 648 moveto (8800 static void) show
0 636 moveto (8801 pci_conf1_set_addr\(uint32_t bus,) show
0 624 moveto (8802 ) show
19 mp_a_x mul 624 moveto (uint32_t dev,) show
0 612 moveto (8803 ) show
19 mp_a_x mul 612 moveto (uint32_t func,) show
0 600 moveto (8804 ) show
19 mp_a_x mul 600 moveto (uint32_t offset\)) show
0 588 moveto (8805 {) show
0 576 moveto (8806     assert\(bus < 256\);) show
0 564 moveto (8807     assert\(dev < 32\);) show
0 552 moveto (8808     assert\(func < 8\);) show
0 540 moveto (8809     assert\(offset < 256\);) show
0 528 moveto (8810     assert\(\(offset & 0x3\) == 0\);) show
0 516 moveto (8811 ) show
0 504 moveto (8812     uint32_t v = \(1 << 31\) |) show
48 mp_a_x mul 504 moveto (// config-space) show
0 492 moveto (8813 ) show
17 mp_a_x mul 492 moveto (\(bus << 16\) | \(dev << 11\) | \(func << 8\) | \(offset\);) show
0 480 moveto (8814     outl\(pci_conf1_addr_ioport, v\);) show
0 468 moveto (8815 }) show
0 456 moveto (8816 ) show
0 444 moveto (8817 static uint32_t) show
0 432 moveto (8818 pci_conf_read\(struct pci_func *f, uint32_t off\)) show
0 420 moveto (8819 {) show
0 408 moveto (8820     pci_conf1_set_addr\(f->bus->busno, f->dev, f->func, off\);) show
0 396 moveto (8821     return inl\(pci_conf1_data_ioport\);) show
0 384 moveto (8822 }) show
0 372 moveto (8823 ) show
0 360 moveto (8824 static void) show
0 348 moveto (8825 pci_conf_write\(struct pci_func *f, uint32_t off, uint32_t v\)) show
0 336 moveto (8826 {) show
0 324 moveto (8827     pci_conf1_set_addr\(f->bus->busno, f->dev, f->func, off\);) show
0 312 moveto (8828     outl\(pci_conf1_data_ioport, v\);) show
0 300 moveto (8829 }) show
0 288 moveto (8830 ) show
0 276 moveto (8831 static int __attribute__\(\(warn_unused_result\)\)) show
0 264 moveto (8832 pci_attach_match\(uint32_t key1, uint32_t key2,) show
0 252 moveto (8833 ) show
17 mp_a_x mul 252 moveto (struct pci_driver *list, struct pci_func *pcif\)) show
0 240 moveto (8834 {) show
0 228 moveto (8835     uint32_t i;) show
0 216 moveto (8836 ) show
0 204 moveto (8837     for \(i = 0; list[i].attachfn; i++\) {) show
0 192 moveto (8838 ) show
8 mp_a_x mul 192 moveto (if \(list[i].key1 == key1 \)) show
0 180 moveto (8839         if \(\(list[i].key2 == key2\) || \(list[i].key2 == 0xffff\)\) {) show
0 168 moveto (8840 ) show
16 mp_a_x mul 168 moveto (int r = list[i].attachfn\(pcif\);) show
0 156 moveto (8841 ) show
16 mp_a_x mul 156 moveto (if \(r > 0\)) show
0 144 moveto (8842 ) show
24 mp_a_x mul 144 moveto (return r;) show
0 132 moveto (8843 ) show
16 mp_a_x mul 132 moveto (if \(r < 0\)) show
0 120 moveto (8844 ) show
16 mp_a_x mul 120 moveto (///cprintf\("pci_attach_match: attaching %x.%x \(%p\): %s\\n",) show
0 108 moveto (8845 ) show
16 mp_a_x mul 108 moveto (//) show
24 mp_a_x mul 108 moveto (key1, key2, list[i].attachfn, e2s\(r\)\);) show
0 96 moveto (8846 ) show
24 mp_a_x mul 96 moveto (cprintf\("pci_attach_match: attaching %x.%x \(%p\): SOME ERROR\\n",) show
0 84 moveto (8847 ) show
32 mp_a_x mul 84 moveto (key1, key2, list[i].attachfn\);) show
0 72 moveto (8848 ) show
12 mp_a_x mul 72 moveto (}) show
0 60 moveto (8849     }) show
0 24 moveto (Sheet 88) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 3) show
0 648 moveto (8850     return 0;) show
0 636 moveto (8851 }) show
0 624 moveto (8852 ) show
0 612 moveto (8853 static int) show
0 600 moveto (8854 pci_attach\(struct pci_func *f\)) show
0 588 moveto (8855 {) show
0 576 moveto (8856     return) show
0 564 moveto (8857 ) show
8 mp_a_x mul 564 moveto (pci_attach_match\(PCI_CLASS\(f->dev_class\), PCI_SUBCLASS\(f->dev_class\),) show
0 552 moveto (8858 ) show
25 mp_a_x mul 552 moveto (&pci_attach_class[0], f\) ||) show
0 540 moveto (8859 ) show
8 mp_a_x mul 540 moveto (pci_attach_match\(PCI_VENDOR\(f->dev_id\), PCI_PRODUCT\(f->dev_id\),) show
0 528 moveto (8860 ) show
25 mp_a_x mul 528 moveto (&pci_attach_vendor[0], f\);) show
0 516 moveto (8861 }) show
0 504 moveto (8862 ) show
0 492 moveto (8863 static int) show
0 480 moveto (8864 pci_scan_bus\(struct pci_bus *bus\)) show
0 468 moveto (8865 {) show
0 456 moveto (8866     int totaldev = 0;) show
0 444 moveto (8867     struct pci_func df;) show
0 432 moveto (8868     memset\(&df, 0, sizeof\(df\)\);) show
0 420 moveto (8869     df.bus = bus;) show
0 408 moveto (8870 ) show
0 396 moveto (8871     for \(df.dev = 0; df.dev < 32; df.dev++\) {) show
0 384 moveto (8872 ) show
8 mp_a_x mul 384 moveto (uint32_t bhlc = pci_conf_read\(&df, PCI_BHLC_REG\);) show
0 372 moveto (8873 ) show
8 mp_a_x mul 372 moveto (if \(PCI_HDRTYPE_TYPE\(bhlc\) > 1\)) show
44 mp_a_x mul 372 moveto (// Unsupported or no device) show
0 360 moveto (8874 ) show
12 mp_a_x mul 360 moveto (continue;) show
0 348 moveto (8875 ) show
0 336 moveto (8876 ) show
8 mp_a_x mul 336 moveto (totaldev++;) show
0 324 moveto (8877 ) show
0 312 moveto (8878 ) show
8 mp_a_x mul 312 moveto (struct pci_func f = df;) show
0 300 moveto (8879 ) show
8 mp_a_x mul 300 moveto (for \(f.func = 0; f.func < \(PCI_HDRTYPE_MULTIFN\(bhlc\) ? 8 : 1\);) show
0 288 moveto (8880 ) show
25 mp_a_x mul 288 moveto (f.func++\) {) show
0 276 moveto (8881 ) show
12 mp_a_x mul 276 moveto (struct pci_func af = f;) show
0 264 moveto (8882 ) show
0 252 moveto (8883 ) show
12 mp_a_x mul 252 moveto (af.dev_id = pci_conf_read\(&f, PCI_ID_REG\);) show
0 240 moveto (8884 ) show
12 mp_a_x mul 240 moveto (if \(PCI_VENDOR\(af.dev_id\) == 0xffff\)) show
0 228 moveto (8885 ) show
16 mp_a_x mul 228 moveto (continue;) show
0 216 moveto (8886 ) show
0 204 moveto (8887 ) show
12 mp_a_x mul 204 moveto (uint32_t intr = pci_conf_read\(&af, PCI_INTERRUPT_REG\);) show
0 192 moveto (8888 ) show
12 mp_a_x mul 192 moveto (af.irq_line = PCI_INTERRUPT_LINE\(intr\);) show
0 180 moveto (8889 ) show
0 168 moveto (8890 ) show
12 mp_a_x mul 168 moveto (af.dev_class = pci_conf_read\(&af, PCI_CLASS_REG\);) show
0 156 moveto (8891 ) show
12 mp_a_x mul 156 moveto (if \(pci_show_devs\)) show
0 144 moveto (8892 ) show
16 mp_a_x mul 144 moveto (cprintf\("PCI: %02x:%02x.%d: %04x:%04x: class %x.%x irq %d\\n",) show
0 132 moveto (8893 ) show
24 mp_a_x mul 132 moveto (af.bus->busno, af.dev, af.func,) show
0 120 moveto (8894 ) show
24 mp_a_x mul 120 moveto (PCI_VENDOR\(af.dev_id\), PCI_PRODUCT\(af.dev_id\),) show
0 108 moveto (8895 ) show
24 mp_a_x mul 108 moveto (PCI_CLASS\(af.dev_class\), PCI_SUBCLASS\(af.dev_class\),) show
0 96 moveto (8896 ) show
24 mp_a_x mul 96 moveto (af.irq_line\);) show
0 84 moveto (8897 ) show
0 72 moveto (8898 ) show
0 60 moveto (8899 ) show
0 24 moveto (Sheet 88) show
grestore
restore
showpage
%%Page: 98 98
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 4) show
0 648 moveto (8900 ) show
12 mp_a_x mul 648 moveto (pci_attach\(&af\);) show
0 636 moveto (8901 ) show
8 mp_a_x mul 636 moveto (}) show
0 624 moveto (8902     }) show
0 612 moveto (8903 ) show
0 600 moveto (8904     return totaldev;) show
0 588 moveto (8905 }) show
0 576 moveto (8906 ) show
0 564 moveto (8907 static int) show
0 552 moveto (8908 pci_net_ether_attach\(struct pci_func *pcif\)) show
0 540 moveto (8909 {) show
0 528 moveto (8910     cprintf\("PCI: %02x:%02x.%d: Network \(ethernet\) %04x:%04x\\n",) show
0 516 moveto (8911 ) show
16 mp_a_x mul 516 moveto (pcif->bus->busno, pcif->dev, pcif->func,) show
0 504 moveto (8912         PCI_VENDOR\(pcif->dev_id\), PCI_PRODUCT\(pcif->dev_id\)\);) show
0 492 moveto (8913     return 0;) show
0 480 moveto (8914 }) show
0 468 moveto (8915 ) show
0 456 moveto (8916 static int) show
0 444 moveto (8917 pci_bridge_attach\(struct pci_func *pcif\)) show
0 432 moveto (8918 {) show
0 420 moveto (8919     cprintf\("PCI: %02x:%02x.%d: Bridge %04x:%04x\\n",) show
0 408 moveto (8920 ) show
16 mp_a_x mul 408 moveto (pcif->bus->busno, pcif->dev, pcif->func,) show
0 396 moveto (8921         PCI_VENDOR\(pcif->dev_id\), PCI_PRODUCT\(pcif->dev_id\)\);) show
0 384 moveto (8922     return 0;) show
0 372 moveto (8923 }) show
0 360 moveto (8924 ) show
0 348 moveto (8925 static int) show
0 336 moveto (8926 pci_bridge_pci_attach\(struct pci_func *pcif\)) show
0 324 moveto (8927 {) show
0 312 moveto (8928     uint32_t ioreg  = pci_conf_read\(pcif, PCI_BRIDGE_STATIO_REG\);) show
0 300 moveto (8929     uint32_t busreg = pci_conf_read\(pcif, PCI_BRIDGE_BUS_REG\);) show
0 288 moveto (8930 ) show
0 276 moveto (8931     if \(PCI_BRIDGE_IO_32BITS\(ioreg\)\) {) show
0 264 moveto (8932 ) show
8 mp_a_x mul 264 moveto (cprintf\("PCI: %02x:%02x.%d: 32-bit bridge IO not supported.\\n",) show
0 252 moveto (8933 ) show
16 mp_a_x mul 252 moveto (pcif->bus->busno, pcif->dev, pcif->func\);) show
0 240 moveto (8934 ) show
8 mp_a_x mul 240 moveto (return 0;) show
0 228 moveto (8935     }) show
0 216 moveto (8936 ) show
0 204 moveto (8937     struct pci_bus nbus;) show
0 192 moveto (8938     memset\(&nbus, 0, sizeof\(nbus\)\);) show
0 180 moveto (8939     nbus.parent_bridge = pcif;) show
0 168 moveto (8940     nbus.busno = \(busreg >> PCI_BRIDGE_BUS_SECONDARY_SHIFT\) & 0xff;) show
0 156 moveto (8941 ) show
0 144 moveto (8942     if \(pci_show_devs\)) show
0 132 moveto (8943 ) show
8 mp_a_x mul 132 moveto (cprintf\("PCI: %02x:%02x.%d: bridge to PCI bus %d--%d\\n",) show
0 120 moveto (8944 ) show
16 mp_a_x mul 120 moveto (pcif->bus->busno, pcif->dev, pcif->func,) show
0 108 moveto (8945 ) show
16 mp_a_x mul 108 moveto (nbus.busno,) show
0 96 moveto (8946 ) show
16 mp_a_x mul 96 moveto (\(busreg >> PCI_BRIDGE_BUS_SUBORDINATE_SHIFT\) & 0xff\);) show
0 84 moveto (8947 ) show
0 72 moveto (8948 ) show
0 60 moveto (8949 ) show
0 24 moveto (Sheet 89) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 5) show
0 648 moveto (8950     pci_scan_bus\(&nbus\);) show
0 636 moveto (8951     return 1;) show
0 624 moveto (8952 }) show
0 612 moveto (8953 ) show
0 600 moveto (8954 static int) show
0 588 moveto (8955 pci_display_attach\(struct pci_func *pcif\)) show
0 576 moveto (8956 {) show
0 564 moveto (8957     cprintf\("PCI: %02x:%02x.%d: Display %04x:%04x\\n",) show
0 552 moveto (8958 ) show
16 mp_a_x mul 552 moveto (pcif->bus->busno, pcif->dev, pcif->func,) show
0 540 moveto (8959         PCI_VENDOR\(pcif->dev_id\), PCI_PRODUCT\(pcif->dev_id\)\);) show
0 528 moveto (8960     return 0;) show
0 516 moveto (8961 }) show
0 504 moveto (8962 ) show
0 492 moveto (8963 // External PCI subsystem interface) show
0 480 moveto (8964 ) show
0 468 moveto (8965 void) show
0 456 moveto (8966 pci_func_enable\(struct pci_func *f\)) show
0 444 moveto (8967 {) show
0 432 moveto (8968     pci_conf_write\(f, PCI_COMMAND_STATUS_REG,) show
0 420 moveto (8969 ) show
19 mp_a_x mul 420 moveto (PCI_COMMAND_IO_ENABLE |) show
0 408 moveto (8970 ) show
19 mp_a_x mul 408 moveto (PCI_COMMAND_MEM_ENABLE |) show
0 396 moveto (8971 ) show
19 mp_a_x mul 396 moveto (PCI_COMMAND_MASTER_ENABLE\);) show
0 384 moveto (8972 ) show
0 372 moveto (8973     uint32_t bar_width;) show
0 360 moveto (8974     uint32_t bar;) show
0 348 moveto (8975     for \(bar = PCI_MAPREG_START; bar < PCI_MAPREG_END;) show
0 336 moveto (8976 ) show
9 mp_a_x mul 336 moveto (bar += bar_width\)) show
0 324 moveto (8977     {) show
0 312 moveto (8978 ) show
8 mp_a_x mul 312 moveto (uint32_t oldv = pci_conf_read\(f, bar\);) show
0 300 moveto (8979 ) show
0 288 moveto (8980 ) show
8 mp_a_x mul 288 moveto (bar_width = 4;) show
0 276 moveto (8981 ) show
8 mp_a_x mul 276 moveto (pci_conf_write\(f, bar, 0xffffffff\);) show
0 264 moveto (8982 ) show
8 mp_a_x mul 264 moveto (uint32_t rv = pci_conf_read\(f, bar\);) show
0 252 moveto (8983 ) show
0 240 moveto (8984 ) show
8 mp_a_x mul 240 moveto (if \(rv == 0\)) show
0 228 moveto (8985 ) show
12 mp_a_x mul 228 moveto (continue;) show
0 216 moveto (8986 ) show
0 204 moveto (8987 ) show
8 mp_a_x mul 204 moveto (int regnum = PCI_MAPREG_NUM\(bar\);) show
0 192 moveto (8988 ) show
8 mp_a_x mul 192 moveto (uint32_t base, size;) show
0 180 moveto (8989 ) show
8 mp_a_x mul 180 moveto (if \(PCI_MAPREG_TYPE\(rv\) == PCI_MAPREG_TYPE_MEM\) {) show
0 168 moveto (8990 ) show
12 mp_a_x mul 168 moveto (if \(PCI_MAPREG_MEM_TYPE\(rv\) == PCI_MAPREG_MEM_TYPE_64BIT\)) show
0 156 moveto (8991 ) show
16 mp_a_x mul 156 moveto (bar_width = 8;) show
0 144 moveto (8992 ) show
0 132 moveto (8993 ) show
12 mp_a_x mul 132 moveto (size = PCI_MAPREG_MEM_SIZE\(rv\);) show
0 120 moveto (8994 ) show
12 mp_a_x mul 120 moveto (base = PCI_MAPREG_MEM_ADDR\(oldv\);) show
0 108 moveto (8995 ) show
12 mp_a_x mul 108 moveto (if \(pci_show_addrs\)) show
0 96 moveto (8996 ) show
16 mp_a_x mul 96 moveto (cprintf\("  mem region %d: %d bytes at 0x%x\\n",) show
0 84 moveto (8997 ) show
24 mp_a_x mul 84 moveto (regnum, size, base\);) show
0 72 moveto (8998 ) show
8 mp_a_x mul 72 moveto (} else {) show
0 60 moveto (8999 ) show
12 mp_a_x mul 60 moveto (size = PCI_MAPREG_IO_SIZE\(rv\);) show
0 24 moveto (Sheet 89) show
grestore
restore
showpage
%%Page: 99 99
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 6) show
0 648 moveto (9000 ) show
12 mp_a_x mul 648 moveto (base = PCI_MAPREG_IO_ADDR\(oldv\);) show
0 636 moveto (9001 ) show
12 mp_a_x mul 636 moveto (if \(pci_show_addrs\)) show
0 624 moveto (9002 ) show
16 mp_a_x mul 624 moveto (cprintf\("  io region %d: %d bytes at 0x%x\\n",) show
0 612 moveto (9003 ) show
24 mp_a_x mul 612 moveto (regnum, size, base\);) show
0 600 moveto (9004 ) show
8 mp_a_x mul 600 moveto (}) show
0 588 moveto (9005 ) show
0 576 moveto (9006 ) show
8 mp_a_x mul 576 moveto (pci_conf_write\(f, bar, oldv\);) show
0 564 moveto (9007 ) show
8 mp_a_x mul 564 moveto (f->reg_base[regnum] = base;) show
0 552 moveto (9008 ) show
8 mp_a_x mul 552 moveto (f->reg_size[regnum] = size;) show
0 540 moveto (9009 ) show
0 528 moveto (9010 ) show
8 mp_a_x mul 528 moveto (cprintf\("  -> reg_base[%d] = %08x\\n", regnum, base\);) show
0 516 moveto (9011 ) show
8 mp_a_x mul 516 moveto (cprintf\("  -> reg_size[%d] = %08x\\n", regnum, size\);) show
0 504 moveto (9012 ) show
0 492 moveto (9013 ) show
8 mp_a_x mul 492 moveto (if \(size && !base\)) show
0 480 moveto (9014 ) show
12 mp_a_x mul 480 moveto (cprintf\("PCI device %02x:%02x.%d \(%04x:%04x\) may be misconfigured: ") show
0 468 moveto (9015 ) show
20 mp_a_x mul 468 moveto ("region %d: base 0x%x, size %d\\n",) show
0 456 moveto (9016 ) show
20 mp_a_x mul 456 moveto (f->bus->busno, f->dev, f->func,) show
0 444 moveto (9017 ) show
20 mp_a_x mul 444 moveto (PCI_VENDOR\(f->dev_id\), PCI_PRODUCT\(f->dev_id\),) show
0 432 moveto (9018 ) show
20 mp_a_x mul 432 moveto (regnum, base, size\);) show
0 420 moveto (9019     }) show
0 408 moveto (9020 }) show
0 396 moveto (9021 ) show
0 384 moveto (9022 int ether_receive\(void *buffer, int len\)) show
0 372 moveto (9023 {) show
0 360 moveto (9024     if \(len == 0\)) show
0 348 moveto (9025         return 0;) show
0 336 moveto (9026     int ret;) show
0 324 moveto (9027     ret = e100_receive\(buffer, len\);) show
0 312 moveto (9028     if \(ret > 0\)) show
0 300 moveto (9029         return ret;) show
0 288 moveto (9030     return -2;) show
0 276 moveto (9031 }) show
0 264 moveto (9032 ) show
0 252 moveto (9033 int ether_send\(void *buffer, int len\)) show
0 240 moveto (9034 {) show
0 228 moveto (9035     if \(len == 0\)) show
0 216 moveto (9036         return 0;) show
0 204 moveto (9037     int ret;) show
0 192 moveto (9038     ret = e100_send\(buffer, len\);) show
0 180 moveto (9039     if \(ret > 0\)) show
0 168 moveto (9040         return ret;) show
0 156 moveto (9041     return -2;) show
0 144 moveto (9042 }) show
0 132 moveto (9043 ) show
0 120 moveto (9044 ) show
0 108 moveto (9045 ) show
0 96 moveto (9046 ) show
0 84 moveto (9047 ) show
0 72 moveto (9048 ) show
0 60 moveto (9049 ) show
0 24 moveto (Sheet 90) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/pci.c  Page 7) show
0 648 moveto (9050 int) show
0 636 moveto (9051 pci_init\(void\)) show
0 624 moveto (9052 {) show
0 612 moveto (9053     static struct pci_bus root_bus;) show
0 600 moveto (9054     memset\(&root_bus, 0, sizeof\(root_bus\)\);) show
0 588 moveto (9055 ) show
0 576 moveto (9056     return pci_scan_bus\(&root_bus\);) show
0 564 moveto (9057 }) show
0 552 moveto (9058 ) show
0 540 moveto (9059 ) show
0 528 moveto (9060 ) show
0 516 moveto (9061 ) show
0 504 moveto (9062 ) show
0 492 moveto (9063 ) show
0 480 moveto (9064 ) show
0 468 moveto (9065 ) show
0 456 moveto (9066 ) show
0 444 moveto (9067 ) show
0 432 moveto (9068 ) show
0 420 moveto (9069 ) show
0 408 moveto (9070 ) show
0 396 moveto (9071 ) show
0 384 moveto (9072 ) show
0 372 moveto (9073 ) show
0 360 moveto (9074 ) show
0 348 moveto (9075 ) show
0 336 moveto (9076 ) show
0 324 moveto (9077 ) show
0 312 moveto (9078 ) show
0 300 moveto (9079 ) show
0 288 moveto (9080 ) show
0 276 moveto (9081 ) show
0 264 moveto (9082 ) show
0 252 moveto (9083 ) show
0 240 moveto (9084 ) show
0 228 moveto (9085 ) show
0 216 moveto (9086 ) show
0 204 moveto (9087 ) show
0 192 moveto (9088 ) show
0 180 moveto (9089 ) show
0 168 moveto (9090 ) show
0 156 moveto (9091 ) show
0 144 moveto (9092 ) show
0 132 moveto (9093 ) show
0 120 moveto (9094 ) show
0 108 moveto (9095 ) show
0 96 moveto (9096 ) show
0 84 moveto (9097 ) show
0 72 moveto (9098 ) show
0 60 moveto (9099 ) show
0 24 moveto (Sheet 90) show
grestore
restore
showpage
%%Page: 100 100
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.h  Page 1) show
0 648 moveto (9100 #ifndef XV6_E100_H_) show
0 636 moveto (9101 #define XV6_E100_H_) show
0 624 moveto (9102 #include "pci.h") show
0 612 moveto (9103 ) show
0 600 moveto (9104 int ether_e100_attach\(struct pci_func *pcif\);) show
0 588 moveto (9105 int e100_send\(void *buffer, uint32_t len\);) show
0 576 moveto (9106 int e100_receive\(void *buffer, uint32_t len\);) show
0 564 moveto (9107 ) show
0 552 moveto (9108 #define PCI_VENDOR_INTEL    0x8086) show
0 540 moveto (9109 #define PCI_PRODUCT_E100    0x1209) show
0 528 moveto (9110 ) show
0 516 moveto (9111 #define E100_MAX_DEVS       10) show
0 504 moveto (9112 ) show
0 492 moveto (9113 #define E100_IOPORT_SIZE    64) show
0 480 moveto (9114 #define E100_CU_RING_SIZE   32) show
0 468 moveto (9115 #define E100_RU_RING_SIZE   32) show
0 456 moveto (9116 #define E100_CB_SIZE       2048) show
0 444 moveto (9117 #define E100_RFD_SIZE      2048) show
0 432 moveto (9118 ) show
0 420 moveto (9119 // Control / Status Register) show
0 408 moveto (9120 #define SCB_STATUS          0x0 // Status) show
0 396 moveto (9121 #define SCB_COMMAND         0x2 // Command) show
0 384 moveto (9122 #define SCB_GENPTR          0x4 // General Pointer) show
0 372 moveto (9123 #define SCB_PORT            0x8 // PORT) show
0 360 moveto (9124 #define SCB_EEPROM_CTL      0xE // EEPROM Control) show
0 348 moveto (9125 #define SCB_MDI_CTL         0x10    // MDI Control) show
0 336 moveto (9126 #define SCB_RX_COUNT        0x14    // RX DMA Byte Count) show
0 324 moveto (9127 #define SCB_FLOW_CTL        0x19    // Flow Control) show
0 312 moveto (9128 #define SCB_PMDR            0x21    // PMDR) show
0 300 moveto (9129 #define SCB_GEN_CTL         0x1C    // General Control) show
0 288 moveto (9130 #define SCB_GEN_STATUS      0x1D    // General Status) show
0 276 moveto (9131 #define SCB_FUNC_EVT        0x30    // Function Event) show
0 264 moveto (9132 #define SCB_FUN_MASK        0x34    // Function Event Mask) show
0 252 moveto (9133 #define SCB_FUNC_STATE      0x38    // Function Present State) show
0 240 moveto (9134 #define SCB_FORCE_EVT       0x3C    // Force Event) show
0 228 moveto (9135 ) show
0 216 moveto (9136 // CU Command) show
0 204 moveto (9137 #define CUC_NOP             0x0) show
0 192 moveto (9138 #define CUC_START           0x1) show
0 180 moveto (9139 #define CUC_RESUME          0x2) show
0 168 moveto (9140 #define CUC_LOAD_DC_ADDR    0x4) show
0 156 moveto (9141 #define CUC_DUMP            0x5) show
0 144 moveto (9142 #define CUC_LOAD_BASE       0x6) show
0 132 moveto (9143 #define CUC_DUMP_RESET      0x7) show
0 120 moveto (9144 #define CUC_STAT_RESUME     0xA) show
0 108 moveto (9145 ) show
0 96 moveto (9146 ) show
0 84 moveto (9147 ) show
0 72 moveto (9148 ) show
0 60 moveto (9149 ) show
0 24 moveto (Sheet 91) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.h  Page 2) show
0 648 moveto (9150 // RU Command) show
0 636 moveto (9151 #define RUC_NOP             0x0) show
0 624 moveto (9152 #define RUC_START           0x1) show
0 612 moveto (9153 #define RUC_RESUME          0x2) show
0 600 moveto (9154 #define RUC_RCV_DMA         0x3) show
0 588 moveto (9155 #define RUC_ABORT           0x4) show
0 576 moveto (9156 #define RUC_LOAD_HDS        0x5) show
0 564 moveto (9157 #define RUC_LOAD_BASE       0x6) show
0 552 moveto (9158 ) show
0 540 moveto (9159 // PORT Function) show
0 528 moveto (9160 #define PORT_SOFT_RESET     0) show
0 516 moveto (9161 #define PORT_SELF_TEST      1) show
0 504 moveto (9162 #define PORT_SElECT_TEST    2) show
0 492 moveto (9163 #define PORT_DUMP           3) show
0 480 moveto (9164 #define PORT_DUMP_WAKE      7) show
0 468 moveto (9165 ) show
0 456 moveto (9166 // Operation Codes) show
0 444 moveto (9167 #define OP_NOP              0) show
0 432 moveto (9168 #define OP_ADDR_SETUP       1) show
0 420 moveto (9169 #define OP_CONFIG           2) show
0 408 moveto (9170 #define OP_MUL_ADDR_SETUP   3) show
0 396 moveto (9171 #define OP_TRANSMIT         4) show
0 384 moveto (9172 #define OP_LOAD_MC          5) show
0 372 moveto (9173 #define OP_DUMP             6) show
0 360 moveto (9174 #define OP_DIAG             7) show
0 348 moveto (9175 ) show
0 336 moveto (9176 // CU Status) show
0 324 moveto (9177 #define CUS_IDLE            0) show
0 312 moveto (9178 #define CUS_SUSPENDED       1) show
0 300 moveto (9179 #define CUS_LPQ             2) show
0 288 moveto (9180 #define CUS_HQP             3) show
0 276 moveto (9181 ) show
0 264 moveto (9182 struct scb_status_word {) show
0 252 moveto (9183     char zero : 2;) show
0 240 moveto (9184     char rus  : 4;) show
0 228 moveto (9185     char cus  : 2;) show
0 216 moveto (9186     // STAT / ACK) show
0 204 moveto (9187     char fcp  : 1;) show
0 192 moveto (9188     char rsv  : 1;) show
0 180 moveto (9189     char swi  : 1;) show
0 168 moveto (9190     char mdi  : 1;) show
0 156 moveto (9191     char rnr  : 1;) show
0 144 moveto (9192     char cna  : 1;) show
0 132 moveto (9193     char fr   : 1;) show
0 120 moveto (9194     char cx   : 1;) show
0 108 moveto (9195 };) show
0 96 moveto (9196 ) show
0 84 moveto (9197 ) show
0 72 moveto (9198 ) show
0 60 moveto (9199 ) show
0 24 moveto (Sheet 91) show
grestore
restore
showpage
%%Page: 101 101
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.h  Page 3) show
0 648 moveto (9200 typedef union scb_status_word_tag {) show
0 636 moveto (9201     uint16_t word;) show
0 624 moveto (9202     struct scb_status_word status;) show
0 612 moveto (9203 } scb_status_word;) show
0 600 moveto (9204 ) show
0 588 moveto (9205 struct scb_command_word {) show
0 576 moveto (9206     char ru_command : 3;) show
0 564 moveto (9207     char res : 1;) show
0 552 moveto (9208     char cu_command : 4;) show
0 540 moveto (9209     // Interrupt Masks) show
0 528 moveto (9210     char m : 1;) show
0 516 moveto (9211     char si : 1;) show
0 504 moveto (9212     char fcp_mask : 1;) show
0 492 moveto (9213     char er_mask : 1;) show
0 480 moveto (9214     char rnr_mask : 1;) show
0 468 moveto (9215     char cna_mask : 1;) show
0 456 moveto (9216     char fr_mask : 1;) show
0 444 moveto (9217     char cx_mask : 1;) show
0 432 moveto (9218 };) show
0 420 moveto (9219 ) show
0 408 moveto (9220 typedef union scb_command_word_tag {) show
0 396 moveto (9221     uint16_t word;) show
0 384 moveto (9222     struct scb_command_word cmd;) show
0 372 moveto (9223 } scb_command_word;) show
0 360 moveto (9224 ) show
0 348 moveto (9225 typedef struct command_block_tag {) show
0 336 moveto (9226     volatile union {) show
0 324 moveto (9227         uint16_t status_word;) show
0 312 moveto (9228         struct {) show
0 300 moveto (9229             short stat :    13;) show
0 288 moveto (9230             char ok :       1;    // No Error) show
0 276 moveto (9231             char x :        1;) show
0 264 moveto (9232             char c :        1;     // Completed) show
0 252 moveto (9233         };) show
0 240 moveto (9234     };) show
0 228 moveto (9235     union {) show
0 216 moveto (9236         uint16_t cmd_word;) show
0 204 moveto (9237         struct {) show
0 192 moveto (9238             char cmd :  3;) show
0 180 moveto (9239             short res : 10;) show
0 168 moveto (9240             char i :    1;     // Interrupt after finish) show
0 156 moveto (9241             char s :    1;     // Suspend after complete) show
0 144 moveto (9242             char el :   1;    // Last one) show
0 132 moveto (9243         };) show
0 120 moveto (9244     };) show
0 108 moveto (9245     struct command_block_tag * link;) show
0 96 moveto (9246 } command_block;) show
0 84 moveto (9247 ) show
0 72 moveto (9248 ) show
0 60 moveto (9249 ) show
0 24 moveto (Sheet 92) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.h  Page 4) show
0 648 moveto (9250 typedef struct op_transmit_cmd_cmd_tag {) show
0 636 moveto (9251     union {) show
0 624 moveto (9252         uint16_t word;) show
0 612 moveto (9253         struct {) show
0 600 moveto (9254             char cmd    : 3;) show
0 588 moveto (9255             char sf     : 1;) show
0 576 moveto (9256             char nc     : 1;) show
0 564 moveto (9257             char res    : 3;) show
0 552 moveto (9258             char cid    : 5;) show
0 540 moveto (9259             char i      : 1;) show
0 528 moveto (9260             char s      : 1;) show
0 516 moveto (9261             char el     : 1;) show
0 504 moveto (9262         };) show
0 492 moveto (9263     };) show
0 480 moveto (9264 } op_transmit_cmd_cmd;) show
0 468 moveto (9265 ) show
0 456 moveto (9266 typedef struct op_transmit_cmd {) show
0 444 moveto (9267     command_block base_cmd;) show
0 432 moveto (9268     uint32_t tbd_addr;) show
0 420 moveto (9269     struct {) show
0 408 moveto (9270         int byte_count :14;) show
0 396 moveto (9271         char res :      1;) show
0 384 moveto (9272         char eof :      1;) show
0 372 moveto (9273         uint8_t trans_thres;) show
0 360 moveto (9274         uint8_t tbd_num;) show
0 348 moveto (9275     };) show
0 336 moveto (9276 } op_transmit_cmd;) show
0 324 moveto (9277 ) show
0 312 moveto (9278 typedef struct rf_desc {) show
0 300 moveto (9279     volatile command_block head;) show
0 288 moveto (9280     uint32_t res;) show
0 276 moveto (9281     volatile struct {) show
0 264 moveto (9282         uint16_t count :    14;) show
0 252 moveto (9283         char f :            1;) show
0 240 moveto (9284         char eof :          1;) show
0 228 moveto (9285         uint16_t size :     14;) show
0 216 moveto (9286         char res2 :         2;) show
0 204 moveto (9287     };) show
0 192 moveto (9288 } rf_desc;) show
0 180 moveto (9289 ) show
0 168 moveto (9290 typedef struct rf_status {) show
0 156 moveto (9291     char tco :      1;) show
0 144 moveto (9292     char ia :       1;) show
0 132 moveto (9293     char nomatch :  1;) show
0 120 moveto (9294     char res :      1;) show
0 108 moveto (9295     char rcv_err :  1;) show
0 96 moveto (9296     char type :     1;) show
0 84 moveto (9297     char res2 :     1;) show
0 72 moveto (9298     char tooshort : 1;) show
0 60 moveto (9299     char dma_err :  1;) show
0 24 moveto (Sheet 92) show
grestore
restore
showpage
%%Page: 102 102
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.h  Page 5) show
0 648 moveto (9300     char no_buf :   1;) show
0 636 moveto (9301     char align_err :1;) show
0 624 moveto (9302     char crc_err :  1;) show
0 612 moveto (9303     char res3 :     1;) show
0 600 moveto (9304 } rf_status;) show
0 588 moveto (9305 ) show
0 576 moveto (9306 #define TBD_DATA_LIMIT  1600) show
0 564 moveto (9307 ) show
0 552 moveto (9308 ) show
0 540 moveto (9309 #endif) show
16 mp_a_x mul 540 moveto (// XV6_E100_H_) show
0 528 moveto (9310 ) show
0 516 moveto (9311 ) show
0 504 moveto (9312 ) show
0 492 moveto (9313 ) show
0 480 moveto (9314 ) show
0 468 moveto (9315 ) show
0 456 moveto (9316 ) show
0 444 moveto (9317 ) show
0 432 moveto (9318 ) show
0 420 moveto (9319 ) show
0 408 moveto (9320 ) show
0 396 moveto (9321 ) show
0 384 moveto (9322 ) show
0 372 moveto (9323 ) show
0 360 moveto (9324 ) show
0 348 moveto (9325 ) show
0 336 moveto (9326 ) show
0 324 moveto (9327 ) show
0 312 moveto (9328 ) show
0 300 moveto (9329 ) show
0 288 moveto (9330 ) show
0 276 moveto (9331 ) show
0 264 moveto (9332 ) show
0 252 moveto (9333 ) show
0 240 moveto (9334 ) show
0 228 moveto (9335 ) show
0 216 moveto (9336 ) show
0 204 moveto (9337 ) show
0 192 moveto (9338 ) show
0 180 moveto (9339 ) show
0 168 moveto (9340 ) show
0 156 moveto (9341 ) show
0 144 moveto (9342 ) show
0 132 moveto (9343 ) show
0 120 moveto (9344 ) show
0 108 moveto (9345 ) show
0 96 moveto (9346 ) show
0 84 moveto (9347 ) show
0 72 moveto (9348 ) show
0 60 moveto (9349 ) show
0 24 moveto (Sheet 93) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 1) show
0 648 moveto (9350 #include "types.h") show
0 636 moveto (9351 #include "x86.h") show
0 624 moveto (9352 #include "pci.h") show
0 612 moveto (9353 #include "pcireg.h") show
0 600 moveto (9354 #include "defs.h") show
0 588 moveto (9355 #include "e100.h") show
0 576 moveto (9356 #include "proc.h") show
0 564 moveto (9357 #include "picirq.h") show
0 552 moveto (9358 #include "traps.h") show
0 540 moveto (9359 #include "lwip/include/ipv4/lwip/ip_addr.h") show
0 528 moveto (9360 #include "lwip/include/ipv4/lwip/ip.h") show
0 516 moveto (9361 #include "lwip/include/lwip/netif.h") show
0 504 moveto (9362 #include "lwip/include/netif/ethernetif.h") show
0 492 moveto (9363 #include "thread.h") show
0 480 moveto (9364 ) show
0 468 moveto (9365 static int dev_count = 0;) show
0 456 moveto (9366 ) show
0 444 moveto (9367 typedef struct e100_devinfo {) show
0 432 moveto (9368     int irq;) show
0 420 moveto (9369     uint32_t regbase[6], regsize[6];) show
0 408 moveto (9370     uint32_t iobase;) show
0 396 moveto (9371     struct netif netif;) show
0 384 moveto (9372     struct spinlock culock;) show
0 372 moveto (9373     uint32_t cubase;) show
0 360 moveto (9374     uint32_t cusize;) show
0 348 moveto (9375 //    uint32_t cuhead;) show
0 336 moveto (9376 //    uint32_t cuend;) show
0 324 moveto (9377     uint32_t cucount;) show
0 312 moveto (9378     int cufirst;) show
0 300 moveto (9379     int cuidle;) show
0 288 moveto (9380     command_block *cu_last_pkt;) show
0 276 moveto (9381     command_block *cu_next_pkt;) show
0 264 moveto (9382     struct spinlock rulock;) show
0 252 moveto (9383     uint32_t rubase;) show
0 240 moveto (9384     uint32_t rusize;) show
0 228 moveto (9385     uint32_t rucount;) show
0 216 moveto (9386     rf_desc *ru_first;) show
0 204 moveto (9387     rf_desc *ru_last;) show
0 192 moveto (9388     rf_desc *ru_prev;) show
0 180 moveto (9389     int ru_full;) show
0 168 moveto (9390     struct spinlock rxlock;) show
0 156 moveto (9391 } e100_dev;) show
0 144 moveto (9392 ) show
0 132 moveto (9393 static e100_dev e100_devs[E100_MAX_DEVS];) show
0 120 moveto (9394 int e100_reset\(e100_dev *dev\);) show
0 108 moveto (9395 scb_status_word e100_print_state\(e100_dev *dev\);) show
0 96 moveto (9396 void e100_put_state\(e100_dev *dev, scb_status_word stat\);) show
0 84 moveto (9397 uint8_t e100_read_scb_command\(e100_dev *dev\);) show
0 72 moveto (9398 void e100_cu_command\(e100_dev *dev, int command, void *cmd_addr\);) show
0 60 moveto (9399 void e100_ru_command\(e100_dev *dev, int command, void *cmd_addr\);) show
0 24 moveto (Sheet 93) show
grestore
restore
showpage
%%Page: 103 103
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 2) show
0 648 moveto (9400 void e100_intr\(struct trapframe *tf\);) show
0 636 moveto (9401 void e100_ru_start\(e100_dev *dev\);) show
0 624 moveto (9402 void ring_printinfo\(e100_dev *dev\);) show
0 612 moveto (9403 void ring_init\(e100_dev *dev\);) show
0 600 moveto (9404 int e100_receive_dev\(e100_dev *dev, void *buffer, int len\);) show
0 588 moveto (9405 void e100_rx_thread\(void *arg\);) show
0 576 moveto (9406 ) show
0 564 moveto (9407 char *cu_state_name[];) show
0 552 moveto (9408 char *ru_state_name[];) show
0 540 moveto (9409 ) show
0 528 moveto (9410 int) show
0 516 moveto (9411 ether_e100_attach\(struct pci_func *pcif\)) show
0 504 moveto (9412 {) show
0 492 moveto (9413     cprintf\("PCI: %02x:%02x.%d: ") show
0 480 moveto (9414             "Intel 82559ER Fast Ethernet PCI Controller %04x:%04x\\n",) show
0 468 moveto (9415 ) show
16 mp_a_x mul 468 moveto (pcif->bus->busno, pcif->dev, pcif->func,) show
0 456 moveto (9416         PCI_VENDOR\(pcif->dev_id\), PCI_PRODUCT\(pcif->dev_id\)\);) show
0 444 moveto (9417     dev_count++;) show
0 432 moveto (9418     int index = dev_count-1;) show
0 420 moveto (9419     e100_dev *dev = &e100_devs[index];) show
0 408 moveto (9420 ) show
0 396 moveto (9421     dev->cubase = \(uint32_t\)kalloc\(E100_CU_RING_SIZE * PAGE\); // 128K) show
0 384 moveto (9422     if \(!dev->cubase\)) show
0 372 moveto (9423     {) show
0 360 moveto (9424         cprintf\("   Failed to allocate CU ring\\n"\);) show
0 348 moveto (9425         dev_count--;) show
0 336 moveto (9426         return -1;) show
0 324 moveto (9427     }) show
0 312 moveto (9428     dev->rubase = \(uint32_t\)kalloc\(E100_RU_RING_SIZE * PAGE\); // 128K) show
0 300 moveto (9429     if \(!dev->rubase\)) show
0 288 moveto (9430     {) show
0 276 moveto (9431         cprintf\("   Failed to allocate RU ring\\n"\);) show
0 264 moveto (9432         dev_count--;) show
0 252 moveto (9433         return -1;) show
0 240 moveto (9434     }) show
0 228 moveto (9435     dev->cusize = E100_CU_RING_SIZE * PAGE;) show
0 216 moveto (9436     dev->rusize = E100_RU_RING_SIZE * PAGE;) show
0 204 moveto (9437     ring_init\(dev\);) show
0 192 moveto (9438 //    dev->cuhead = 0;) show
0 180 moveto (9439 //    dev->cuend = 0;) show
0 168 moveto (9440 ) show
0 156 moveto (9441     pci_func_enable\(pcif\);) show
0 144 moveto (9442     initlock\(&dev->culock, "e100 CU lock"\);) show
0 132 moveto (9443     initlock\(&dev->rulock, "e100 RU lock"\);) show
0 120 moveto (9444     initlock\(&dev->rxlock, "e100 RX lock"\);) show
0 108 moveto (9445     dev->irq = pcif->irq_line;) show
0 96 moveto (9446     int i;) show
0 84 moveto (9447     for \(i=0; i<6; i++\)) show
0 72 moveto (9448     {) show
0 60 moveto (9449         dev->regbase[i] = pcif->reg_base[i];) show
0 24 moveto (Sheet 94) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 3) show
0 648 moveto (9450         dev->regsize[i] = pcif->reg_size[i];) show
0 636 moveto (9451         if \(dev->regsize[i] == E100_IOPORT_SIZE\)) show
0 624 moveto (9452             dev->iobase = dev->regbase[i];) show
0 612 moveto (9453     }) show
0 600 moveto (9454     e100_reset\(dev\);) show
0 588 moveto (9455     dev->cufirst = 1;) show
0 576 moveto (9456     dev->cuidle = 1;) show
0 564 moveto (9457     e100_print_state\(dev\);) show
0 552 moveto (9458     struct ip_addr ipaddr;) show
0 540 moveto (9459     IP4_ADDR\(&ipaddr, 192, 168, 1, 1\);) show
0 528 moveto (9460     struct ip_addr netmask;) show
0 516 moveto (9461     IP4_ADDR\(&netmask, 255, 255, 255, 0\);) show
0 504 moveto (9462     struct ip_addr gw;) show
0 492 moveto (9463     IP4_ADDR\(&gw, 192, 168, 1, 2\);) show
0 480 moveto (9464     netif_add\(&dev->netif, &ipaddr, &netmask, &gw, 0, ethernetif_init, ip_input\);) show
0 468 moveto (9465     reg_irq_handler\(dev->irq, e100_intr\);) show
0 456 moveto (9466     pic_enable\(dev->irq\);) show
0 444 moveto (9467     ioapic_enable\(dev->irq, ncpu-1\);) show
0 432 moveto (9468     kproc_start\(e100_rx_thread, dev, 0, 0, "[e100 rx thread]"\);) show
0 420 moveto (9469     e100_ru_start\(dev\);) show
0 408 moveto (9470     return 1;) show
0 396 moveto (9471 }) show
0 384 moveto (9472 ) show
0 372 moveto (9473 static void) show
0 360 moveto (9474 delay\(int n\)) show
0 348 moveto (9475 {) show
0 336 moveto (9476     volatile int i;) show
0 324 moveto (9477     int j;) show
0 312 moveto (9478     for \(j=0; j<n; j++\)) show
0 300 moveto (9479     {) show
0 288 moveto (9480     for \(i=0; i<1000; i++\)) show
0 276 moveto (9481         ;) show
0 264 moveto (9482     }) show
0 252 moveto (9483 }) show
0 240 moveto (9484 ) show
0 228 moveto (9485 int) show
0 216 moveto (9486 e100_reset\(e100_dev *dev\)) show
0 204 moveto (9487 {) show
0 192 moveto (9488     outl\(dev->iobase + SCB_PORT, PORT_SOFT_RESET\);) show
0 180 moveto (9489     delay\(10\);) show
0 168 moveto (9490     scb_command_word cmd;) show
0 156 moveto (9491     cmd.word = 0;) show
0 144 moveto (9492     cmd.cmd.cu_command = CUC_DUMP_RESET;) show
0 132 moveto (9493     outw\(dev->iobase + SCB_COMMAND, cmd.word\);) show
0 120 moveto (9494     return 0;) show
0 108 moveto (9495 }) show
0 96 moveto (9496 ) show
0 84 moveto (9497 ) show
0 72 moveto (9498 ) show
0 60 moveto (9499 ) show
0 24 moveto (Sheet 94) show
grestore
restore
showpage
%%Page: 104 104
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 4) show
0 648 moveto (9500 scb_status_word) show
0 636 moveto (9501 e100_get_state\(e100_dev *dev\)) show
0 624 moveto (9502 {) show
0 612 moveto (9503     scb_status_word st;) show
0 600 moveto (9504     st.word = inw\(dev->iobase + SCB_STATUS\);) show
0 588 moveto (9505     return st;) show
0 576 moveto (9506 }) show
0 564 moveto (9507 ) show
0 552 moveto (9508 void) show
0 540 moveto (9509 e100_put_state\(e100_dev *dev, scb_status_word stat\)) show
0 528 moveto (9510 {) show
0 516 moveto (9511     outw\(dev->iobase + SCB_STATUS, stat.word\);) show
0 504 moveto (9512 }) show
0 492 moveto (9513 ) show
0 480 moveto (9514 scb_status_word) show
0 468 moveto (9515 e100_print_state\(e100_dev *dev\)) show
0 456 moveto (9516 {) show
0 444 moveto (9517     scb_status_word state = e100_get_state\(dev\);) show
0 432 moveto (9518     cprintf\("   RU Status: %s\\n", ru_state_name[state.status.rus]\);) show
0 420 moveto (9519     cprintf\("   CU Status: %s\\n", cu_state_name[state.status.cus]\);) show
0 408 moveto (9520 ) show
0 396 moveto (9521     struct scb_status_word stat = state.status;) show
0 384 moveto (9522     if \(stat.cx\) cprintf\("   CU executed\\n"\);) show
0 372 moveto (9523     if \(stat.fr\)) show
0 360 moveto (9524         cprintf\("   RU received\\n"\);) show
0 348 moveto (9525     if \(stat.cna\)) show
0 336 moveto (9526         cprintf\("   CU state change\\n"\);) show
0 324 moveto (9527     if \(stat.rnr\)) show
0 312 moveto (9528         cprintf\("   RU not ready\\n"\);) show
0 300 moveto (9529     if \(stat.mdi\)) show
0 288 moveto (9530         cprintf\("   MDI operation completed\\n"\);) show
0 276 moveto (9531     if \(stat.swi\)) show
0 264 moveto (9532         cprintf\("   Software Interrupt\\n"\);) show
0 252 moveto (9533     if \(stat.fcp\)) show
0 240 moveto (9534         cprintf\("   Flow Control Pause\\n"\);) show
0 228 moveto (9535 ) show
0 216 moveto (9536     return state;) show
0 204 moveto (9537 }) show
0 192 moveto (9538 ) show
0 180 moveto (9539 char *cu_state_name[4] = {) show
0 168 moveto (9540     "Idle",) show
0 156 moveto (9541     "Suspended",) show
0 144 moveto (9542     "LPQ Active",) show
0 132 moveto (9543     "HQP Active",) show
0 120 moveto (9544 };) show
0 108 moveto (9545 ) show
0 96 moveto (9546 ) show
0 84 moveto (9547 ) show
0 72 moveto (9548 ) show
0 60 moveto (9549 ) show
0 24 moveto (Sheet 95) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 5) show
0 648 moveto (9550 char *ru_state_name[16] = {) show
0 636 moveto (9551     "Idle",) show
0 624 moveto (9552     "Suspended",) show
0 612 moveto (9553     "No resources",) show
0 600 moveto (9554     "Reserved",) show
0 588 moveto (9555     "Ready",) show
0 576 moveto (9556     "Reserved",) show
0 564 moveto (9557     "Reserved",) show
0 552 moveto (9558     "Reserved",) show
0 540 moveto (9559     "Reserved",) show
0 528 moveto (9560     "Reserved",) show
0 516 moveto (9561     "Reserved",) show
0 504 moveto (9562     "Reserved",) show
0 492 moveto (9563     "Reserved",) show
0 480 moveto (9564     "Reserved",) show
0 468 moveto (9565     "Reserved",) show
0 456 moveto (9566     "Reserved",) show
0 444 moveto (9567 };) show
0 432 moveto (9568 ) show
0 420 moveto (9569 uint8_t) show
0 408 moveto (9570 e100_read_scb_command\(e100_dev *dev\)) show
0 396 moveto (9571 {) show
0 384 moveto (9572     return inb\(dev->iobase + SCB_COMMAND + 1\);) show
0 372 moveto (9573 }) show
0 360 moveto (9574 ) show
0 348 moveto (9575 void) show
0 336 moveto (9576 e100_set_gp\(e100_dev *dev, void *addr\)) show
0 324 moveto (9577 {) show
0 312 moveto (9578     outl\(dev->iobase + SCB_GENPTR, \(uint32_t\)addr\);) show
0 300 moveto (9579 }) show
0 288 moveto (9580 ) show
0 276 moveto (9581 void) show
0 264 moveto (9582 e100_cu_command\(e100_dev *dev, int command, void *cmd_addr\)) show
0 252 moveto (9583 {) show
0 240 moveto (9584     scb_command_word cmd;) show
0 228 moveto (9585     cmd.word = 0;) show
0 216 moveto (9586     cmd.cmd.cu_command = command;) show
0 204 moveto (9587     e100_set_gp\(dev, cmd_addr\);) show
0 192 moveto (9588     outw\(dev->iobase + SCB_COMMAND, cmd.word\);) show
0 180 moveto (9589     while \(e100_read_scb_command\(dev\)\) ;) show
0 168 moveto (9590 }) show
0 156 moveto (9591 ) show
0 144 moveto (9592 ) show
0 132 moveto (9593 ) show
0 120 moveto (9594 ) show
0 108 moveto (9595 ) show
0 96 moveto (9596 ) show
0 84 moveto (9597 ) show
0 72 moveto (9598 ) show
0 60 moveto (9599 ) show
0 24 moveto (Sheet 95) show
grestore
restore
showpage
%%Page: 105 105
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 6) show
0 648 moveto (9600 void) show
0 636 moveto (9601 e100_ru_command\(e100_dev *dev, int command, void *cmd_addr\)) show
0 624 moveto (9602 {) show
0 612 moveto (9603     scb_command_word cmd;) show
0 600 moveto (9604     cmd.word = 0;) show
0 588 moveto (9605     cmd.cmd.ru_command = command;) show
0 576 moveto (9606     e100_set_gp\(dev, cmd_addr\);) show
0 564 moveto (9607     outw\(dev->iobase + SCB_COMMAND, cmd.word\);) show
0 552 moveto (9608     while \(e100_read_scb_command\(dev\)\) ;) show
0 540 moveto (9609 }) show
0 528 moveto (9610 ) show
0 516 moveto (9611 void) show
0 504 moveto (9612 e100_rx_thread\(void *arg\)) show
0 492 moveto (9613 {) show
0 480 moveto (9614     e100_dev *dev = arg;) show
0 468 moveto (9615     acquire\(&dev->rxlock\);) show
0 456 moveto (9616     while\(1\)) show
0 444 moveto (9617     {) show
0 432 moveto (9618         sleep\(&dev->rxlock, &dev->rxlock\);) show
0 420 moveto (9619         while \(dev->ru_last->eof\)) show
0 408 moveto (9620         {) show
0 396 moveto (9621             ethernetif_input\(&dev->netif\);) show
0 384 moveto (9622             dev->ru_last = \(void*\)dev->ru_last->head.link;) show
0 372 moveto (9623         }) show
0 360 moveto (9624     }) show
0 348 moveto (9625     release\(&dev->rxlock\);) show
0 336 moveto (9626 }) show
0 324 moveto (9627 ) show
0 312 moveto (9628 void) show
0 300 moveto (9629 e100_intr\(struct trapframe *tf\)) show
0 288 moveto (9630 {) show
0 276 moveto (9631 //    cprintf\("e100_intr\\n"\);) show
0 264 moveto (9632     int i;) show
0 252 moveto (9633     int index = -1;) show
0 240 moveto (9634     for \(i=0; i< dev_count; i++\)) show
0 228 moveto (9635     {) show
0 216 moveto (9636         if \(tf->trapno == IRQ_OFFSET + e100_devs[i].irq\)) show
0 204 moveto (9637         {) show
0 192 moveto (9638             index = i;) show
0 180 moveto (9639             break;) show
0 168 moveto (9640         }) show
0 156 moveto (9641     }) show
0 144 moveto (9642     if \(index == -1\)) show
0 132 moveto (9643     {) show
0 120 moveto (9644         cprintf\("e100_intr: can't find corresponding device\\n"\);) show
0 108 moveto (9645         return;) show
0 96 moveto (9646     }) show
0 84 moveto (9647     e100_dev *dev = &e100_devs[index];) show
0 72 moveto (9648 //    e100_print_state\(dev\);) show
0 60 moveto (9649     scb_status_word state = e100_get_state\(dev\);) show
0 24 moveto (Sheet 96) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 7) show
0 648 moveto (9650     struct scb_status_word stat = state.status;) show
0 636 moveto (9651     state.word |= 0xff00;) show
0 624 moveto (9652     e100_put_state\(dev, state\);) show
0 612 moveto (9653 ) show
0 600 moveto (9654     if \(stat.cx\)) show
0 588 moveto (9655     {) show
0 576 moveto (9656 //        cprintf\("   CU executed\\n"\);) show
0 564 moveto (9657     }) show
0 552 moveto (9658     if \(stat.fr\)) show
0 540 moveto (9659     {) show
0 528 moveto (9660         if \(!dev->ru_first\)) show
0 516 moveto (9661         {) show
0 504 moveto (9662             dev->ru_first = dev->ru_last;) show
0 492 moveto (9663             wakeup\(&dev->ru_first\);) show
0 480 moveto (9664         }) show
0 468 moveto (9665         wakeup\(&dev->rxlock\);) show
0 456 moveto (9666 /*        while \(dev->ru_last->eof\)) show
0 444 moveto (9667         {) show
0 432 moveto (9668             ethernetif_input\(&dev->netif\);) show
0 420 moveto (9669             dev->ru_last = \(void*\)dev->ru_last->head.link;) show
0 408 moveto (9670         }*/) show
0 396 moveto (9671     }) show
0 384 moveto (9672     if \(stat.cna\)) show
0 372 moveto (9673     {) show
0 360 moveto (9674 /*        if \(dev->cu_next_pkt != 0\)) show
0 348 moveto (9675         {) show
0 336 moveto (9676             cprintf\("   finished 0x%08x\\n", dev->cu_next_pkt\);) show
0 324 moveto (9677             if \(dev->cu_next_pkt->link != 0\)) show
0 312 moveto (9678             {) show
0 300 moveto (9679                 cprintf\("   starting next packet: ") show
0 288 moveto (9680                         "0x%08x\\n", dev->cu_next_pkt->link\);) show
0 276 moveto (9681                 e100_cu_command\(dev, CUC_START,) show
0 264 moveto (9682                         \(void*\)dev->cu_next_pkt->link\);) show
0 252 moveto (9683                 dev->cuhead = dev->cu_next_pkt->link - dev->cubase;) show
0 240 moveto (9684                 dev->cu_next_pkt = \(command_block *\)dev->cu_next_pkt->link;) show
0 228 moveto (9685             }) show
0 216 moveto (9686             else) show
0 204 moveto (9687             {) show
0 192 moveto (9688                 dev->cuhead = dev->cuend;) show
0 180 moveto (9689                 dev->cu_last_pkt = 0;) show
0 168 moveto (9690                 dev->cu_next_pkt = 0;) show
0 156 moveto (9691             }) show
0 144 moveto (9692             ring_printinfo\(dev\);) show
0 132 moveto (9693         }*/) show
0 120 moveto (9694         if \(dev->cu_last_pkt\)) show
0 108 moveto (9695         {) show
0 96 moveto (9696             if \(dev->cu_last_pkt->c\)) show
0 84 moveto (9697             {) show
0 72 moveto (9698                 dev->cuidle = 1;) show
0 60 moveto (9699 //                dev->cuhead = dev->cuend;) show
0 24 moveto (Sheet 96) show
grestore
restore
showpage
%%Page: 106 106
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 8) show
0 648 moveto (9700                 dev->cu_next_pkt = 0;) show
0 636 moveto (9701 //                dev->cu_last_pkt = 0;) show
0 624 moveto (9702             } else {) show
0 612 moveto (9703                 dev->cuidle = 0;) show
0 600 moveto (9704                 while \(dev->cu_next_pkt->c\)) show
0 588 moveto (9705                 {) show
0 576 moveto (9706                     if \(!dev->cu_next_pkt->ok\)) show
0 564 moveto (9707                         cprintf\("send error 0x%08x\\n", dev->cu_next_pkt\);) show
0 552 moveto (9708                     dev->cu_next_pkt = \(void*\)dev->cu_next_pkt->link;) show
0 540 moveto (9709                 }) show
0 528 moveto (9710                 e100_cu_command\(dev, CUC_RESUME, 0\);) show
0 516 moveto (9711 //                dev->cuhead = \(uint32_t\)dev->cu_next_pkt - dev->cubase;) show
0 504 moveto (9712             }) show
0 492 moveto (9713         }) show
0 480 moveto (9714 //        ring_printinfo\(dev\);) show
0 468 moveto (9715     }) show
0 456 moveto (9716     if \(stat.rnr\)) show
0 444 moveto (9717     {) show
0 432 moveto (9718         cprintf\("e100: RU overrun!\\n"\);) show
0 420 moveto (9719         dev->ru_full = 1;) show
0 408 moveto (9720     }) show
0 396 moveto (9721     if \(stat.mdi\)) show
0 384 moveto (9722         cprintf\("   MDI operation completed\\n"\);) show
0 372 moveto (9723     if \(stat.swi\)) show
0 360 moveto (9724         cprintf\("   Software Interrupt\\n"\);) show
0 348 moveto (9725     if \(stat.fcp\)) show
0 336 moveto (9726         cprintf\("   Flow Control Pause\\n"\);) show
0 324 moveto (9727 ) show
0 312 moveto (9728 }) show
0 300 moveto (9729 ) show
0 288 moveto (9730 void) show
0 276 moveto (9731 ring_printinfo\(e100_dev *dev\)) show
0 264 moveto (9732 {) show
0 252 moveto (9733     cprintf\("Ring Info:   "\);) show
0 240 moveto (9734     cprintf\("head: 0x%08x  ", dev->cu_next_pkt\);) show
0 228 moveto (9735     cprintf\("end:  0x%08x\\n", dev->cu_last_pkt\);) show
0 216 moveto (9736 }) show
0 204 moveto (9737 ) show
0 192 moveto (9738 ) show
0 180 moveto (9739 ) show
0 168 moveto (9740 ) show
0 156 moveto (9741 ) show
0 144 moveto (9742 ) show
0 132 moveto (9743 ) show
0 120 moveto (9744 ) show
0 108 moveto (9745 ) show
0 96 moveto (9746 ) show
0 84 moveto (9747 ) show
0 72 moveto (9748 ) show
0 60 moveto (9749 ) show
0 24 moveto (Sheet 97) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 9) show
0 648 moveto (9750 void *) show
0 636 moveto (9751 ring_alloc\(e100_dev *dev, uint32_t len\)) show
0 624 moveto (9752 {) show
0 612 moveto (9753     if \(len > E100_CB_SIZE\)) show
0 600 moveto (9754         return \(void*\) 0;) show
0 588 moveto (9755     if \(dev->cu_next_pkt\)) show
0 576 moveto (9756     {) show
0 564 moveto (9757         if \(\(void*\)dev->cu_last_pkt->link == dev->cu_next_pkt\)) show
0 552 moveto (9758             return \(void*\) 0;) show
0 540 moveto (9759         return \(void*\)dev->cu_last_pkt->link;) show
0 528 moveto (9760     } else {) show
0 516 moveto (9761         return \(void*\)dev->cu_last_pkt->link;) show
0 504 moveto (9762     }) show
0 492 moveto (9763 /*) show
0 480 moveto (9764     len = E100_CB_SIZE;) show
0 468 moveto (9765     if \(dev->cuhead <= dev->cuend\)) show
0 456 moveto (9766     {) show
0 444 moveto (9767         uint32_t newend = dev->cuend + len;) show
0 432 moveto (9768         uint32_t oldend = dev->cuend;) show
0 420 moveto (9769         if \(newend >= dev->cusize\)) show
0 408 moveto (9770         {) show
0 396 moveto (9771             newend = len; // Start from base) show
0 384 moveto (9772             if \(newend < dev->cuhead\)) show
0 372 moveto (9773             {) show
0 360 moveto (9774                 dev->cuend = newend;) show
0 348 moveto (9775                 return \(void*\)dev->cubase;) show
0 336 moveto (9776             }) show
0 324 moveto (9777             else) show
0 312 moveto (9778                 return \(void*\)0;) show
0 300 moveto (9779         }) show
0 288 moveto (9780         else) show
0 276 moveto (9781         {) show
0 264 moveto (9782             dev->cuend = newend;) show
0 252 moveto (9783             return \(void*\)\(oldend + dev->cubase\);) show
0 240 moveto (9784         }) show
0 228 moveto (9785     }) show
0 216 moveto (9786     else) show
0 204 moveto (9787     {) show
0 192 moveto (9788         uint32_t newend = dev->cuend + len;) show
0 180 moveto (9789         uint32_t oldend = dev->cuend;) show
0 168 moveto (9790         if \(newend < dev->cuhead\)) show
0 156 moveto (9791         {) show
0 144 moveto (9792             dev->cuend = newend;) show
0 132 moveto (9793             return \(void*\)\(oldend + dev->cubase\);) show
0 120 moveto (9794         }) show
0 108 moveto (9795         else) show
0 96 moveto (9796             return \(void*\)0;) show
0 84 moveto (9797     }*/) show
0 72 moveto (9798 }) show
0 60 moveto (9799 ) show
0 24 moveto (Sheet 97) show
grestore
restore
showpage
%%Page: 107 107
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 10) show
0 648 moveto (9800 int) show
0 636 moveto (9801 e100_send_dev\(e100_dev *dev, void *buffer, uint32_t len\)) show
0 624 moveto (9802 {) show
0 612 moveto (9803 //    cprintf\("e100_send_dev\\n"\);) show
0 600 moveto (9804     if \(len > TBD_DATA_LIMIT\)) show
0 588 moveto (9805         return -1; // ETOOBIG) show
0 576 moveto (9806     acquire\(&dev->culock\);) show
0 564 moveto (9807     op_transmit_cmd *start =) show
0 552 moveto (9808         ring_alloc\(dev, sizeof\(op_transmit_cmd\) + len\);) show
0 540 moveto (9809 //    cprintf\("   start: 0x%08x\\n", start\);) show
0 528 moveto (9810     if \(!start\)) show
0 516 moveto (9811     {) show
0 504 moveto (9812         release\(&dev->culock\);) show
0 492 moveto (9813         return -1; // No space in buffer) show
0 480 moveto (9814     }) show
0 468 moveto (9815     op_transmit_cmd_cmd cmd_word;) show
0 456 moveto (9816     cmd_word.word = 0;) show
0 444 moveto (9817     cmd_word.cmd = OP_TRANSMIT;) show
0 432 moveto (9818 //    cmd_word.el = 0;) show
0 420 moveto (9819     cmd_word.cid = 0xe;) show
0 408 moveto (9820     cmd_word.i = 1;) show
0 396 moveto (9821     cmd_word.s = 1;) show
0 384 moveto (9822     if \(!dev->cuidle\)) show
0 372 moveto (9823         dev->cu_last_pkt->s = 0;) show
0 360 moveto (9824     start->base_cmd.cmd_word = cmd_word.word;) show
0 348 moveto (9825     start->base_cmd.status_word = 0;) show
0 336 moveto (9826 //    start->base_cmd.link = 0;) show
0 324 moveto (9827     start->tbd_addr = 0xffffffff;) show
0 312 moveto (9828     start->byte_count = len;) show
0 300 moveto (9829     start->eof = 1;) show
0 288 moveto (9830     start->trans_thres = 0xE0;) show
0 276 moveto (9831     start->tbd_num = 0;) show
0 264 moveto (9832     memcpy\(\(void*\)\(start+1\), buffer, len\);) show
0 252 moveto (9833 //    e100_print_state\(dev\);) show
0 240 moveto (9834 //    if \(e100_get_state\(dev\).status.cus == CUS_IDLE\)) show
0 228 moveto (9835 //    if \(dev->cu_next_pkt == 0\)) show
0 216 moveto (9836 //    This test would fail in real i82559er) show
0 204 moveto (9837 //    But it passed in qemu) show
0 192 moveto (9838 /*    if \(\(!dev->cufirst\) && \(!dev->cuidle\)\)) show
0 180 moveto (9839         if \(start->base_cmd.link == dev->cu_next_pkt\)) show
0 168 moveto (9840             e100_cu_command\(dev, CUC_RESUME, start\);*/) show
0 156 moveto (9841     if \(dev->cufirst\)) show
0 144 moveto (9842     {) show
0 132 moveto (9843         dev->cufirst = 0;) show
0 120 moveto (9844         dev->cu_next_pkt = &start->base_cmd;) show
0 108 moveto (9845         e100_cu_command\(dev, CUC_START, start\);) show
0 96 moveto (9846     }) show
0 84 moveto (9847     else if \(dev->cuidle\)) show
0 72 moveto (9848     {) show
0 60 moveto (9849         dev->cuidle = 0;) show
0 24 moveto (Sheet 98) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 11) show
0 648 moveto (9850         dev->cu_next_pkt = &start->base_cmd;) show
0 636 moveto (9851         e100_cu_command\(dev, CUC_RESUME, start\); // the GENPTR is nonsense) show
0 624 moveto (9852     }) show
0 612 moveto (9853     dev->cu_last_pkt = &start->base_cmd;) show
0 600 moveto (9854     release\(&dev->culock\);) show
0 588 moveto (9855     return len;) show
0 576 moveto (9856 }) show
0 564 moveto (9857 ) show
0 552 moveto (9858 int) show
0 540 moveto (9859 e100_send\(void *buffer, uint32_t len\)) show
0 528 moveto (9860 {) show
0 516 moveto (9861     if \(dev_count == 0\)) show
0 504 moveto (9862         return -2; // Device not found) show
0 492 moveto (9863     return e100_send_dev\(&e100_devs[0], buffer,len\);) show
0 480 moveto (9864 }) show
0 468 moveto (9865 ) show
0 456 moveto (9866 void) show
0 444 moveto (9867 ring_init\(e100_dev *dev\)) show
0 432 moveto (9868 {) show
0 420 moveto (9869     int i;) show
0 408 moveto (9870     dev->cucount = dev->cusize / E100_CB_SIZE;) show
0 396 moveto (9871     dev->cu_next_pkt = 0;) show
0 384 moveto (9872     for \(i=0; i<dev->cucount ; i++\)) show
0 372 moveto (9873     {) show
0 360 moveto (9874         command_block *cmd = \(void*\)\(dev->cubase + i * E100_CB_SIZE\);) show
0 348 moveto (9875         cmd->cmd_word = 0;) show
0 336 moveto (9876         cmd->status_word = 0;) show
0 324 moveto (9877         cmd->c = 1;) show
0 312 moveto (9878         cmd->el = 1;) show
0 300 moveto (9879         if \(i == dev->cucount - 1\)) show
0 288 moveto (9880         {) show
0 276 moveto (9881             cmd->link = \(void*\)dev->cubase;) show
0 264 moveto (9882             dev->cu_last_pkt = cmd;) show
0 252 moveto (9883         }) show
0 240 moveto (9884         else) show
0 228 moveto (9885         {) show
0 216 moveto (9886             cmd->link = \(void*\)\(\(uint32_t\)cmd + E100_CB_SIZE\);) show
0 204 moveto (9887         }) show
0 192 moveto (9888 //        cprintf\("CB %d: start 0x%08x next 0x%08x\\n", i, cmd, cmd->link\);) show
0 180 moveto (9889     }) show
0 168 moveto (9890     dev->rucount = dev->rusize / E100_RFD_SIZE;) show
0 156 moveto (9891     for \(i=0; i<dev->rucount; i++\)) show
0 144 moveto (9892     {) show
0 132 moveto (9893         rf_desc *rfd = \(void*\)\(dev->rubase + i * E100_RFD_SIZE\);) show
0 120 moveto (9894         rfd->head.cmd_word = 0;) show
0 108 moveto (9895         rfd->head.status_word = 0;) show
0 96 moveto (9896         rfd->size = E100_RFD_SIZE - sizeof\(rf_desc\);) show
0 84 moveto (9897         if \(rfd->size & 1\)) show
0 72 moveto (9898             rfd->size--;) show
0 60 moveto (9899         rfd->eof = 0;) show
0 24 moveto (Sheet 98) show
grestore
restore
showpage
%%Page: 108 108
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 12) show
0 648 moveto (9900         rfd->f = 0;) show
0 636 moveto (9901         if \(i == dev->rucount - 1\)) show
0 624 moveto (9902         {) show
0 612 moveto (9903             rfd->head.link = \(void*\)dev->rubase;) show
0 600 moveto (9904             rfd->head.el = 1;) show
0 588 moveto (9905             dev->ru_prev = rfd;) show
0 576 moveto (9906         }) show
0 564 moveto (9907         else) show
0 552 moveto (9908         {) show
0 540 moveto (9909             rfd->head.link = \(void*\)\(\(uint32_t\)rfd + E100_RFD_SIZE\);) show
0 528 moveto (9910         }) show
0 516 moveto (9911     }) show
0 504 moveto (9912     dev->ru_first = 0;) show
0 492 moveto (9913     dev->ru_last = \(void*\)dev->rubase;) show
0 480 moveto (9914 ) show
0 468 moveto (9915 }) show
0 456 moveto (9916 ) show
0 444 moveto (9917 void) show
0 432 moveto (9918 e100_ru_start\(e100_dev *dev\)) show
0 420 moveto (9919 {) show
0 408 moveto (9920     dev->ru_full = 0;) show
0 396 moveto (9921     e100_ru_command\(dev, RUC_START, \(void*\)dev->rubase\);) show
0 384 moveto (9922 }) show
0 372 moveto (9923 ) show
0 360 moveto (9924 int) show
0 348 moveto (9925 e100_receive\(void *buffer, uint32_t len\)) show
0 336 moveto (9926 {) show
0 324 moveto (9927     if \(dev_count == 0\)) show
0 312 moveto (9928         return -2; // Device not found) show
0 300 moveto (9929     return e100_receive_dev\(&e100_devs[0], buffer, len\);) show
0 288 moveto (9930 }) show
0 276 moveto (9931 ) show
0 264 moveto (9932 int) show
0 252 moveto (9933 e100_receive_dev\(e100_dev *dev, void *buffer, int len\)) show
0 240 moveto (9934 {) show
0 228 moveto (9935     int count;) show
0 216 moveto (9936 //    cprintf\("e100_receive_dev\\n"\);) show
0 204 moveto (9937     acquire\(&dev->rulock\);) show
0 192 moveto (9938     while \(dev->ru_first == 0\)) show
0 180 moveto (9939         sleep\(&dev->rulock, &dev->rulock\);) show
0 168 moveto (9940     if \(len < dev->ru_first->count\)) show
0 156 moveto (9941     {) show
0 144 moveto (9942         release\(&dev->rulock\);) show
0 132 moveto (9943         return -1; // ETOOBIG) show
0 120 moveto (9944     }) show
0 108 moveto (9945     memcpy\(buffer, dev->ru_first + 1, dev->ru_first->count\);) show
0 96 moveto (9946 //    cprintf\("received %d bytes into 0x%08x\\n", dev->ru_first->count, buffer\);) show
0 84 moveto (9947     count = dev->ru_first->count;) show
0 72 moveto (9948     dev->ru_first->eof = 0;) show
0 60 moveto (9949     dev->ru_first->f = 0;) show
0 24 moveto (Sheet 99) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/e100.c  Page 13) show
0 648 moveto (9950     dev->ru_prev->head.el = 0;) show
0 636 moveto (9951     dev->ru_first->head.el = 1;) show
0 624 moveto (9952     dev->ru_prev = dev->ru_first;) show
0 612 moveto (9953     dev->ru_first = \(void*\)dev->ru_first->head.link;) show
0 600 moveto (9954     if \(dev->ru_full\)) show
0 588 moveto (9955     {) show
0 576 moveto (9956         // RU full, in No Resource state) show
0 564 moveto (9957         dev->ru_full = 0;) show
0 552 moveto (9958         e100_ru_command\(dev, RUC_START, dev->ru_prev\);) show
0 540 moveto (9959     }) show
0 528 moveto (9960     if \(dev->ru_first == dev->ru_last\)) show
0 516 moveto (9961         dev->ru_first = 0;) show
0 504 moveto (9962     release\(&dev->rulock\);) show
0 492 moveto (9963     return count;) show
0 480 moveto (9964 }) show
0 468 moveto (9965 ) show
0 456 moveto (9966 ) show
0 444 moveto (9967 ) show
0 432 moveto (9968 ) show
0 420 moveto (9969 ) show
0 408 moveto (9970 ) show
0 396 moveto (9971 ) show
0 384 moveto (9972 ) show
0 372 moveto (9973 ) show
0 360 moveto (9974 ) show
0 348 moveto (9975 ) show
0 336 moveto (9976 ) show
0 324 moveto (9977 ) show
0 312 moveto (9978 ) show
0 300 moveto (9979 ) show
0 288 moveto (9980 ) show
0 276 moveto (9981 ) show
0 264 moveto (9982 ) show
0 252 moveto (9983 ) show
0 240 moveto (9984 ) show
0 228 moveto (9985 ) show
0 216 moveto (9986 ) show
0 204 moveto (9987 ) show
0 192 moveto (9988 ) show
0 180 moveto (9989 ) show
0 168 moveto (9990 ) show
0 156 moveto (9991 ) show
0 144 moveto (9992 ) show
0 132 moveto (9993 ) show
0 120 moveto (9994 ) show
0 108 moveto (9995 ) show
0 96 moveto (9996 ) show
0 84 moveto (9997 ) show
0 72 moveto (9998 ) show
0 60 moveto (9999 ) show
0 24 moveto (Sheet 99) show
grestore
restore
showpage
%%Page: 109 109
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/initcode.S  Page 1) show
0 648 moveto (10000 # Initial process execs /init.) show
0 636 moveto (10001 ) show
0 624 moveto (10002 #include "syscall.h") show
0 612 moveto (10003 #include "traps.h") show
0 600 moveto (10004 ) show
0 588 moveto (10005 # exec\(init, argv\)) show
0 576 moveto (10006 .globl start) show
0 564 moveto (10007 start:) show
0 552 moveto (10008   pushl $argv) show
0 540 moveto (10009   pushl $init) show
0 528 moveto (10010   pushl $0) show
0 516 moveto (10011   movl $SYS_exec, %eax) show
0 504 moveto (10012   int $T_SYSCALL) show
0 492 moveto (10013 ) show
0 480 moveto (10014 # for\(;;\) exit\(\);) show
0 468 moveto (10015 exit:) show
0 456 moveto (10016   movl $SYS_exit, %eax) show
0 444 moveto (10017   int $T_SYSCALL) show
0 432 moveto (10018   jmp exit) show
0 420 moveto (10019 ) show
0 408 moveto (10020 # char init[] = "/init\\0";) show
0 396 moveto (10021 init:) show
0 384 moveto (10022   .string "/init\\0") show
0 372 moveto (10023 ) show
0 360 moveto (10024 # char *argv[] = { init, 0 };) show
0 348 moveto (10025 .p2align 2) show
0 336 moveto (10026 argv:) show
0 324 moveto (10027   .long init) show
0 312 moveto (10028   .long 0) show
0 300 moveto (10029 ) show
0 288 moveto (10030 ) show
0 276 moveto (10031 ) show
0 264 moveto (10032 ) show
0 252 moveto (10033 ) show
0 240 moveto (10034 ) show
0 228 moveto (10035 ) show
0 216 moveto (10036 ) show
0 204 moveto (10037 ) show
0 192 moveto (10038 ) show
0 180 moveto (10039 ) show
0 168 moveto (10040 ) show
0 156 moveto (10041 ) show
0 144 moveto (10042 ) show
0 132 moveto (10043 ) show
0 120 moveto (10044 ) show
0 108 moveto (10045 ) show
0 96 moveto (10046 ) show
0 84 moveto (10047 ) show
0 72 moveto (10048 ) show
0 60 moveto (10049 ) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/init.c  Page 1) show
0 648 moveto (10050 // init: The initial user-level program) show
0 636 moveto (10051 ) show
0 624 moveto (10052 #include "types.h") show
0 612 moveto (10053 #include "stat.h") show
0 600 moveto (10054 #include "user.h") show
0 588 moveto (10055 #include "fcntl.h") show
0 576 moveto (10056 ) show
0 564 moveto (10057 char *sh_args[] = { "sh", 0 };) show
0 552 moveto (10058 ) show
0 540 moveto (10059 int) show
0 528 moveto (10060 main\(void\)) show
0 516 moveto (10061 {) show
0 504 moveto (10062   int pid, wpid;) show
0 492 moveto (10063 ) show
0 480 moveto (10064   if\(open\("console", O_RDWR\) < 0\){) show
0 468 moveto (10065     mknod\("console", 1, 1\);) show
0 456 moveto (10066     open\("console", O_RDWR\);) show
0 444 moveto (10067   }) show
0 432 moveto (10068   dup\(0\);  // stdout) show
0 420 moveto (10069   dup\(0\);  // stderr) show
0 408 moveto (10070 ) show
0 396 moveto (10071   for\(;;\){) show
0 384 moveto (10072     printf\(1, "init: starting sh\\n"\);) show
0 372 moveto (10073     pid = fork\(\);) show
0 360 moveto (10074     if\(pid < 0\){) show
0 348 moveto (10075       printf\(1, "init: fork failed\\n"\);) show
0 336 moveto (10076       exit\(\);) show
0 324 moveto (10077     }) show
0 312 moveto (10078     if\(pid == 0\){) show
0 300 moveto (10079       exec\("sh", sh_args\);) show
0 288 moveto (10080       printf\(1, "init: exec sh failed\\n"\);) show
0 276 moveto (10081       exit\(\);) show
0 264 moveto (10082     }) show
0 252 moveto (10083     while\(\(wpid=wait\(\)\) >= 0 && wpid != pid\)) show
0 240 moveto (10084     {) show
0 228 moveto (10085 #if 0) show
0 216 moveto (10086       printf\(1, "zombie!\\n"\);) show
0 204 moveto (10087 #endif) show
0 192 moveto (10088     }) show
0 180 moveto (10089   }) show
0 168 moveto (10090 }) show
0 156 moveto (10091 ) show
0 144 moveto (10092 ) show
0 132 moveto (10093 ) show
0 120 moveto (10094 ) show
0 108 moveto (10095 ) show
0 96 moveto (10096 ) show
0 84 moveto (10097 ) show
0 72 moveto (10098 ) show
0 60 moveto (10099 ) show
grestore
restore
showpage
%%Page: 110 110
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/usys.S  Page 1) show
0 648 moveto (10100 #include "syscall.h") show
0 636 moveto (10101 #include "traps.h") show
0 624 moveto (10102 ) show
0 612 moveto (10103 #define STUB\(name\) \\) show
0 600 moveto (10104   .globl name; \\) show
0 588 moveto (10105   name: \\) show
0 576 moveto (10106     movl $SYS_ ## name, %eax; \\) show
0 564 moveto (10107     int $T_SYSCALL; \\) show
0 552 moveto (10108     ret) show
0 540 moveto (10109 ) show
0 528 moveto (10110 STUB\(fork\)) show
0 516 moveto (10111 STUB\(exit\)) show
0 504 moveto (10112 STUB\(wait\)) show
0 492 moveto (10113 STUB\(pipe\)) show
0 480 moveto (10114 STUB\(read\)) show
0 468 moveto (10115 STUB\(write\)) show
0 456 moveto (10116 STUB\(close\)) show
0 444 moveto (10117 STUB\(kill\)) show
0 432 moveto (10118 STUB\(exec\)) show
0 420 moveto (10119 STUB\(open\)) show
0 408 moveto (10120 STUB\(mknod\)) show
0 396 moveto (10121 STUB\(unlink\)) show
0 384 moveto (10122 STUB\(fstat\)) show
0 372 moveto (10123 STUB\(link\)) show
0 360 moveto (10124 STUB\(mkdir\)) show
0 348 moveto (10125 STUB\(chdir\)) show
0 336 moveto (10126 STUB\(dup\)) show
0 324 moveto (10127 STUB\(getpid\)) show
0 312 moveto (10128 STUB\(sbrk\)) show
0 300 moveto (10129 STUB\(sleep\)) show
0 288 moveto (10130 STUB\(upmsec\)) show
0 276 moveto (10131 STUB\(socket\)) show
0 264 moveto (10132 STUB\(bind\)) show
0 252 moveto (10133 STUB\(listen\)) show
0 240 moveto (10134 STUB\(accept\)) show
0 228 moveto (10135 STUB\(recv\)) show
0 216 moveto (10136 STUB\(recvfrom\)) show
0 204 moveto (10137 STUB\(send\)) show
0 192 moveto (10138 STUB\(sendto\)) show
0 180 moveto (10139 STUB\(shutdown\)) show
0 168 moveto (10140 STUB\(getsockopt\)) show
0 156 moveto (10141 STUB\(setsockopt\)) show
0 144 moveto (10142 STUB\(sockclose\)) show
0 132 moveto (10143 STUB\(connect\)) show
0 120 moveto (10144 STUB\(getpeername\)) show
0 108 moveto (10145 STUB\(getsockname\)) show
0 96 moveto (10146 ) show
0 84 moveto (10147 ) show
0 72 moveto (10148 ) show
0 60 moveto (10149 ) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 1) show
0 648 moveto (10150 // Shell.) show
0 636 moveto (10151 ) show
0 624 moveto (10152 #include "types.h") show
0 612 moveto (10153 #include "user.h") show
0 600 moveto (10154 #include "fcntl.h") show
0 588 moveto (10155 ) show
0 576 moveto (10156 // Parsed command representation) show
0 564 moveto (10157 #define EXEC  1) show
0 552 moveto (10158 #define REDIR 2) show
0 540 moveto (10159 #define PIPE  3) show
0 528 moveto (10160 #define LIST  4) show
0 516 moveto (10161 #define BACK  5) show
0 504 moveto (10162 ) show
0 492 moveto (10163 #define MAXARGS 10) show
0 480 moveto (10164 ) show
0 468 moveto (10165 struct cmd {) show
0 456 moveto (10166   int type;) show
0 444 moveto (10167 };) show
0 432 moveto (10168 ) show
0 420 moveto (10169 struct execcmd {) show
0 408 moveto (10170   int type;) show
0 396 moveto (10171   char *argv[MAXARGS];) show
0 384 moveto (10172   char *eargv[MAXARGS];) show
0 372 moveto (10173 };) show
0 360 moveto (10174 ) show
0 348 moveto (10175 struct redircmd {) show
0 336 moveto (10176   int type;) show
0 324 moveto (10177   struct cmd *cmd;) show
0 312 moveto (10178   char *file;) show
0 300 moveto (10179   char *efile;) show
0 288 moveto (10180   int mode;) show
0 276 moveto (10181   int fd;) show
0 264 moveto (10182 };) show
0 252 moveto (10183 ) show
0 240 moveto (10184 struct pipecmd {) show
0 228 moveto (10185   int type;) show
0 216 moveto (10186   struct cmd *left;) show
0 204 moveto (10187   struct cmd *right;) show
0 192 moveto (10188 };) show
0 180 moveto (10189 ) show
0 168 moveto (10190 struct listcmd {) show
0 156 moveto (10191   int type;) show
0 144 moveto (10192   struct cmd *left;) show
0 132 moveto (10193   struct cmd *right;) show
0 120 moveto (10194 };) show
0 108 moveto (10195 ) show
0 96 moveto (10196 struct backcmd {) show
0 84 moveto (10197   int type;) show
0 72 moveto (10198   struct cmd *cmd;) show
0 60 moveto (10199 };) show
grestore
restore
showpage
%%Page: 111 111
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 2) show
0 648 moveto (10200 int fork1\(void\);  // Fork but panics on failure.) show
0 636 moveto (10201 void panic\(char*\);) show
0 624 moveto (10202 struct cmd *parsecmd\(char*\);) show
0 612 moveto (10203 ) show
0 600 moveto (10204 // Execute cmd.  Never returns.) show
0 588 moveto (10205 void) show
0 576 moveto (10206 runcmd\(struct cmd *cmd\)) show
0 564 moveto (10207 {) show
0 552 moveto (10208   int p[2];) show
0 540 moveto (10209   struct backcmd *bcmd;) show
0 528 moveto (10210   struct execcmd *ecmd;) show
0 516 moveto (10211   struct listcmd *lcmd;) show
0 504 moveto (10212   struct pipecmd *pcmd;) show
0 492 moveto (10213   struct redircmd *rcmd;) show
0 480 moveto (10214 ) show
0 468 moveto (10215   if\(cmd == 0\)) show
0 456 moveto (10216     exit\(\);) show
0 444 moveto (10217 ) show
0 432 moveto (10218   switch\(cmd->type\){) show
0 420 moveto (10219   default:) show
0 408 moveto (10220     panic\("runcmd"\);) show
0 396 moveto (10221 ) show
0 384 moveto (10222   case EXEC:) show
0 372 moveto (10223     ecmd = \(struct execcmd*\)cmd;) show
0 360 moveto (10224     if\(ecmd->argv[0] == 0\)) show
0 348 moveto (10225       exit\(\);) show
0 336 moveto (10226     exec\(ecmd->argv[0], ecmd->argv\);) show
0 324 moveto (10227     printf\(2, "exec %s failed\\n", ecmd->argv[0]\);) show
0 312 moveto (10228     break;) show
0 300 moveto (10229 ) show
0 288 moveto (10230   case REDIR:) show
0 276 moveto (10231     rcmd = \(struct redircmd*\)cmd;) show
0 264 moveto (10232     close\(rcmd->fd\);) show
0 252 moveto (10233     if\(open\(rcmd->file, rcmd->mode\) < 0\){) show
0 240 moveto (10234       printf\(2, "open %s failed\\n", rcmd->file\);) show
0 228 moveto (10235       exit\(\);) show
0 216 moveto (10236     }) show
0 204 moveto (10237     runcmd\(rcmd->cmd\);) show
0 192 moveto (10238     break;) show
0 180 moveto (10239 ) show
0 168 moveto (10240   case LIST:) show
0 156 moveto (10241     lcmd = \(struct listcmd*\)cmd;) show
0 144 moveto (10242     if\(fork1\(\) == 0\)) show
0 132 moveto (10243       runcmd\(lcmd->left\);) show
0 120 moveto (10244     wait\(\);) show
0 108 moveto (10245     runcmd\(lcmd->right\);) show
0 96 moveto (10246     break;) show
0 84 moveto (10247 ) show
0 72 moveto (10248 ) show
0 60 moveto (10249 ) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 3) show
0 648 moveto (10250   case PIPE:) show
0 636 moveto (10251     pcmd = \(struct pipecmd*\)cmd;) show
0 624 moveto (10252     if\(pipe\(p\) < 0\)) show
0 612 moveto (10253       panic\("pipe"\);) show
0 600 moveto (10254     if\(fork1\(\) == 0\){) show
0 588 moveto (10255       close\(1\);) show
0 576 moveto (10256       dup\(p[1]\);) show
0 564 moveto (10257       close\(p[0]\);) show
0 552 moveto (10258       close\(p[1]\);) show
0 540 moveto (10259       runcmd\(pcmd->left\);) show
0 528 moveto (10260     }) show
0 516 moveto (10261     if\(fork1\(\) == 0\){) show
0 504 moveto (10262       close\(0\);) show
0 492 moveto (10263       dup\(p[0]\);) show
0 480 moveto (10264       close\(p[0]\);) show
0 468 moveto (10265       close\(p[1]\);) show
0 456 moveto (10266       runcmd\(pcmd->right\);) show
0 444 moveto (10267     }) show
0 432 moveto (10268     close\(p[0]\);) show
0 420 moveto (10269     close\(p[1]\);) show
0 408 moveto (10270     wait\(\);) show
0 396 moveto (10271     wait\(\);) show
0 384 moveto (10272     break;) show
0 372 moveto (10273 ) show
0 360 moveto (10274   case BACK:) show
0 348 moveto (10275     bcmd = \(struct backcmd*\)cmd;) show
0 336 moveto (10276     if\(fork1\(\) == 0\)) show
0 324 moveto (10277       runcmd\(bcmd->cmd\);) show
0 312 moveto (10278     break;) show
0 300 moveto (10279   }) show
0 288 moveto (10280   exit\(\);) show
0 276 moveto (10281 }) show
0 264 moveto (10282 ) show
0 252 moveto (10283 int) show
0 240 moveto (10284 getcmd\(char *buf, int nbuf\)) show
0 228 moveto (10285 {) show
0 216 moveto (10286   printf\(2, "$ "\);) show
0 204 moveto (10287   memset\(buf, 0, nbuf\);) show
0 192 moveto (10288   gets\(buf, nbuf\);) show
0 180 moveto (10289   if\(buf[0] == 0\) // EOF) show
0 168 moveto (10290     return -1;) show
0 156 moveto (10291   return 0;) show
0 144 moveto (10292 }) show
0 132 moveto (10293 ) show
0 120 moveto (10294 ) show
0 108 moveto (10295 ) show
0 96 moveto (10296 ) show
0 84 moveto (10297 ) show
0 72 moveto (10298 ) show
0 60 moveto (10299 ) show
grestore
restore
showpage
%%Page: 112 112
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 4) show
0 648 moveto (10300 int) show
0 636 moveto (10301 main\(void\)) show
0 624 moveto (10302 {) show
0 612 moveto (10303   static char buf[100];) show
0 600 moveto (10304   int fd;) show
0 588 moveto (10305 ) show
0 576 moveto (10306   // Assumes three file descriptors open.) show
0 564 moveto (10307   while\(\(fd = open\("console", O_RDWR\)\) >= 0\){) show
0 552 moveto (10308     if\(fd >= 3\){) show
0 540 moveto (10309       close\(fd\);) show
0 528 moveto (10310       break;) show
0 516 moveto (10311     }) show
0 504 moveto (10312   }) show
0 492 moveto (10313 ) show
0 480 moveto (10314   // Read and run input commands.) show
0 468 moveto (10315   while\(getcmd\(buf, sizeof\(buf\)\) >= 0\){) show
0 456 moveto (10316     if\(buf[0] == 'c' && buf[1] == 'd' && buf[2] == ' '\){) show
0 444 moveto (10317       // Clumsy but will have to do for now.) show
0 432 moveto (10318       // Chdir has no effect on the parent if run in the child.) show
0 420 moveto (10319       buf[strlen\(buf\)-1] = 0;  // chop \\n) show
0 408 moveto (10320       if\(chdir\(buf+3\) < 0\)) show
0 396 moveto (10321         printf\(2, "cannot cd %s\\n", buf+3\);) show
0 384 moveto (10322       continue;) show
0 372 moveto (10323     }) show
0 360 moveto (10324     if\(fork1\(\) == 0\)) show
0 348 moveto (10325       runcmd\(parsecmd\(buf\)\);) show
0 336 moveto (10326     wait\(\);) show
0 324 moveto (10327   }) show
0 312 moveto (10328   exit\(\);) show
0 300 moveto (10329 }) show
0 288 moveto (10330 ) show
0 276 moveto (10331 void) show
0 264 moveto (10332 panic\(char *s\)) show
0 252 moveto (10333 {) show
0 240 moveto (10334   printf\(2, "%s\\n", s\);) show
0 228 moveto (10335   exit\(\);) show
0 216 moveto (10336 }) show
0 204 moveto (10337 ) show
0 192 moveto (10338 int) show
0 180 moveto (10339 fork1\(void\)) show
0 168 moveto (10340 {) show
0 156 moveto (10341   int pid;) show
0 144 moveto (10342 ) show
0 132 moveto (10343   pid = fork\(\);) show
0 120 moveto (10344   if\(pid == -1\)) show
0 108 moveto (10345     panic\("fork"\);) show
0 96 moveto (10346   return pid;) show
0 84 moveto (10347 }) show
0 72 moveto (10348 ) show
0 60 moveto (10349 ) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 5) show
0 648 moveto (10350 // Constructors) show
0 636 moveto (10351 ) show
0 624 moveto (10352 struct cmd*) show
0 612 moveto (10353 execcmd\(void\)) show
0 600 moveto (10354 {) show
0 588 moveto (10355   struct execcmd *cmd;) show
0 576 moveto (10356 ) show
0 564 moveto (10357   cmd = malloc\(sizeof\(*cmd\)\);) show
0 552 moveto (10358   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 540 moveto (10359   cmd->type = EXEC;) show
0 528 moveto (10360   return \(struct cmd*\)cmd;) show
0 516 moveto (10361 }) show
0 504 moveto (10362 ) show
0 492 moveto (10363 struct cmd*) show
0 480 moveto (10364 redircmd\(struct cmd *subcmd, char *file, char *efile, int mode, int fd\)) show
0 468 moveto (10365 {) show
0 456 moveto (10366   struct redircmd *cmd;) show
0 444 moveto (10367 ) show
0 432 moveto (10368   cmd = malloc\(sizeof\(*cmd\)\);) show
0 420 moveto (10369   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 408 moveto (10370   cmd->type = REDIR;) show
0 396 moveto (10371   cmd->cmd = subcmd;) show
0 384 moveto (10372   cmd->file = file;) show
0 372 moveto (10373   cmd->efile = efile;) show
0 360 moveto (10374   cmd->mode = mode;) show
0 348 moveto (10375   cmd->fd = fd;) show
0 336 moveto (10376   return \(struct cmd*\)cmd;) show
0 324 moveto (10377 }) show
0 312 moveto (10378 ) show
0 300 moveto (10379 struct cmd*) show
0 288 moveto (10380 pipecmd\(struct cmd *left, struct cmd *right\)) show
0 276 moveto (10381 {) show
0 264 moveto (10382   struct pipecmd *cmd;) show
0 252 moveto (10383 ) show
0 240 moveto (10384   cmd = malloc\(sizeof\(*cmd\)\);) show
0 228 moveto (10385   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 216 moveto (10386   cmd->type = PIPE;) show
0 204 moveto (10387   cmd->left = left;) show
0 192 moveto (10388   cmd->right = right;) show
0 180 moveto (10389   return \(struct cmd*\)cmd;) show
0 168 moveto (10390 }) show
0 156 moveto (10391 ) show
0 144 moveto (10392 ) show
0 132 moveto (10393 ) show
0 120 moveto (10394 ) show
0 108 moveto (10395 ) show
0 96 moveto (10396 ) show
0 84 moveto (10397 ) show
0 72 moveto (10398 ) show
0 60 moveto (10399 ) show
grestore
restore
showpage
%%Page: 113 113
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 6) show
0 648 moveto (10400 struct cmd*) show
0 636 moveto (10401 listcmd\(struct cmd *left, struct cmd *right\)) show
0 624 moveto (10402 {) show
0 612 moveto (10403   struct listcmd *cmd;) show
0 600 moveto (10404 ) show
0 588 moveto (10405   cmd = malloc\(sizeof\(*cmd\)\);) show
0 576 moveto (10406   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 564 moveto (10407   cmd->type = LIST;) show
0 552 moveto (10408   cmd->left = left;) show
0 540 moveto (10409   cmd->right = right;) show
0 528 moveto (10410   return \(struct cmd*\)cmd;) show
0 516 moveto (10411 }) show
0 504 moveto (10412 ) show
0 492 moveto (10413 struct cmd*) show
0 480 moveto (10414 backcmd\(struct cmd *subcmd\)) show
0 468 moveto (10415 {) show
0 456 moveto (10416   struct backcmd *cmd;) show
0 444 moveto (10417 ) show
0 432 moveto (10418   cmd = malloc\(sizeof\(*cmd\)\);) show
0 420 moveto (10419   memset\(cmd, 0, sizeof\(*cmd\)\);) show
0 408 moveto (10420   cmd->type = BACK;) show
0 396 moveto (10421   cmd->cmd = subcmd;) show
0 384 moveto (10422   return \(struct cmd*\)cmd;) show
0 372 moveto (10423 }) show
0 360 moveto (10424 // Parsing) show
0 348 moveto (10425 ) show
0 336 moveto (10426 char whitespace[] = " \\t\\r\\n\\v";) show
0 324 moveto (10427 char symbols[] = "<|>&;\(\)";) show
0 312 moveto (10428 ) show
0 300 moveto (10429 int) show
0 288 moveto (10430 gettoken\(char **ps, char *es, char **q, char **eq\)) show
0 276 moveto (10431 {) show
0 264 moveto (10432   char *s;) show
0 252 moveto (10433   int ret;) show
0 240 moveto (10434 ) show
0 228 moveto (10435   s = *ps;) show
0 216 moveto (10436   while\(s < es && strchr\(whitespace, *s\)\)) show
0 204 moveto (10437     s++;) show
0 192 moveto (10438   if\(q\)) show
0 180 moveto (10439     *q = s;) show
0 168 moveto (10440   ret = *s;) show
0 156 moveto (10441   switch\(*s\){) show
0 144 moveto (10442   case 0:) show
0 132 moveto (10443     break;) show
0 120 moveto (10444   case '|':) show
0 108 moveto (10445   case '\(':) show
0 96 moveto (10446   case '\)':) show
0 84 moveto (10447   case ';':) show
0 72 moveto (10448   case '&':) show
0 60 moveto (10449   case '<':) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 7) show
0 648 moveto (10450     s++;) show
0 636 moveto (10451     break;) show
0 624 moveto (10452   case '>':) show
0 612 moveto (10453     s++;) show
0 600 moveto (10454     if\(*s == '>'\){) show
0 588 moveto (10455       ret = '+';) show
0 576 moveto (10456       s++;) show
0 564 moveto (10457     }) show
0 552 moveto (10458     break;) show
0 540 moveto (10459   default:) show
0 528 moveto (10460     ret = 'a';) show
0 516 moveto (10461     while\(s < es && !strchr\(whitespace, *s\) && !strchr\(symbols, *s\)\)) show
0 504 moveto (10462       s++;) show
0 492 moveto (10463     break;) show
0 480 moveto (10464   }) show
0 468 moveto (10465   if\(eq\)) show
0 456 moveto (10466     *eq = s;) show
0 444 moveto (10467 ) show
0 432 moveto (10468   while\(s < es && strchr\(whitespace, *s\)\)) show
0 420 moveto (10469     s++;) show
0 408 moveto (10470   *ps = s;) show
0 396 moveto (10471   return ret;) show
0 384 moveto (10472 }) show
0 372 moveto (10473 ) show
0 360 moveto (10474 int) show
0 348 moveto (10475 peek\(char **ps, char *es, char *toks\)) show
0 336 moveto (10476 {) show
0 324 moveto (10477   char *s;) show
0 312 moveto (10478 ) show
0 300 moveto (10479   s = *ps;) show
0 288 moveto (10480   while\(s < es && strchr\(whitespace, *s\)\)) show
0 276 moveto (10481     s++;) show
0 264 moveto (10482   *ps = s;) show
0 252 moveto (10483   return *s && strchr\(toks, *s\);) show
0 240 moveto (10484 }) show
0 228 moveto (10485 ) show
0 216 moveto (10486 ) show
0 204 moveto (10487 ) show
0 192 moveto (10488 ) show
0 180 moveto (10489 ) show
0 168 moveto (10490 ) show
0 156 moveto (10491 ) show
0 144 moveto (10492 ) show
0 132 moveto (10493 ) show
0 120 moveto (10494 ) show
0 108 moveto (10495 ) show
0 96 moveto (10496 ) show
0 84 moveto (10497 ) show
0 72 moveto (10498 ) show
0 60 moveto (10499 ) show
grestore
restore
showpage
%%Page: 114 114
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 8) show
0 648 moveto (10500 struct cmd *parseline\(char**, char*\);) show
0 636 moveto (10501 struct cmd *parsepipe\(char**, char*\);) show
0 624 moveto (10502 struct cmd *parseexec\(char**, char*\);) show
0 612 moveto (10503 struct cmd *nulterminate\(struct cmd*\);) show
0 600 moveto (10504 ) show
0 588 moveto (10505 struct cmd*) show
0 576 moveto (10506 parsecmd\(char *s\)) show
0 564 moveto (10507 {) show
0 552 moveto (10508   char *es;) show
0 540 moveto (10509   struct cmd *cmd;) show
0 528 moveto (10510 ) show
0 516 moveto (10511   es = s + strlen\(s\);) show
0 504 moveto (10512   cmd = parseline\(&s, es\);) show
0 492 moveto (10513   peek\(&s, es, ""\);) show
0 480 moveto (10514   if\(s != es\){) show
0 468 moveto (10515     printf\(2, "leftovers: %s\\n", s\);) show
0 456 moveto (10516     panic\("syntax"\);) show
0 444 moveto (10517   }) show
0 432 moveto (10518   nulterminate\(cmd\);) show
0 420 moveto (10519   return cmd;) show
0 408 moveto (10520 }) show
0 396 moveto (10521 ) show
0 384 moveto (10522 struct cmd*) show
0 372 moveto (10523 parseline\(char **ps, char *es\)) show
0 360 moveto (10524 {) show
0 348 moveto (10525   struct cmd *cmd;) show
0 336 moveto (10526 ) show
0 324 moveto (10527   cmd = parsepipe\(ps, es\);) show
0 312 moveto (10528   while\(peek\(ps, es, "&"\)\){) show
0 300 moveto (10529     gettoken\(ps, es, 0, 0\);) show
0 288 moveto (10530     cmd = backcmd\(cmd\);) show
0 276 moveto (10531   }) show
0 264 moveto (10532   if\(peek\(ps, es, ";"\)\){) show
0 252 moveto (10533     gettoken\(ps, es, 0, 0\);) show
0 240 moveto (10534     cmd = listcmd\(cmd, parseline\(ps, es\)\);) show
0 228 moveto (10535   }) show
0 216 moveto (10536   return cmd;) show
0 204 moveto (10537 }) show
0 192 moveto (10538 ) show
0 180 moveto (10539 ) show
0 168 moveto (10540 ) show
0 156 moveto (10541 ) show
0 144 moveto (10542 ) show
0 132 moveto (10543 ) show
0 120 moveto (10544 ) show
0 108 moveto (10545 ) show
0 96 moveto (10546 ) show
0 84 moveto (10547 ) show
0 72 moveto (10548 ) show
0 60 moveto (10549 ) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 9) show
0 648 moveto (10550 struct cmd*) show
0 636 moveto (10551 parsepipe\(char **ps, char *es\)) show
0 624 moveto (10552 {) show
0 612 moveto (10553   struct cmd *cmd;) show
0 600 moveto (10554 ) show
0 588 moveto (10555   cmd = parseexec\(ps, es\);) show
0 576 moveto (10556   if\(peek\(ps, es, "|"\)\){) show
0 564 moveto (10557     gettoken\(ps, es, 0, 0\);) show
0 552 moveto (10558     cmd = pipecmd\(cmd, parsepipe\(ps, es\)\);) show
0 540 moveto (10559   }) show
0 528 moveto (10560   return cmd;) show
0 516 moveto (10561 }) show
0 504 moveto (10562 ) show
0 492 moveto (10563 struct cmd*) show
0 480 moveto (10564 parseredirs\(struct cmd *cmd, char **ps, char *es\)) show
0 468 moveto (10565 {) show
0 456 moveto (10566   int tok;) show
0 444 moveto (10567   char *q, *eq;) show
0 432 moveto (10568 ) show
0 420 moveto (10569   while\(peek\(ps, es, "<>"\)\){) show
0 408 moveto (10570     tok = gettoken\(ps, es, 0, 0\);) show
0 396 moveto (10571     if\(gettoken\(ps, es, &q, &eq\) != 'a'\)) show
0 384 moveto (10572       panic\("missing file for redirection"\);) show
0 372 moveto (10573     switch\(tok\){) show
0 360 moveto (10574     case '<':) show
0 348 moveto (10575       cmd = redircmd\(cmd, q, eq, O_RDONLY, 0\);) show
0 336 moveto (10576       break;) show
0 324 moveto (10577     case '>':) show
0 312 moveto (10578       cmd = redircmd\(cmd, q, eq, O_WRONLY|O_CREATE, 1\);) show
0 300 moveto (10579       break;) show
0 288 moveto (10580     case '+':  // >>) show
0 276 moveto (10581       cmd = redircmd\(cmd, q, eq, O_WRONLY|O_CREATE, 1\);) show
0 264 moveto (10582       break;) show
0 252 moveto (10583     }) show
0 240 moveto (10584   }) show
0 228 moveto (10585   return cmd;) show
0 216 moveto (10586 }) show
0 204 moveto (10587 ) show
0 192 moveto (10588 ) show
0 180 moveto (10589 ) show
0 168 moveto (10590 ) show
0 156 moveto (10591 ) show
0 144 moveto (10592 ) show
0 132 moveto (10593 ) show
0 120 moveto (10594 ) show
0 108 moveto (10595 ) show
0 96 moveto (10596 ) show
0 84 moveto (10597 ) show
0 72 moveto (10598 ) show
0 60 moveto (10599 ) show
grestore
restore
showpage
%%Page: 115 115
save
gsave
18 742 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 10) show
0 648 moveto (10600 struct cmd*) show
0 636 moveto (10601 parseblock\(char **ps, char *es\)) show
0 624 moveto (10602 {) show
0 612 moveto (10603   struct cmd *cmd;) show
0 600 moveto (10604 ) show
0 588 moveto (10605   if\(!peek\(ps, es, "\("\)\)) show
0 576 moveto (10606     panic\("parseblock"\);) show
0 564 moveto (10607   gettoken\(ps, es, 0, 0\);) show
0 552 moveto (10608   cmd = parseline\(ps, es\);) show
0 540 moveto (10609   if\(!peek\(ps, es, "\)"\)\)) show
0 528 moveto (10610     panic\("syntax - missing \)"\);) show
0 516 moveto (10611   gettoken\(ps, es, 0, 0\);) show
0 504 moveto (10612   cmd = parseredirs\(cmd, ps, es\);) show
0 492 moveto (10613   return cmd;) show
0 480 moveto (10614 }) show
0 468 moveto (10615 ) show
0 456 moveto (10616 struct cmd*) show
0 444 moveto (10617 parseexec\(char **ps, char *es\)) show
0 432 moveto (10618 {) show
0 420 moveto (10619   char *q, *eq;) show
0 408 moveto (10620   int tok, argc;) show
0 396 moveto (10621   struct execcmd *cmd;) show
0 384 moveto (10622   struct cmd *ret;) show
0 372 moveto (10623 ) show
0 360 moveto (10624   if\(peek\(ps, es, "\("\)\)) show
0 348 moveto (10625     return parseblock\(ps, es\);) show
0 336 moveto (10626 ) show
0 324 moveto (10627   ret = execcmd\(\);) show
0 312 moveto (10628   cmd = \(struct execcmd*\)ret;) show
0 300 moveto (10629 ) show
0 288 moveto (10630   argc = 0;) show
0 276 moveto (10631   ret = parseredirs\(ret, ps, es\);) show
0 264 moveto (10632   while\(!peek\(ps, es, "|\)&;"\)\){) show
0 252 moveto (10633     if\(\(tok=gettoken\(ps, es, &q, &eq\)\) == 0\)) show
0 240 moveto (10634       break;) show
0 228 moveto (10635     if\(tok != 'a'\)) show
0 216 moveto (10636       panic\("syntax"\);) show
0 204 moveto (10637     cmd->argv[argc] = q;) show
0 192 moveto (10638     cmd->eargv[argc] = eq;) show
0 180 moveto (10639     argc++;) show
0 168 moveto (10640     if\(argc >= MAXARGS\)) show
0 156 moveto (10641       panic\("too many args"\);) show
0 144 moveto (10642     ret = parseredirs\(ret, ps, es\);) show
0 132 moveto (10643   }) show
0 120 moveto (10644   cmd->argv[argc] = 0;) show
0 108 moveto (10645   cmd->eargv[argc] = 0;) show
0 96 moveto (10646   return ret;) show
0 84 moveto (10647 }) show
0 72 moveto (10648 ) show
0 60 moveto (10649 ) show
grestore
gsave
18 396 translate
-90 rotate
0 0 moveto 0 576 rlineto 346 0 rlineto 0 -576 rlineto closepath clip
346 80 mp_a_x mul div 576 720 div scale
4 7 translate 338 346 div 712 720 div scale
textfont setfont
mp_a_x 684 moveto (4  9 17:56 2009  xv6/sh.c  Page 11) show
0 648 moveto (10650 // NUL-terminate all the counted strings.) show
0 636 moveto (10651 struct cmd*) show
0 624 moveto (10652 nulterminate\(struct cmd *cmd\)) show
0 612 moveto (10653 {) show
0 600 moveto (10654   int i;) show
0 588 moveto (10655   struct backcmd *bcmd;) show
0 576 moveto (10656   struct execcmd *ecmd;) show
0 564 moveto (10657   struct listcmd *lcmd;) show
0 552 moveto (10658   struct pipecmd *pcmd;) show
0 540 moveto (10659   struct redircmd *rcmd;) show
0 528 moveto (10660 ) show
0 516 moveto (10661   if\(cmd == 0\)) show
0 504 moveto (10662     return 0;) show
0 492 moveto (10663 ) show
0 480 moveto (10664   switch\(cmd->type\){) show
0 468 moveto (10665   case EXEC:) show
0 456 moveto (10666     ecmd = \(struct execcmd*\)cmd;) show
0 444 moveto (10667     for\(i=0; ecmd->argv[i]; i++\)) show
0 432 moveto (10668       *ecmd->eargv[i] = 0;) show
0 420 moveto (10669     break;) show
0 408 moveto (10670 ) show
0 396 moveto (10671   case REDIR:) show
0 384 moveto (10672     rcmd = \(struct redircmd*\)cmd;) show
0 372 moveto (10673     nulterminate\(rcmd->cmd\);) show
0 360 moveto (10674     *rcmd->efile = 0;) show
0 348 moveto (10675     break;) show
0 336 moveto (10676 ) show
0 324 moveto (10677   case PIPE:) show
0 312 moveto (10678     pcmd = \(struct pipecmd*\)cmd;) show
0 300 moveto (10679     nulterminate\(pcmd->left\);) show
0 288 moveto (10680     nulterminate\(pcmd->right\);) show
0 276 moveto (10681     break;) show
0 264 moveto (10682 ) show
0 252 moveto (10683   case LIST:) show
0 240 moveto (10684     lcmd = \(struct listcmd*\)cmd;) show
0 228 moveto (10685     nulterminate\(lcmd->left\);) show
0 216 moveto (10686     nulterminate\(lcmd->right\);) show
0 204 moveto (10687     break;) show
0 192 moveto (10688 ) show
0 180 moveto (10689   case BACK:) show
0 168 moveto (10690     bcmd = \(struct backcmd*\)cmd;) show
0 156 moveto (10691     nulterminate\(bcmd->cmd\);) show
0 144 moveto (10692     break;) show
0 132 moveto (10693   }) show
0 120 moveto (10694   return cmd;) show
0 108 moveto (10695 }) show
0 96 moveto (10696 ) show
0 84 moveto (10697 ) show
0 72 moveto (10698 ) show
0 60 moveto (10699 ) show
grestore
restore
showpage
%%Trailer
%%Pages: 116
